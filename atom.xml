<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å“€æ®¿firstã®ç©ºé—´</title>
  
  <subtitle>æ–‡å­—avg+æ‚¬ç–‘æ¨ç†çˆ±å¥½è€…</subtitle>
  <link href="http://aidianfirst.com/atom.xml" rel="self"/>
  
  <link href="http://aidianfirst.com/"/>
  <updated>2023-12-08T09:34:11.602Z</updated>
  <id>http://aidianfirst.com/</id>
  
  <author>
    <name>aidianfirst</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Springä¸»è¦åŠ è½½é“¾è·¯åˆ†æ</title>
    <link href="http://aidianfirst.com/2023/12/08/%E5%B7%A5%E4%BD%9C%20&amp;%20%E6%BA%90%E7%A0%81/Spring%E4%B8%BB%E8%A6%81%E5%8A%A0%E8%BD%BD%E9%93%BE%E8%B7%AF%E5%88%86%E6%9E%90/"/>
    <id>http://aidianfirst.com/2023/12/08/%E5%B7%A5%E4%BD%9C%20&amp;%20%E6%BA%90%E7%A0%81/Spring%E4%B8%BB%E8%A6%81%E5%8A%A0%E8%BD%BD%E9%93%BE%E8%B7%AF%E5%88%86%E6%9E%90/</id>
    <published>2023-12-08T09:33:35.781Z</published>
    <updated>2023-12-08T09:34:11.602Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Springä¸»è¦åŠ è½½é“¾è·¯åˆ†æ"><a href="#Springä¸»è¦åŠ è½½é“¾è·¯åˆ†æ" class="headerlink" title="Springä¸»è¦åŠ è½½é“¾è·¯åˆ†æ"></a>Springä¸»è¦åŠ è½½é“¾è·¯åˆ†æ</h1><h2 id="åŒ…æ‰«æ"><a href="#åŒ…æ‰«æ" class="headerlink" title="åŒ…æ‰«æ"></a>åŒ…æ‰«æ</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">relativePath</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>application.run =&gt; prepareEnvironment å‡†å¤‡ç¯å¢ƒ</p><ul><li>å‘å¸ƒäº‹ä»¶ BootstrapApplicationListener =&gt; bootstrap ä¼šè§¦å‘ä¸€ä¸ªapplication.run</li></ul></li><li><p>bootstrapçš„runæ‰§è¡Œå®Œåï¼Œç»§ç»­æ‰§è¡ŒåŸapplication.runï¼Œä¹Ÿå°±æ˜¯prepareEnvironment å¤„ç†å®Œåï¼ŒrefreshContextåˆ·æ–°ä¸Šä¸‹æ–‡</p></li><li><p>AbstractApplicationContext #invokeBeanFactoryPostProcessors</p></li><li><p>PostProcessorRegistrationDelegate #invokeBeanDefinitionRegistryPostProcessors</p><ul><li>for åç½®å¤„ç†å™¨ #postProcessBeanDefinitionRegistry</li></ul></li><li><p>ConfigurationClassPostProcessor #processConfigBeanDefinitions</p><ul><li>BeanDefinitionRegistryæ³¨å†Œè¡¨ è·å–åˆå§‹BeanDefinition</li><li>for æ ¡éªŒè·å–å¯ç”¨é…ç½®ç±»ï¼Œä¸€èˆ¬éƒ½æ˜¯é¡¹ç›®çš„å¯åŠ¨ç±»</li><li>åˆ†æé…ç½®ç±» 319è¡Œ <strong>parser.parse(â€¦) =&gt; processConfigurationClass()</strong></li></ul></li><li><p>ConfigurationClassParser <strong>#doProcessConfigurationClass</strong> 289è¡Œå¼€å§‹æ ¹æ®æ‰«æè·¯å¾„å¼€å§‹æ‰«æåŒ…</p><ul><li>296è¡Œ ComponentScanAnnotationParser #parse åŒ…æ‰«æè§£æï¼Œæ ¹æ®ComponentScanæ³¨è§£é…ç½®å¯¹æ‰«æå™¨è¿›è¡Œé…ç½®ï¼Œç„¶åæ‰§è¡Œæ‰«æ scanner.doScan(â€¦)</li><li>ClassPathBeanDefinitionScanner #doscan é€šè¿‡ç±»åŠ è½½å™¨ä»¥åŠé…ç½®è·¯å¾„ï¼Œä»ç¼–è¯‘åæ–‡ä»¶ä¸­è·å–ï¼Œè·å–@Componentç›¸å…³ç±»ï¼Œä¸æ»¡è¶³åˆ™è¿‡æ»¤ï¼Œæœ€åè¿”å›å…¨éƒ¨å¯è‡ªåŠ¨è£…é…ç±»</li></ul></li><li><p>for å¤„ç†åŒ…æ‰«æç»“æœé›† </p><ul><li><p>è‡ªåŠ¨è£…é…ç›¸å…³ç±»éƒ½ä¼šé€šè¿‡æ ¡éªŒï¼Œä¸»è¦å…³æ³¨ä»¥ä¸‹æ–¹æ³•</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ConfigurationClassUtils </span><br><span class="line">#checkConfigurationClassCandidate()</span><br><span class="line">#isConfigurationCandidate()</span><br></pre></td></tr></table></figure></li><li><p>ç¼“å­˜åˆ°å…ƒæ•°æ®è¯»å–å·¥å‚ metadataReaderFactory</p></li><li><p><strong>processConfigurationClass()</strong> é€’å½’å¤„ç†</p></li></ul></li></ul><h2 id="é…ç½®ç±»å¤„ç†é€»è¾‘"><a href="#é…ç½®ç±»å¤„ç†é€»è¾‘" class="headerlink" title="é…ç½®ç±»å¤„ç†é€»è¾‘"></a>é…ç½®ç±»å¤„ç†é€»è¾‘</h2><ul><li><p><strong>ConfigurationClassParser #processConfigurationClass</strong></p><ul><li>è·å–é…ç½®ç±»ç¼“å­˜ configurationClasses<ul><li>å·²å­˜åœ¨ç¼“å­˜ï¼Œé…ç½®ç±»ä¸ @Imported æœ‰å…³ï¼Œåˆ™æ‰§è¡Œå®Œç›¸å…³é€»è¾‘åç›´æ¥<strong>return</strong></li><li>å·²å­˜åœ¨ç¼“å­˜ï¼Œé…ç½®ç±»ä¸ @Imported æ— å…³ï¼Œè®²é…ç½®ç±»ä»ç¼“å­˜ä¸­å»é™¤ï¼Œç»§ç»­æ‰§è¡Œé‡æ–°åŠ è½½ï¼ˆå…·ä½“å¤„ç†åŸå› æºç ä¸­æœ‰æ³¨é‡Šï¼‰</li></ul></li><li><strong>é€’å½’å¤„ç†é…ç½®ç±»åŠå…¶çˆ¶ç±» #doProcessConfigurationClass</strong> æœ‰çˆ¶ç±»åˆ™é€šè¿‡æ–¹æ³•è¿”å›å€¼èµ‹å€¼ï¼Œé€’å½’å¤„ç†</li><li>é…ç½®ç±»æ”¾å…¥ç¼“å­˜ configurationClasses</li></ul></li><li><p><strong>ConfigurationClassParser #doProcessConfigurationClass</strong></p><ul><li><p>é…ç½®ç±»æ˜¯å¦æœ‰ @Component ï¼Œæœ‰åˆ™å…ˆé€’å½’å¤„ç†å†…éƒ¨ç±» #processMemberClasses</p><ul><li>TODO </li></ul></li><li><p>å¤„ç† @PropertySource</p></li><li><p>å¤„ç† @ComponentScan åŒ…æ‰«æ</p><ul><li><p><strong>ComponentScanAnnotationParser #parse</strong> åŒ…æ‰«æè§£æï¼Œæ ¹æ®ComponentScanæ³¨è§£é…ç½®å¯¹æ‰«æå™¨è¿›è¡Œé…ç½®ï¼Œç„¶åæ‰§è¡Œæ‰«æ scanner.doScan(â€¦)</p><p><strong>ClassPathBeanDefinitionScanner #doscan =&gt; #findCandidateComponents</strong> é€šè¿‡ç±»åŠ è½½å™¨ä»¥åŠé…ç½®è·¯å¾„ï¼Œä»ç¼–è¯‘åæ–‡ä»¶ä¸­è·å–ã€‚</p><p><strong>#isCandidateComponent(MetadataReader metadataReader)</strong> è·å–å¯è‡ªåŠ¨è£…é…ç±»ï¼ŒåŒ…æ‹¬ @Componentï¼Œå…·ä½“çœ‹æ–¹æ³•å®ç°ï¼Œå…¶ä¸­includeFiltersåŒ…å«äº†@Component</p></li><li><p>for å¤„ç†åŒ…æ‰«æç»“æœé›† </p><ol><li><p> è½¬æ¢æˆBeanDefinition</p></li><li><p>æ ¡éªŒBeanDefinitionï¼Œä¸»è¦å…³æ³¨ä»¥ä¸‹æ–¹æ³•ï¼Œä¸€èˆ¬è‡ªåŠ¨è£…é…ç±»éƒ½ä¼šé€šè¿‡æ ¡éªŒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ConfigurationClassUtils </span><br><span class="line">#checkConfigurationClassCandidate()</span><br><span class="line">#isConfigurationCandidate()</span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡æ ¡éªŒåè§£æç›¸åº”BeanDefinition #parse(String className, String beanName)</p></li><li><p>ç¼“å­˜åˆ°å…ƒæ•°æ®è¯»å–å·¥å‚ metadataReaderFactory</p></li><li><p><strong>processConfigurationClass() é€’å½’å¤„ç†</strong></p></li></ol></li></ul></li><li><p>å¤„ç† @Import</p><ul><li><p>å…ˆé€šè¿‡ #getImports() è·å–å¯¼å…¥é…ç½®ç±»ï¼Œå½“å‰ç±»ä¸Šæ³¨è§£ =&gt; æ³¨è§£ä¸Šçš„æ³¨è§£ï¼Œé€’å½’è·å–ç›¸å…³æ³¨è§£æœ‰è¿‡æ»¤é€»è¾‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ConfigurationClassParser</span></span><br><span class="line">  Predicate&lt;String&gt; DEFAULT_EXCLUSION_FILTER = className -&gt;</span><br><span class="line">  (className.startsWith(<span class="string">&quot;java.lang.annotation.&quot;</span>) || className.startsWith(<span class="string">&quot;org.springframework.stereotype.&quot;</span>));</span><br></pre></td></tr></table></figure></li><li><p>@importå¯¼å…¥çš„é…ç½®ç±»ä¹Ÿä¼šåŠ å…¥ç¼“å­˜ metadataReaderFactory</p></li></ul></li><li><p>å¤„ç† @ImportResource</p></li><li><p>å¤„ç† @Bean</p><ul><li>è·å–å…¨éƒ¨ @Bean ç›¸å…³æ–¹æ³•</li><li>å½“ç›¸å…³æ–¹æ³•ä¸ºå¤æ•°æ—¶ï¼Œä¸”å…ƒæ•°æ®æ˜¯ç”±åå°„ç”Ÿæˆï¼ˆoriginal instanceof StandardAnnotationMetadataï¼‰ã€‚å› ä¸ºåå°„æ— éœ€ï¼Œéœ€è¦æ’åº</li><li>æ ¹æ®@Beanç»“æœé›†ï¼Œç»™é…ç½®ç±»æ·»åŠ  BeanMethod</li></ul></li><li><p>å¤„ç†æ¥å£é»˜è®¤æ–¹æ³•</p></li><li><p>å¤„ç†çˆ¶ç±»</p><ul><li>knownSuperclasses ç¼“å­˜å·²å¤„ç†è¿‡çš„çˆ¶ç±»</li><li>æœ‰çˆ¶ç±»å°±è¿”å›çˆ¶ç±»ï¼Œå¤–å±‚å¾ªç¯é€’å½’å¤„ç†çˆ¶ç±» <strong>return sourceClass.getSuperClass();</strong></li></ul></li><li><p>æ²¡æœ‰çˆ¶ç±»è¿”å›nullï¼Œç»“æŸé€’å½’ <strong>return null;</strong></p></li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Springä¸»è¦åŠ è½½é“¾è·¯åˆ†æ&quot;&gt;&lt;a href=&quot;#Springä¸»è¦åŠ è½½é“¾è·¯åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;Springä¸»è¦åŠ è½½é“¾è·¯åˆ†æ&quot;&gt;&lt;/a&gt;Springä¸»è¦åŠ è½½é“¾è·¯åˆ†æ&lt;/h1&gt;&lt;h2 id=&quot;åŒ…æ‰«æ&quot;&gt;&lt;a href=&quot;#åŒ…æ‰«</summary>
      
    
    
    
    <category term="å·¥ä½œ &amp; æºç " scheme="http://aidianfirst.com/categories/%E5%B7%A5%E4%BD%9C-%E6%BA%90%E7%A0%81/"/>
    
    
  </entry>
  
  <entry>
    <title>æ•£è£…çŸ¥è¯†ç‚¹</title>
    <link href="http://aidianfirst.com/2023/07/30/%E5%B7%A5%E4%BD%9C%20&amp;%20%E6%BA%90%E7%A0%81/%E6%95%A3%E8%A3%85%E7%9F%A5%E8%AF%86%E7%82%B9/"/>
    <id>http://aidianfirst.com/2023/07/30/%E5%B7%A5%E4%BD%9C%20&amp;%20%E6%BA%90%E7%A0%81/%E6%95%A3%E8%A3%85%E7%9F%A5%E8%AF%86%E7%82%B9/</id>
    <published>2023-07-30T11:20:17.737Z</published>
    <updated>2023-12-08T09:33:27.382Z</updated>
    
    <content type="html"><![CDATA[<h1 id="OncePerRequestFilterï¼ˆè¿‡æ»¤å™¨Filterï¼‰"><a href="#OncePerRequestFilterï¼ˆè¿‡æ»¤å™¨Filterï¼‰" class="headerlink" title="OncePerRequestFilterï¼ˆè¿‡æ»¤å™¨Filterï¼‰"></a>OncePerRequestFilterï¼ˆè¿‡æ»¤å™¨Filterï¼‰</h1><p>Springé’ˆå¯¹ServletåŸç”Ÿè¿‡æ»¤å™¨Filterçš„è¿›ä¸€æ­¥å°è£…ã€‚é€šè¿‡ç»§æ‰¿OncePerRequestFilterï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œä¸”æ¯ä¸ªè¯·æ±‚éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚å…³äºé‡å†™æ–¹æ³•ï¼Œ<code>init</code>ã€<code>doFilter</code>ä½œä¸ºé»˜è®¤å®ç°ï¼Œæœ‰finalä¿®é¥°ï¼Œæˆ‘ä»¬æƒ³è¿›è¡Œæ‰©å±•ï¼Œéœ€è¦é‡å†™<code>initFilterBean</code>ã€<code>doFilterInternal</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é‡å†™doFilterInternalè¿›è¡Œä¸šåŠ¡æ‰©å±•ï¼Œåˆ«å¿˜äº†æœ€åè¿›è¡Œè¿‡æ»¤é“¾è°ƒç”¨</span></span><br><span class="line">filterChain.doFilter(request, response);</span><br></pre></td></tr></table></figure><h1 id="HandlerInterceptorAdapterï¼ˆæ‹¦æˆªå™¨Interceptorï¼‰"><a href="#HandlerInterceptorAdapterï¼ˆæ‹¦æˆªå™¨Interceptorï¼‰" class="headerlink" title="HandlerInterceptorAdapterï¼ˆæ‹¦æˆªå™¨Interceptorï¼‰"></a>HandlerInterceptorAdapterï¼ˆæ‹¦æˆªå™¨Interceptorï¼‰</h1><p>HandlerInterceptorAdapteræ˜¯Springæä¾›çš„ä¸€ç§æ‹¦æˆªå™¨é€‚é…å™¨ï¼Œé€šè¿‡ç»§æ‰¿è¯¥æŠ½è±¡ç±»è‡ªå®šä¹‰æ‹¦æˆªå™¨ã€‚</p><p>ä¸»è¦å®ç°ä¸‰ä¸ªæ¥å£ï¼š<code>preHandle</code>ã€<code>postHandle</code>ã€<code>afterCompletion</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">preHandleï¼šå‰ç½®å¤„ç†ï¼ŒControlleræ‰§è¡Œå‰</span><br><span class="line">postHandleï¼šåç½®å¤„ç†ï¼ŒControlleræ‰§è¡Œå®Œæˆï¼Œå¯ä»¥æ ¹æ®æ–¹æ³•å‚æ•°modelAndViewæ“ä½œæ¸²æŸ“è§†å›¾</span><br><span class="line">afterCompletionï¼šè¯·æ±‚å›è°ƒå®Œæ¯•ï¼Œå¯è¿›è¡Œèµ„æºé‡Šæ”¾ï¼Œæ¯”å¦‚å¤„ç†Filterä¸­setçš„ThreadLocal</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰é…ç½®ç±»ï¼Œå°†æ‹¦æˆªå™¨åŠ å…¥è°ƒç”¨é“¾è·¯ï¼Œå®ç°WebMvcConfigureræˆ–WebMvcConfigurationSupportè¿›è¡Œå®ç°</p><p>WebMvcConfigurerå¯ä»¥è¿›è¡Œå¤šå®ç°ï¼ŒWebMvcConfigurationSupportå¤šå®ç°ä¼šäº§ç”Ÿå†²çª</p><p><a href="https://zhuanlan.zhihu.com/p/344541013">è‡ªå®šä¹‰SpringBooté»˜è®¤MVCé…ç½®ï¼Ÿå¥½å‡ ä¸ªå‘ï¼Œé¿ä¸€é¿ - çŸ¥ä¹ (zhihu.com)</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">WebMvcAutoConfiguration WebMvcConfigurationSupporté»˜è®¤å®ç°DelegatingWebMvcConfigurationï¼ŒDelegatingä¼šæŠŠæ‰€æœ‰WebMvcConfigurerçš„å®ç°è¿›è¡Œéå†ï¼Œç„¶ååŠ å…¥é…ç½®ã€‚</span><br><span class="line">è‡ªå·±å®ç°ä¼šè¦†ç›–DelegatingWebMvcConfigurationçš„æ“ä½œï¼Œå¯¼è‡´WebMvcConfigurerçš„å®ç°è¢«å¿½ç•¥</span><br><span class="line"></span><br><span class="line">æœ‰ä¸ªç–‘é—®ï¼Œä¸ºä»€ä¹ˆDelegatingWebMvcConfiguration è¿™ä¸ªå®ç°ç±»ä¸€å®šæ™šäºWebMvcAutoConfiguration è¢«æ³¨å…¥ï¼Œå®ƒä¸æ˜¯ä¹Ÿè¢«@configurationä¿®é¥°äº†å—ã€‚ä¹Ÿå°±DelegatingWebMvcConfiguration å’Œæˆ‘ä»¬è‡ªå·±çš„å®ç°ç±»åœ¨æ³¨å…¥æ—¶å…ˆåé¡ºåºåˆ°åº•æœ‰ä½•å·®å¼‚ï¼Œä¸ºä»€ä¹ˆspringèƒ½ä¿è¯WebMvcAutoConfiguration æ³¨å…¥æ—¶WebMvcAutoConfiguration ä¸€å®šæ²¡æœ‰è¢«æ³¨å…¥</span><br></pre></td></tr></table></figure><h1 id="RequestContextHolders"><a href="#RequestContextHolders" class="headerlink" title="RequestContextHolders"></a>RequestContextHolders</h1><p>å¯éšæ—¶è·å–è¯·æ±‚ä¸å“åº”ï¼Œä¸ç”¨controllerå±‚å¾€ä¸‹ä¼ ã€‚</p><p>å¯è‡ªè¡Œå°è£…httpå·¥å…·ç±»ï¼Œegï¼š<a href="https://www.jianshu.com/p/83a872d8db92">https://www.jianshu.com/p/83a872d8db92</a></p><h1 id="MDC"><a href="#MDC" class="headerlink" title="MDC"></a>MDC</h1><p>åˆ†å¸ƒå¼æ—¥å¿—ï¼Ÿ</p><h1 id="TransmittableThreadLocalï¼ˆè§£å†³å¼‚æ­¥ä¸Šä¸‹æ–‡ä¼ é€’é—®é¢˜ï¼‰"><a href="#TransmittableThreadLocalï¼ˆè§£å†³å¼‚æ­¥ä¸Šä¸‹æ–‡ä¼ é€’é—®é¢˜ï¼‰" class="headerlink" title="TransmittableThreadLocalï¼ˆè§£å†³å¼‚æ­¥ä¸Šä¸‹æ–‡ä¼ é€’é—®é¢˜ï¼‰"></a>TransmittableThreadLocalï¼ˆè§£å†³å¼‚æ­¥ä¸Šä¸‹æ–‡ä¼ é€’é—®é¢˜ï¼‰</h1><h1 id="AOPåŠ¨æ€ä»£ç†ï¼Œthiså¼•ç”¨ä¸ä»£ç†åˆ™å¤±æ•ˆ"><a href="#AOPåŠ¨æ€ä»£ç†ï¼Œthiså¼•ç”¨ä¸ä»£ç†åˆ™å¤±æ•ˆ" class="headerlink" title="AOPåŠ¨æ€ä»£ç†ï¼Œthiså¼•ç”¨ä¸ä»£ç†åˆ™å¤±æ•ˆ"></a>AOPåŠ¨æ€ä»£ç†ï¼Œthiså¼•ç”¨ä¸ä»£ç†åˆ™å¤±æ•ˆ</h1><h1 id="SmartInitializingSingleton-ï¼ˆåç½®å¤„ç†è§£å†³å¾ªç¯ä¾èµ–ï¼‰"><a href="#SmartInitializingSingleton-ï¼ˆåç½®å¤„ç†è§£å†³å¾ªç¯ä¾èµ–ï¼‰" class="headerlink" title="SmartInitializingSingleton ï¼ˆåç½®å¤„ç†è§£å†³å¾ªç¯ä¾èµ–ï¼‰"></a>SmartInitializingSingleton ï¼ˆåç½®å¤„ç†è§£å†³å¾ªç¯ä¾èµ–ï¼‰</h1><h1 id="HandlerMethodArgumentResolver-ï¼ˆè‡ªå®šä¹‰æ¥æ”¶å‰ç«¯ä¼ å‚å®ç°ï¼‰"><a href="#HandlerMethodArgumentResolver-ï¼ˆè‡ªå®šä¹‰æ¥æ”¶å‰ç«¯ä¼ å‚å®ç°ï¼‰" class="headerlink" title="HandlerMethodArgumentResolver ï¼ˆè‡ªå®šä¹‰æ¥æ”¶å‰ç«¯ä¼ å‚å®ç°ï¼‰"></a>HandlerMethodArgumentResolver ï¼ˆè‡ªå®šä¹‰æ¥æ”¶å‰ç«¯ä¼ å‚å®ç°ï¼‰</h1><p><a href="https://blog.csdn.net/dear_little_bear/article/details/104565425">https://blog.csdn.net/dear_little_bear/article/details/104565425</a></p><h2 id="WebDataBinder-å‚æ•°è½¬æ¢"><a href="#WebDataBinder-å‚æ•°è½¬æ¢" class="headerlink" title="WebDataBinder å‚æ•°è½¬æ¢"></a>WebDataBinder å‚æ•°è½¬æ¢</h2><h2 id="WebMvcConfigurer"><a href="#WebMvcConfigurer" class="headerlink" title="WebMvcConfigurer"></a>WebMvcConfigurer</h2><h1 id="AliasForï¼ˆåˆ«åï¼Œå°è£…æ³¨è§£ï¼‰"><a href="#AliasForï¼ˆåˆ«åï¼Œå°è£…æ³¨è§£ï¼‰" class="headerlink" title="@AliasForï¼ˆåˆ«åï¼Œå°è£…æ³¨è§£ï¼‰"></a>@AliasForï¼ˆåˆ«åï¼Œå°è£…æ³¨è§£ï¼‰</h1><h1 id="EventListener-springäº‹ä»¶ç›‘å¬æœºåˆ¶"><a href="#EventListener-springäº‹ä»¶ç›‘å¬æœºåˆ¶" class="headerlink" title="@EventListener springäº‹ä»¶ç›‘å¬æœºåˆ¶"></a>@EventListener springäº‹ä»¶ç›‘å¬æœºåˆ¶</h1><h1 id="Import-å®ç°é…ç½®é“¾å¼åŠ è½½"><a href="#Import-å®ç°é…ç½®é“¾å¼åŠ è½½" class="headerlink" title="@Import å®ç°é…ç½®é“¾å¼åŠ è½½"></a>@Import å®ç°é…ç½®é“¾å¼åŠ è½½</h1><p>é…ç½®é“¾å¼åŠ è½½ï¼Œå¤šä¸ªé…ç½®ç±»é“¾å¼å¼•ç”¨ï¼Œç¬¬ä¸€ä¸ªè¢«æ³¨å…¥åï¼Œåé¢é…ç½®è¿›è¡Œé“¾å¼åŠ è½½</p><h2 id="Controllerå±‚æ¥å£å®šä¹‰ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯public"><a href="#Controllerå±‚æ¥å£å®šä¹‰ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯public" class="headerlink" title="Controllerå±‚æ¥å£å®šä¹‰ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯public"></a>Controllerå±‚æ¥å£å®šä¹‰ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯public</h2><p>æ¥å£è°ƒç”¨servletåˆå§‹åŒ–æ˜¯ä»£ç†å¯¹è±¡ï¼Œpublicåœ¨åç»­è°ƒç”¨é“¾ä¸Šä¼šèµ°aopä»£ç†å¢å¼ºï¼Œæ³¨å…¥å®¹å™¨ç®¡ç†çš„ç±»ï¼Œprivateæ–¹æ³•åˆ™ä¸ä¼šã€‚æ‰€ä»¥privateæ–¹æ³•è¢«è°ƒç”¨æ—¶ç”¨çš„æ˜¯ä»£ç†å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡æ˜¯ä¸­è‡ªåŠ¨æ³¨å…¥çš„å±æ€§éƒ½æ˜¯nullï¼Œå¼•å‘ç©ºæŒ‡é’ˆã€‚</p><h1 id="Querydsl-for-JPA"><a href="#Querydsl-for-JPA" class="headerlink" title="Querydsl for JPA"></a>Querydsl for JPA</h1><p><a href="http://querydsl.com/static/querydsl/latest/reference/html/ch02.html">http://querydsl.com/static/querydsl/latest/reference/html/ch02.html</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@LastModifiedBy</span><br><span class="line">@EntityListeners(AuditingEntityListener.class)</span><br><span class="line">ä¸Šè¿°æ³¨è§£ç»„åˆå¯ä»¥è‡ªåŠ¨æ›´æ–°ä¿®æ”¹äººï¼Œä½¿ç”¨querydslæ›´æ–°æ•°æ®æ˜¯å¦ä¹Ÿä¼šè‡ªåŠ¨æ›´æ–°ï¼Ÿ</span><br></pre></td></tr></table></figure><h1 id="è‡ªå®šä¹‰starterï¼Œå¦‚ä½•è‡ªåŠ¨è£…é…"><a href="#è‡ªå®šä¹‰starterï¼Œå¦‚ä½•è‡ªåŠ¨è£…é…" class="headerlink" title="è‡ªå®šä¹‰starterï¼Œå¦‚ä½•è‡ªåŠ¨è£…é…"></a>è‡ªå®šä¹‰starterï¼Œå¦‚ä½•è‡ªåŠ¨è£…é…</h1><p><a href="https://juejin.cn/post/6918283737771966477">SpringBootè‡ªå®šä¹‰æ—¥å¿—Starterï¼Œå¯åŠ¨æ€æ‹”æ’é…ç½® - æ˜é‡‘ (juejin.cn)</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">starterä¸­é…ç½®ç»Ÿä¸€ç”¨ä¸€ä¸ªé…ç½®ç±»é›†ä¸­æ³¨å…¥</span><br><span class="line"></span><br><span class="line">æ˜¾ç¤ºæ³¨å…¥ï¼šè‡ªå®šä¹‰@EnableXXXæ³¨è§£ï¼Œ@import å¯¼å…¥ ImportSelectorå®ç°ç±»ï¼Œå®ç°ç±»selectImportsè¿”å›éœ€è¦è£…é…çš„é…ç½®ç±»ã€‚æœ€åå¯ç”¨æ³¨è§£å³å¯åŠŸèƒ½ç”Ÿæ•ˆ</span><br><span class="line"></span><br><span class="line">éšå¼æ³¨å…¥ï¼šresources -&gt; META-INF -&gt; spring.factoriesï¼Œ</span><br><span class="line">å…¶ä¸­é…ç½®org.springframework.boot.autoconfigure.EnableAutoConfiguration&#x3D;\ è½¬è¡Œå†™è‡ªå·±çš„é…ç½®ç±»</span><br><span class="line"></span><br><span class="line">è¿™ä¸¤ç§å®ç°éƒ½å¯ä»¥çœ‹springå®˜æ–¹çš„starterè¿›è¡Œå­¦ä¹ ã€‚éƒ½æœ‰è¿ç”¨</span><br></pre></td></tr></table></figure><h1 id="UriComponentsBuilder"><a href="#UriComponentsBuilder" class="headerlink" title="UriComponentsBuilder"></a>UriComponentsBuilder</h1><p><a href="https://www.baeldung.com/spring-uricomponentsbuilder">https://www.baeldung.com/spring-uricomponentsbuilder</a></p><h1 id="ä½å›¾BitMap"><a href="#ä½å›¾BitMap" class="headerlink" title="ä½å›¾BitMap"></a>ä½å›¾BitMap</h1><p>äºŒè¿›åˆ¶ä½ä»£è¡¨å¤šç§ç±»å‹ç»„åˆï¼Œå­˜å‚¨intå‹å³å¯</p><p>ä¾‹å¦‚ä¸šåŠ¡äº§å“æ¶‰åŠç±»å‹A B C D Eã€‚10101ï¼Œ00011ï¼Œ01010 åˆ™å¯¹åº”ACEã€DEã€BDè¿™ä¸‰ç§ç»„åˆã€‚å­˜å‚¨å€¼å¯¹åº”21ã€3ã€10</p><p>åŸºç¡€é€‚ç”¨åœºæ™¯ï¼Œå¤šç»„åˆä¼˜æƒ å·ã€å¤šå›ºå®šæ ‡ç­¾ã€ç­¾åˆ°ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;OncePerRequestFilterï¼ˆè¿‡æ»¤å™¨Filterï¼‰&quot;&gt;&lt;a href=&quot;#OncePerRequestFilterï¼ˆè¿‡æ»¤å™¨Filterï¼‰&quot; class=&quot;headerlink&quot; title=&quot;OncePerRequestFilterï¼ˆè¿‡æ»¤å™¨Filter</summary>
      
    
    
    
    <category term="å·¥ä½œ &amp; æºç " scheme="http://aidianfirst.com/categories/%E5%B7%A5%E4%BD%9C-%E6%BA%90%E7%A0%81/"/>
    
    
  </entry>
  
  <entry>
    <title>Spelå­—æ®µè§£æåŠŸèƒ½æºç æµ…æ</title>
    <link href="http://aidianfirst.com/2023/07/30/%E5%B7%A5%E4%BD%9C%20&amp;%20%E6%BA%90%E7%A0%81/Spel%E5%AD%97%E6%AE%B5%E8%A7%A3%E6%9E%90%E6%BA%90%E7%A0%81/"/>
    <id>http://aidianfirst.com/2023/07/30/%E5%B7%A5%E4%BD%9C%20&amp;%20%E6%BA%90%E7%A0%81/Spel%E5%AD%97%E6%AE%B5%E8%A7%A3%E6%9E%90%E6%BA%90%E7%A0%81/</id>
    <published>2023-07-30T11:20:17.736Z</published>
    <updated>2023-07-30T11:20:17.736Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h1><p>æœ€è¿‘åœ¨å†™æ—¥å¿—åŠŸèƒ½ï¼Œaop + æ³¨è§£ + spelï¼Œä½¿ç”¨ @RestControllerAdvice å…¨å±€æ•è·åˆ°çš„Exceptionçš„å¼‚å¸¸ä¿¡æ¯è‚¯å®šæ˜¯éœ€è¦æ‰“å°çš„ï¼Œäºæ˜¯æˆ‘æƒ³å½“ç„¶è·å–è‡ªå®šä¹‰ä¿¡æ¯çš„spelè¡¨è¾¾å¼æ˜¯ e.getDetailMessageï¼ŒdetailMessageå¼‚å¸¸ä¿¡æ¯å­—æ®µæ˜¯å¼‚å¸¸ç»§æ‰¿äºThrowableçš„ï¼Œç„¶åè¿è¡Œä»£ç spelè§£æå‡ºç°å¼‚å¸¸ï¼Œç½‘ä¸Šæœä¸€åœˆæ— æœï¼Œåªå¥½è‡ªå·±debugçœ‹æºç ï¼Œæ‰¾æ‰¾åŸå› äº†ã€‚</p><h1 id="Debuging"><a href="#Debuging" class="headerlink" title="Debuging"></a>Debuging</h1><p>é¢˜å¤–è¯ï¼Œå­¦ä¼šdebugæŠ€å·§åº”è¯¥æ˜¯æˆ‘ä»¬åˆçº§åç«¯è¿›é˜¶çš„ç¬¬ä¸€æ­¥ï¼Œå­¦ä¼šdebugæ‰å¥½çœ‹æºç ï¼ŒEvaluate Expression æ‰§è¡Œè¡¨è¾¾å¼ï¼Œæ–­ç‚¹è®¾ç½®æ¡ä»¶ä»¥åŠæ˜¯å¦çº¿ç¨‹ï¼Œè¿™ä¸¤ä¸ªå°æŠ€å·§æŒæ¡å¥½å°±å¯ä»¥çœ‹æºç äº†ã€‚</p><h2 id="readProperty"><a href="#readProperty" class="headerlink" title="readProperty"></a>readProperty</h2><p>debugæ­¥è¿›ç›´åˆ°spelåˆ¤æ–­æ ¸å¿ƒ</p><p>org.springframework.expression.spel.ast.Indexer#readProperty å…³é”®ä»£ç èŠ‚é€‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (PropertyAccessor accessor : accessorsToTry) &#123;</span><br><span class="line">    <span class="keyword">if</span> (accessor.canRead(evalContext, contextObject.getValue(), name)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (accessor <span class="keyword">instanceof</span> ReflectivePropertyAccessor) &#123;</span><br><span class="line">            accessor = ((ReflectivePropertyAccessor) accessor).createOptimalAccessor(</span><br><span class="line">                evalContext, contextObject.getValue(), name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.cachedReadAccessor = accessor;</span><br><span class="line">        <span class="keyword">return</span> accessor.read(evalContext, contextObject.getValue(), name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>canReadè¿™ä¸ªæ–¹æ³•æ˜¯æ ¡éªŒçš„å…³é”®ï¼Œè¿™é‡Œå¦‚æœæ ¡éªŒä¸é€šè¿‡å°±ä¸ä¼šè¿”å›ç»“æœï¼Œå†å¾€åèµ°éƒ½æ˜¯æŠ›å¼‚å¸¸äº†ï¼Œæˆ‘ä»¬è¿›canReadçœ‹çœ‹</p><h2 id="canRead"><a href="#canRead" class="headerlink" title="canRead"></a>canRead</h2><p>PropertyAccessor.canReadçš„å…·ä½“å®ç°å¦‚ä¸‹</p><p>org.springframework.expression.spel.support.<strong>ReflectivePropertyAccessor</strong>#canRead</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canRead</span><span class="params">(EvaluationContext context, <span class="meta">@Nullable</span> Object target, String name)</span> <span class="keyword">throws</span> AccessException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (target == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt; type = (target <span class="keyword">instanceof</span> Class ? (Class&lt;?&gt;) target : target.getClass());</span><br><span class="line">    <span class="keyword">if</span> (type.isArray() &amp;&amp; name.equals(<span class="string">&quot;length&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PropertyCacheKey cacheKey = <span class="keyword">new</span> PropertyCacheKey(type, name, target <span class="keyword">instanceof</span> Class);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.readerCache.containsKey(cacheKey)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Method method = findGetterForProperty(name, type, target);</span><br><span class="line">    <span class="keyword">if</span> (method != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Property property = <span class="keyword">new</span> Property(type, method, <span class="keyword">null</span>);</span><br><span class="line">        TypeDescriptor typeDescriptor = <span class="keyword">new</span> TypeDescriptor(property);</span><br><span class="line">        method = ClassUtils.getInterfaceMethodIfPossible(method);</span><br><span class="line">        <span class="keyword">this</span>.readerCache.put(cacheKey, <span class="keyword">new</span> InvokerPair(method, typeDescriptor));</span><br><span class="line">        <span class="keyword">this</span>.typeDescriptorCache.put(cacheKey, typeDescriptor);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Field field = findField(name, type, target);</span><br><span class="line">        <span class="keyword">if</span> (field != <span class="keyword">null</span>) &#123;</span><br><span class="line">            TypeDescriptor typeDescriptor = <span class="keyword">new</span> TypeDescriptor(field);</span><br><span class="line">            <span class="keyword">this</span>.readerCache.put(cacheKey, <span class="keyword">new</span> InvokerPair(field, typeDescriptor));</span><br><span class="line">            <span class="keyword">this</span>.typeDescriptorCache.put(cacheKey, typeDescriptor);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>canReadçš„ä¸»è¦é€»è¾‘</p><ul><li>åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„ï¼Œè¡¨è¾¾å¼æ˜¯lengthåˆ™å¯æ‰§è¡Œ</li><li>ç¼“å­˜ä¸­æœ‰ï¼Œå¯æ‰§è¡Œ</li><li>findGetterForProperty æ‰¾æ–¹æ³•</li><li>æ‰¾ä¸åˆ°æ–¹æ³• findField æ‰¾å­—æ®µ</li></ul><p>æˆ‘ä»¬å…ˆçœ‹Methodï¼Œé€šè¿‡ findGetterForProperty æ˜¯æ€ä¹ˆæ‰¾çš„</p></li><li><p><strong>findGetterForProperty</strong> åœ¨canReadè¿™ä¸ªç±»é‡Œé¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Method <span class="title">findGetterForProperty</span><span class="params">(String propertyName, Class&lt;?&gt; clazz, <span class="keyword">boolean</span> mustBeStatic)</span> </span>&#123;</span><br><span class="line">    Method method = findMethodForProperty(getPropertyMethodSuffixes(propertyName),</span><br><span class="line">                                          <span class="string">&quot;get&quot;</span>, clazz, mustBeStatic, <span class="number">0</span>, ANY_TYPES);</span><br><span class="line">    <span class="keyword">if</span> (method == <span class="keyword">null</span>) &#123;</span><br><span class="line">        method = findMethodForProperty(getPropertyMethodSuffixes(propertyName),</span><br><span class="line">                                       <span class="string">&quot;is&quot;</span>, clazz, mustBeStatic, <span class="number">0</span>, BOOLEAN_TYPES);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> method;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ç”¨çœ‹åˆ°æœ€åº•ä¸‹ï¼Œé‡Œé¢çš„å®ç°æ˜¯ä¸€å †æ ¡éªŒæ‰¾æ–¹æ³•ï¼Œæœ€ä¸»è¦çš„åˆ¤æ–­é€»è¾‘æ˜¯å°† get æˆ– is ä½œä¸ºå‰ç¼€ï¼Œè¡¨è¾¾å¼å­—æ®µä½œä¸ºåç¼€è¿›è¡Œæ‹¼æ¥ï¼Œç„¶ååœ¨ç›®æ ‡ç±»é‡Œé¢æŸ¥æ‰¾æ˜¯å¦æœ‰ç›¸å…³çš„æ–¹æ³•ã€‚</p><p>æ‰¾å®Œæ–¹æ³•åç»§ç»­canReadé‡Œçš„é€»è¾‘ï¼Œå¦‚æœæ–¹æ³•ä¸ä¸ºç©ºï¼Œè¯´æ˜æœ‰å¯æ‹¼æ¥çš„ getã€isæ–¹æ³•ï¼Œå¯ä»¥ç»§ç»­èµ° readProperty çš„æµç¨‹ã€‚</p><p>å¦‚æœæ–¹æ³•ä¸ºç©ºï¼Œåˆ™æ²¡æœ‰å¯¹åº”çš„getæ–¹æ³•ï¼Œå» findField æ‰¾å­—æ®µã€‚</p></li><li><p><strong>findField</strong> åœ¨canReadè¿™ä¸ªç±»é‡Œé¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Field <span class="title">findField</span><span class="params">(String name, Class&lt;?&gt; clazz, <span class="keyword">boolean</span> mustBeStatic)</span> </span>&#123;</span><br><span class="line">    Field[] fields = clazz.getFields();</span><br><span class="line">    <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">        <span class="keyword">if</span> (field.getName().equals(name) &amp;&amp; (!mustBeStatic || Modifier.isStatic(field.getModifiers()))) &#123;</span><br><span class="line">            <span class="keyword">return</span> field;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (clazz.getSuperclass() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Field field = findField(name, clazz.getSuperclass(), mustBeStatic);</span><br><span class="line">        <span class="keyword">if</span> (field != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> field;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (Class&lt;?&gt; implementedInterface : clazz.getInterfaces()) &#123;</span><br><span class="line">        Field field = findField(name, implementedInterface, mustBeStatic);</span><br><span class="line">        <span class="keyword">if</span> (field != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> field;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹ç¬¬ä¸€è¡Œï¼Œå‘ç°è¿™é‡Œåªè·å–äº†å…¬å…±å­—æ®µï¼Œä½¿ç”¨ getDeclaredFields() æ‰å¯ä»¥è·å–ç§æœ‰å­—æ®µã€‚</p><p>è·å–å…¬å…±å­—æ®µåä¸è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ï¼Œç„¶åè¿›è¡Œé™æ€æ ¡éªŒï¼Œç›¸åŒåˆ™è¿”å›ã€‚</p><p>å…¬å…±å­—æ®µæ‰¾ä¸åˆ°åˆ™è·å–çˆ¶ç±»ï¼Œé€’å½’æŸ¥æ‰¾ã€‚</p><p>é€’å½’å®Œä»ç„¶æŸ¥ä¸åˆ°ï¼Œåˆ™å»å®ç°çš„æ¥å£ï¼Œä¹Ÿä¼šé€’å½’ã€‚</p><p><strong>è¿™é‡Œæˆ‘æœ‰ä¸ªç‚¹æ²¡æƒ³æ˜ç™½ï¼ŒgetFieldsè·å–å…¨éƒ¨å…¬å…±å­—æ®µåŒ…æ‹¬çˆ¶ç±»ã€æ¥å£ï¼Œæ‰€ä»¥ä¸ºä»€ä¹ˆè¿˜è¦ç»§ç»­é€’å½’ï¼Ÿå¤§èƒ†è´¨ç–‘æºç ï¼ï¼ï¼</strong></p></li></ul><h2 id="createOptimalAccessor"><a href="#createOptimalAccessor" class="headerlink" title="createOptimalAccessor"></a>createOptimalAccessor</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((ReflectivePropertyAccessor) accessor).createOptimalAccessor();</span><br></pre></td></tr></table></figure><p>readProperty åœ¨é€šè¿‡ canRead æ ¡éªŒåï¼Œå¦‚æœç»§æ‰¿ ReflectivePropertyAccessorï¼Œåˆ™ä¼šç”¨åšä¸€äº›ç¼“å­˜æ“ä½œï¼Œä¸”è°ƒç”¨OptimalPropertyAccessoræ„é€ å™¨ï¼Œç¼“å­˜ <strong>member</strong> çš„å€¼</p><h2 id="read"><a href="#read" class="headerlink" title="read"></a>read</h2><p>å¦‚æœé€šè¿‡äº†canReadçš„æ ¡éªŒï¼ŒreadPropertyæ–¹æ³•ä¼šå…ˆè¿›è¡Œç¼“å­˜ï¼Œç„¶åè°ƒç”¨readè¿”å›å€¼ã€‚</p><p>ReflectivePropertyAccessor.OptimalPropertyAccessor#read</p><p>æˆ‘debugæ˜¯èµ°äº†å†…éƒ¨ç±»çš„readæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> TypedValue <span class="title">read</span><span class="params">(EvaluationContext context, <span class="meta">@Nullable</span> Object target, String name)</span> <span class="keyword">throws</span> AccessException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.member <span class="keyword">instanceof</span> Method) &#123;</span><br><span class="line">        Method method = (Method) <span class="keyword">this</span>.member;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ReflectionUtils.makeAccessible(method);</span><br><span class="line">            Object value = method.invoke(target);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> TypedValue(value, <span class="keyword">this</span>.typeDescriptor.narrow(value));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AccessException(<span class="string">&quot;Unable to access property &#x27;&quot;</span> + name + <span class="string">&quot;&#x27; through getter method&quot;</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Field field = (Field) <span class="keyword">this</span>.member;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ReflectionUtils.makeAccessible(field);</span><br><span class="line">            Object value = field.get(target);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> TypedValue(value, <span class="keyword">this</span>.typeDescriptor.narrow(value));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AccessException(<span class="string">&quot;Unable to access field &#x27;&quot;</span> + name + <span class="string">&quot;&#x27;&quot;</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ member ä¼šä½¿ç”¨ createOptimalAccessor ç¼“å­˜å¥½çš„å€¼ï¼Œé€šè¿‡ä»£ç† invoke æ–¹æ³•èµ°å¯¹åº”ç±»çš„æ–¹æ³•è·å–å€¼ï¼Œæˆ–è€…ç›´æ¥å»è·å–å­—æ®µçš„å€¼ã€‚</p><h1 id="è§£æƒ‘"><a href="#è§£æƒ‘" class="headerlink" title="è§£æƒ‘"></a>è§£æƒ‘</h1><p>æºç åˆ†æåï¼Œåœ¨å›æ¥çœ‹é—®é¢˜çš„èµ·å› ï¼Œæˆ‘æƒ³è·å–å¼‚å¸¸ä¿¡æ¯ Throwableï¼šdetailMessageï¼Œæˆ‘è¡¨è¾¾å¼å†™çš„æ˜¯e.getDetailMessageï¼ŒæŒ‰ç…§åˆšåˆšçš„åˆ†æèµ°åˆ° <strong>findGetterForProperty</strong> ä¼šå»æŸ¥æ‰¾å­—æ®µå¯¹åº”çš„getã€isæ–¹æ³•ï¼Œä½†æ˜¯å¼‚å¸¸é‡Œé¢è·å–ä¿¡æ¯çš„æ–¹æ³•æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public String getMessage() &#123;return detailMessage;&#125;</span><br></pre></td></tr></table></figure><p>å¹¶ä¸æ˜¯ getDetailMessageï¼Œæ‰€ä»¥æ–¹æ³•æŸ¥æ‰¾ä¸åˆ°ï¼Œè€ŒdetailMessageåˆæ˜¯ç§æœ‰å­—æ®µï¼Œæ‰€ä»¥ <strong>findField</strong> ä¹Ÿæ‰¾ä¸åˆ°å­—æ®µï¼Œæœ€åå°±æ‹¿ä¸åˆ°æˆ‘ä»¬æƒ³è¦çš„å€¼ï¼Œå‡ºç°è§£æå¼‚å¸¸ã€‚</p><p><strong>è§£å†³åŠæ³•å°±æ˜¯å°†è¡¨è¾¾å¼å†™æˆ e.messageï¼Œèµ°getMessageæ–¹æ³•è·å– detailMessage å­—æ®µçš„å€¼ã€‚</strong></p><p>æˆ‘ä¸Šé¢åˆ†æçš„éƒ½æ˜¯é’ˆå¯¹å­—æ®µè¡¨è¾¾å¼ï¼Œå¦‚æœå†™çš„æ˜¯æ–¹æ³•è¡¨è¾¾å¼ï¼ŒgetMessage()ï¼Œå¸¦æ‹¬å·çš„è¿™ç§ï¼Œspelè°ƒç”¨çš„æ—¶å€™å°±éœ€è¦æ¢ä¸€ç§å†™æ³•ï¼Œç»™è¡¨è¾¾å¼æŒ‡å®šrootObjectï¼Œè€Œä¸”è¡¨è¾¾å¼çš„è§£æè·¯å¾„ä¹Ÿä¸ä¸€æ ·äº†ï¼Œé‚£ä¹ˆæºç å°±æ˜¯å¦å¤–ä¸€ç§è§£æè·¯å¾„äº†ï¼Œä¸‹æ¬¡è¿™é‡Œæœ‰å‘æˆ‘å†å»çœ‹å§ğŸ˜‚</p><h1 id="å½©è›‹"><a href="#å½©è›‹" class="headerlink" title="å½©è›‹"></a>å½©è›‹</h1><p>åœ¨çœ‹ <strong>findFields</strong> å¯¹å­—æ®µæ ¡éªŒæ—¶ï¼Œæœ‰ä¸ªåœ°æ–¹å¸å¼•åˆ°æˆ‘äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Modifier.isStatic(field.getModifiers())</span><br></pre></td></tr></table></figure><p>å­—é¢æ„æ€å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ˜¯åœ¨åˆ¤æ–­å­—æ®µæ˜¯å¦é™æ€å˜é‡ï¼Œç‚¹è¿›æºç çœ‹çœ‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STATIC           = <span class="number">0x00000008</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isStatic</span><span class="params">(<span class="keyword">int</span> mod)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (mod &amp; STATIC) != <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘ç°æ˜¯åœ¨åšä½è¿ç®—ï¼Œç”¨ field.getModifiers() çš„å€¼å’Œ STATICï¼ŒSTATICè¡¨ç¤ºåå…­è¿›åˆ¶æ•°ï¼š8ã€‚</p><p>çœ‹åˆ°è¿™æƒ³èµ·ä¹‹å‰åˆ·ç®—æ³•é‡åˆ°ä½è¿ç®—çš„é¢˜ï¼Œå°±æƒ³çœ‹çœ‹jdkæ˜¯æ€ä¹ˆè”åŠ¨çš„ï¼Œé€šè¿‡ä½è¿ç®—åˆ¤æ–­é™æ€å˜é‡ã€‚</p><p>ç½‘ä¸Šæœäº†ä¸‹ field.getModifiers() è¿™ä¸ªæ–¹æ³•æ˜¯è·å–å­—æ®µå‰é¢ä¿®é¥°ç¬¦çš„å€¼ï¼Œjdkåº•å±‚æŠŠæ¯ä¸ªä¿®é¥°ç¬¦æŒ‰åå…­è¿›åˆ¶æ•°è¿›è¡Œå®šä¹‰äº†ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥å¾—åˆ°ä¿®é¥°ç¬¦ä¹‹å’Œã€‚ä»¥ä¸‹åˆ—ä¸¾éƒ¨åˆ†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PUBLIC           = <span class="number">0x00000001</span>; <span class="comment">//1</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PRIVATE          = <span class="number">0x00000002</span>;<span class="comment">//2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PROTECTED        = <span class="number">0x00000004</span>;<span class="comment">//4</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STATIC           = <span class="number">0x00000008</span>;<span class="comment">//8</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FINAL            = <span class="number">0x00000010</span>;<span class="comment">//16</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SYNCHRONIZED     = <span class="number">0x00000020</span>;<span class="comment">//32</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> VOLATILE         = <span class="number">0x00000040</span>;<span class="comment">//64</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TRANSIENT        = <span class="number">0x00000080</span>;<span class="comment">//8*16</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NATIVE           = <span class="number">0x00000100</span>;<span class="comment">//16*16</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INTERFACE        = <span class="number">0x00000200</span>;<span class="comment">//32*16</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ABSTRACT         = <span class="number">0x00000400</span>;<span class="comment">//64*16</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå°±å¾ˆæ¸…æ™°äº†ï¼Œè·å–å­—æ®µä¿®é¥°ç¬¦ä¹‹å’Œï¼Œç„¶ååœ¨å’Œ STATICï¼š8 è¿›è¡ŒæŒ‰ä½ä¸è®¡ç®—ï¼ŒæŒ‰ç…§ä½è¿ç®—ï¼Œå¦‚æœä¿®é¥°ç¬¦ä¹‹å’Œæ²¡æœ‰STATICï¼š8ï¼Œå¾—åˆ°çš„ç»“æœä¸€å®šæ˜¯0ï¼Œä¸ä¸º0åˆ™è¯´æ˜ç»„åˆçš„ä¿®é¥°ç¬¦åŒ…å« staticã€‚åŒç†å…¶ä»–ä¿®é¥°ç¬¦éƒ½å¯ä»¥ä½¿ç”¨ Modifier ç±»ä¸­çš„æ–¹æ³•è¿›è¡Œä½è¿ç®—åˆ¤æ–­ã€‚</p><p>psï¼šå¦‚æœä¸æ˜ç™½å°±å»å¤ä¹ ä¸€ä¸‹ä½è¿ç®—å§ï¼ŒæŒ‰ä½ä¸&amp;ï¼Œæ¯ä½è®¡ç®—çš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0 &amp; 0 | 0 &amp; 1 | 1 &amp; 0 &#x3D; 0</span><br><span class="line">1 &amp; 1 &#x3D; 1</span><br></pre></td></tr></table></figure><p>åªæœ‰åŒä½éƒ½ä¸º1ï¼ŒæŒ‰ä½ä¸æ‰ç­‰äº1ï¼Œæ‰€ä»¥å½“å‰ä½ä¸ä¸º1è¯´æ˜ä¿®é¥°ç¬¦ä¹‹å’Œä¸åŒ…å«è¦åˆ¤æ–­çš„ä¿®é¥°ç¬¦ã€‚</p><h1 id="è¿½åŠ å†…å®¹"><a href="#è¿½åŠ å†…å®¹" class="headerlink" title="è¿½åŠ å†…å®¹"></a>è¿½åŠ å†…å®¹</h1><p><a href="https://gitee.com/link?target=https://www.bilibili.com/video/BV1R24y1W7DY/?spm_id_from=333.999.0.0&vd_source=77c5fa1cb2cbdaccec0dbbcfa038a8e7">https://www.bilibili.com/video/BV1R24y1W7DY/?spm_id_from=333.999.0.0&amp;vd_source=77c5fa1cb2cbdaccec0dbbcfa038a8e7</a></p><p>æœ€è¿‘çœ‹åˆ°1v5å¤§ä½¬åˆ†äº«çš„å†…å®¹è®²åˆ°äº†Spelï¼Œåˆšå¥½è‡ªå·±å†™æ—¥å¿—çš„æ—¶å€™æœ‰è¿‡äº†è§£ï¼Œçœ‹å®Œè§†é¢‘åå¯¹Spelè¿™ä¸€å—å†…å®¹è®¤çŸ¥æ›´å…¨é¢äº†ï¼Œä¸»è¦æ˜¯ä»ä¸‰ä¸ªå±‚é¢è¿›è¡Œç†è§£ï¼Œè§£æå™¨ã€è¡¨è¾¾å¼ã€ä¸Šä¸‹æ–‡ã€‚</p><p>Spelå…³è”é“¾è·¯ï¼šä½¿ç”¨è§£æå™¨è½¬æ¢è¾“å…¥å­—ç¬¦ä¸²å†…å®¹ï¼Œå¾—åˆ°éœ€è¦çš„è¡¨è¾¾å¼ç±»å‹ï¼Œç„¶åè®¾ç½®ä¸Šä¸‹æ–‡å†…å®¹ï¼Œæœ€åæ ¹æ®è¡¨è¾¾å¼åœ¨ä¸Šä¸‹æ–‡ä¸­è·å–å‚æ•°å¯¹åº”çš„å€¼ã€‚è¿™æ˜¯SpelæŠ€æœ¯å®ç°çš„ä¸‰ä¸ªé¡¶å±‚æŠ½è±¡ï¼Œä»è¿™ä¸‰ä¸ªå±‚é¢è¿›è¡Œå±•å¼€ï¼Œæˆ‘ä»¬å†å»çœ‹å®ç°ç±»ä¹‹é—´çš„å…³ç³»ï¼Œç¡®å®æ›´åŠ æ¸…æ™°äº†ã€‚éå¸¸æ¨èçœ‹åˆ°è¿™é‡Œçš„æœ‹å‹å»çœ‹çœ‹ä¸Šæ–¹é“¾æ¥çš„è§†é¢‘ã€‚æ­¤æ¬¡è®²è§£Spelä¹Ÿè®©æˆ‘å¯¹æºç é˜…è¯»æœ‰äº†æ–°çš„æ€è·¯ï¼Œçœ‹é¡¶å±‚æŠ½è±¡ï¼Œå…¥æ‰‹è®¾è®¡å±‚é¢ä¸Šçš„åŸºç¡€å…³è”å…³ç³»ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/46.png" alt="46.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;èµ·å› &quot;&gt;&lt;a href=&quot;#èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;èµ·å› &quot;&gt;&lt;/a&gt;èµ·å› &lt;/h1&gt;&lt;p&gt;æœ€è¿‘åœ¨å†™æ—¥å¿—åŠŸèƒ½ï¼Œaop + æ³¨è§£ + spelï¼Œä½¿ç”¨ @RestControllerAdvice å…¨å±€æ•è·åˆ°çš„Exceptionçš„å¼‚å¸¸ä¿¡æ¯</summary>
      
    
    
    
    <category term="å·¥ä½œ &amp; æºç " scheme="http://aidianfirst.com/categories/%E5%B7%A5%E4%BD%9C-%E6%BA%90%E7%A0%81/"/>
    
    
  </entry>
  
  <entry>
    <title>Controlleræ¥å£è°ƒç”¨é“¾è·¯æµ…æ</title>
    <link href="http://aidianfirst.com/2023/07/30/%E5%B7%A5%E4%BD%9C%20&amp;%20%E6%BA%90%E7%A0%81/Controller%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8%E9%93%BE%E8%B7%AF%E6%B5%85%E6%9E%90/"/>
    <id>http://aidianfirst.com/2023/07/30/%E5%B7%A5%E4%BD%9C%20&amp;%20%E6%BA%90%E7%A0%81/Controller%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8%E9%93%BE%E8%B7%AF%E6%B5%85%E6%9E%90/</id>
    <published>2023-07-30T11:20:17.736Z</published>
    <updated>2023-07-30T11:20:17.736Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Controlleræ¥å£è°ƒç”¨é“¾è·¯æµ…æ"><a href="#Controlleræ¥å£è°ƒç”¨é“¾è·¯æµ…æ" class="headerlink" title="Controlleræ¥å£è°ƒç”¨é“¾è·¯æµ…æ"></a>Controlleræ¥å£è°ƒç”¨é“¾è·¯æµ…æ</h1><h2 id="é¡¹ç›®åˆå§‹åŒ–ï¼Œåˆ›å»ºä»£ç†ç±»"><a href="#é¡¹ç›®åˆå§‹åŒ–ï¼Œåˆ›å»ºä»£ç†ç±»" class="headerlink" title="é¡¹ç›®åˆå§‹åŒ–ï¼Œåˆ›å»ºä»£ç†ç±»"></a>é¡¹ç›®åˆå§‹åŒ–ï¼Œåˆ›å»ºä»£ç†ç±»</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">AbstractClassGenerator#generate() 358:&#123;strategy.generate(this)&#125; -&gt;</span><br><span class="line">DefaultGeneratorStrategy#generate() 25:&#123;transform(cg).generateClass(cw)&#125; -&gt;</span><br><span class="line">Enhancer#generateClass() 670:&#123;getMethods(...)&#125; -&gt;</span><br><span class="line">Enhancer#generateClass() 651:&#123;CollectionUtils.filter(methods, new VisibilityPredicate(superclass, true));&#125; -&gt;</span><br><span class="line">AbstractClassGenerator#generate() 363:&#123;gen = ReflectUtils.defineClass(...)&#125;</span><br></pre></td></tr></table></figure><p>ä¸»è¦æ˜¯åœ¨<code>AbstractClassGenerator</code>è¿™ä¸ªç±»å®Œæˆä»£ç†ç±»çš„ç”Ÿæˆï¼Œå…¶ä¸­è°ƒç”¨äº†cglibç›¸å…³é€»è¾‘è¿‡æ»¤åŸç”Ÿç±»çš„æ–¹æ³•ï¼Œ <code>DefaultGeneratorStrategy</code>ã€<code>CollectionUtils</code>éœ€è¦å¯¼å…¥cglibæºç è¿›è¡ŒæŸ¥çœ‹ï¼Œè€Œprivateæ–¹æ³•åˆ™è¢«<code>VisibilityPredicate</code>è¿™ä¸ªç­–ç•¥è¿‡æ»¤äº†ï¼Œæºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// VisibilityPredicate è¿‡æ»¤æ–¹æ³• å¾ˆæ˜æ˜¾privateæ–¹æ³•false</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">evaluate</span><span class="params">(Object arg)</span> </span>&#123;</span><br><span class="line">    Member member = (Member)arg;</span><br><span class="line">    <span class="keyword">int</span> mod = member.getModifiers();</span><br><span class="line">    <span class="keyword">if</span> (Modifier.isPrivate(mod)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Modifier.isPublic(mod)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Modifier.isProtected(mod) &amp;&amp; protectedOk) &#123;</span><br><span class="line">        <span class="comment">// protected is fine if &#x27;protectedOk&#x27; is true (for subclasses)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// protected/package private if the member is in the same package as the source class </span></span><br><span class="line">        <span class="comment">// and we are generating into the same classloader.</span></span><br><span class="line">        <span class="keyword">return</span> samePackageOk </span><br><span class="line">            &amp;&amp; pkg.equals(TypeUtils.getPackageName(Type.getType(member.getDeclaringClass())));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŒä¸€ä¸ªä»£ç†ç±»ç”Ÿæˆæµç¨‹ä¼šè¢«å¤šæ¬¡è§¦å‘ï¼Œè¿™ä¸ªåŸå› è¿˜æœªæ·±ç©¶ï¼Œä¸çŸ¥é“å‡ºäºä»€ä¹ˆç›®çš„ï¼Œå¯ä»¥æ ‡è®°ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ç‚¹ã€‚</strong></p><h2 id="tomcatå¼€å¯çº¿ç¨‹ï¼Œèµ°åˆ°è¿‡æ»¤å™¨é“¾ä¹‹å‰çš„ä¸€ä¸ªå®šå‘é€»è¾‘é“¾è·¯è°ƒç”¨"><a href="#tomcatå¼€å¯çº¿ç¨‹ï¼Œèµ°åˆ°è¿‡æ»¤å™¨é“¾ä¹‹å‰çš„ä¸€ä¸ªå®šå‘é€»è¾‘é“¾è·¯è°ƒç”¨" class="headerlink" title="tomcatå¼€å¯çº¿ç¨‹ï¼Œèµ°åˆ°è¿‡æ»¤å™¨é“¾ä¹‹å‰çš„ä¸€ä¸ªå®šå‘é€»è¾‘é“¾è·¯è°ƒç”¨"></a>tomcatå¼€å¯çº¿ç¨‹ï¼Œèµ°åˆ°è¿‡æ»¤å™¨é“¾ä¹‹å‰çš„ä¸€ä¸ªå®šå‘é€»è¾‘é“¾è·¯è°ƒç”¨</h2><p>tomcatè¿™éƒ¨åˆ†è°ƒç”¨é“¾ç»•å¼¯å¾ˆå¤šï¼Œæˆ‘æ²¡æœ‰ç»†çœ‹è¿™éƒ¨åˆ†çš„æ˜ å°„é€»è¾‘ï¼Œå’Œæˆ‘ä»¬çš„é—®é¢˜æ ¸å¿ƒä¹Ÿæ²¡æœ‰å¤ªå¤§å…³ç³»ï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹çœ‹ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:202)</span><br><span class="line">at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:97)</span><br><span class="line">at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:542)</span><br><span class="line">at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:143)</span><br><span class="line">at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)</span><br><span class="line">at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:78)</span><br><span class="line">at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)</span><br><span class="line">at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:374)</span><br><span class="line">at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65)</span><br><span class="line">at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868)</span><br><span class="line">at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1590)</span><br></pre></td></tr></table></figure><h2 id="è¿‡æ»¤å™¨é“¾è·¯"><a href="#è¿‡æ»¤å™¨é“¾è·¯" class="headerlink" title="è¿‡æ»¤å™¨é“¾è·¯"></a>è¿‡æ»¤å™¨é“¾è·¯</h2><p>è¿‡æ»¤å™¨é“¾è·¯æ˜¯åœ¨é¡¹ç›®å¯åŠ¨æ—¶æå‰æ‰«æå¥½æ³¨å…¥ä¸Šä¸‹æ–‡ä¸­çš„ï¼ŒservletåŸç”Ÿè¿‡æ»¤é“¾ï¼Œ<code>ApplicationFilterChain</code>ï¼Œä»¥ä¸‹æ˜¯ä¸»è¦è°ƒç”¨é“¾çš„é€»è¾‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ApplicationFilterChain#doFilter() è°ƒç”¨é“¾è·¯ -&gt;</span><br><span class="line">ApplicationFilterChain#internalDoFilter() 193 ç´¢å¼•ç§»åŠ¨,è°ƒç”¨è¿‡æ»¤å™¨ -&gt; </span><br><span class="line">Filter#doFilter() ç›¸åº”è¿‡æ»¤å™¨é€»è¾‘ -&gt;</span><br><span class="line">chain.doFilter(request, response) è¿‡æ»¤å™¨å®Œæˆåç»§ç»­è°ƒç”¨é“¾è·¯ -&gt;</span><br><span class="line">é‡å¤ä¸Šè¿°åŠ¨ä½œç›´è‡³éå†å®Œé“¾è·¯ ApplicationFilterChain#internalDoFilter() 231 servlet.service(request, response) -&gt;</span><br><span class="line">å¼€å§‹servletè°ƒç”¨æ¥å£...</span><br></pre></td></tr></table></figure><p>å®Œæˆä¸Šè¿°tomcatçš„å®šå‘é€»è¾‘è°ƒç”¨åå°±ä¼šå¼€å¯è¿‡æ»¤å™¨é“¾è·¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StandardWrapperValve#invoke() 174</span><br><span class="line">ApplicationFilterChain filterChain = ApplicationFilterFactory.createFilterChain(request, wrapper, servlet);</span><br></pre></td></tr></table></figure><h2 id="è°ƒç”¨controlleræ¥å£"><a href="#è°ƒç”¨controlleræ¥å£" class="headerlink" title="è°ƒç”¨controlleræ¥å£"></a>è°ƒç”¨controlleræ¥å£</h2><p>è¿‡æ»¤å™¨é“¾è·¯èµ°å®Œåï¼Œç»§ç»­servletè¯·æ±‚å¤„ç†ï¼Œæ‰§è¡ŒdoServiceã€doDispatchç›¸å…³æ“ä½œã€‚ç„¶åä¾¿æ˜¯è°ƒç”¨æ¥å£æ–¹æ³•ï¼Œè¿™é‡Œå°†é’ˆå¯¹æ–¹æ³•å±æ€§è¿›è¡Œæ˜¯å¦ä»£ç†ç±»æ‹¦æˆªå¢å¼ºæ“ä½œã€‚æˆ‘ä»¬å…ˆç”Ÿæˆä»£ç†ç±»ã€‚</p><h3 id="Method-invoke"><a href="#Method-invoke" class="headerlink" title="Method invoke"></a>Method invoke</h3><p>cæºç ä¸‹è½½ï¼š<a href="https://hg.openjdk.org/jdk8u%EF%BC%8C%E6%83%B3%E7%9C%8B%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%BA%90%E7%A0%81%E7%82%B9%E5%87%BBhotspot%EF%BC%8C%E5%8A%A0%E8%BD%BD%E9%A1%B5%E9%9D%A2%E5%90%8E%E7%82%B9%E5%87%BB%E5%B7%A6%E4%BE%A7%E6%A0%8Fzip%E3%80%81gc%E4%B8%8B%E8%BD%BD%E6%BA%90%E7%A0%81%E5%8E%8B%E7%BC%A9%E5%8C%85%EF%BC%8C%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81jdk%E5%92%8Chotspot%E7%9A%84%E6%BA%90%E7%A0%81%E3%80%82">https://hg.openjdk.org/jdk8uï¼Œæƒ³çœ‹è™šæ‹Ÿæœºæºç ç‚¹å‡»hotspotï¼ŒåŠ è½½é¡µé¢åç‚¹å‡»å·¦ä¾§æ zipã€gcä¸‹è½½æºç å‹ç¼©åŒ…ï¼Œæˆ‘ä»¬éœ€è¦jdkå’Œhotspotçš„æºç ã€‚</a></p><p>æˆ‘ä»¬çŸ¥é“æºç éƒ½æ˜¯ä½¿ç”¨åå°„è¿›è¡ŒåŠ¨æ€ä»£ç†çš„ï¼Œè¿™ä¸€æ­¥éª¤å°±æ˜¯è°ƒç”¨<code>Method#invoke()</code>æ–¹æ³•ï¼Œä¸€å±‚å±‚å¾€ä¸‹çœ‹ï¼Œæœ€ç»ˆè°ƒç”¨çš„nativeæ–¹æ³•ï¼š</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NativeMethodAccessorImpl.class</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> Object <span class="title">invoke0</span><span class="params">(Method m, Object obj, Object[] args)</span></span>;</span><br></pre></td></tr></table></figure><p>jdkæºç è¿›ä¸€æ­¥è°ƒç”¨jvm</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">jdk<span class="number">-7f</span>cf35286d52\src\share\native\sun\reflect\NativeAccessors.c</span><br><span class="line"></span><br><span class="line">JNIEXPORT jobject JNICALL Java_sun_reflect_NativeMethodAccessorImpl_invoke0</span><br><span class="line">(JNIEnv *env, jclass unused, jobject m, jobject obj, jobjectArray args)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">return</span> JVM_InvokeMethod(env, m, obj, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³é”®åå°„è°ƒç”¨ Reflection::invoke_method</p><p><strong>å®åŠ›æœ‰é™ï¼Œè¿™å—cæºç ç¡®å®å•ƒä¸åŠ¨ï¼Œå•çº¯æŠ›ç –å¼•ç‰ä¸€ä¸‹</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">hotspot<span class="number">-69087</span>d08d473\src\share\vm\prims\jvm.cpp</span><br><span class="line"></span><br><span class="line">JVM_ENTRY(jobject, JVM_InvokeMethod(JNIEnv *env, jobject method, jobject obj, jobjectArray args0))</span><br><span class="line">  JVMWrapper(<span class="string">&quot;JVM_InvokeMethod&quot;</span>);</span><br><span class="line">  Handle method_handle;</span><br><span class="line">  <span class="keyword">if</span> (thread-&gt;stack_available((address) &amp;method_handle) &gt;= JVMInvokeMethodSlack) &#123;</span><br><span class="line">    method_handle = Handle(THREAD, JNIHandles::resolve(method));</span><br><span class="line">    <span class="function">Handle <span class="title">receiver</span><span class="params">(THREAD, JNIHandles::resolve(obj))</span></span>;</span><br><span class="line">    <span class="function">objArrayHandle <span class="title">args</span><span class="params">(THREAD, objArrayOop(JNIHandles::resolve(args0)))</span></span>;</span><br><span class="line">    oop result = Reflection::invoke_method(method_handle(), receiver, args, CHECK_NULL);</span><br><span class="line">    jobject res = JNIHandles::make_local(env, result);</span><br><span class="line">    <span class="keyword">if</span> (JvmtiExport::should_post_vm_object_alloc()) &#123;</span><br><span class="line">      oop ret_type = java_lang_reflect_Method::return_type(method_handle());</span><br><span class="line">      assert(ret_type != <span class="literal">NULL</span>, <span class="string">&quot;sanity check: ret_type oop must not be NULL!&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (java_lang_Class::is_primitive(ret_type)) &#123;</span><br><span class="line">        <span class="comment">// Only for primitive type vm allocates memory for java object.</span></span><br><span class="line">        <span class="comment">// See box() method.</span></span><br><span class="line">        JvmtiExport::post_vm_object_alloc(JavaThread::current(), result);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    THROW_0(vmSymbols::java_lang_StackOverflowError());</span><br><span class="line">  &#125;</span><br><span class="line">JVM_END</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">oop <span class="title">Reflection::invoke_method</span><span class="params">(oop method_mirror, Handle receiver, objArrayHandle args, TRAPS)</span> </span>&#123;</span><br><span class="line">  oop mirror             = java_lang_reflect_Method::clazz(method_mirror);</span><br><span class="line">  <span class="keyword">int</span> slot               = java_lang_reflect_Method::slot(method_mirror);</span><br><span class="line">  <span class="keyword">bool</span> <span class="keyword">override</span>          = java_lang_reflect_Method::<span class="keyword">override</span>(method_mirror) != <span class="number">0</span>;</span><br><span class="line">  <span class="function">objArrayHandle <span class="title">ptypes</span><span class="params">(THREAD, objArrayOop(java_lang_reflect_Method::parameter_types(method_mirror)))</span></span>;</span><br><span class="line"></span><br><span class="line">  oop return_type_mirror = java_lang_reflect_Method::return_type(method_mirror);</span><br><span class="line">  BasicType rtype;</span><br><span class="line">  <span class="keyword">if</span> (java_lang_Class::is_primitive(return_type_mirror)) &#123;</span><br><span class="line">    rtype = basic_type_mirror_to_basic_type(return_type_mirror, CHECK_NULL);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    rtype = T_OBJECT;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">instanceKlassHandle <span class="title">klass</span><span class="params">(THREAD, java_lang_Class::as_Klass(mirror))</span></span>;</span><br><span class="line">  Method* m = klass-&gt;method_with_idnum(slot);</span><br><span class="line">  <span class="keyword">if</span> (m == <span class="literal">NULL</span>) &#123;</span><br><span class="line">    THROW_MSG_0(vmSymbols::java_lang_InternalError(), <span class="string">&quot;invoke&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function">methodHandle <span class="title">method</span><span class="params">(THREAD, m)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> invoke(klass, method, receiver, <span class="keyword">override</span>, ptypes, rtype, args, <span class="literal">true</span>, THREAD);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆcglibä»£ç†ç±»"><a href="#ç”Ÿæˆcglibä»£ç†ç±»" class="headerlink" title="ç”Ÿæˆcglibä»£ç†ç±»"></a>ç”Ÿæˆcglibä»£ç†ç±»</h3><p>ä½¿ç”¨<code>System.setPropert()</code>å®šä¹‰è¾“å‡ºè·¯å¾„ï¼Œå°† YOUR_CLASS æ›¿æ¢æˆä½ ç”Ÿæˆä»£ç†ç±»çš„åŸç”Ÿç±»ï¼Œæœ€åè°ƒç”¨ä¸€ä¸‹ç±»æ–¹æ³•ï¼Œåœ¨å¯¹åº”è·¯å¾„ä¸‹æ‰¾åˆ°ç”Ÿæˆçš„ä»£ç†ç±»ã€‚</p><p>å½“ç„¶ç”Ÿæˆåçš„æ˜¯classæ–‡ä»¶ï¼Œéœ€è¦åç¼–è¯‘æºç ï¼Œå¯ä»¥ä½¿ç”¨jd-guiï¼š<a href="https://github.com/java-decompiler/jd-gui/releases">https://github.com/java-decompiler/jd-gui/releases</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.setProperty(DebuggingClassWriter.DEBUG_LOCATION_PROPERTY, <span class="string">&quot;D:\\class&quot;</span>);</span><br><span class="line">        Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">        enhancer.setSuperclass(YOUR_CLASS.class);</span><br><span class="line">        enhancer.setCallback(<span class="keyword">new</span> MyMethodInterceptor());</span><br><span class="line">        YOUR_CLASS <span class="class"><span class="keyword">class</span> </span>= (YOUR_CLASS) enhancer.create();</span><br><span class="line">        class.function();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMethodInterceptor</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> methodProxy.invokeSuper(o, objects);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä»£ç†ç±»è¿‡æ»¤é“¾è·¯"><a href="#ä»£ç†ç±»è¿‡æ»¤é“¾è·¯" class="headerlink" title="ä»£ç†ç±»è¿‡æ»¤é“¾è·¯"></a>ä»£ç†ç±»è¿‡æ»¤é“¾è·¯</h3><ul><li>ä»£ç†ç±»è°ƒç”¨å‰éƒ½æ˜¯é€šè¿‡<code>Enhancer</code>è®¾ç½®åŸºç±»å’Œå›è°ƒï¼Œå¯¹åº”ä¸Šæ–‡ä¸­çš„<code>enhancer.setSuperclass()</code>ã€<code>enhancer.setCallback()</code>ï¼Œå›è°ƒç±»å®ç°cglibçš„æ‰©å±•æ¥å£ï¼Œä¹Ÿå°±æ˜¯å®ç°<code>intercept()</code></li><li>å¤–éƒ¨è°ƒç”¨cglibçš„<code>invoke()</code>é€šè¿‡ä¸¤ä¸ªfastclassç›¸å…³çš„æ˜ å°„ç±»å»è°ƒç”¨ä»£ç†ç±»çš„æ–¹æ³•</li><li>ä»£ç†æ–¹æ³•ï¼Œé€šè¿‡åˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ‹¦æˆªå¢å¼ºå™¨ï¼Œè¿›è¡Œå¢å¼ºæˆ–èµ°åŸç”Ÿæ–¹æ³•ï¼Œä»£ç†ç±»çš„åŸºç±»æ˜¯æˆ‘ä»¬çš„åŸç”Ÿæ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ***$$FastClassByCGLIB$$***</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(<span class="keyword">int</span> paramInt, Object paramObject, Object[] paramArrayOfObject)</span> <span class="keyword">throws</span> InvocationTargetException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (paramInt) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> ((OhbController)paramObject).add((Ohb)paramArrayOfObject[<span class="number">0</span>]);</span><br><span class="line">                ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> () &#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ***$$EnhancerByCGLIB$$***$$FastClassByCGLIB$$***</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(<span class="keyword">int</span> paramInt, Object paramObject, Object[] paramArrayOfObject)</span> <span class="keyword">throws</span> InvocationTargetException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (paramInt) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> ((OhbController$$EnhancerByCGLIB$$a5ddc9c3)paramObject).add((Ohb)paramArrayOfObject[<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> () &#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ***$$EnhancerByCGLIB$$***          </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title">add</span><span class="params">(Ohb paramOhb)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.CGLIB$CALLBACK_0 == <span class="keyword">null</span>) CGLIB$BIND_CALLBACKS(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">this</span>.CGLIB$CALLBACK_0 != <span class="keyword">null</span>) </span><br><span class="line">        ? <span class="keyword">this</span>.CGLIB$CALLBACK_0.intercept(<span class="keyword">this</span>, CGLIB$add$<span class="number">0</span>$Method, <span class="keyword">new</span> Object[] &#123; paramOhb &#125;, CGLIB$add$<span class="number">0</span>$Proxy) </span><br><span class="line">        : <span class="keyword">super</span>.add(paramOhb);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="cglib"><a href="#cglib" class="headerlink" title="cglib"></a>cglib</h2><p>åˆå§‹åŒ–ç”ŸæˆæŠ½è±¡ç±»çš„æ—¶å€™ï¼Œå°±æŠŠprivateæ–¹æ³•æ’é™¤äº†ã€‚</p><p>ç°åœ¨é—®é¢˜ç‚¹æ˜¯invoke0æ–¹æ³•æ‰§è¡Œçš„æ—¶å€™æ˜¯ä¸ªä»€ä¹ˆè°ƒç”¨é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> Object <span class="title">invoke0</span><span class="params">(Method m, Object obj, Object[] args)</span></span>;</span><br></pre></td></tr></table></figure><p>debugç»“æœæ˜¯ï¼Œobjæ˜¯ä»£ç†å¯¹è±¡ï¼Œè€Œä»£ç†å¯¹è±¡ä¸­ä¸å­˜åœ¨å·²è¢«è¿‡æ»¤çš„æ–¹æ³•ï¼Œä¸èƒ½è¢«è°ƒç”¨é“¾è·¯å¢å¼ºï¼Œç›´æ¥åå°„è°ƒç”¨äº†æ–¹æ³•ï¼Œæ­¤æ—¶çš„ç±»ç›¸å½“äºæ˜¯åå°„æ˜ å°„çš„ï¼Œéspringç®¡ç†ã€‚</p><p>è€Œpublicå¯ä»¥åœ¨å¢å¼ºé“¾è·¯ä¸­ï¼Œå¯ä»¥è¢«å¢å¼ºï¼Œé€šè¿‡å¢å¼ºé“¾è·¯è°ƒç”¨äº†å®¹å™¨ä¸­bean</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- cglibæºç </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="invoke0"><a href="#invoke0" class="headerlink" title="invoke0"></a>invoke0</h2><p>è°ƒç”¨ä»£ç†ç±»æ–¹æ³•ï¼Œèƒ½è°ƒç”¨åˆ°å°±è°ƒç”¨ï¼Œprivateæ–¹æ³•è°ƒç”¨ä¸åˆ°å°±ç›´æ¥æ˜ å°„åˆ°çˆ¶ç±»äº†ï¼Œè¿™ä¸ªæ˜¯çŒœæµ‹ï¼Œéœ€è¦éªŒè¯ã€‚</p><p>å¤šä¸ªä»£ç†ï¼ŒEnhancerBySpringCGLIBã€FastClassBySpringCGLIBï¼Œå­˜åœ¨æ˜ å°„å…³ç³»ï¼Œinterceptèµ°aopé“¾</p><p>çœ‹æºç ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®Enhancer callbackï¼Œåˆ™ç›´æ¥è°ƒç”¨çˆ¶ç±»åŸæ–¹æ³•</p><p>æ‰€ä»¥privateæ²¡æœ‰çš„æ–¹æ³•è½¬å‘æ˜¯åœ¨invoke0å­—èŠ‚ç ä¸­è¢«å‘å°„å¤„ç†äº†</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Controlleræ¥å£è°ƒç”¨é“¾è·¯æµ…æ&quot;&gt;&lt;a href=&quot;#Controlleræ¥å£è°ƒç”¨é“¾è·¯æµ…æ&quot; class=&quot;headerlink&quot; title=&quot;Controlleræ¥å£è°ƒç”¨é“¾è·¯æµ…æ&quot;&gt;&lt;/a&gt;Controlleræ¥å£è°ƒç”¨é“¾è·¯æµ…æ&lt;/h1&gt;&lt;h2 id=&quot;é¡¹</summary>
      
    
    
    
    <category term="å·¥ä½œ &amp; æºç " scheme="http://aidianfirst.com/categories/%E5%B7%A5%E4%BD%9C-%E6%BA%90%E7%A0%81/"/>
    
    
  </entry>
  
  <entry>
    <title>å¹¶å‘ç¼–ç¨‹å®æˆ˜é˜…è¯»å­¦ä¹ </title>
    <link href="http://aidianfirst.com/2023/07/30/%E5%B7%A5%E4%BD%9C%20&amp;%20%E6%BA%90%E7%A0%81/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98%E9%98%85%E8%AF%BB%E5%AD%A6%E4%B9%A0/"/>
    <id>http://aidianfirst.com/2023/07/30/%E5%B7%A5%E4%BD%9C%20&amp;%20%E6%BA%90%E7%A0%81/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98%E9%98%85%E8%AF%BB%E5%AD%A6%E4%B9%A0/</id>
    <published>2023-07-30T11:20:17.736Z</published>
    <updated>2023-07-30T11:20:17.736Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å†…å­˜å¯è§æ€§"><a href="#å†…å­˜å¯è§æ€§" class="headerlink" title="å†…å­˜å¯è§æ€§"></a>å†…å­˜å¯è§æ€§</h1><p>é€šå¸¸æˆ‘ä»¬æ— æ³•ç¡®ä¿æ‰§è¡Œè¯»æ“ä½œçš„çº¿ç¨‹èƒ½é€‚æ—¶çš„çœ‹åˆ°å…¶ä»–å†™çº¿ç¨‹å†™å…¥çš„å€¼ï¼Œä¸ºäº†ç¡®ä¿å¤šçº¿ç¨‹é—´å¯¹å†…å­˜å†™å…¥æ“ä½œçš„å¯è§æ€§ï¼Œå¿…é¡»ä½¿ç”¨åŒæ­¥æœºåˆ¶ã€‚</p><h2 id="åŠ é”ä¸å¯è§æ€§"><a href="#åŠ é”ä¸å¯è§æ€§" class="headerlink" title="åŠ é”ä¸å¯è§æ€§"></a>åŠ é”ä¸å¯è§æ€§</h2><p>ABçº¿ç¨‹è·å–åŒä¸€ä¸ªé”ï¼Œå¯ä»¥ä¿è¯Aä¸­æ”¹å˜çš„å˜é‡ï¼Œç­‰åˆ°Bè·å–é”åä»å¯ä»¥çœ‹è§ã€‚</p><p>Bçº¿ç¨‹æ‰§è¡Œç”±é”ä¿æŠ¤çš„åŒæ­¥ä»£ç å—æ—¶ï¼Œå¯ä»¥çœ‹è§Açº¿ç¨‹ä¹‹å‰åœ¨åŒä¸€ä¸ªåŒæ­¥ä»£ç å—ä¸­çš„æ‰€æœ‰æ“ä½œç»“æœã€‚</p><p>å¯è§æ€§å³å…¬å…±å˜é‡çš„å¯è§†æ€§ã€ä¸€è‡´æ€§ï¼ŒåŒæ­¥ä¿è¯å¹¶å‘ä¸‹ä¸åŒçº¿ç¨‹æ•°æ®å˜é‡ä¸€è‡´ã€‚å¯¹äºå˜é‡æ¥è¯´ï¼Œé”æœºåˆ¶åŒæ­¥æ˜¯ä¸ºäº†ç¡®ä¿æŸä¸ªçº¿ç¨‹å†™å…¥æ”¹å˜é‡çš„å€¼ï¼Œå¯¹äºå…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯å¯è§çš„ã€‚</p><p>åŠ é”çš„æ„ä¹‰ä¸ä»…ä»…å±€é™äºäº’æ–¥è¡Œä¸ºï¼Œè¿˜åŒ…æ‹¬å†…å­˜å¯è§æ€§ï¼Œä¸ºäº†ç¡®ä¿æ‰€æœ‰çº¿ç¨‹å¯ä»¥çœ‹åˆ°å…±äº«å˜é‡çš„æœ€æ–°å€¼ï¼Œæ‰€æœ‰æ‰§è¡Œè¯»æ“ä½œæˆ–å†™æ“ä½œçš„çº¿ç¨‹éƒ½å¿…é¡»åœ¨åŒä¸€ä¸ªé”ä¸ŠåŒæ­¥ã€‚</p><h2 id="Volatile"><a href="#Volatile" class="headerlink" title="Volatile"></a>Volatile</h2><p>Javaæä¾›ä¸€ç§ç¨å¼±çš„åŒæ­¥æœºåˆ¶ï¼Œvolatileå…³é”®å­—ï¼Œç”¨äºç¡®ä¿å°†å˜é‡çš„æ›´æ–°æ“ä½œé€šçŸ¥åˆ°å…¶ä»–çº¿ç¨‹ã€‚</p><p>å½“å˜é‡å£°æ˜ä¸ºvolatileåï¼Œç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶éƒ½ä¼šæ³¨æ„åˆ°è¯¥å˜é‡æ˜¯å…±äº«çš„ï¼Œå› æ­¤ä¸ä¼šå°†å˜é‡ä¸Šçš„æ“ä½œä¸å…¶ä»–å†…å­˜æ“ä½œä¸€èµ·é‡æ’åºï¼Œvolatileå˜é‡ä¸ä¼šè¢«ç¼“å­˜åœ¨å¯„å­˜å™¨æˆ–å…¶ä»–å¤„ç†å™¨ä¸å¯è§çš„åœ°æ–¹ï¼Œå› æ­¤åœ¨è¯»å–volatileå˜é‡æ—¶æ€»èƒ½å¾—åˆ°æœ€æ–°å†™å…¥çš„å€¼ã€‚</p><p>volatileä¸ä¼šæ‰§è¡ŒåŠ é”æ“ä½œï¼Œå› æ­¤ä¹Ÿä¸ä¼šä½¿çº¿ç¨‹é˜»å¡ï¼Œvolatileæ˜¯ä¸€ç§æ¯”synchronizedæ›´è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ã€‚</p><p>volatileä¹Ÿæœ‰ä¸€äº›ä¸è¶³ï¼Œå®ƒä¸è¶³ä»¥ç¡®ä¿ i++ è¿™ç±»æ“ä½œçš„åŸå­æ€§ï¼Œé™¤éåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹å˜é‡æ‰§è¡Œå†™æ“ä½œã€‚</p><p>synchronizedæ­¤ç±»çš„åŠ é”æœºåˆ¶ï¼šåŸå­æ€§ + å¯è§æ€§ï¼Œvolatileï¼šå¯è§æ€§ã€‚</p><p><strong>volatileä¸»è¦ä½œç”¨æ˜¯å¯è§æ€§ + é˜²é‡æ’ï¼Œæ— åŠ é”åŠ¨ä½œï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯åŸå­æ€§ã€‚</strong></p><h1 id="å–æ¶ˆä¸å…³é—­"><a href="#å–æ¶ˆä¸å…³é—­" class="headerlink" title="å–æ¶ˆä¸å…³é—­"></a>å–æ¶ˆä¸å…³é—­</h1><h2 id="ä¸­æ–­-interrpt-åœæ­¢çº¿ç¨‹"><a href="#ä¸­æ–­-interrpt-åœæ­¢çº¿ç¨‹" class="headerlink" title="ä¸­æ–­ interrpt åœæ­¢çº¿ç¨‹"></a>ä¸­æ–­ interrpt åœæ­¢çº¿ç¨‹</h2><p>javaä¸­æ–­æ²¡æœ‰å®è´¨æ“ä½œï¼Œä¸€èˆ¬æ˜¯æä¾›ä¸€ä¸ªä¸­æ–­æ ‡è¯†ï¼Œç¨‹åºæ ¹æ®æ ‡è¯†è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚ waitã€sleep æ“ä½œï¼Œåº•å±‚ä¼šè‡ªåŠ¨æ„ŸçŸ¥æ ‡è¯†ä½æŠ›å‡º InterruptedException å¼‚å¸¸ã€‚</p><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ª boolean ç±»å‹çš„ä¸­æ–­çŠ¶æ€ï¼Œä¸­æ–­æ“ä½œä¼šå°†æ­¤æ ‡è¯†è®¾ç½®ä¸º trueï¼Œæ‰€ä»¥è¦çœŸæ­£ä¸­æ–­ä¸€ä¸ªè¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œéœ€è¦å…ˆè§¦å‘ä¸­æ–­ä¿®æ”¹çŠ¶æ€ï¼Œç„¶åè‡ªè¡Œæ„ŸçŸ¥çŠ¶æ€æ‰§è¡Œä¸­æ–­é€»è¾‘ã€‚</p><p>Thread ç±»æä¾›ä¸€äº›ç›¸å…³æ–¹æ³•ï¼š</p><ul><li>interrupt()ï¼šä¿®æ”¹ç›®æ ‡çº¿ç¨‹ï¼ˆè¿ç»­å¤šæ¬¡ä¸­æ–­ï¼Œæ ‡è¯†ä¼šä¸€ç›´ä¸ºfalseï¼ŒåŸå› æœªçŸ¥ï¼‰</li><li>isInterrupted()ï¼šæ„ŸçŸ¥çº¿ç¨‹ä¸­æ–­æ ‡è¯†</li><li>interrupted()ï¼šæ¸…é™¤ä¸­æ–­æ ‡è¯†ä½</li></ul><h2 id="JVMå…³é—­"><a href="#JVMå…³é—­" class="headerlink" title="JVMå…³é—­"></a>JVMå…³é—­</h2><h3 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h3><p>é€šè¿‡ <code>Runtime.getRuntime.addShutDownHook()</code> æ³¨å†Œé’©å­ï¼ŒJVMåœ¨å…³é—­æ—¶ä¼šå»è°ƒç”¨é’©å­ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Runtime.getRuntime().addShutdownHook(<span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é’©å­&quot;</span>);</span><br><span class="line">    &#125;));</span><br><span class="line">    System.out.println(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="number">2</span>);</span><br><span class="line">    System.exit(<span class="number">0</span>);</span><br><span class="line">    System.out.println(<span class="number">3</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸»è¦æ˜¯çœ‹åˆ°äº†é’©å­ Hook è¿™ä¸ªæ¦‚å¿µæƒ³æä¸€ä¸‹ï¼ŒSpringä¸­æä¾›äº†ä¸€äº›æ‰©å±•ç‚¹å°±æ˜¯é’©å­ï¼Œä¾‹å¦‚è·å–ä¸Šä¸‹æ–‡ä¼šå®ç°æ¥å£ ApplicationContextAwareï¼Œæˆ‘ä»¬å¯ä»¥è·å–ä¸Šä¸‹æ–‡å¹¶è¿›è¡Œç›¸åº”æ‰©å±•ï¼Œéœ€è¦å¯¹è¿™ä¸ªæ¦‚å¿µæœ‰ä¸€ä¸ªè®¤çŸ¥ã€‚</p><h2 id="å®ˆæŠ¤çº¿ç¨‹"><a href="#å®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="å®ˆæŠ¤çº¿ç¨‹"></a>å®ˆæŠ¤çº¿ç¨‹</h2><p>JVMå…³é—­åœºæ™¯å¾ˆå¤šï¼Œæ™®é€šçš„æ­£å¸¸å…³é—­æ–¹å¼æ˜¯åœ¨æœ€åä¸€ä¸ªæ™®é€šçº¿ç¨‹ï¼ˆéå®ˆæŠ¤ï¼‰ç»“æŸæ—¶è¢«è§¦å‘ã€‚ç¨‹åºä¸­çº¿ç¨‹éä¸ºæ™®é€šå’Œå®ˆæŠ¤ï¼ŒJVMå¯åŠ¨æ—¶åˆ›å»ºçš„æ‰€æœ‰çº¿ç¨‹ä¸­ï¼Œé™¤ä¸»çº¿ç¨‹å¤–éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼ˆå¦‚gcçº¿ç¨‹ï¼‰ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹Aåˆ›å»ºæ–°çº¿ç¨‹Bæ—¶ï¼ŒBä¼šç»§æ‰¿åˆ›å»ºè€…Açš„çº¿ç¨‹å®ˆæŠ¤çŠ¶æ€ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç¨‹åºä¸­ç”±ä¸»çº¿ç¨‹åˆ›å»ºçš„å…¨éƒ¨éƒ½æ˜¯æ™®é€šçº¿ç¨‹ã€‚</p><p>æ™®é€šã€å®ˆæŠ¤äºŒè€…å·®å¼‚ä»…å­˜åœ¨äºçº¿ç¨‹é€€å‡ºæ—¶å‘ç”Ÿçš„æ“ä½œï¼Œå½“ä¸€ä¸ªçº¿ç¨‹é€€å‡ºæ—¶ï¼ŒJVMä¼šæ£€æŸ¥å…¶ä»–æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Œè‹¥è¿™äº›çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œåˆ™JVMä¼šæ­£å¸¸é€€å‡ºã€‚</p><h1 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h1><h2 id="çº¿ç¨‹æ± å¤§å°"><a href="#çº¿ç¨‹æ± å¤§å°" class="headerlink" title="çº¿ç¨‹æ± å¤§å°"></a>çº¿ç¨‹æ± å¤§å°</h2><p>çº¿ç¨‹æ± è¿‡å¤§ï¼Œä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œåœ¨CPUå’Œå†…å­˜èµ„æºä¸Šè¿›è¡Œç«äº‰ï¼ŒåŠ å¤§äº†å†…å­˜ä½¿ç”¨é‡ã€‚</p><p>çº¿ç¨‹æ± è¿‡å°ï¼Œæ— æ³•åˆç†è¿ç”¨ç©ºé—²çš„å¤„ç†å™¨ï¼Œé™ä½ç³»ç»Ÿçš„ååç‡ã€‚</p><ul><li>è®¡ç®—å¯†é›†ä»»åŠ¡ï¼šCPUæ•° + 1 å¯è¾¾åˆ°è¾ƒå¥½çš„åˆ©ç”¨ç‡</li><li>IOå¯†é›†ä»»åŠ¡ æˆ– é˜»å¡æ“ä½œçš„ä»»åŠ¡ï¼šçº¿ç¨‹æ± è§„æ¨¡æ›´å¤§ï¼Œç½‘ä¼  2*CPUæ•°</li><li>çº¿ç¨‹æ± ç²¾ç¡®è®¡ç®—å…¬å¼ï¼š<code>CPUæ•° * CPUåˆ©ç”¨ç‡ * (1 + ä»»åŠ¡ç­‰å¾…æ—¶é—´/ä»»åŠ¡è®¡ç®—æ—¶é—´)</code></li></ul><h2 id="ThreadPoolExecutor"><a href="#ThreadPoolExecutor" class="headerlink" title="ThreadPoolExecutor"></a>ThreadPoolExecutor</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">çº¿ç¨‹æ± æ‰­è½¬è¿‡ç¨‹ï¼šæ ¸å¿ƒçº¿ç¨‹ -&gt; é˜»å¡é˜Ÿåˆ— -&gt; æœ€å¤§çº¿ç¨‹ -&gt; æ‹’ç»ç­–ç•¥</span><br></pre></td></tr></table></figure><h3 id="é˜»å¡é˜Ÿåˆ—"><a href="#é˜»å¡é˜Ÿåˆ—" class="headerlink" title="é˜»å¡é˜Ÿåˆ—"></a>é˜»å¡é˜Ÿåˆ—</h3><p>é˜»å¡é˜Ÿåˆ—åŸºæœ¬çš„ä¸‰ç§å®ç°ï¼š</p><ul><li><strong>æ— ç•Œé˜Ÿåˆ—ï¼š</strong>ä»»åŠ¡æ— é™ç§¯ç´¯çŸ¥é“ä¸Šé™</li><li><strong>æœ‰ç•Œé˜Ÿåˆ—ï¼š</strong>æœ‰åˆ©äºé¿å…èµ„æºè€—å°½ï¼Œ<strong>ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—ï¼Œå…¶å¤§å°åº”ä¸çº¿ç¨‹æ± å¤§å°ä¸€èµ·è°ƒèŠ‚</strong></li><li><strong>åŒæ­¥ç§»äº¤ï¼š</strong>SynchronousQueue å¯é¿å…ä»»åŠ¡æ’é˜Ÿï¼Œç›´æ¥å°†ä»»åŠ¡ç§»äº¤ç»™å·¥ä½œçº¿ç¨‹ï¼Œå¯ä»¥è¯´ä¸æ˜¯é˜Ÿåˆ—è€Œæ˜¯ä¸€ç§çº¿ç¨‹é—´è¿›è¡Œç§»äº¤çš„æœºåˆ¶ï¼Œè‹¥å…ƒç´ æ”¾å…¥è¯¥é˜Ÿåˆ—ï¼Œæ²¡æœ‰çº¿ç¨‹ç­‰å¾…ä»»åŠ¡ï¼Œåˆ™ä¼šèµ°åç»­æœ€å¤§çº¿ç¨‹ã€æ‹’ç»ç­–ç•¥çš„é€»è¾‘ï¼Œå®ƒä¸ä¼šè¿›è¡Œå­˜å‚¨ä»»åŠ¡ã€‚åœ¨æ— ç•Œçº¿ç¨‹æ± å’Œå¯æ‹’ç»ä»»åŠ¡çš„åœºæ™¯ä¸‹ï¼Œå®ƒæ‰æœ‰ä»·å€¼</li></ul><h3 id="æ‹’ç»ç­–ç•¥"><a href="#æ‹’ç»ç­–ç•¥" class="headerlink" title="æ‹’ç»ç­–ç•¥"></a>æ‹’ç»ç­–ç•¥</h3><ul><li><strong>AbortPolicyï¼š</strong>é»˜è®¤æ‹’ç»ç­–ç•¥ï¼Œä¼šæŠ›å‡º RejectedExecutionException ï¼Œæˆ‘ä»¬å¯ä»¥æ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œæ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘</li><li><strong>DiscardPolicyï¼š</strong>ç›´æ¥ä¸¢å¼ƒå½“å‰ä»»åŠ¡</li><li><strong>DiscardOldestPolicyï¼š</strong>ä¸¢å¼ƒä¸‹ä¸€ä¸ªå°†è¦è¢«æ‰§è¡Œçš„ä»»åŠ¡ï¼ŒFIFO ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„å°±æ˜¯æœ€æ—©å…¥é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œç„¶åå°è¯•é‡æ–°æäº¤æ–°ä»»åŠ¡ï¼ˆä¸æ˜“å’Œä¼˜å…ˆé˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨ï¼Œå› ä¸ºè¢«æŠ›å¼ƒçš„æ˜¯ä¼˜å…ˆçº§æœ€é«˜çš„ä»»åŠ¡ï¼‰</li><li><strong>CallerRunsPolicyï¼š</strong>è®©è°ƒç”¨äº† execute çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡</li><li>é€šè¿‡å®ç°RejectedExecutionHandlerè¿›è¡Œè‡ªå®šä¹‰æ‰©å±•</li></ul><h3 id="æ‰©å±•æ€§"><a href="#æ‰©å±•æ€§" class="headerlink" title="æ‰©å±•æ€§"></a>æ‰©å±•æ€§</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ThreadPoolExecutor executor = <span class="keyword">new</span> ThreadPoolExecutor(...) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterExecute</span><span class="params">(Runnable r, Throwable t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.afterExecute(r, t);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeExecute</span><span class="params">(Thread t, Runnable r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.beforeExecute(t, r);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">terminated</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.terminated();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><strong>beforeExecuteï¼š</strong>æ‰©å±•å‰ç½®å¤„ç†ï¼Œå‡ºç°å¼‚å¸¸ï¼Œä»»åŠ¡åˆ™ä¸æ‰§è¡Œ</li><li><strong>afterExecuteï¼š</strong>æ‰©å±•åç½®å¤„ç†</li><li><strong>terminatedï¼š</strong>æ‰€æœ‰ä»»åŠ¡å®Œæˆä¸”æ‰€æœ‰å·¥ä½œçº¿ç¨‹ä¹Ÿå…³é—­ï¼Œterminated ä¼šé‡Šæ”¾ Executor åœ¨ç”Ÿå‘½å‘¨æœŸä¸­åˆ†é…çš„èµ„æº</li></ul><h1 id="å‡å°‘é”çš„ç«äº‰"><a href="#å‡å°‘é”çš„ç«äº‰" class="headerlink" title="å‡å°‘é”çš„ç«äº‰"></a>å‡å°‘é”çš„ç«äº‰</h1><p><strong>ä¸²è¡Œæ“ä½œé™ä½å¯ä¼¸ç¼©æ€§ï¼Œè€Œä¸Šä¸‹æ–‡åˆ‡æ¢å›é™ä½æ€§èƒ½ã€‚åœ¨é”ä¸Šå‘ç”Ÿç«äº‰ä¼šåŒæ—¶å¯¼è‡´è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå› æ­¤å‡å°‘é”çš„ç«äº‰èƒ½å¤Ÿæé«˜æ€§èƒ½æ€¥å¯ä¼¸ç¼©æ€§ã€‚ï¼ˆçº¿ç¨‹é˜»å¡ä¼šé¢‘ç¹å¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰</strong></p><h2 id="ç¼©å°é”çš„èŒƒå›´"><a href="#ç¼©å°é”çš„èŒƒå›´" class="headerlink" title="ç¼©å°é”çš„èŒƒå›´"></a>ç¼©å°é”çš„èŒƒå›´</h2><p>é™ä½é”å‘ç”Ÿç«äº‰çš„å¯èƒ½æ€§ï¼Œæœ‰æ•ˆæ–¹æ³•ä¹‹ä¸€æ˜¯<strong>å‡å°‘é”çš„æŒæœ‰æ—¶é—´</strong>ã€‚ä¾‹å¦‚ï¼Œå¯å°†ä¸€äº›ä¸é”æ— å…³çš„ä»£ç ç§»å‡ºåŒæ­¥ä»£ç å—ï¼Œå°¤å…¶æ˜¯é‚£äº›å¼€é”€å¤§çš„æ“ä½œã€ä»¥åŠå¯èƒ½è¢«é˜»å¡çš„æ“ä½œï¼Œå¦‚IOæ“ä½œã€‚</p><p>ç»†åŒ–åŠ é”çš„ä»£ç èŒƒå›´ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘é”æŒæœ‰æ—¶é—´ã€‚è€Œæœ‰æ—¶åŒæ­¥ä»£ç èŒƒå›´ä¹Ÿä¸éš¾è¿‡å°ï¼Œä¸€äº›éœ€è¦ä¿è¯åŸå­æ€§çš„æ“ä½œï¼Œå¿…é¡»åŒ…å«åœ¨ä¸€ä¸ªåŒæ­¥å—ä¸­ã€‚</p><p><strong>ä¾‹ï¼šå°†ä¸€ä¸ªåŒæ­¥æ–¹æ³•æ”¹å†™æˆå†…éƒ¨å…³é”®é€»è¾‘ä½¿ç”¨ synchronized ä¿®é¥°ï¼Œå‡å°‘é”å†…éƒ¨é€»è¾‘æ‰§è¡Œçš„æ—¶é—´ã€‚</strong></p><h2 id="å‡å°é”çš„ç²’åº¦â€”â€”é”åˆ†è§£"><a href="#å‡å°é”çš„ç²’åº¦â€”â€”é”åˆ†è§£" class="headerlink" title="å‡å°é”çš„ç²’åº¦â€”â€”é”åˆ†è§£"></a>å‡å°é”çš„ç²’åº¦â€”â€”é”åˆ†è§£</h2><p>å¦ä¸€ç§<strong>å‡å°‘é”çš„æŒæœ‰æ—¶é—´</strong>çš„æ–¹å¼æ˜¯<strong>é™ä½çº¿ç¨‹è¯·æ±‚é”çš„é¢‘ç‡</strong>ï¼Œè¿›è€Œå‡å°‘å‘ç”Ÿç«äº‰çš„å¯èƒ½æ€§ã€‚</p><p>å¦‚ä¸€ä¸ªé”éœ€è¦ä¿æŠ¤<strong>å¤šä¸ªç›¸äº’ç‹¬ç«‹çš„çŠ¶æ€å˜é‡</strong>ï¼Œä½ ä»¬å¯ä»¥å°†è¿™ä¸ªé”åˆ†è§£ä¸ºå¤šä¸ªé”ï¼Œæ¯ä¸ªé”ä¿æŠ¤ä¸€ä¸ªå˜é‡ï¼Œé™ä½æ¯ä¸ªé”è¢«è¯·æ±‚çš„é¢‘ç‡ï¼Œæé«˜å¯ä¼¸ç¼©æ€§ã€‚</p><p>å¯¹ç«äº‰é€‚ä¸­çš„é”è¿›è¡Œåˆ†è§£æ—¶ï¼Œå®é™…ä¸Šæ—¶å°†è¿™äº›é”è½¬å˜ä¸ºéç«äº‰é”ï¼Œæœ‰æ•ˆæé«˜æ€§èƒ½ã€‚è€Œå¯¹ç«äº‰å¹¶ä¸æ¿€çƒˆçš„é”è¿›è¡Œåˆ†è§£ï¼Œåˆ™æå‡æœ‰é™ã€‚</p><p><strong>ä¾‹ï¼šå‰ææ˜¯ä¸€ä¸ªç±»æœ‰å¤šä¸ªç‹¬ç«‹çš„å˜é‡ï¼Œä¸”å½“å‰ç±»å­˜åœ¨å¤šä¸ªåŒæ­¥æ–¹æ³•ï¼Œæœªè¿›è¡Œé”åˆ†è§£å‰ï¼Œæ‰€æœ‰æ–¹æ³•éƒ½ä¼šé’ˆå¯¹å½“å‰å®ä¾‹è·å–é”ï¼Œè¿›è¡Œé”åˆ†è§£åï¼Œæˆ‘ä»¬å–æ¶ˆåŒæ­¥æ–¹æ³•ï¼Œæ”¹ä¸ºåœ¨æ–¹æ³•å†…éƒ¨ä½¿ç”¨ synchronized è·å–çš„é”åˆ™æ˜¯å„ä¸ªé€»è¾‘å¯¹åº”çš„ç‹¬ç«‹å˜é‡ï¼Œè¿™æ ·æ‰€æœ‰æ–¹æ³•é”çš„å¯¹è±¡å°±ç»†åŒ–äº†ï¼Œå‡å°äº†é”çš„ç²’åº¦ã€‚</strong></p><h2 id="å‡å°é”çš„ç²’åº¦â€”â€”é”åˆ†æ®µ"><a href="#å‡å°é”çš„ç²’åº¦â€”â€”é”åˆ†æ®µ" class="headerlink" title="å‡å°é”çš„ç²’åº¦â€”â€”é”åˆ†æ®µ"></a>å‡å°é”çš„ç²’åº¦â€”â€”é”åˆ†æ®µ</h2><p>å°†ä¸€ä¸ªç«äº‰æ¿€çƒˆçš„é”åˆ†è§£ä¸ºä¸¤ä¸ªé”ï¼Œåˆ†è§£åçš„å¤šä¸ªé”å¯èƒ½éƒ½å­˜åœ¨æ¿€çƒˆçš„ç«äº‰ï¼Œåœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œæ— æ³•å¾—åˆ°æœ€å¤§çš„æ€§èƒ½æå‡ï¼Œ</p><p>æŸäº›æƒ…å†µä¸‹ï¼Œå¯å°†é”åˆ†è§£æŠ€æœ¯è¿›ä¸€æ­¥æ‰©å±•ä¸ºå¯¹ä¸€ç»„ç‹¬ç«‹å¯¹è±¡ä¸Šçš„é”è¿›è¡Œåˆ†è§£ï¼Œå³é”åˆ†æ®µï¼Œç»†åŒ–ä½œç”¨åŸŸã€‚</p><p>ConcurrentHashMap jdk1.7å°±æ˜¯åˆ†æ®µé”å®ç°ï¼Œç°åœ¨jdk1.8å·²ç»æ¢æˆ cas + synchronizedï¼Œé€šè¿‡å‡å°‘é”ç²’åº¦ï¼Œä»1.7çš„åˆ†æ®µåˆ°1.8çš„å„ä¸ªèŠ‚ç‚¹ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œç›¸å½“äºè¿›ä¸€æ­¥åˆ†æ®µäº†ï¼Œå…·ä½“åé¢æˆ‘è€ƒè™‘å»å†™ä¸€ä¸‹ConcurrentHashMapçš„æºç åˆ†æï¼Œåˆ°æ—¶å€™åœ¨å…³æ³¨ç»†èŠ‚ã€‚</p><p><strong>ä¾‹ï¼šå­˜åœ¨ä¸€ä¸ªmapå®ä¾‹ä¸­ï¼Œå¯ä»¥é€šè¿‡hashç®—æ³•ï¼ˆé€šè¿‡hashcodeè®¾è®¡ï¼‰è·å–æ¯ä¸ªçº¿ç¨‹å¯¹åº”çš„æ˜ å°„ï¼Œä¹Ÿå°±æ˜¯å°†mapä¸­å®ä¾‹åˆ†æ®µæ“ä½œï¼Œæ¯æ¬¡é”çš„å¯¹è±¡ç”±ä¸€ä¸ªmapå®ä¾‹å˜ä¸ºç®—æ³•å¤„ç†åå„ä¸ªçº¿ç¨‹å¯¹åº”çš„å­æ¨¡å—ï¼Œå„ä¸ªçº¿ç¨‹æ“ä½œçš„åŒºé—´ä¸ä¸€æ ·ï¼Œå‡å°é”ç²’åº¦æé«˜æ€§èƒ½ã€‚</strong></p><h2 id="æ”¾å¼ƒç‹¬å é”"><a href="#æ”¾å¼ƒç‹¬å é”" class="headerlink" title="æ”¾å¼ƒç‹¬å é”"></a>æ”¾å¼ƒç‹¬å é”</h2><p>ç¬¬ä¸‰ç§é™ä½é”ç«äº‰çš„æ–¹å¼å°±æ˜¯æ”¾å¼ƒä½¿ç”¨ç‹¬å é”ï¼Œæ‰æœ‰éç‹¬å é”æˆ–éé˜»å¡é”è¿›è¡Œä¼˜åŒ–ã€‚</p><ul><li>è¯»å†™é” ReadWriteLockï¼Œè¯»é”å…±äº«ï¼Œå†™é”ç‹¬å </li><li>åŸå­ç±»ï¼Œæä¾›åœ¨æ•´æ•°ã€å¯¹è±¡å¼•ç”¨ä¸Šçš„ç»†ç²’åº¦åŸå­æ“ä½œ</li></ul><h1 id="æ˜¾å¼é”"><a href="#æ˜¾å¼é”" class="headerlink" title="æ˜¾å¼é”"></a>æ˜¾å¼é”</h1><h2 id="Lockä¸ReentrantLock"><a href="#Lockä¸ReentrantLock" class="headerlink" title="Lockä¸ReentrantLock"></a>Lockä¸ReentrantLock</h2><p>å’ŒsynåŒæ­¥ä»£ç å—å†…ç½®åŠ é”æœºåˆ¶ä¸åŒï¼ŒLockæ¥å£æä¾›äº†å¤šç§é”è·å–çš„æ–¹å¼ï¼Œä¸”æ‰€æœ‰åŠ é”ã€è§£é”æ–¹æ³•éƒ½æ˜¯æ˜¾å¼çš„ã€‚ReentrantLock å®ç° Lockæ¥å£ï¼Œå¹¶æä¾›ä¸ syn ç›¸åŒçš„äº’æ–¥æ€§å’Œå†…å­˜å¯è§æ€§ã€‚è·å– ReentrantLock æ—¶ï¼Œæœ‰ç€ä¸è¿›å…¥åŒæ­¥ä»£ç å—ç›¸åŒçš„å†…å­˜è¯­ä¹‰ï¼Œé‡Šæ”¾ ReentrantLock æ—¶ ï¼ŒåŒæ ·æœ‰ä¸é€€å‡ºåŒæ­¥ä»£ç å—ç›¸åŒçš„å†…å­˜è¯­ä¹‰ã€‚æ­¤å¤–ï¼ŒReentrantLock å’Œ synchronized ä¸€æ ·å…·æœ‰å¯é‡å…¥çš„åŠ é”è¯­ä¹‰ã€‚</p><p>è‡³äºä¸ºä»€ä¹ˆè¦åˆ›å»ºä¸€ç§å’Œå†…ç½®é”é«˜åº¦ç›¸ä¼¼çš„é”æœºåˆ¶ï¼Œè¿™æ˜¯å› ä¸ºå†…ç½®é”å­˜åœ¨ä¸€å®šå±€é™æ€§ã€‚å†…ç½®é”å¿…é¡»åœ¨è·å–è¯¥é”çš„ä»£ç å—ä¸­é‡Šæ”¾ï¼Œè¿›å…¥ä»£ç å—è·å–é”ï¼Œé€€å‡ºä»£ç å—é‡Šæ”¾é”ï¼Œç®€åŒ–äº†ç¼–ç å·¥ä½œï¼Œ<strong>ä½†å´æ— æ³•å®ç°éé˜»å¡ç»“æ„çš„åŠ é”è§„åˆ™ã€‚</strong></p><p>é€šå¸¸æˆ‘ä»¬ä½¿ç”¨Lockæ¥å£ï¼Œéœ€è¦ try-finally æ ¼å¼ï¼Œåœ¨finallyä¸­ç¡®ä¿é”çš„é‡Šæ”¾ã€‚ä»¥ä¸‹å±•ç¤ºå››ç§åŠ é”æœºåˆ¶ï¼š</p><ul><li>ç‹¬å é”</li><li>è½®è¯¢é”ï¼Œæ ¹æ®éé˜»å¡åŠ é”è¿›è¡Œè½®è¯¢é‡è¯•</li><li>å®šæ—¶é”ï¼Œæœªè¶…æ—¶æœŸé—´ä¸ºç‹¬å ï¼Œè¢«é˜»å¡ä½å¯å“åº”ä¸­æ–­</li><li>å¯æ„ŸçŸ¥ä¸­æ–­çš„ç‹¬å é”</li><li>éå—ç»“æ„çš„åŠ é”ï¼Œæ˜¾ç¤ºé”çš„lockå¯ä»¥åº”å¯¹éå—ç»“æ„</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç‹¬å é”ï¼Œé˜»å¡</span></span><br><span class="line">lock.lock();</span><br><span class="line"></span><br><span class="line"><span class="comment">// é…åˆå¾ªç¯ä¸€ç›´é‡è¯•ç»„æˆè½®è¯¢é”ï¼Œéé˜»å¡åŠ é”ï¼Œæœ‰è¿”å›å€¼</span></span><br><span class="line"><span class="keyword">boolean</span> b = lock.tryLock();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šæ—¶é”ï¼Œè¶…æ—¶æ—¶é—´å†…æ˜¯ç‹¬å é”ï¼Œé˜»å¡ï¼Œè¶…æ—¶åå˜ä¸ºéé˜»å¡ï¼Œæœ‰è¿”å›å€¼ã€‚ä¸”é˜»å¡æ—¶å¯ä»¥å“åº”ä¸­æ–­</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">boolean</span> b1 = lock.tryLock(<span class="number">1</span>, TimeUnit.DAYS);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„ŸçŸ¥ä¸­æ–­çš„ç‹¬å é”</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    lock.lockInterruptibly();</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// synåŒæ­¥ä»£ç å—ï¼Œå—ç»“æ„åŠ é”</span></span><br><span class="line"><span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">doSomthing();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å…¬å¹³æ€§"><a href="#å…¬å¹³æ€§" class="headerlink" title="å…¬å¹³æ€§"></a>å…¬å¹³æ€§</h2><p>ReentrantLock æœ‰å…¬å¹³é”ã€éå…¬å¹³é”ä¸¤ç§å®ç°ï¼Œå…¬å¹³é”çº¿ç¨‹æŒ‰ç…§å‘å‡ºè¯·æ±‚çš„é¡ºåºè·å¾—é”ï¼Œè€Œéå…¬å¹³é”å…è®¸æ’é˜Ÿï¼Œå³æŸçº¿ç¨‹è¯·æ±‚éå…¬å¹³é”æ—¶ï¼Œè‹¥å‘å‡ºè¯·æ±‚çš„åŒæ—¶è¯¥é”çš„çŠ¶æ€å˜ä¸ºå¯ç”¨ï¼Œåˆ™è·³è¿‡é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„ç­‰å¾…çº¿ç¨‹å¹¶è·å¾—è¯¥é”ã€‚</p><p>æ™®é€šåœºæ™¯æˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨é»˜è®¤å®ç°ï¼Œå³éå…¬å¹³é”æé«˜ååé‡ï¼Œæœ‰éœ€è¦ä½¿ç”¨å…¬å¹³é”çš„ç‰¹æ®Šåœºæ™¯åˆ™å¦å¤–è®¨è®ºã€‚</p><h2 id="synchronizedã€ReentrantLock-çš„é€‰æ‹©"><a href="#synchronizedã€ReentrantLock-çš„é€‰æ‹©" class="headerlink" title="synchronizedã€ReentrantLock çš„é€‰æ‹©"></a>synchronizedã€ReentrantLock çš„é€‰æ‹©</h2><p>ä¸ºä»€ä¹ˆæœ‰äº† ReentrantLock æˆ‘ä»¬è¿˜åœ¨ç”¨ synchronizedï¼Ÿä¸»è¦æ˜¯ synchronized å¯ä»¥è‡ªåŠ¨é‡Šæ”¾é”ï¼Œæ²¡æœ‰äº†ReentrantLock å¿˜è®°é‡Šæ”¾é”çš„éšæ‚£ï¼Œä¸” synchronized å·²ç»è¢«å¹¿æ³›ä½¿ç”¨ä¹Ÿèƒ½æ»¡è¶³æ™®é€šéœ€æ±‚ã€‚è€Œ ReentrantLock ä¸»è¦æ˜¯é€‚ç”¨äºå†…ç½®é”æ— æ³•æ»¡è¶³éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œå……å½“ä¸€ç§é«˜çº§å·¥å…·ï¼Œæä¾›ä¸€äº›é«˜é˜¶åŠŸèƒ½ï¼Œæˆ‘ä»¬æ™®é€šåŠ é”ä½¿ç”¨ synchronized å°±å¤Ÿäº†ã€‚</p><p>æ­¤å¤– synchronized ç›¸æ¯” ReentrantLock è¿˜æœ‰ä¸€ä¸ªä¼˜ç‚¹ï¼š<strong>çº¿ç¨‹è½¬å‚¨ä¸­èƒ½ç»™å‡ºåœ¨å“ªäº›è°ƒç”¨å¸§ä¸­è·å¾—äº†å“ªäº›é”ï¼Œå¹¶å¯ä»¥æ£€æµ‹å’Œè¯†åˆ«å‘ç”Ÿæ­»é”çš„çº¿ç¨‹ã€‚</strong>è€Œ ReentrantLock æƒ³å®ç°è¿™ä¸ªåŠŸèƒ½éœ€è¦è‡ªè¡Œå®ç°æ¥å£ï¼ŒReentrantLock çš„éå—ç»“æ„ç‰¹æ€§æ„å‘³ç€è·å–é”çš„æ“ä½œä¸èƒ½ä¸ç‰¹å®šçš„æ ˆå¸§å…³è”èµ·æ¥ï¼Œè€Œ synchronized å¯ä»¥ã€‚</p><h2 id="ReentrantReadWriteLock-è¯»å†™é”"><a href="#ReentrantReadWriteLock-è¯»å†™é”" class="headerlink" title="ReentrantReadWriteLock è¯»å†™é”"></a>ReentrantReadWriteLock è¯»å†™é”</h2><p>è¯»å†™é”æ”¾å®½åŠ é”éœ€æ±‚ï¼Œå…è®¸å¤šä¸ªè¯»çº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œå¯ä»¥æå‡ç³»ç»Ÿæ€§èƒ½ã€‚åªè¦æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½ç¡®ä¿è¯»å–åˆ°æœ€æ–°æ•°æ®ï¼Œä¸”è¯»å–æ•°æ®æ—¶ä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹æ•°æ®ï¼Œå°±ä¸ä¼šå‘ç”Ÿé—®é¢˜ï¼ŒåŸºäºæ­¤ç§æƒ…å†µä½¿ç”¨è¯»å†™é”ï¼Œ<strong>è¯»é”å¯è¢«å¤šä¸ªçº¿ç¨‹æŒæœ‰ï¼Œå†™é”åªèƒ½è¢«å•ä¸€çº¿ç¨‹æŒæœ‰ã€‚</strong></p><p>åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šè¢«é¢‘ç¹è¯»å–çš„æ•°æ®ç»“æ„ï¼Œè¯»å†™é”èƒ½æé«˜æ€§èƒ½ï¼Œè€Œå…¶ä»–æƒ…å†µä¸‹è¯»å†™é”å› ä¸ºå¤æ‚æ€§é«˜äºç‹¬å é”ï¼Œæ€§èƒ½ä¼šç•¥å·®ä¸€ç‚¹ã€‚åŸºäºå®é™…åœºæ™¯ä½¿ç”¨ã€‚</p><p><strong>å¤šçº¿ç¨‹è¯»å†™é”ï¼Œè¯»è¯»å…±äº«ã€è¯»å†™äº’æ–¥ã€å†™è¯»äº’æ–¥ã€å†™å†™äº’æ–¥ï¼Œä½†æ˜¯å†…éƒ¨åŠ é”æ“ä½œæœ‰æ‰€ä¸åŒã€‚</strong></p><h3 id="å¯é‡å…¥æ€§"><a href="#å¯é‡å…¥æ€§" class="headerlink" title="å¯é‡å…¥æ€§"></a>å¯é‡å…¥æ€§</h3><p>è¯»å†™é”ï¼Œè¯»é”ã€å†™é”éƒ½æ˜¯å¯é‡å…¥çš„ï¼Œå†™é”å†…éƒ¨åŠ å†™é”ä¸ä¼šæ­»é”ã€‚</p><h3 id="é”é™çº§"><a href="#é”é™çº§" class="headerlink" title="é”é™çº§"></a>é”é™çº§</h3><p>å½“ä¸€ä¸ªçº¿ç¨‹æŒæœ‰å†™é”ï¼Œå½“å®ƒæœªé‡Šæ”¾å†™é”çš„æƒ…å†µä¸‹è·å–è¯»é”ï¼Œè¿™ä¼šä½¿å†™é”é™çº§ä¸ºè¯»é”ï¼ŒåŒæ—¶ä¸å…è®¸å…¶ä»–å†™çº¿ç¨‹ä¿®æ”¹è¢«ä¿æŠ¤çš„èµ„æºï¼Œ<strong>é”é™çº§æ˜¯ä¸ºäº†ä¿è¯çº¿ç¨‹çš„å¯è§æ€§ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockDegrade</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    ReadWriteLock lock = <span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line">    Lock writeLock = lock.writeLock();</span><br><span class="line">    Lock readLock = lock.readLock();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        LockDegrade degrade = <span class="keyword">new</span> LockDegrade();</span><br><span class="line">        <span class="keyword">new</span> Thread(degrade::doSomething).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(degrade::doSomething).start();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//    public void doSomething () &#123;</span></span><br><span class="line"><span class="comment">//        writeLock.lock();</span></span><br><span class="line"><span class="comment">//    </span></span><br><span class="line"><span class="comment">//        ++i;</span></span><br><span class="line"><span class="comment">//        try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; &#125;</span></span><br><span class="line"><span class="comment">//        System.out.println(i);</span></span><br><span class="line"><span class="comment">//    </span></span><br><span class="line"><span class="comment">//        writeLock.unlock();</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    public void doSomething () &#123;</span></span><br><span class="line"><span class="comment">//        writeLock.lock();</span></span><br><span class="line"><span class="comment">//        ++i;</span></span><br><span class="line"><span class="comment">//        writeLock.unlock();</span></span><br><span class="line"><span class="comment">//        </span></span><br><span class="line"><span class="comment">//      try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; &#125;</span></span><br><span class="line"><span class="comment">//        System.out.println(i);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        writeLock.lock();</span><br><span class="line">        ++i;</span><br><span class="line">        readLock.lock();</span><br><span class="line">        </span><br><span class="line">        writeLock.unlock();</span><br><span class="line">        <span class="keyword">try</span> &#123; Thread.sleep(<span class="number">1000</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; &#125;</span><br><span class="line">        System.out.println(i);</span><br><span class="line">        readLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é’ˆå¯¹ä¸Šé¢è¿™ä¸ªdemoæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹é”é™çº§ï¼Œ3ä¸ªdoSomethingçš„å†™æ³•é€ä¸ªåˆ†æ</p><ul><li>ç¬¬ä¸€ç§å†™æ³•æ˜¯é€šè¿‡å†™é”äº’æ–¥ï¼Œè®©æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½è¯»åˆ°è‡ªå·±ä¿®æ”¹åçš„å˜é‡å€¼ï¼Œå‡å®šä¸šåŠ¡æœ‰ä¼˜åŒ–ç©ºé—´ï¼Œåªæœ‰æ•°æ®ä¿®æ”¹è¿™ä¸€æ­¥æ˜¯å¹¶å‘çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›¸åº”çš„å‡å°é”çš„èŒƒå›´ï¼Œæé«˜æ€§èƒ½ã€‚</li><li>ç¬¬äºŒç§å†™æ³•æ˜¯æˆ‘ä»¬ä¸ºäº†å‡å°é”çš„èŒƒå›´ï¼Œåªå°†æ•°æ®ä¿®æ”¹åŒ…è£¹åœ¨å†™é”å†…ï¼Œåç»­é‡Šæ”¾é”æ ¹æ®æ•°æ®èµ°ä¸šåŠ¡é€»è¾‘ï¼Œä½†æ­¤æ—¶å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œå½“çº¿ç¨‹Aå†™é”é‡Šæ”¾åï¼Œçº¿ç¨‹Bå°±å¯ä»¥æ‹¿åˆ°å†™é”è¿›è¡Œæ•°æ®ä¿®æ”¹æ“ä½œï¼Œæ­¤æ—¶å¦‚æœçº¿ç¨‹Aåç»­ä¸šåŠ¡è¯»å–æ•°æ®çš„æ“ä½œè¿˜æœªæ‰§è¡Œï¼Œé‚£ä¹ˆçº¿ç¨‹Açš„å˜é‡å€¼ä¼šå˜ä¸ºçº¿ç¨‹Bä¿®æ”¹åçš„å€¼ï¼Œæ­¤æ—¶å½“ä¸šåŠ¡å†æ¥è¯»å–ï¼Œå°±äº§ç”Ÿäº†ä¸€è‡´æ€§é—®é¢˜ã€‚é¢å¯¹ç¬¬äºŒç§å†™æ³•çš„é—®é¢˜å°±æœ‰é”é™çº§è¿™ç§å¤„ç†æ–¹å¼ã€‚</li><li>ç¬¬ä¸‰ç§å†™æ³•å°±æ˜¯é”é™çº§ï¼Œæˆ‘ä»¬åœ¨æ‰§è¡Œå®Œæ•°æ®ä¿®æ”¹æ“ä½œåï¼Œç»§ç»­åœ¨çº¿ç¨‹å†…éƒ¨è·å–è¯»é”ï¼Œæ¥ç€æˆ‘ä»¬åœ¨é‡Šæ”¾å†™é”ï¼Œæ­¤æ—¶å†™é”è¢«é‡Šæ”¾è‚¯å®šä¼šæœ‰å…¶ä»–çº¿ç¨‹æ¥ç«äº‰ï¼Œä½†æ˜¯æˆ‘ä»¬åŠ äº†è¯»é”ï¼Œç”±äºè¯»å†™äº’æ–¥çš„åŸå› ï¼Œå…¶ä»–å†™çº¿ç¨‹è·å–ä¸åˆ°å†™é”ï¼Œéšåæˆ‘ä»¬æ‰§è¡Œä¸šåŠ¡æ“ä½œå°±èƒ½å¾—åˆ°å½“å‰çº¿ç¨‹ä¿®æ”¹çš„å˜é‡å€¼ï¼Œæœ€åé‡Šæ”¾æ‰è¯»é”å…¶ä»–å†™çº¿ç¨‹åˆå¯ä»¥æ¥ç«äº‰äº†ã€‚ä½¿ç”¨é”é™çº§å’Œç¬¬ä¸€ç§çº¯å†™é”åŒ…è£¹çš„åŒºåˆ«ï¼Œå°±æ˜¯è¯»æ•°æ®è¿™ä¸€æ­¥æ˜¯å…±äº«çš„ï¼Œæ€§èƒ½å¯èƒ½æ¯”å†™é”åŒ…è£¹é«˜ä¸€ç‚¹ï¼Œè¿™ä¸€ç‚¹ç®—æ˜¯æˆ‘çš„çŒœæƒ³ï¼Œè¿™é‡Œçš„ç¤ºä¾‹ä¹Ÿæ˜¯ä¸ºäº†è®²æ¸…æ¥šé”é™çº§åˆ°åº•æ˜¯å¹²å•¥ï¼Œèƒ½å¦åº”ç”¨åˆ°å®é™…é¡¹ç›®æˆ‘ä»¬éœ€è¦ç»“åˆå®é™…åœºæ™¯è®¨è®ºã€‚</li></ul><h3 id="ä¸ºä»€ä¹ˆæ²¡æœ‰é”å‡çº§ï¼ˆé™„åŠ å†™é”ã€è¯»é”æºç æµ…æï¼‰"><a href="#ä¸ºä»€ä¹ˆæ²¡æœ‰é”å‡çº§ï¼ˆé™„åŠ å†™é”ã€è¯»é”æºç æµ…æï¼‰" class="headerlink" title="ä¸ºä»€ä¹ˆæ²¡æœ‰é”å‡çº§ï¼ˆé™„åŠ å†™é”ã€è¯»é”æºç æµ…æï¼‰"></a>ä¸ºä»€ä¹ˆæ²¡æœ‰é”å‡çº§ï¼ˆé™„åŠ å†™é”ã€è¯»é”æºç æµ…æï¼‰</h3><p>æ—¢ç„¶å¯ä»¥å°†å†™é”é™çº§ä¸ºè¯»é”ï¼Œä¿è¯ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰å¯èƒ½å°†è¯»é”å‡çº§ä¸ºå†™é”å‘¢ï¼Œç­”æ¡ˆæ˜¯ä¸å¯ä»¥ã€‚</p><p>ä»¥ä¸‹ä¸ºç½‘ç»œç­”æ¡ˆï¼šè¯»é”å‡çº§æ­»é”è¿™ç§å†™æ³•ä¼šå¯¼è‡´æ­»é”ï¼Œå› ä¸ºè¯»é”å¯ä»¥å¤šçº¿ç¨‹åŒæ—¶æŒæœ‰ï¼Œå†™é”åªèƒ½å•ä¸€çº¿ç¨‹æŒæœ‰ï¼Œè¯»é”å‡çº§éœ€è¦å…¶ä»–çº¿ç¨‹çš„è¯»é”éƒ½é‡Šæ”¾æ‰æ‰å¯ä»¥ï¼Œæ‰€ä»¥æ¯ä¸ªæŒæœ‰è¯»é”çš„çº¿ç¨‹éƒ½æ˜¯ç­‰å¾…å…¶ä»–çº¿ç¨‹é‡Šæ”¾è¯»é”ï¼Œç„¶åå†å»è·å–å†™é”ï¼Œè¿™ä¸ªäº’ç›¸ç­‰å¾…è¯»é”é‡Šæ”¾çš„è¿‡ç¨‹å°±æ˜¯ä¸€ä¸ªæ˜æ˜¾çš„æ­»é”ï¼Œæ‰€ä»¥æ°¸è¿œè·å–ä¸åˆ°å†™é”ï¼Œæ— æ³•é”å‡çº§ã€‚</p><p>çœ‹äº†ç½‘ä¸Šå½¢å½¢è‰²è‰²çš„è§£æï¼Œæ²¡æœ‰ä¸€ä¸ªåŸºäºcodeè¯æ˜è¯´æ³•çš„ï¼Œä»Šå¤©ä¸ä¿¡é‚ªæ¥çœ‹çœ‹æºç æ˜¯æ€ä¹ˆå†™çš„ã€‚ä»¥ä¸‹æ˜¯æˆ‘å¯¹å†™é”ã€è¯»é”æºç çš„ç²—ç•¥åˆ†æã€‚</p><ul><li>å†™é”åˆ†æ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å†™é”åŠ é”æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">    Thread current = Thread.currentThread();</span><br><span class="line">    <span class="comment">// çº¿ç¨‹è·å–é”çš„æ ‡è¯†ï¼Œå¯ä»¥å½“ä½œæ•°é‡ï¼Œè·å–å†™é”+1ï¼Œè·å–è¯»é”+65536ï¼Œ</span></span><br><span class="line">    <span class="keyword">int</span> c = getState();</span><br><span class="line">    <span class="comment">// å†™é”ä¸ªæ•°ï¼Œé™¤é‡å…¥é”çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè®¡æ•°æ°¸è¿œä¸ä¼š&gt;1ï¼Œå¯è®¤ä¸ºæ˜¯å†™é”çš„å¯é‡å…¥æ•°ï¼Œå…·ä½“å®ç°çœ‹åé¢ä»£ç </span></span><br><span class="line">    <span class="comment">// åŠ è¯»é”ï¼Œä¸å½±å“å†™é”çš„å¯é‡å…¥æ•°ï¼Œè¯»é”é‡å…¥é”æ˜¯å¦ä¸€ç§è®¡ç®—æ–¹å¼ï¼Œåº•å±‚é€šè¿‡ä½è¿ç®—å®ç°</span></span><br><span class="line">    <span class="keyword">int</span> w = exclusiveCount(c);</span><br><span class="line">    <span class="comment">// stateä¸ä¸º0ï¼Œè¯´æ˜æœ‰çº¿ç¨‹è·å–äº†è¯»é”æˆ–å†™é”</span></span><br><span class="line">    <span class="keyword">if</span> (c != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 1ã€å¯é‡å…¥æ•°==0ï¼Œtrue:æœ‰çº¿ç¨‹è·å–äº†è¯»é”ï¼Œfalse:æœ‰çº¿ç¨‹è·å–äº†å†™é”</span></span><br><span class="line">        <span class="comment">// 2ã€æœ‰çº¿ç¨‹è·å–äº†å†™é”ï¼Œåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯ä¸æ˜¯ç‹¬å çº¿ç¨‹ï¼Œ</span></span><br><span class="line">        <span class="comment">// true:è¯´æ˜ä¸æ˜¯å½“å‰çº¿ç¨‹è·å–è¯»é”ï¼Œfalse:å½“å‰çº¿ç¨‹è·å–äº†å†™é”</span></span><br><span class="line">        <span class="keyword">if</span> (w == <span class="number">0</span> || current != getExclusiveOwnerThread())</span><br><span class="line">            <span class="comment">// 1ã€åªè¦æœ‰çº¿ç¨‹è·å–äº†è¯»é”ï¼ŒåŠ å†™é”å°±å¤±è´¥ï¼Œ2ã€å…¶ä»–çº¿ç¨‹è·å–äº†å†™é”ï¼Œå†™å†™äº’æ–¥ï¼ŒåŠ å†™é”å¤±è´¥</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­å†™é”çš„å¯é‡å…¥æ•°åœ¨è¿™æ¬¡åŠ é”åæ˜¯å¦è¶…è¿‡ä¸Šçº¿ï¼Œè¶…è¿‡åˆ™æŠ›error</span></span><br><span class="line">        <span class="keyword">if</span> (w + exclusiveCount(acquires) &gt; MAX_COUNT)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">&quot;Maximum lock count exceeded&quot;</span>);</span><br><span class="line">        <span class="comment">// é‡å…¥é”ï¼Œå¯¹æ ‡è¯†ä½++ï¼Œè¿™é‡Œå¯ä»¥å‘ç°é‡å…¥é”æ˜¯ç›´æ¥æ“ä½œæ ‡è¯†ä½ï¼Œæ²¡æœ‰é€šè¿‡casæ“ä½œ</span></span><br><span class="line">        setState(c + acquires);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1ã€å†™é”æ˜¯å¦åº”è¯¥é˜»å¡ï¼Œéå…¬å¹³é”=falseï¼Œå…¬å¹³é”ä¼šè¿›é˜»å¡é˜Ÿåˆ—åˆ¤æ–­èŠ‚ç‚¹</span></span><br><span class="line">    <span class="comment">// 2ã€é€šè¿‡æ ¡éªŒï¼ŒcasåŠ é”å¹¶å–åç»“æœï¼Œå†™é”state+=1ï¼Œfalse:åŠ é”æˆåŠŸï¼Œtrue:æ·é”å¤±è´¥</span></span><br><span class="line">    <span class="keyword">if</span> (writerShouldBlock() ||</span><br><span class="line">        !compareAndSetState(c, c + acquires))</span><br><span class="line">        <span class="comment">// å†™é”è¢«å…¬å¹³é”é˜»å¡é˜Ÿåˆ—é˜»å¡ï¼›æˆ–casåŠ é”å¤±è´¥</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">// casåŠ é”æˆåŠŸå°†å½“å‰çº¿ç¨‹è®¾ç½®ä¸ºç‹¬å çº¿ç¨‹</span></span><br><span class="line">    setExclusiveOwnerThread(current);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯é‡å…¥é”çš„ä¸Šé™ï¼Œè¶…è¿‡ä¼šæŠ¥errorï¼Œè‡ªå·±å¯ä»¥newä¸ªå†™é”è·‘å¾ªç¯è¯•è¯•</span></span><br><span class="line"><span class="comment">// è¿™ä¸ªä¸Šé™è®¾è®¡å’ŒåŠ è¯»é”ï¼Œstate+65536è¿™äº›è®¾è®¡éƒ½æ˜¯æŒ‚é’©çš„ï¼Œjdkä½è¿ç®—ç©çš„6</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">65536</span>; i++)&#123;</span><br><span class="line">    writeLock.lock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¯»é”åˆ†æ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯»é”åŠ é”æ–¹æ³•ï¼Œå†™é”ä¸­å‡ºç°è¿‡çš„ç®€å•æ³¨é‡Šå°±ä¸é‡å¤äº†</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">tryAcquireShared</span><span class="params">(<span class="keyword">int</span> unused)</span> </span>&#123;</span><br><span class="line">    Thread current = Thread.currentThread();</span><br><span class="line">    <span class="keyword">int</span> c = getState();</span><br><span class="line">    <span class="comment">// 1ã€å¯é‡å…¥æ•°!=0ï¼Œtrue:æœ‰çº¿ç¨‹è·å–äº†å†™é”ï¼Œfalse:æœ‰çº¿ç¨‹è·å–äº†è¯»é”ï¼Œ2ã€è§å†™é”ä¸­åˆ¤æ–­æ³¨é‡Š</span></span><br><span class="line">    <span class="keyword">if</span> (exclusiveCount(c) != <span class="number">0</span> &amp;&amp;</span><br><span class="line">        getExclusiveOwnerThread() != current)</span><br><span class="line">        <span class="comment">// æœ‰å…¶ä»–çº¿ç¨‹è·å–äº†å†™é”ï¼Œå†™è¯»äº’æ–¥åŠ è¯»é”å¤±è´¥</span></span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="comment">// è¯»é”çš„å¯é‡å…¥æ•°</span></span><br><span class="line">    <span class="keyword">int</span> r = sharedCount(c);</span><br><span class="line">    <span class="comment">// 1ã€è¯»é”æ˜¯å¦åº”è¯¥é˜»å¡ï¼Œè¿™é‡Œé¢æœ‰å¤šä¸ªæç«¯åœºæ™¯çš„æ ¡éªŒï¼Œæˆ‘ä»¬æš‚ä¸è®¨è®ºï¼Œ2ã€ä¸è¶…è¿‡å¯é‡å…¥ä¸Šé™</span></span><br><span class="line">    <span class="comment">// 3ã€casåŠ é”ï¼Œè¿™é‡Œå¯ä»¥å‘ç°è¯»é”åŠ é”state+=SHARED_UNITï¼Œå»æºç çœ‹æ˜¯ä½è¿ç®—çš„65536</span></span><br><span class="line">    <span class="keyword">if</span> (!readerShouldBlock() &amp;&amp;</span><br><span class="line">        r &lt; MAX_COUNT &amp;&amp;</span><br><span class="line">        compareAndSetState(c, c + SHARED_UNIT)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (r == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// æ²¡æœ‰å¯é‡å…¥æ•°ï¼Œæ ‡è®°ä¸ºç¬¬ä¸€æ¬¡åŠ è¯»é”çš„çº¿ç¨‹ï¼Œcount=1</span></span><br><span class="line">            firstReader = current;</span><br><span class="line">            firstReaderHoldCount = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (firstReader == current) &#123;</span><br><span class="line">            <span class="comment">// æœ‰å¯é‡å…¥æ•°ï¼Œä¸”å½“å‰çº¿ç¨‹æ˜¯ç¬¬ä¸€æ¬¡åŠ è¯»é”çš„çº¿ç¨‹ï¼Œç›´æ¥å¯¹ç¬¬ä¸€æ¬¡Readerçš„å˜é‡++</span></span><br><span class="line">            firstReaderHoldCount++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æœ‰å¯é‡å…¥æ•°ï¼Œä¸”ä¸æ˜¯ç¬¬ä¸€æ¬¡åŠ è¯»é”çš„çº¿ç¨‹ï¼Œæ‹¿ç¼“å­˜</span></span><br><span class="line">            HoldCounter rh = cachedHoldCounter;</span><br><span class="line">            <span class="keyword">if</span> (rh == <span class="keyword">null</span> || rh.tid != getThreadId(current))</span><br><span class="line">                <span class="comment">// 1ã€ç¼“å­˜æ‹¿ä¸åˆ°ï¼Œè¯´æ˜æ˜¯å¤´ä¸€æ¬¡è·å–è¯»é”çš„çº¿ç¨‹ï¼Œ</span></span><br><span class="line">                <span class="comment">// 2ã€ç¼“å­˜tidä¸å½“å‰çº¿ç¨‹ä¸åŒ¹é…ï¼Œä»æœ¬åœ°ThreadLocalè·å–ï¼Œæ­¤å¤„è®¾è®¡æˆ‘ä¸çŸ¥é“ç”¨æ„</span></span><br><span class="line">                cachedHoldCounter = rh = readHolds.get();</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (rh.count == <span class="number">0</span>)</span><br><span class="line">                <span class="comment">// ç¼“å­˜æ‹¿åˆ°ä¸”æ˜¯å½“å‰çº¿ç¨‹ï¼Œè€Œè®¡æ•°ä¸º0ï¼Œåˆ™æ”¾åˆ°æœ¬åœ°ThreadLocal</span></span><br><span class="line">                readHolds.set(rh);</span><br><span class="line">            <span class="comment">// ç¼“å­˜è®¡æ•°++</span></span><br><span class="line">            rh.count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¯»é”è¢«æ ¡éªŒé˜»å¡ æˆ– åŠ é”å¤±è´¥ç»§ç»­èµ°é€»è¾‘ï¼Œä»¥ååšAQSå…¨è§£æˆ‘ä»¬åœ¨æ…¢æ…¢ç†ï¼Œç°åœ¨å°±ä¸è¿›ä¸€æ­¥äº†</span></span><br><span class="line">    <span class="keyword">return</span> fullTryAcquireShared(current);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»ç»“ä¸€ä¸‹ï¼š</p><ul><li><strong>åŠ å†™é”æ—¶ï¼Œæ— è®ºæ˜¯å½“å‰çº¿ç¨‹è¿˜æ˜¯å…¶ä»–çº¿ç¨‹ï¼Œåªè¦æœ‰çº¿ç¨‹æŒæœ‰è¯»é”å°±åŠ å†™é”å¤±è´¥ï¼Œè¿™é‡Œä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆé”å‡çº§ä¼šå¤±è´¥ï¼Œå¿…é¡»ç­‰è¯»é”å…¨éƒ¨é‡Šæ”¾æ‰èƒ½åŠ é”ï¼Œç½‘ä¸Šçš„ç»“è®ºç¡®å®æ˜¯å¯¹çš„ï¼Œè‡³äºåŸå› å¦‚æœæˆ‘ä¸åˆ†ææ°¸è¿œéƒ½ä¸çŸ¥é“äº†ï¼Œå°±æ²¡çœ‹åˆ°ä¸€ç¯‡æ–‡ç« å¯¹ç€ä»£ç åˆ†æè¿‡ã€‚ã€‚ã€‚</strong></li><li><strong>åŠ å†™é”ï¼Œè‹¥å…¶ä»–çº¿ç¨‹æŒæœ‰å†™é”ï¼Œå†™å†™äº’æ–¥ï¼ŒåŠ é”å¤±è´¥</strong></li><li><strong>åŠ å†™é”ï¼Œè‹¥å½“å‰çº¿ç¨‹æŒæœ‰å†™é”ï¼Œå¯é‡å…¥æ€§ï¼Œå¯ä»¥åŠ é”</strong></li><li><strong>åŠ è¯»é”ï¼Œè‹¥å…¶ä»–çº¿ç¨‹æŒæœ‰å†™é”ï¼Œå†™è¯»äº’æ–¥ï¼ŒåŠ é”å¤±è´¥</strong></li><li><strong>åŠ è¯»é”ï¼Œé™¤äº†å…¶ä»–çº¿ç¨‹æŒæœ‰å†™é”çš„æƒ…å†µéƒ½èƒ½è§¦å‘åŠ é”é€»è¾‘ï¼Œæ‰€ä»¥å½“å‰çº¿ç¨‹æŒæœ‰å†™é”ä¸å½±å“å…¶è·å–è¯»é”ï¼Œè¿™ä¹Ÿå°±æ˜¯é”é™çº§å¯è¡Œçš„åŸå› ï¼Œè€Œä¸”è¯»è¯»ä¹Ÿä¸å½±å“ï¼Œè¯»è¯»å…±äº«å¾—åˆ°éªŒè¯</strong></li></ul><h2 id="Conditionï¼ˆç±»æ¯”waitï¼‰"><a href="#Conditionï¼ˆç±»æ¯”waitï¼‰" class="headerlink" title="Conditionï¼ˆç±»æ¯”waitï¼‰"></a>Conditionï¼ˆç±»æ¯”waitï¼‰</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Condition condition &#x3D; Lock.newCondition();</span><br><span class="line">condition.await();</span><br><span class="line">condition.signal();</span><br></pre></td></tr></table></figure><p>å¯¹äºæ¯ä¸ªLockï¼Œå¯ä»¥æœ‰ä»»æ„æ•°é‡çš„Conditionå¯¹è±¡ï¼Œå¯ä½¿ç”¨Conditionå¯¹æ˜¾ç¤ºé”è¿›è¡Œç­‰å¾…ã€å”¤é†’æ“ä½œï¼Œè€Œä¸æ˜¯Objectçš„waitã€notifyï¼Œå½“ç„¶å’Œå†…ç½®é”ä¸€æ ·ï¼Œæ˜¾ç¤ºé”ä½¿ç”¨Conditionè¿›è¡Œç­‰å¾…ã€å”¤é†’å‰éœ€è¦å…ˆè·å–é”ã€‚</p><p>psï¼šåœ¨Conditionå¯¹è±¡ä¸­ï¼Œå¯¹åº”waitã€notifyã€notifyAllçš„åˆ†åˆ«æ˜¯awaitã€signalã€signalAllï¼Œä½†æ˜¯Conditionå¯¹Objectè¿›è¡Œäº†æ‰©å±•ï¼Œå®ƒä¹ŸåŒ…å«äº†waitã€notifyï¼Œæˆ‘ä»¬ä¸€å®šè¦ä½¿ç”¨æ­£ç¡®çš„ç‰ˆæœ¬â€”â€”awaitã€signal</p><h1 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h1><p>compareAndSwap æ¯”è¾ƒå¹¶è®¾ç½®ï¼Œæ— è®ºæ“ä½œæ˜¯å¦æˆåŠŸéƒ½æœ‰è¿”å›ï¼ŒCASåŒ…å«äº†ä¸‰ä¸ªæ“ä½œæ•°ï¼Œéœ€è¦è¯»å†™çš„å†…å­˜ä½ç½®Vã€è¿›è¡Œæ¯”è¾ƒçš„å€¼Aã€æ‹Ÿå†™å…¥çš„æ–°å€¼Bã€‚å½“ä¸”ä»…å½“Vçš„å€¼ç­‰äºAæ—¶ï¼ŒCASæ‰ä¼šé€šè¿‡åŸå­æ–¹å¼ç”¨æ–°å€¼Bæ¥æ›´æ–°Vçš„å€¼ï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚</p><p>å½“å¤šçº¿ç¨‹å°è¯•ä½¿ç”¨CASåŒæ—¶æ›´æ–°ä¸€ä¸ªå˜é‡æ—¶ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹èƒ½æ›´æ–°å˜é‡å€¼ï¼Œè€Œå…¶ä»–çº¿ç¨‹éƒ½å°†å¤±è´¥ï¼Œå¤±è´¥çº¿ç¨‹ä¸ä¼šè¢«æŒ‚èµ·ï¼Œè€Œæ˜¯å‘ŠçŸ¥ç«äº‰å¤±è´¥ã€‚CASå¯å®ç°åŸå­æ€§çš„è¯»â€”æ”¹â€”å†™æ“ä½œã€‚</p><h2 id="ABA"><a href="#ABA" class="headerlink" title="ABA"></a>ABA</h2><p>å½“æ•°æ®Aè¢«ä¸¤ä¸ªçº¿ç¨‹Xã€Yéƒ½åŒæ—¶è¯»åˆ°ï¼ŒYçº¿ç¨‹å…ˆå¤„ç†å…¶ä»–ä¸šåŠ¡ï¼Œè€ŒXåˆ™è¿›è¡Œä¸¤æ¬¡CASæ“ä½œï¼Œæ•°æ®å˜åŒ–ä¸º A -&gt; Bï¼ŒB -&gt; Aï¼Œæœ€åç­‰Yå¤„ç†å®Œä¸šåŠ¡è¿›è¡ŒCASæ“ä½œæ—¶ï¼Œçœ‹åˆ°çš„æ•°æ®ä»ç„¶æ˜¯Aï¼Œè¯¯ä»¥ä¸ºæ²¡æœ‰æ”¹å˜ï¼ŒæˆåŠŸæ‰§è¡Œäº†CASï¼Œå…¶å®åœ¨å®é™…æ“ä½œä¸­è¯¥æ•°æ®æ˜¯è¢«æ”¹å˜äº†ï¼Œè¿™ç§ä¸­é—´çŠ¶æ€çš„ä¸å¯æŸ¥æƒ…å†µå³æ˜¯ABAé—®é¢˜ã€‚</p><p>å¯¹äºè§¦å‘è¿™ç§é—®é¢˜çš„åœºæ™¯ï¼Œå¸¸è§„è§£å†³æ–¹æ¡ˆæ˜¯å¼•å…¥ç¬¬ä¸‰æ–¹å‚æ•°è¿›è¡Œè¾…åŠ©æ ¡éªŒï¼Œä¾‹å¦‚ç‰ˆæœ¬å·æœºåˆ¶ï¼Œæ¯æ¬¡æ“ä½œæ•°æ®åˆ™ç‰ˆæœ¬å·é€’å¢ï¼Œå³ä½¿å¤šä¸ªçº¿ç¨‹è¯»å–æ•°æ®æ—¶å€¼ä¸€æ ·ï¼Œä½†è½®åˆ°æ¯ä¸ªçº¿ç¨‹æ“ä½œæ—¶ç‰ˆæœ¬å·ä¸ä¸€è‡´ï¼Œè¯´æ˜ä¸­é—´çŠ¶æ€è¢«ä¿®æ”¹è¿‡ï¼ŒCASæ‰§è¡Œå¤±è´¥ã€‚</p><p>ä¸€èˆ¬CASæ“ä½œæ˜¯åœ¨Unsafeç±»ä¸­å®ç°ï¼Œé’ˆå¯¹intã€longã€objectä¸‰ç§ç±»å‹æœ‰ä¸‰ç§å®ç°<code>compareAndSwapInt</code>ï¼Œ<code>compareAndSwapLong</code>ï¼Œ<code>compareAndSwapObject</code>ï¼ŒåŸå­ç±»ä¸­ä¼šåˆ†åˆ«åŸºäºè¿™ä¸‰ç§åŸç”Ÿæ–¹æ³•è¿›è¡Œå°è£…ï¼Œè€Œè§£å†³ABAé—®é¢˜å°±æœ‰ä¸¤ä¸ªåŸå­ç±»å¯ä»¥å®ç°ï¼Œ<code>AtomicStampedReference</code>ï¼Œ<code>AtomicMarkableReference</code>ï¼Œç¬¬ä¸€ä¸ªæ˜¯ç±»ä¼¼äºç‰ˆæœ¬å·çš„å®ç°ï¼Œç¬¬äºŒä¸ªæ˜¯é€šè¿‡true falseè¿›è¡Œè¾…åŠ©æ ‡è®°ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å†…å­˜å¯è§æ€§&quot;&gt;&lt;a href=&quot;#å†…å­˜å¯è§æ€§&quot; class=&quot;headerlink&quot; title=&quot;å†…å­˜å¯è§æ€§&quot;&gt;&lt;/a&gt;å†…å­˜å¯è§æ€§&lt;/h1&gt;&lt;p&gt;é€šå¸¸æˆ‘ä»¬æ— æ³•ç¡®ä¿æ‰§è¡Œè¯»æ“ä½œçš„çº¿ç¨‹èƒ½é€‚æ—¶çš„çœ‹åˆ°å…¶ä»–å†™çº¿ç¨‹å†™å…¥çš„å€¼ï¼Œä¸ºäº†ç¡®ä¿å¤šçº¿ç¨‹é—´å¯¹å†…å­˜å†™å…¥æ“ä½œçš„å¯è§æ€§ï¼Œå¿…é¡»ä½¿ç”¨åŒæ­¥</summary>
      
    
    
    
    <category term="å·¥ä½œ &amp; æºç " scheme="http://aidianfirst.com/categories/%E5%B7%A5%E4%BD%9C-%E6%BA%90%E7%A0%81/"/>
    
    
  </entry>
  
  <entry>
    <title>ES operation mark</title>
    <link href="http://aidianfirst.com/2023/07/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/ES/"/>
    <id>http://aidianfirst.com/2023/07/30/%E4%B8%AD%E9%97%B4%E4%BB%B6/ES/</id>
    <published>2023-07-30T11:20:17.727Z</published>
    <updated>2023-12-08T09:31:23.587Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ•°æ®è¿ç§»"><a href="#æ•°æ®è¿ç§»" class="headerlink" title="æ•°æ®è¿ç§»"></a>æ•°æ®è¿ç§»</h1><h2 id="æ•°æ®è¿ç§»æµç¨‹"><a href="#æ•°æ®è¿ç§»æµç¨‹" class="headerlink" title="æ•°æ®è¿ç§»æµç¨‹"></a>æ•°æ®è¿ç§»æµç¨‹</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å…ˆå°†ä¸Šæ¬¡çš„å¤‡ä»½æ•°æ®æ¸…ç©º</span></span><br><span class="line"><span class="string">delete</span> <span class="string">/logger_mes_bak</span></span><br><span class="line"><span class="string">delete</span> <span class="string">/logger_mcs_bak</span></span><br><span class="line"><span class="string">delete</span> <span class="string">/logger_mcs_command_bak</span></span><br><span class="line"><span class="string">delete</span> <span class="string">/logger_mcs_exception_bak</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤‡ä»½ç´¢å¼•</span></span><br><span class="line"><span class="string">PUT</span> <span class="string">/logger_mcs_exception_bak</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;settings&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;number_of_shards&quot;:</span> <span class="number">6</span>,</span><br><span class="line">        <span class="attr">&quot;number_of_replicas&quot;:</span> <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;refresh_interval&quot;:</span> <span class="number">-1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;mappings&quot;</span> <span class="string">:</span> &#123;</span><br><span class="line">      <span class="string">&quot;properties&quot;</span> <span class="string">:</span> &#123;</span><br><span class="line">        <span class="string">&quot;carrier&quot;</span> <span class="string">:</span> &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> <span class="string">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;createTime&quot;</span> <span class="string">:</span> &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> <span class="string">:</span> <span class="string">&quot;date&quot;</span>,</span><br><span class="line">          <span class="string">&quot;format&quot;</span> <span class="string">:</span> <span class="string">&quot;yyyy-MM-dd HH:mm:ss.SSS || yyyy-MM-dd HH:mm:ss&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;data&quot;</span> <span class="string">:</span> &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> <span class="string">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;detail&quot;</span> <span class="string">:</span> &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> <span class="string">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;device&quot;</span> <span class="string">:</span> &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> <span class="string">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;logType&quot;</span> <span class="string">:</span> &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> <span class="string">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;vehicle&quot;</span> <span class="string">:</span> &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> <span class="string">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—§ç´¢å¼•æ•°æ®æ‹·è´è‡³å¤‡ä»½ç´¢å¼•ï¼Œreindexå¤šå‚æ•°é…ç½®ï¼Œè¿›è¡Œå¼‚æ­¥æ“ä½œ</span></span><br><span class="line"><span class="string">POST</span> <span class="string">/_reindex</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;:</span> <span class="string">&quot;logger_mcs_exception&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;:</span> <span class="string">&quot;logger_mcs_exception_bak&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ·æ–°å¤‡ä»½ç´¢å¼•</span></span><br><span class="line"><span class="string">PUT</span> <span class="string">/logger_mcs_exception_bak/_settings</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;refresh_interval&quot;:</span> <span class="string">&quot;1s&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;number_of_replicas&quot;:</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æ—§ç´¢å¼•</span></span><br><span class="line"><span class="string">DELETE</span> <span class="string">/logger_mcs_exception</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ–°ç´¢å¼•</span></span><br><span class="line"><span class="string">PUT</span> <span class="string">/logger_mcs_exception</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;settings&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;number_of_shards&quot;:</span> <span class="number">6</span>,</span><br><span class="line">        <span class="attr">&quot;number_of_replicas&quot;:</span> <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;refresh_interval&quot;:</span> <span class="number">-1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;mappings&quot;</span> <span class="string">:</span> &#123;</span><br><span class="line">      <span class="string">&quot;properties&quot;</span> <span class="string">:</span> &#123;</span><br><span class="line">        <span class="string">&quot;carrier&quot;</span> <span class="string">:</span> &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> <span class="string">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;createTime&quot;</span> <span class="string">:</span> &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> <span class="string">:</span> <span class="string">&quot;date&quot;</span>,</span><br><span class="line">          <span class="string">&quot;format&quot;</span> <span class="string">:</span> <span class="string">&quot;yyyy-MM-dd HH:mm:ss.SSS || yyyy-MM-dd HH:mm:ss&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;data&quot;</span> <span class="string">:</span> &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> <span class="string">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;detail&quot;</span> <span class="string">:</span> &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> <span class="string">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;device&quot;</span> <span class="string">:</span> &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> <span class="string">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;logType&quot;</span> <span class="string">:</span> &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> <span class="string">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;vehicle&quot;</span> <span class="string">:</span> &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> <span class="string">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤‡ä»½æ•°æ®æ‹·è´åˆ°æ–°ç´¢å¼•</span></span><br><span class="line"><span class="string">POST</span> <span class="string">/_reindex</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;:</span> <span class="string">&quot;logger_mcs_exception_bak&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;:</span> <span class="string">&quot;logger_mcs_exception&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ·æ–°æ–°ç´¢å¼•</span></span><br><span class="line"><span class="string">PUT</span> <span class="string">/logger_mcs_exception/_settings</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;refresh_interval&quot;:</span> <span class="string">&quot;1s&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;number_of_replicas&quot;:</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="reindex-æ•°æ®è¿ç§»"><a href="#reindex-æ•°æ®è¿ç§»" class="headerlink" title="reindex æ•°æ®è¿ç§»"></a>reindex æ•°æ®è¿ç§»</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/docs-reindex.html#docs-reindex-api-request-body">https://www.elastic.co/guide/en/elasticsearch/reference/7.9/docs-reindex.html#docs-reindex-api-request-body</a></p><p>script ä½¿ç”¨è„šæœ¬æ“ä½œï¼Œæœ‰ä¸¤ä¸ªé…ç½®é¡¹ï¼Œsourceï¼šè„šæœ¬å†…å®¹ï¼Œlangï¼šè„šæœ¬è¯­è¨€ç±»å‹ï¼ˆé»˜è®¤å®ç°æ˜¯painlessï¼‰ï¼Œè¯¦æƒ…è§ å®˜æ–¹æ–‡æ¡£ Request body</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¯¥è¯­å¥æ‰§è¡ŒæˆåŠŸå å³ä¾§ä¼šå‡ºç°&quot;task&quot; : &quot;ä»»åŠ¡id&quot;ï¼ŒæŠŠä»»åŠ¡idè®°å½•ä¸‹æ¥ï¼Œä¸è¦å·¦å³å¼•å·</span></span><br><span class="line"><span class="string">POST</span> <span class="string">/_reindex?wait_for_completion=false</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;:</span> <span class="string">&quot;logger_mes&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;:</span> <span class="string">&quot;logger_mes_bak&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;script&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;source&quot;:</span> <span class="string">&quot;ctx._source.remove(\&quot;returnCode\&quot;);ctx._source.remove(\&quot;returnMessage\&quot;)&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠŠ&lt;task-id&gt;æ¢æˆä¸Šä¸€æ­¥æ“ä½œå¾—åˆ°çš„ä»»åŠ¡idï¼Œä¸è¦å¼•å·ï¼Œæ‰§è¡Œåå¯åœ¨å³ä¾§æŸ¥çœ‹è¿ç§»æƒ…å†µï¼Œ&quot;completed&quot; : trueä»£è¡¨å®Œæˆè¿ç§»</span></span><br><span class="line"><span class="string">GET</span> <span class="string">_tasks/&lt;task-id&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœesé›†ç¾¤è´Ÿè½½è¿‡å¤§ï¼Œå¯é€šè¿‡ä»»åŠ¡idåœæ­¢æ“ä½œ</span></span><br><span class="line"><span class="string">POST</span> <span class="string">_tasks/&lt;task-id&gt;/_cancel</span></span><br></pre></td></tr></table></figure><p>reindex æ¥æºæ•°æ®å’Œç»ˆç‚¹æ•°æ®å¯è¿›è¡ŒæŸ¥è¯¢é…ç½®è¿ç§»çš„å†…å®¹ï¼Œè¯¦æƒ…è§ å®˜æ–¹æ–‡æ¡£ Request body</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">POST</span> <span class="string">/_reindex</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;:</span> <span class="string">&quot;logger_mes&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;query&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;range&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;createTime&quot;:</span> &#123;</span><br><span class="line">              <span class="attr">&quot;gte&quot;:</span> ,</span><br><span class="line">              <span class="attr">&quot;lte&quot;:</span> </span><br><span class="line">          &#125;</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;:</span> <span class="string">&quot;logger_mes_bak&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å¸¸ç”¨API"><a href="#å¸¸ç”¨API" class="headerlink" title="å¸¸ç”¨API"></a>å¸¸ç”¨API</h1><h2 id="delete-by-query"><a href="#delete-by-query" class="headerlink" title="delete by query"></a>delete by query</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/docs-update-by-query.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.9/docs-update-by-query.html</a></p><p>scroll_sizeï¼šå•æ¬¡å†…å­˜æ“ä½œæ•°æ®é‡</p><p>slicesï¼šå¼‚æ­¥çº¿ç¨‹ï¼Œæœ€å¥½é…ç½®ä¸ºautoï¼Œesä¼šè‡ªåŠ¨åˆ†é…å’Œåˆ†ç‰‡æ•°ä¸€è‡´ï¼Œå¼‚æ­¥çº¿ç¨‹æ•°å¤§äºåˆ†ç‰‡æ•°åè€Œä¼šå¯¼è‡´æ€§èƒ½ä½ä¸‹</p><p>wait_for_completionï¼šå¼‚æ­¥æ‰§è¡Œæ“ä½œï¼Œè¯·æ±‚responseä¸ºtask-idï¼ŒæŸ¥è¯¢ä»»åŠ¡è·Ÿè¿›è¯·æ±‚æ‰§è¡Œæƒ…å†µ</p><p>refreshï¼šè¯·æ±‚æ‰§è¡ŒæˆåŠŸååˆ·æ–°æ‰€æœ‰å—å½±å“çš„åˆ†ç‰‡</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">POST</span> <span class="string">/&lt;index_name&gt;/_delete_by_query?scroll_size=5000&amp;slices=10&amp;wait_for_completion=false&amp;refresh=true</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;range&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;date&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;lt&quot;:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨javaè¿›è¡Œcodeå®ç°æ—¶éœ€æ³¨æ„ï¼ˆRestHighLevelClientï¼‰"><a href="#ä½¿ç”¨javaè¿›è¡Œcodeå®ç°æ—¶éœ€æ³¨æ„ï¼ˆRestHighLevelClientï¼‰" class="headerlink" title="ä½¿ç”¨javaè¿›è¡Œcodeå®ç°æ—¶éœ€æ³¨æ„ï¼ˆRestHighLevelClientï¼‰"></a>ä½¿ç”¨javaè¿›è¡Œcodeå®ç°æ—¶éœ€æ³¨æ„ï¼ˆRestHighLevelClientï¼‰</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">submitDeleteByQueryTask wait_for_completion &#x3D; false eså®ç°çš„å¼‚æ­¥æ“ä½œï¼Œè¿”å›å€¼taskidï¼Œå¯æ ¹æ®idæŸ¥çœ‹</span><br><span class="line">deleteByQueryAsync wait_for_completion &#x3D; true ä»£ç å±‚é¢å®ç°å¼‚æ­¥</span><br><span class="line">deleteByQuery wait_for_completion &#x3D; true åŒæ­¥åˆ é™¤</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸç”Ÿapiç¿»è¯‘ä¸€ä¸‹ï¼Œæ‰§è¡Œä»»åŠ¡æœ‰ä¸Šè¿°ä¸‰ç§æ–¹æ³•ï¼Œä»£ç å®ç°å¤šäº†ä¸€ç§å¼‚æ­¥</span></span><br><span class="line">DeleteByQueryRequest request = <span class="keyword">new</span> DeleteByQueryRequest(index);</span><br><span class="line">request.setBatchSize(<span class="number">5000</span>);</span><br><span class="line">request.setSlices(AbstractBulkByScrollRequest.AUTO_SLICES);</span><br><span class="line">request.setRefresh(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">TaskSubmissionResponse taskSubmissionResponse = esClient.submitDeleteByQueryTask(request, RequestOptions.DEFAULT);</span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ—¶BatchSizeå‚æ•°å¯¹åº”scroll_sizeï¼Œè™½ç„¶æ³¨é‡Šæœ‰å†™ï¼Œä½†æ˜¯åˆçœ‹ä»£ç æ—¶æœ‰ç–‘æƒ‘ï¼Œå› ä¸ºè¿™ä¸ªå‚æ•°å®é™…èµ‹å€¼å¦‚ä¸‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> DeleteByQueryRequest <span class="title">setBatchSize</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">    getSearchRequest().source().size(size);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨çš„æ—¶sizeå‚æ•°ï¼Œåˆšå¥½æˆ‘åœ¨ä»£ç å®ç°æ—¶æœ‰è€ƒè™‘ç±»ä¼¼æ•°æ®åº“é™åˆ¶æ¯æ¬¡æ“ä½œçš„æ•°æ®é‡ï¼Œå› ä¸ºqueryæ—¶å°±æœ‰è¿™ä¸ªsizeå‚æ•°ï¼Œæ‰€ä»¥è‡ªå·±çœ‹æºç æ—¶å°±æœ‰ç–‘é—®ï¼ŒdeleteByQueryæ˜¯å¦æ”¯æŒsizeé™åˆ¶æ•°æ®é‡ï¼ŒBatchSizeå’Œscroll_sizeæ˜¯å¦ä¸ºåŒä¸€ä¸ªå­—æ®µï¼Œä¸‹é¢æˆ‘æ¥è§£å¯†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RequestConverters.class#prepareDeleteByQueryRequest(...) 598</span></span><br><span class="line"><span class="keyword">if</span> (deleteByQueryRequest.getBatchSize() != AbstractBulkByScrollRequest.DEFAULT_SCROLL_SIZE) &#123;</span><br><span class="line">    params.putParam(<span class="string">&quot;scroll_size&quot;</span>, Integer.toString(deleteByQueryRequest.getBatchSize()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œæˆ‘ä»¬å°±èƒ½çœ‹åˆ°å®é™…åœ¨deleteByQueryæ—¶ä½¿ç”¨è¿™ä¸ªå­—æ®µçš„å€¼èµ‹ç»™äº†scroll_sizeï¼Œæœ¬æ¥è¿™ä¸ªå­—æ®µæ˜¯queryçš„é€šç”¨å­—æ®µï¼Œä½†æ˜¯åœ¨eså¯¹deleteçš„å®ç°ä¸­å°è£…äº†ä¸€å±‚ï¼Œæ„é€ è¯·æ±‚æ—¶åˆ†æˆselectã€updateã€deleteä¸‰ç§ï¼Œå„ä¸ªå‚æ•°çš„åº”ç”¨ç‚¹ä¹Ÿå°±ä¸åŒäº†</strong></p><h2 id="å•è¡¨å…¨æ•°æ®"><a href="#å•è¡¨å…¨æ•°æ®" class="headerlink" title="å•è¡¨å…¨æ•°æ®"></a>å•è¡¨å…¨æ•°æ®</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">GET</span> <span class="string">/logger_moc/_search</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;track_total_hits&quot;:</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æŸ¥è¯¢å…¨éƒ¨ç´¢å¼•æƒ…å†µ"><a href="#æŸ¥è¯¢å…¨éƒ¨ç´¢å¼•æƒ…å†µ" class="headerlink" title="æŸ¥è¯¢å…¨éƒ¨ç´¢å¼•æƒ…å†µ"></a>æŸ¥è¯¢å…¨éƒ¨ç´¢å¼•æƒ…å†µ</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">GET</span> <span class="string">/_cat/indices?v</span></span><br></pre></td></tr></table></figure><h2 id="èŠ‚ç‚¹å †å†…å­˜ï¼Œåˆ†ç‰‡è®¾ç½®"><a href="#èŠ‚ç‚¹å †å†…å­˜ï¼Œåˆ†ç‰‡è®¾ç½®" class="headerlink" title="èŠ‚ç‚¹å †å†…å­˜ï¼Œåˆ†ç‰‡è®¾ç½®"></a>èŠ‚ç‚¹å †å†…å­˜ï¼Œåˆ†ç‰‡è®¾ç½®</h2><p><a href="https://juejin.cn/post/7202639428132094010">å…³äºESåˆ†ç‰‡è®¾ç½®çš„6ä¸ªå»ºè®® - æ˜é‡‘ (juejin.cn)</a></p><p>esåˆ†ç‰‡è®¾ç½®å‰éœ€è¦å¯¹ç´¢å¼•å­˜å‚¨è¿›è¡Œè¯„ä¼°ï¼Œæœ€å¥½æ¯ä¸ªåˆ†ç‰‡å¤„äº1~50G</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_cat&#x2F;nodes?v&amp;h&#x3D;heap*</span><br><span class="line"></span><br><span class="line">GET &#x2F;_nodes&#x2F;stats&#x2F;jvm?pretty</span><br><span class="line"></span><br><span class="line">GET &#x2F;_nodes&#x2F;stats&#x2F;jvm?filter_path&#x3D;nodes.*.jvm.mem.heap_*</span><br></pre></td></tr></table></figure><h2 id="é›†ç¾¤çº§åˆ«é…ç½®ä¿®æ”¹"><a href="#é›†ç¾¤çº§åˆ«é…ç½®ä¿®æ”¹" class="headerlink" title="é›†ç¾¤çº§åˆ«é…ç½®ä¿®æ”¹"></a>é›†ç¾¤çº§åˆ«é…ç½®ä¿®æ”¹</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–æ‰€æœ‰é›†ç¾¤çº§åˆ«çš„é…ç½®</span></span><br><span class="line"><span class="string">get</span> <span class="string">_cluster/settings</span></span><br><span class="line"><span class="comment"># responseä¸»è¦æœ‰ä¸¤ä¸ªä¸»ä½“</span></span><br><span class="line"><span class="string">persistentï¼šè¿™äº›è®¾ç½®ä¼šä¸€ç›´ç”Ÿæ•ˆï¼Œå³ä½¿é›†ç¾¤é‡å¯ã€‚è¿™äº›è®¾ç½®å¯ä»¥é€šè¿‡</span> <span class="string">API</span> <span class="string">æˆ–è€…é…ç½®æ–‡ä»¶</span> <span class="string">elasticsearch.yml</span> <span class="string">æ¥è¿›è¡Œè®¾ç½®ã€‚</span></span><br><span class="line"><span class="string">transientï¼šè¿™äº›è®¾ç½®åœ¨é›†ç¾¤é‡å¯ä¹‹å‰ä¸€ç›´ä¼šç”Ÿæ•ˆã€‚ä¸€æ—¦æ•´ä¸ªé›†ç¾¤é‡å¯ï¼Œè¿™äº›è®¾ç½®å°±è¢«æ¸…é™¤ã€‚è¿™äº›è®¾ç½®å¯ä»¥é€šè¿‡</span> <span class="string">API</span> <span class="string">æ¥è¿›è¡Œè®¾ç½®ã€‚</span></span><br></pre></td></tr></table></figure><h1 id="docker-é€šè¿‡æ’ä»¶æŸ¥çœ‹å®¹å™¨å¯åŠ¨å‘½å"><a href="#docker-é€šè¿‡æ’ä»¶æŸ¥çœ‹å®¹å™¨å¯åŠ¨å‘½å" class="headerlink" title="docker é€šè¿‡æ’ä»¶æŸ¥çœ‹å®¹å™¨å¯åŠ¨å‘½å"></a>docker é€šè¿‡æ’ä»¶æŸ¥çœ‹å®¹å™¨å¯åŠ¨å‘½å</h1><p><a href="https://hub.docker.com/r/cucker/get_command_4_run_container">https://hub.docker.com/r/cucker/get_command_4_run_container</a></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">docker</span> <span class="string">pull</span> <span class="string">cucker/get_command_4_run_container</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°è£…æ’ä»¶å‘½ä»¤ï¼Œ--privileged ç»™äºˆå®¹å™¨æƒé™</span></span><br><span class="line"><span class="string">echo</span> <span class="string">&quot;alias get_run_command=&#x27;docker run  --privileged --rm -v /var/run/docker.sock:/var/run/docker.sock cucker/get_command_4_run_container&#x27;&quot;</span> <span class="string">&gt;&gt;</span> <span class="string">~/.bashrc</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨å‘½ä»¤</span></span><br><span class="line"><span class="string">.</span> <span class="string">~/.bashrc</span></span><br><span class="line"></span><br><span class="line"><span class="string">get_run_command</span> <span class="string">&lt;å®¹å™¨NAME&gt;/&lt;å®¹å™¨ID&gt;</span></span><br></pre></td></tr></table></figure><h1 id="ES-ILM-amp-rollover-ç´¢å¼•æ»šåŠ¨"><a href="#ES-ILM-amp-rollover-ç´¢å¼•æ»šåŠ¨" class="headerlink" title="ES ILM &amp; rollover ç´¢å¼•æ»šåŠ¨"></a>ES ILM &amp; rollover ç´¢å¼•æ»šåŠ¨</h1><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/ilm-index-lifecycle.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.9/ilm-index-lifecycle.html</a></p><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/ilm-rollover.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.9/ilm-rollover.html</a></p><h2 id="ILM-config"><a href="#ILM-config" class="headerlink" title="ILM config"></a>ILM config</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/ilm-settings.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.9/ilm-settings.html</a></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é›†ç¾¤çº§åˆ«é…ç½®ä¿®æ”¹ILMç­–ç•¥åº”ç”¨é¢‘ç‡ï¼Œé»˜è®¤å€¼10min</span></span><br><span class="line"><span class="string">indices.lifecycle.poll_interval</span></span><br><span class="line"></span><br><span class="line"><span class="string">PUT</span> <span class="string">_cluster/settings</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;transient&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;indices.lifecycle.poll_interval&quot;:</span> <span class="string">&quot;1m&quot;</span> </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ILM-policy"><a href="#ILM-policy" class="headerlink" title="ILM policy"></a>ILM policy</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/ilm-rollover.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.9/ilm-rollover.html</a></p><p>rollover æ»šåŠ¨apiæ­é…ILMè‡ªåŠ¨è¿›è¡Œç”Ÿå‘½å‘¨æœŸç®¡ç†</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">PUT</span> <span class="string">_ilm/policy/&lt;policy_name&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;policy&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;phases&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;hot&quot;:</span> &#123;                      </span><br><span class="line">        <span class="attr">&quot;actions&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;rollover&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;max_age&quot;:</span> <span class="string">&quot;30d&quot;</span> </span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;delete&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;min_age&quot;:</span> <span class="string">&quot;180d&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;actions&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;delete&quot;:</span> &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="index-template"><a href="#index-template" class="headerlink" title="index template"></a>index template</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">PUT</span> <span class="string">_template/&lt;template_name&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;index_patterns&quot;:</span> [</span><br><span class="line">    <span class="string">&quot;&lt;index_name-predfix&gt;-*&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;settings&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;lifecycle.name&quot;:</span> <span class="string">&quot;&lt;policy_name&gt;&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;lifecycle.rollover_alias&quot;:</span> <span class="string">&quot;&lt;your_alias&gt;&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;number_of_shards&quot;:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;mappings&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;:</span> &#123;</span><br><span class="line">      <span class="string">.....</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="init-index-amp-set-alias"><a href="#init-index-amp-set-alias" class="headerlink" title="init index &amp; set alias"></a>init index &amp; set alias</h2><p>is_write_indexï¼šè¡¨ç¤ºå½“å‰ç´¢å¼•æ˜¯å†™å…¥ç´¢å¼•</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">PUT</span> <span class="string">/&lt;index_name&gt;-000001</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;aliases&quot;:</span> &#123;</span><br><span class="line">    <span class="string">&quot;&lt;your_alias&gt;&quot;</span><span class="string">:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;is_write_index&quot;:</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³äº is_write_index å‚æ•°åœ¨ rollover index api ä¸­æœ‰è®°è½½ï¼Œç´¢å¼•æ»šåŠ¨æœ‰å¤šç§åœºæ™¯ï¼Œè¯¦æƒ…çœ‹æ–‡æ¡£ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/indices-rollover-index.html#">https://www.elastic.co/guide/en/elasticsearch/reference/7.9/indices-rollover-index.html#</a></p><p>æˆ‘ä»¬è¿™é‡Œåˆ«åå¯¹åº”å¤šä¸ªç´¢å¼•ï¼Œéœ€è¦æŒ‡å®šå“ªä¸ªç´¢å¼•æ˜¯å½“å‰æœ€æ–°å†™å…¥çš„ï¼Œæ‰€ä»¥åˆå§‹åŒ–æ—¶è®¾ç½® â€œis_write_indexâ€: trueï¼Œè§¦å‘æ»šåŠ¨åæ–°ç´¢å¼•ä¼šè¢«è®¾ç½®ä¸ºâ€is_write_indexâ€: trueï¼Œæ—§ç´¢å¼•å€¼è¢«ä¿®æ”¹ä¸ºfalse</p><h2 id="æ‰‹åŠ¨æ‰§è¡Œæ»šåŠ¨ç­–ç•¥"><a href="#æ‰‹åŠ¨æ‰§è¡Œæ»šåŠ¨ç­–ç•¥" class="headerlink" title="æ‰‹åŠ¨æ‰§è¡Œæ»šåŠ¨ç­–ç•¥"></a>æ‰‹åŠ¨æ‰§è¡Œæ»šåŠ¨ç­–ç•¥</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/indices-rollover-index.html#">https://www.elastic.co/guide/en/elasticsearch/reference/7.9/indices-rollover-index.html#</a></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">POST</span> <span class="string">/&lt;your_alias&gt;/_rollover</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;conditions&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;max_docs&quot;:</span>  <span class="number">50000</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h1 id="ELK"><a href="#ELK" class="headerlink" title="ELK"></a>ELK</h1><h2 id="filebeat"><a href="#filebeat" class="headerlink" title="filebeat"></a>filebeat</h2><p>é…ç½®é¡¹ï¼š<a href="https://www.elastic.co/guide/en/beats/filebeat/7.9/configuring-howto-filebeat.html">https://www.elastic.co/guide/en/beats/filebeat/7.9/configuring-howto-filebeat.html</a></p><p>æ¨¡æ¿åŒ–é…ç½®æ–‡ä»¶ï¼š<a href="https://www.elastic.co/guide/en/beats/filebeat/7.9/filebeat-reference-yml.html">https://www.elastic.co/guide/en/beats/filebeat/7.9/filebeat-reference-yml.html</a></p><p>filebeatæ—¥å¿—å¤šè¡ŒåŒ¹é…ï¼š<a href="https://www.elastic.co/guide/en/beats/filebeat/7.9/multiline-examples.html#multiline">https://www.elastic.co/guide/en/beats/filebeat/7.9/multiline-examples.html#multiline</a></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /u01/soft/filebeat/filebeat.yml filebeat.yml è¾“å…¥æºinputã€modulesã€‚modulesæ˜¯ä¸€äº›æ—¥å¿—æ”¶é›†æ–¹å¼çš„å®˜æ–¹å®ç°ï¼Œinputåˆ™æ˜¯è‡ªå®šä¹‰æ”¶é›†</span></span><br><span class="line"><span class="attr">filebeat.inputs:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">type:</span> <span class="string">log</span></span><br><span class="line">  <span class="attr">paths:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/usr/share/filebeat/logs/mcs-service.log</span></span><br><span class="line">  <span class="attr">fields:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">mcs</span></span><br><span class="line">  <span class="comment"># è·¨å¤šè¡Œæ—¥å¿—å¤„ç†ï¼Œä¾‹å¦‚å †æ ˆä¿¡æ¯ï¼Œæ¯æ¬¡æ—¥å¿—æ‰“å°å¼€å¤´å¿…æ˜¯æ—¥æœŸï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨æ—¥æœŸåˆ†å‰²ï¼Œè¿™é‡Œå’Œä½ çš„logbackè¾“å‡ºç›¸å¯¹åº”</span></span><br><span class="line">  <span class="attr">multiline.type:</span> <span class="string">pattern</span></span><br><span class="line">  <span class="attr">multiline.pattern:</span> <span class="string">&#x27;^\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125;&#x27;</span></span><br><span class="line">  <span class="attr">multiline.negate:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">multiline.match:</span> <span class="string">after</span></span><br><span class="line">  </span><br><span class="line"><span class="bullet">-</span> <span class="attr">type:</span> <span class="string">log</span></span><br><span class="line">  <span class="attr">paths:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/usr/share/filebeat/logs/mes-service.log</span></span><br><span class="line">  <span class="attr">fields:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">mes</span></span><br><span class="line">  <span class="attr">multiline.type:</span> <span class="string">pattern</span></span><br><span class="line">  <span class="attr">multiline.pattern:</span> <span class="string">&#x27;^\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125;&#x27;</span></span><br><span class="line">  <span class="attr">multiline.negate:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">multiline.match:</span> <span class="string">after</span></span><br><span class="line"><span class="comment"># å¿½ç•¥æŒ‡å®šæ—¶é—´è·¨åº¦å‰çš„æ–‡ä»¶</span></span><br><span class="line"><span class="attr">ignore_older:</span> <span class="string">2h</span></span><br><span class="line"><span class="comment"># æŒ‡å®šæ—¶é—´èŒƒå›´å†…æ–‡ä»¶æœªå‘ç”Ÿæ”¹å˜ï¼Œåˆ™å…³é—­æ–‡ä»¶å¤„ç†</span></span><br><span class="line"><span class="attr">close_inactive:</span> <span class="string">1m</span></span><br><span class="line"><span class="comment"># æ–‡ä»¶åˆ·æ–°é¢‘ç‡ï¼Œé»˜è®¤æ—¶é—´10s</span></span><br><span class="line"><span class="attr">scan_frequency:</span> <span class="string">10s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">output.logstash:</span></span><br><span class="line">  <span class="attr">hosts:</span> [<span class="string">&quot;128.168.11.101:5044&quot;</span>]</span><br><span class="line"><span class="attr">processors:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">drop_fields:</span></span><br><span class="line">      <span class="attr">fields:</span> [<span class="string">&quot;agent&quot;</span>,<span class="string">&quot;ecs&quot;</span>,<span class="string">&quot;host&quot;</span>,<span class="string">&quot;input&quot;</span>,<span class="string">&quot;log&quot;</span>]</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker pull elastic&#x2F;filebeat:7.9.3</span><br><span class="line"></span><br><span class="line">docker run -d \</span><br><span class="line">--name filebeat \</span><br><span class="line">--privileged&#x3D;true \</span><br><span class="line">-v &#x2F;u01&#x2F;soft&#x2F;filebeat&#x2F;filebeat.yml:&#x2F;usr&#x2F;share&#x2F;filebeat&#x2F;filebeat.yml \</span><br><span class="line">-v &#x2F;u01&#x2F;soft&#x2F;logs:&#x2F;usr&#x2F;share&#x2F;filebeat&#x2F;logs \</span><br><span class="line">-w &#x2F;usr&#x2F;share&#x2F;filebeat \</span><br><span class="line">elastic&#x2F;filebeat:7.9.3</span><br></pre></td></tr></table></figure><h3 id="æ”¶é›†å™¨å¤šä¸ªæ—¥å¿—æºå¤„ç†"><a href="#æ”¶é›†å™¨å¤šä¸ªæ—¥å¿—æºå¤„ç†" class="headerlink" title="æ”¶é›†å™¨å¤šä¸ªæ—¥å¿—æºå¤„ç†"></a>æ”¶é›†å™¨å¤šä¸ªæ—¥å¿—æºå¤„ç†</h3><p><a href="https://www.elastic.co/guide/en/beats/filebeat/7.9/filebeat-input-log.html#filebeat-input-log-fields">https://www.elastic.co/guide/en/beats/filebeat/7.9/filebeat-input-log.html#filebeat-input-log-fields</a></p><p>è‡ªå®šä¹‰fieldså­—æ®µï¼Œlogstashè¿›è¡Œåˆ†ç±»åˆ¤æ–­</p><h2 id="logstash"><a href="#logstash" class="headerlink" title="logstash"></a>logstash</h2><p>logstashå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://www.elastic.co/guide/en/logstash/7.9/input-plugins.html">https://www.elastic.co/guide/en/logstash/7.9/input-plugins.html</a></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /u01/soft/logstash/config/logstash.yml logstash.yml</span></span><br><span class="line"><span class="attr">http.host:</span> <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">9600</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ ¼å¼å¯¹æ¯”</span></span><br><span class="line"><span class="attr">logback:</span></span><br><span class="line"><span class="string">%date</span> <span class="string">%level</span> [<span class="string">%thread</span>] <span class="string">%logger&#123;36&#125;</span> [<span class="string">%file</span> <span class="string">:</span> <span class="string">%line</span>] <span class="string">%msg%n</span></span><br><span class="line"><span class="attr">logstash:</span></span><br><span class="line"><span class="string">&quot;(?&lt;log_time&gt;\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125;\s\d&#123;2&#125;:\d&#123;2&#125;:\d&#123;2&#125;,\d&#123;3&#125;) <span class="template-variable">%&#123;LOGLEVEL:level&#125;</span> \[<span class="template-variable">%&#123;DATA:thread&#125;</span>\] <span class="template-variable">%&#123;JAVACLASS:javaClass&#125;</span> \[<span class="template-variable">%&#123;DATA:class&#125;</span>\] <span class="template-variable">%&#123;GREEDYDATA:data&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logback:</span></span><br><span class="line"><span class="string">%d&#123;yyyy-MM-dd</span> <span class="string">HH:mm:ss.SSS&#125;</span> <span class="string">%ip</span> <span class="string">%level</span> [<span class="string">%thread</span>] [<span class="string">%file</span> <span class="string">:</span> <span class="string">%line</span>] <span class="string">%msg%n</span></span><br><span class="line"><span class="string">logstashï¼š</span></span><br><span class="line"><span class="string">&quot;(?&lt;log_time&gt;\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125;\s\d&#123;2&#125;:\d&#123;2&#125;:\d&#123;2&#125;.\d&#123;3&#125;) <span class="template-variable">%&#123;IP:ip&#125;</span> <span class="template-variable">%&#123;LOGLEVEL:level&#125;</span> \[<span class="template-variable">%&#123;DATA:thread&#125;</span>\] \[<span class="template-variable">%&#123;DATA:class&#125;</span>\] <span class="template-variable">%&#123;GREEDYDATA:data&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /u01/soft/logstash/pipeline/logstash.conf logstash.conf</span></span><br><span class="line"><span class="string">input</span> &#123;</span><br><span class="line"><span class="string">beats</span> &#123;</span><br><span class="line"><span class="string">port</span> <span class="string">=&gt;</span> <span class="number">5044</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">filter</span> &#123;</span><br><span class="line"><span class="string">if</span> [<span class="string">fields</span>][<span class="string">type</span>] <span class="string">==</span> <span class="string">&quot;mcs&quot;</span> &#123;</span><br><span class="line">        <span class="string">grok</span> &#123;</span><br><span class="line">            <span class="string">match</span> <span class="string">=&gt;</span> &#123;<span class="string">&quot;message&quot;</span> <span class="string">=&gt;</span> <span class="string">&quot;(?&lt;log_time&gt;\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125;\s\d&#123;2&#125;:\d&#123;2&#125;:\d&#123;2&#125;.\d&#123;3&#125;) <span class="template-variable">%&#123;IP:ip&#125;</span> <span class="template-variable">%&#123;LOGLEVEL:level&#125;</span> \[<span class="template-variable">%&#123;DATA:thread&#125;</span>\] \[<span class="template-variable">%&#123;DATA:class&#125;</span>\] <span class="template-variable">%&#123;GREEDYDATA:data&#125;</span>&quot;</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">else</span> <span class="string">if</span> [<span class="string">fields</span>][<span class="string">type</span>] <span class="string">==</span> <span class="string">&quot;mes&quot;</span> &#123;</span><br><span class="line">        <span class="string">grok</span> &#123;</span><br><span class="line">            <span class="string">match</span> <span class="string">=&gt;</span> &#123;<span class="string">&quot;message&quot;</span> <span class="string">=&gt;</span> <span class="string">&quot;(?&lt;log_time&gt;\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125;\s\d&#123;2&#125;:\d&#123;2&#125;:\d&#123;2&#125;.\d&#123;3&#125;) <span class="template-variable">%&#123;LOGLEVEL:level&#125;</span> \[<span class="template-variable">%&#123;DATA:thread&#125;</span>\] \[<span class="template-variable">%&#123;DATA:class&#125;</span>\] <span class="template-variable">%&#123;GREEDYDATA:data&#125;</span>&quot;</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">date</span> &#123;</span><br><span class="line"><span class="string">match</span> <span class="string">=&gt;</span> [<span class="string">&quot;log_time&quot;</span>, <span class="string">&quot;yyyy-MM-dd HH:mm:ss.SSS&quot;</span>]</span><br><span class="line"><span class="string">target</span> <span class="string">=&gt;</span> <span class="string">&quot;@timestamp&quot;</span></span><br><span class="line"><span class="string">timezone</span> <span class="string">=&gt;</span> <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">mutate</span> &#123;</span><br><span class="line"><span class="string">remove_field</span> <span class="string">=&gt;</span> [<span class="string">&quot;@version&quot;</span>,<span class="string">&quot;tags&quot;</span>,<span class="string">&quot;message&quot;</span>,<span class="string">&quot;log_time&quot;</span>,<span class="string">&quot;thread&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">output</span> &#123;</span><br><span class="line"><span class="string">if</span> [<span class="string">fields</span>][<span class="string">type</span>] <span class="string">==</span> <span class="string">&quot;mcs&quot;</span> &#123;</span><br><span class="line"><span class="string">elasticsearch</span> &#123;</span><br><span class="line"><span class="string">hosts</span> <span class="string">=&gt;</span> [<span class="string">&quot;http://128.168.11.112:9200&quot;</span>]</span><br><span class="line"><span class="string">index</span> <span class="string">=&gt;</span> <span class="string">&quot;mcslog-<span class="template-variable">%&#123;+YYYY.MM.dd&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">else</span> <span class="string">if</span> [<span class="string">fields</span>][<span class="string">type</span>] <span class="string">==</span> <span class="string">&quot;mes&quot;</span> &#123;</span><br><span class="line"><span class="string">elasticsearch</span> &#123;</span><br><span class="line"><span class="string">hosts</span> <span class="string">=&gt;</span> [<span class="string">&quot;http://128.168.11.112:9200&quot;</span>]</span><br><span class="line"><span class="string">index</span> <span class="string">=&gt;</span> <span class="string">&quot;meslog-<span class="template-variable">%&#123;+YYYY.MM.dd&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># ç´¢å¼•è‡ªåŠ¨åˆ é™¤ç­–ç•¥</span><br><span class="line">PUT _ilm&#x2F;policy&#x2F;logstash_auto_delete</span><br><span class="line">&#123;</span><br><span class="line">  &quot;policy&quot;: &#123;</span><br><span class="line">    &quot;phases&quot;: &#123;</span><br><span class="line">      &quot;delete&quot;: &#123;</span><br><span class="line">        &quot;min_age&quot;: &quot;7d&quot;,</span><br><span class="line">        &quot;actions&quot;: &#123;</span><br><span class="line">          &quot;delete&quot;: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç´¢å¼•æ¨¡æ¿é…ç½®ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/indices-templates-v1.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.9/indices-templates-v1.html</a></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è‡ªå®šä¹‰æ—¥å¿—ç´¢å¼•æ¨¡æ¿ meslogåŒç†</span></span><br><span class="line"><span class="string">PUT</span> <span class="string">_template/mcslog</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;index_patterns&quot;:</span> [</span><br><span class="line">    <span class="string">&quot;mcslog-*&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;settings&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;lifecycle&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;logstash_auto_delete&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;number_of_shards&quot;:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line">      <span class="comment"># å•æœºè®¾ç½®å‰¯æœ¬åˆ†ç‰‡0 &quot;number_of_replicas&quot; : &quot;0&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;mappings&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;:</span> &#123;</span><br><span class="line">      <span class="string">&quot;@timestamp&quot;</span><span class="string">:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;date&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;level&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;ip&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;class&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;data&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker pull logstash:7.9.3</span><br><span class="line"></span><br><span class="line">docker run -d \</span><br><span class="line">--name logstash \</span><br><span class="line">--privileged&#x3D;true \</span><br><span class="line">-p 9600:9600 \</span><br><span class="line">-p 5044:5044 \</span><br><span class="line">-v &#x2F;u01&#x2F;soft&#x2F;logstash&#x2F;config&#x2F;logstash.yml:&#x2F;usr&#x2F;share&#x2F;logstash&#x2F;config&#x2F;logstash.yml \</span><br><span class="line">-v &#x2F;u01&#x2F;soft&#x2F;logstash&#x2F;pipeline:&#x2F;usr&#x2F;share&#x2F;logstash&#x2F;pipeline \</span><br><span class="line">-w &#x2F;usr&#x2F;share&#x2F;logstash \</span><br><span class="line">logstash:7.9.3</span><br><span class="line"></span><br><span class="line">-v &#x2F;u01&#x2F;soft&#x2F;logstash&#x2F;data:&#x2F;usr&#x2F;share&#x2F;logstash&#x2F;data \</span><br></pre></td></tr></table></figure><h2 id="kibana"><a href="#kibana" class="headerlink" title="kibana"></a>kibana</h2><p>kibanaé…ç½®ï¼š<a href="https://www.elastic.co/guide/en/kibana/7.9/settings.html">https://www.elastic.co/guide/en/kibana/7.9/settings.html</a></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /u01/soft/kibana/kibana.yml kibana.yml</span></span><br><span class="line"><span class="attr">server.name:</span> <span class="string">kibana</span></span><br><span class="line"><span class="attr">server.host:</span> <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="attr">elasticsearch.hosts:</span> [ <span class="string">&quot;http://128.168.11.112:9200&quot;</span> ]</span><br><span class="line"><span class="attr">monitoring.ui.container.elasticsearch.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">i18n.locale:</span> <span class="string">zh-CN</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">docker</span> <span class="string">pull</span> <span class="string">kibana:7.9.3</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">run</span> <span class="string">-d</span> <span class="string">\</span></span><br><span class="line"><span class="string">--name</span> <span class="string">kibana</span> <span class="string">\</span></span><br><span class="line"><span class="string">--privileged=true</span> <span class="string">\</span></span><br><span class="line"><span class="string">-p</span> <span class="number">5601</span><span class="string">:5601</span> <span class="string">\</span></span><br><span class="line"><span class="string">-v</span> <span class="string">/u01/soft/kibana/kibana.yml:/usr/share/kibana/config/kibana.yml</span> <span class="string">\</span></span><br><span class="line"><span class="string">-w</span> <span class="string">/usr/share/kibana</span> <span class="string">\</span></span><br><span class="line"><span class="string">kibana:7.9.3</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dateFormatYYYY-MM-DD HH:mm:ss.SSS</span><br><span class="line">dateFormat:tzAsia&#x2F;Shanghai</span><br></pre></td></tr></table></figure><h2 id="logbackåˆ‡å‰²æ—¥å¿—ï¼Œfilebeatæ”¶é›†æ—¥å¿—æ˜¯å¦ä¼šå†²çªï¼Ÿ"><a href="#logbackåˆ‡å‰²æ—¥å¿—ï¼Œfilebeatæ”¶é›†æ—¥å¿—æ˜¯å¦ä¼šå†²çªï¼Ÿ" class="headerlink" title="logbackåˆ‡å‰²æ—¥å¿—ï¼Œfilebeatæ”¶é›†æ—¥å¿—æ˜¯å¦ä¼šå†²çªï¼Ÿ"></a>logbackåˆ‡å‰²æ—¥å¿—ï¼Œfilebeatæ”¶é›†æ—¥å¿—æ˜¯å¦ä¼šå†²çªï¼Ÿ</h2><p>logbackåˆ‡å‰²æ—¥å¿—ï¼Œå°†å½“å‰logæ–‡ä»¶å˜æˆæˆ‘ä»¬è‡ªå®šä¹‰çš„zipï¼Œå¹¶ç”Ÿæˆæ–°çš„logï¼Œæ­¤æ—¶filebeatæ”¶é›†æ—¥å¿—ä¼šä¸ä¼šå—åˆ°å½±å“ï¼Ÿ</p><p><a href="https://www.jianshu.com/p/e98287437d41">https://www.jianshu.com/p/e98287437d41</a></p><p>å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://www.elastic.co/guide/en/beats/filebeat/7.9/filebeat-input-docker.html#filebeat-input-docker-close-inactive">https://www.elastic.co/guide/en/beats/filebeat/7.9/filebeat-input-docker.html#filebeat-input-docker-close-inactive</a></p><p>close_inactiveã€scan_frequencyç­‰ç›¸å…³é…ç½®</p><p>ç®€å•è¯´filebeatæœ‰åˆ·æ–°æœºåˆ¶ï¼Œä¸ä¼šé•¿æœŸç›‘å¬ä¸€ä¸ªæ²¡æœ‰æ–°å¢å†…å®¹çš„æ–‡ä»¶</p><h2 id="é•œåƒå¯¼å…¥å¯¼å‡º"><a href="#é•œåƒå¯¼å…¥å¯¼å‡º" class="headerlink" title="é•œåƒå¯¼å…¥å¯¼å‡º"></a>é•œåƒå¯¼å…¥å¯¼å‡º</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">docker</span> <span class="string">save</span> <span class="string">-o</span> <span class="string">&lt;é•œåƒå­˜å‚¨è¾“å‡ºè·¯å¾„ï¼Œä¿å­˜ä¸ºtar&gt;</span> <span class="string">&lt;é•œåƒid</span> <span class="string">or</span> <span class="string">é•œåƒå:ç‰ˆæœ¬å·&gt;</span></span><br><span class="line"><span class="string">ä¸Šä¼ æ–‡ä»¶è¿›è¡Œå®¿ä¸»æœºå¯¼å…¥</span></span><br><span class="line"><span class="string">docker</span> <span class="string">load</span> <span class="string">-i</span> <span class="string">&lt;taråŒ…ä¸Šä¼ è·¯å¾„&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;æ•°æ®è¿ç§»&quot;&gt;&lt;a href=&quot;#æ•°æ®è¿ç§»&quot; class=&quot;headerlink&quot; title=&quot;æ•°æ®è¿ç§»&quot;&gt;&lt;/a&gt;æ•°æ®è¿ç§»&lt;/h1&gt;&lt;h2 id=&quot;æ•°æ®è¿ç§»æµç¨‹&quot;&gt;&lt;a href=&quot;#æ•°æ®è¿ç§»æµç¨‹&quot; class=&quot;headerlink&quot; title=&quot;æ•°æ®è¿ç§»æµ</summary>
      
    
    
    
    <category term="ä¸­é—´ä»¶" scheme="http://aidianfirst.com/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
    
  </entry>
  
  <entry>
    <title>Springæ¡†æ¶å…«è‚¡</title>
    <link href="http://aidianfirst.com/2021/12/07/%E5%85%AB%E8%82%A1/Spring%E6%A1%86%E6%9E%B6%E5%85%AB%E8%82%A1/"/>
    <id>http://aidianfirst.com/2021/12/07/%E5%85%AB%E8%82%A1/Spring%E6%A1%86%E6%9E%B6%E5%85%AB%E8%82%A1/</id>
    <published>2021-12-07T02:00:08.000Z</published>
    <updated>2023-07-30T11:20:17.727Z</updated>
    
    <content type="html"><![CDATA[<h1 id="IoC"><a href="#IoC" class="headerlink" title="IoC"></a>IoC</h1><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p><a href="https://www.jianshu.com/p/ad05cfe7868e">https://www.jianshu.com/p/ad05cfe7868e</a></p><p>IoCæ§åˆ¶åè½¬ï¼Œæ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œå°†ä»¥å¾€é€šè¿‡æ‰‹åŠ¨åˆ›å»ºå¯¹è±¡çš„æ§åˆ¶æƒäº¤ç”±Springç®¡ç†ï¼Œ<strong>é™ä½å¯¹è±¡ä¹‹é—´çš„è€¦åˆæ€§</strong>ã€‚å…¶æ§åˆ¶åè½¬ï¼ŒæŒ‡çš„æ˜¯<strong>æ§åˆ¶</strong>å¯¹è±¡åˆ›å»ºçš„æƒåŠ›ï¼Œç„¶åå°†æ§åˆ¶æƒ<strong>åè½¬</strong>äº¤ç»™å¤–éƒ¨ç¯å¢ƒç®¡ç†ã€‚</p><p>æ‰€æœ‰çš„Beanåœ¨é¡¹ç›®å¯åŠ¨æ—¶ç”Ÿæˆï¼ŒåŠ è½½åˆ°Springå®¹å™¨ä¸­ç»Ÿä¸€ç®¡ç†ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„æ—¶å€™å†å»å®¹å™¨ä¸­å–Beanã€‚è€Œä¸æ˜¯å•ç‹¬çš„å»newä¸€ä¸ªç›¸å…³ç±»æ¥è¿›è¡Œè°ƒç”¨ã€‚</p><p>IoCåªæ˜¯ä¸€ç§æ€æƒ³ï¼Œè€Œä¾èµ–æ³¨å…¥DIæ˜¯å…·ä½“å®ç°ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>åº•å±‚xmlé…ç½®æ–‡ä»¶ï¼Œç¼–å†™å¯¹åº”å±æ€§kvï¼Œå¦‚k - ç±»åï¼Œv - ç±»çš„å…¨è·¯å¾„ã€‚</p><p>åˆ›å»ºä¸€ä¸ªå·¥å‚ç±»è§£æxmlï¼Œè·å–å¯¹åº”ç±»çš„å…¨è·¯å¾„ï¼Œå¹¶é€šè¿‡åå°„åˆ›å»ºè¯¥ç±»å¯¹è±¡ã€‚</p><p>æœ€åä»å·¥å‚ä¸­è°ƒç”¨åˆ›å»ºå¥½çš„å¯¹è±¡å³å¯ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å¼€å‘éƒ½æ˜¯ä½¿ç”¨æ³¨è§£æ³¨å…¥Beanæ›¿ä»£xmlé…ç½®ã€‚</p><h1 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h1><h2 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h2><p>AOPé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œèƒ½å°†ä¸ä¸šåŠ¡æ— å…³ï¼Œå´è¢«ä¸šåŠ¡æ¨¡å—å…±åŒè°ƒç”¨çš„æœåŠ¡è¿›è¡Œå°è£…ï¼ˆå¦‚å·¥å…·ç±»ç­‰ï¼‰ï¼Œç„¶åè¿›è¡Œç»Ÿä¸€è°ƒç”¨ï¼Œé™ä½æ¨¡å—ä¹‹é—´çš„è€¦åˆæ€§ï¼Œåˆ©äºæ‹“å±•å’Œç»´æŠ¤ã€‚</p><p>AOPåŸºäºä»£ç†æ¨¡å¼å®ç°ï¼Œå…¶åˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ã€‚</p><ul><li>AspectJ AOP é™æ€ä»£ç†</li><li>Spring AOP åŠ¨æ€ä»£ç†ï¼ˆJDKã€CGLIBï¼‰</li></ul><h2 id="Spring-AOP"><a href="#Spring-AOP" class="headerlink" title="Spring AOP"></a>Spring AOP</h2><p>æˆ‘ä»¬è¦ä»£ç†çš„å¯¹è±¡<strong>å®ç°äº†æ¥å£</strong>æ—¶ï¼ŒSpring AOPä½¿ç”¨ <strong>JDKåŠ¨æ€ä»£ç†</strong> å»åˆ›å»ºä»£ç†å¯¹è±¡ï¼›å¯¹äº<strong>æ²¡æœ‰å®ç°æ¥å£</strong>çš„å¯¹è±¡ï¼ŒSpring AOPä½¿ç”¨ <strong>CGLIBåŠ¨æ€ä»£ç† å»ç”Ÿæˆä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡çš„å­ç±»æ¥ä½œä¸ºä»£ç†ï¼ˆç»§æ‰¿ï¼‰</strong>ã€‚</p><p>Springé»˜è®¤ä½¿ç”¨çš„ JDKåŠ¨æ€ä»£ç†ã€‚</p><h2 id="JDKåŠ¨æ€ä»£ç†åŸç†ï¼ˆåå°„ï¼‰"><a href="#JDKåŠ¨æ€ä»£ç†åŸç†ï¼ˆåå°„ï¼‰" class="headerlink" title="JDKåŠ¨æ€ä»£ç†åŸç†ï¼ˆåå°„ï¼‰"></a>JDKåŠ¨æ€ä»£ç†åŸç†ï¼ˆåå°„ï¼‰</h2><ul><li><p>ç¼–å†™ä¸€ä¸ª<strong>ä»£ç†ç±»</strong>ï¼šå®ç° InvocationHandler æ¥å£ï¼Œå°†åŸç±»æ–¹æ³•é€šè¿‡é‡å†™ invoke() è¿›è¡Œä»£ç†å®ç°ï¼Œinvoke()ä¸­å¯ä»¥è‡ªè¡Œæ·»åŠ å†…å®¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * proxy ä»£ç†ç±»ï¼Œmethod ä»£ç†æ–¹æ³•ï¼Œargs[] æ–¹æ³•å‚æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">invoke(Object proxy, Method method, Object[] args)</span><br></pre></td></tr></table></figure></li><li><p>ç¼–å†™<strong>å·¥å‚ç±»ç”Ÿæˆä»£ç†å¯¹è±¡</strong>ï¼šProxy.newProxyinstanceï¼Œè·å–å…¨éƒ¨æ¥å£ï¼Œå°†æ¥å£æ–¹æ³•é€šè¿‡ä»£ç†è¿›è¡Œå¢å¼ºï¼Œæœ€åè¿”å›ä»£ç†å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// loader ç±»åŠ è½½å™¨ï¼Œinterfaces[] å…¨éƒ¨æ¥å£ï¼Œhandler è‡ªè¡Œå®ç°çš„ä»£ç†ç±»</span></span><br><span class="line">newProxyInstance(ClassLoader loader,Class&lt;?&gt;[] interfaces,InvocationHandler handler)</span><br></pre></td></tr></table></figure></li></ul><p>JDKåŠ¨æ€ä»£ç†åŸºäº<strong>åå°„</strong>å®ç°ï¼Œå·¥å‚ç±»å®ç°äº†åŸç±»çš„å…¨éƒ¨æ¥å£ï¼Œå¹¶å¯¹æ¥å£çš„æ‰€æœ‰æ–¹æ³•è¿›è¡Œäº†ä»£ç†ã€‚é€šè¿‡ä»£ç†å¯¹è±¡æ‰§è¡ŒåŸç±»æ–¹æ³•æ—¶ï¼Œä»£ç†å¯¹è±¡ä¼šé€šè¿‡åå°„å›è°ƒæˆ‘ä»¬å®ç°çš„ä»£ç†ç±»çš„ invoke()ï¼Œä¹Ÿå°±æ˜¯ä»£ç†æ–¹æ³•è¢«è°ƒç”¨ã€‚</p><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li>JDKåŠ¨æ€ä»£ç†é€šè¿‡åå°„å®ç°ï¼Œæ˜¯JDKåŸç”Ÿçš„ã€‚</li><li>JDKåŠ¨æ€ä»£ç†ï¼Œè¢«ä»£ç†ç±»å¿…é¡»å®ç°æ¥å£ï¼Œä¸”åªèƒ½ä»£ç†æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå¦‚æœä»£ç†ç±»è‡ªè¡Œç¼–å†™äº†ä¸å­˜åœ¨äºæ¥å£çš„æ–¹æ³•ï¼Œé‚£ä¹ˆJDKåŠ¨æ€ä»£ç†ä¸ä¼šå®ç°è¯¥æ–¹æ³•ã€‚</li></ul><h2 id="CGLIBåŠ¨æ€ä»£ç†åŸç†ï¼ˆå­—èŠ‚ç ï¼‰"><a href="#CGLIBåŠ¨æ€ä»£ç†åŸç†ï¼ˆå­—èŠ‚ç ï¼‰" class="headerlink" title="CGLIBåŠ¨æ€ä»£ç†åŸç†ï¼ˆå­—èŠ‚ç ï¼‰"></a>CGLIBåŠ¨æ€ä»£ç†åŸç†ï¼ˆå­—èŠ‚ç ï¼‰</h2><p>åº•å±‚å¯¹ä»£ç†ç±»çš„å­—èŠ‚ç è¿›è¡Œæ“ä½œï¼Œç”Ÿæˆè¯¥ç±»çš„ä¸€ä¸ªå­ç±»ï¼Œå¹¶é‡å†™çˆ¶ç±»çš„æ‰€æœ‰å¯é‡å†™æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ç”Ÿæˆè‡ªå®šä¹‰çš„ä»£ç†æ–¹æ³•ï¼ˆè‡ªè¡Œç”Ÿæˆå­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œå¯¹å­ç±»è¿›è¡Œä»£ç†ï¼‰ã€‚ç„¶åé€šè¿‡å­—èŠ‚ç æ“ä½œç”Ÿæˆä»£ç†ç±»ã€‚</p><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li>CGLIBä»£ç†çš„ç±»æ— éœ€å®ç°æ¥å£ï¼ŒCGLIBä¼šè‡ªè¡Œç”Ÿæˆå­ç±»ç»§æ‰¿åŸç±»æ¥ä»£ç†ã€‚</li><li>ç”±äºfinalä¿®é¥°çš„ç±»æ— æ³•è¢«ç»§æ‰¿ï¼Œæ‰€ä»¥CGLIBä¸èƒ½ä»£ç†finalç±»ã€‚</li><li>CGLIBä»£ç†æ˜¯ç”Ÿæˆå­ç±»ï¼Œå¯¹åŸç±»æ–¹æ³•è¿›è¡Œé‡å†™ï¼Œç”Ÿæˆç›¸åº”çš„ä»£ç†æ–¹æ³•ï¼Œå¦‚æœåŸæ–¹æ³•ç”±final æˆ– privateä¿®é¥°ï¼Œæˆ‘ä»¬æ— æ³•é‡å†™æ–¹æ³•ï¼Œæ‰€ä»¥finalå’Œprivateä¿®é¥°çš„æ–¹æ³•ä¸èƒ½è¢«ä»£ç†ã€‚</li></ul><h2 id="AspectJ-AOPï¼ˆé™æ€ä»£ç†ï¼‰"><a href="#AspectJ-AOPï¼ˆé™æ€ä»£ç†ï¼‰" class="headerlink" title="AspectJ AOPï¼ˆé™æ€ä»£ç†ï¼‰"></a>AspectJ AOPï¼ˆé™æ€ä»£ç†ï¼‰</h2><p><strong>Spring AOPæ˜¯è¿è¡Œæ—¶å¢å¼ºï¼ŒåŸºäºä»£ç†ï¼›Aspect AOPæ˜¯ç¼–è¯‘æ—¶å¢å¼ºï¼ŒåŸºäºå­—èŠ‚ç æ“ä½œã€‚</strong></p><h1 id="Bean"><a href="#Bean" class="headerlink" title="Bean"></a>Bean</h1><p>Beanå°±æ˜¯IoCå®¹å™¨ç®¡ç†çš„å¯¹è±¡ã€‚</p><h2 id="Beanç”Ÿå‘½å‘¨æœŸ"><a href="#Beanç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Beanç”Ÿå‘½å‘¨æœŸ"></a>Beanç”Ÿå‘½å‘¨æœŸ</h2><p>Beanå®ä¾‹åŒ–ï¼Œæ ¹æ®å®ç°çš„æ¥å£ï¼Œè°ƒç”¨å¯¹åº”æ–¹æ³•å®Œæˆç›¸åº”æ“ä½œï¼Œå¦‚åœ¨BeanFactoryä¸­è·å–å®¹å™¨å®ä¾‹ï¼ŒåŠ è½½Beanæ‰€åœ¨åº”ç”¨çš„ä¸Šä¸‹æ–‡å¼•ç”¨ç­‰ã€‚</p><p>Beanåˆå§‹åŒ–å®Œæˆåï¼Œå¯ä»¥è¢«åº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œå®ƒä»¬ä¸€ç›´é©»ç•™åœ¨åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œï¼Œç›´åˆ°åº”ç”¨ä¸Šä¸‹æ–‡è¢«é”€æ¯ã€‚</p><p>å¯ä»¥æ‰§è¡Œdestroy()é”€æ¯Beanã€‚</p><h2 id="Beanä½œç”¨åŸŸ"><a href="#Beanä½œç”¨åŸŸ" class="headerlink" title="Beanä½œç”¨åŸŸ"></a>Beanä½œç”¨åŸŸ</h2><ul><li>singletonï¼šå•ä¾‹ï¼Œå”¯ä¸€Beanå®ä¾‹</li><li>prototypeï¼šå¤šå®ä¾‹ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªBean</li><li>requestï¼šæ¯æ¬¡Httpè¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªBeanï¼Œåªåœ¨å½“å‰Http requestå†…æœ‰æ•ˆ</li><li>sessionï¼šæ¯æ¬¡æ–°sessionçš„Httpè¯·æ±‚ä¼šåˆ›å»ºä¸€ä¸ªBeanï¼Œåªæœ‰å½“å‰HttpSessionå†…æœ‰æ•ˆ</li><li>global - sessionï¼šå…¨å±€Sessionï¼Œä¸€ä¸ªBeanå¯¹åº”ä¸€ä¸ªå®ä¾‹</li></ul><h2 id="Beançº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#Beançº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="Beançº¿ç¨‹å®‰å…¨é—®é¢˜"></a>Beançº¿ç¨‹å®‰å…¨é—®é¢˜</h2><p>å•ä¾‹å¯èƒ½ä¼šè®¾è®¡å¤šçº¿ç¨‹ä¿®æ”¹å˜é‡ã€‚æ”¹å˜Beanä½œç”¨åŸŸï¼Œé€‰æ‹©å¤šå®ä¾‹ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªBeanã€‚æˆ–ä½¿ç”¨ThreadLcoalå­˜å‚¨å˜é‡ã€‚</p><h1 id="Springäº‹åŠ¡"><a href="#Springäº‹åŠ¡" class="headerlink" title="Springäº‹åŠ¡"></a>Springäº‹åŠ¡</h1><h2 id="Transaction"><a href="#Transaction" class="headerlink" title="@Transaction"></a>@Transaction</h2><p>Springäº‹åŠ¡å¯¹åº”æ•°æ®åº“äº‹åŠ¡ï¼Œä¹Ÿæ˜¯ACIDï¼Œéš”ç¦»çº§åˆ«ä¹Ÿä¸€è‡´ï¼Œå¤šäº†ä¸€ç§é»˜è®¤çš„çº§åˆ«defaultï¼Œå’Œæ•°æ®åº“çš„çº§åˆ«åŒæ­¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„Springäº‹åŠ¡é»˜è®¤æ˜¯è¿è¡Œæ—¶å¼‚å¸¸æ‰å›æ»šï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸ºä»»ä½•å¼‚å¸¸éƒ½å›æ»šã€‚</p><h2 id="AOP-1"><a href="#AOP-1" class="headerlink" title="AOP"></a>AOP</h2><p>@Transactionä¹Ÿæ˜¯é€šè¿‡AOPåŠ¨æ€ä»£ç†å®ç°çš„ã€‚ç”±äºæ˜¯åŠ¨æ€ä»£ç†ï¼Œåªæœ‰æ³¨è§£æ–¹æ³•è¢«ç±»ä»¥å¤–æ–¹æ³•è°ƒç”¨æ—¶äº‹åŠ¡æ‰ç”Ÿæ•ˆï¼Œå¦‚æœæœ¬ç±»æ–¹æ³•ç›´æ¥è°ƒç”¨åˆ™äº‹åŠ¡æ— æ³•ç”Ÿæ•ˆã€‚</p><h1 id="MyBatisçš„-ã€"><a href="#MyBatisçš„-ã€" class="headerlink" title="MyBatisçš„#{}ã€${}"></a>MyBatisçš„#{}ã€${}</h1><ul><li>#{}ï¼šsqlå‚æ•°å ä½ç¬¦ï¼Œmybatisä¼šè®¤å®šä¼ å…¥å‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå°†å…¶å­—æ®µåŠ ä¸Šâ€™ â€˜ï¼Œæ›¿æ¢æˆ‘ä»¬éœ€è¦çš„å‚æ•°ã€‚ç»è¿‡é¢„ç¼–è¯‘ï¼Œé˜²æ­¢sqlæ³¨å…¥ã€‚</li><li>${}ï¼šå˜é‡å ä½ç¬¦ï¼Œç›´æ¥ä¼ å€¼ï¼Œä¸åšå¤„ç†ã€‚</li></ul><h2 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(Â·Â·Â·)</span></span><br></pre></td></tr></table></figure><p>ä¸»å¯åŠ¨ç±»æ³¨è§£ç”±ä¸‰ä¸ªæ³¨è§£ç»„æˆï¼š</p><ul><li><p>@SpringBootConfigurationï¼šä»£è¡¨ä¸»å¯åŠ¨æ³¨è§£æ˜¯ä¸€ä¸ªé…ç½®ç±»</p></li><li><p>@ComponentScanï¼šé»˜è®¤æ‰«æä¸»å¯åŠ¨ç±»åŒ…ä¸‹çš„å…¨éƒ¨æ³¨å…¥ç»„ä»¶ï¼ˆ@Componentç­‰ï¼‰ï¼Œå¯è‡ªå®šä¹‰ä¸æ‰«æçš„Beanã€‚</p></li><li><p>@EnableAutoConfigurationï¼šå¼€å¯è‡ªåŠ¨è£…é…</p><p>åœ¨META-INF/spring.factoriesä¸‹é…ç½®è‡ªåŠ¨åŠ è½½ç±»ï¼Œä¸€èˆ¬éƒ½æ˜¯ **AutoConfiguration ç»“å°¾çš„ç±»ï¼Œé€šè¿‡@Conditionalæ³¨è§£æŒ‰éœ€åŠ è½½å®ç°è‡ªåŠ¨è£…é…ã€‚</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;IoC&quot;&gt;&lt;a href=&quot;#IoC&quot; class=&quot;headerlink&quot; title=&quot;IoC&quot;&gt;&lt;/a&gt;IoC&lt;/h1&gt;&lt;h2 id=&quot;åŸç†&quot;&gt;&lt;a href=&quot;#åŸç†&quot; class=&quot;headerlink&quot; title=&quot;åŸç†&quot;&gt;&lt;/a&gt;åŸç†&lt;/h2&gt;&lt;p</summary>
      
    
    
    
    <category term="å…«è‚¡" scheme="http://aidianfirst.com/categories/%E5%85%AB%E8%82%A1/"/>
    
    
  </entry>
  
  <entry>
    <title>å¾®æœåŠ¡å•†åŸé¡¹ç›®å­¦ä¹ æ€»ç»“</title>
    <link href="http://aidianfirst.com/2021/11/23/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/"/>
    <id>http://aidianfirst.com/2021/11/23/%E5%90%8E%E7%AB%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</id>
    <published>2021-11-23T09:29:08.000Z</published>
    <updated>2023-07-30T11:20:17.736Z</updated>
    
    <content type="html"><![CDATA[<h1 id="è™šæ‹Ÿæœºç¯å¢ƒé…ç½®"><a href="#è™šæ‹Ÿæœºç¯å¢ƒé…ç½®" class="headerlink" title="è™šæ‹Ÿæœºç¯å¢ƒé…ç½®"></a>è™šæ‹Ÿæœºç¯å¢ƒé…ç½®</h1><p>è¿™æ¬¡ä½¿ç”¨Virtual Box + Vagrantå®Œæˆè™šæ‹Ÿæœºå®‰è£…ï¼Œæ¯”ä¼ ç»ŸVMwareé…ç½®é•œåƒæ›´æ–¹ä¾¿ï¼ŒVagrantå¯ä¸‹è½½æ‰“åŒ…å¥½çš„é•œåƒæ–‡ä»¶è¿›è¡Œå®‰è£…ï¼Œæ— éœ€è¯¦ç»†é…ç½®ã€‚</p><p><a href="https://blog.csdn.net/qq_15990969/article/details/113096469">https://blog.csdn.net/qq_15990969/article/details/113096469</a></p><p><a href="https://www.cnblogs.com/lxwphp/p/11121283.html">https://www.cnblogs.com/lxwphp/p/11121283.html</a></p><h1 id="å¿«é€Ÿåå‘å·¥ç¨‹è¾…åŠ©crud"><a href="#å¿«é€Ÿåå‘å·¥ç¨‹è¾…åŠ©crud" class="headerlink" title="å¿«é€Ÿåå‘å·¥ç¨‹è¾…åŠ©crud"></a>å¿«é€Ÿåå‘å·¥ç¨‹è¾…åŠ©crud</h1><p>ä½¿ç”¨renrenè„šæ‰‹æ¶è¾…åŠ©å¼€å‘ï¼Œå¯¹åº”å‰åç«¯åˆ†ç¦»ï¼Œrenren-fastï¼Œrenren-fast-vueï¼Œrenren-generatorä½¿ç”¨å‰éœ€åˆ é™¤.gitæ–‡ä»¶ï¼Œè¿™æ˜¯å®˜æ–¹çš„gitä¿¡æ¯</p><p>renrençš„serviceå±‚æ— éœ€æ³¨å…¥daoï¼Œå®ƒç»§æ‰¿äº†ä¸€ä¸ªçˆ¶ç±»ï¼Œçˆ¶ç±»æ³¨å…¥äº†baseMapperï¼Œè€Œè¿™ä¸ªbaseMapperçš„ç±»å‹æ˜¯å¯¹åº”ç»§æ‰¿æ—¶ç±»çš„æ³›å‹Mçš„ï¼Œäººäººç»§æ‰¿è¿™ä¸ªçˆ¶ç±»å°±ä¼šç”¨è‡ªå·±çš„daoå®ç°æ³›å‹ï¼Œæ‰€ä»¥æ­¤æ—¶çˆ¶ç±»æ³¨å…¥çš„baseMapperå³æˆ‘ä»¬éœ€è¦çš„daoï¼Œå°è£…nbã€‚</p><h1 id="å•†å“æœåŠ¡"><a href="#å•†å“æœåŠ¡" class="headerlink" title="å•†å“æœåŠ¡"></a>å•†å“æœåŠ¡</h1><p><a href="https://blog.csdn.net/unique_perfect/article/details/113824202">https://blog.csdn.net/unique_perfect/article/details/113824202</a></p><p>å¯ä»¥æ‹¿sqlæ•°æ®ï¼Œ1000+å•†å“è¯æ¡ã€‚</p><h2 id="èœå•åˆ†çº§å±•ç¤º"><a href="#èœå•åˆ†çº§å±•ç¤º" class="headerlink" title="èœå•åˆ†çº§å±•ç¤º"></a>èœå•åˆ†çº§å±•ç¤º</h2><p>å…ˆæŸ¥ä¸€çº§èœå•ï¼Œç„¶åé€’å½’æŸ¥è¯¢äºŒçº§èœå•ï¼Œç»™productå•†å“åŠ ä¸Šå­èœå•ï¼Œæ–¹ä¾¿è®¾ç½®ï¼Œæ•°æ®åº“æ²¡æœ‰è¯¥å­—æ®µéœ€æ³¨æ˜existã€‚</p><h2 id="ç½‘å…³ï¼ˆè·¨åŸŸï¼‰"><a href="#ç½‘å…³ï¼ˆè·¨åŸŸï¼‰" class="headerlink" title="ç½‘å…³ï¼ˆè·¨åŸŸï¼‰"></a>ç½‘å…³ï¼ˆè·¨åŸŸï¼‰</h2><p>é€šè¿‡gatewayè·¯ç”±è¯·æ±‚ï¼Œæ¶‰åŠ<strong>è·¨åŸŸé—®é¢˜</strong>ï¼ˆåŒæºç­–ç•¥ï¼‰ã€‚</p><p>éç®€å•è¯·æ±‚å…ˆå‘é€é¢„æ£€è¯·æ±‚optionï¼ŒæœåŠ¡å™¨ä¸å…è®¸åˆ™ä¸å‘é€è¯·æ±‚ã€‚</p><p>æˆ‘ä»¬åœ¨gatewayçš„å¾®æœåŠ¡ä¸­è¿›è¡Œconfigé…ç½®ï¼Œä½¿ç”¨å‰ç½®filterè¿‡æ»¤è¯·æ±‚å³å¯ï¼Œæ”¾è¡Œæ‰€æœ‰çš„è¯·æ±‚éƒ½è·¨åŸŸã€‚CorsWebFilteræ˜¯å®˜æ–¹æä¾›è·¨åŸŸè¿‡æ»¤å™¨ã€‚</p><p><strong>ç«¯å£å·çš„åŠ¨æ€åˆ·æ–°ï¼Œå¥½åƒèƒ½å–æ”¹å˜åçš„å€¼ï¼Œä½†è®¿é—®çš„urlæ²¡å˜ï¼Ÿ</strong></p><h2 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h2><p><strong>æˆ‘ä»¬åˆ é™¤ä½¿ç”¨é€»è¾‘åˆ é™¤</strong>ï¼Œå³å±æ€§æœ‰ä¸ªå­—æ®µä¸ºæ˜¯å¦å±•ç¤ºï¼Œæˆ‘ä»¬æä¾›æ”¹å˜è¿™ä¸ªå­—æ®µçŠ¶æ€å°†å±æ€§éšè—æ˜¾ç¤ºï¼Œè€Œä¸æ˜¯å°†æ•°æ®çœŸæ­£çš„åˆ é™¤ã€‚</p><p>mybatis-plusè‡ªå¸¦é€»è¾‘åˆ é™¤ç»„ä»¶é…ç½®ï¼Œymlé…ç½®</p><h2 id="JSR303"><a href="#JSR303" class="headerlink" title="JSR303"></a>JSR303</h2><p>å“ç‰Œç®¡ç†è¿›è¡Œåç«¯æ ¡éªŒï¼Œä»…ä»…å‰ç«¯æ ¡éªŒæ˜¯ä¸å¤Ÿçš„ï¼Œä»¥é˜²è¶Šè¿‡å‰ç«¯ç›´æ¥è®¿é—®æ¥å£ã€‚</p><p>@NotBlankç­‰æ³¨è§£æ ‡æ˜å­—æ®µï¼Œ@Validæ ‡æ˜ä¸šåŠ¡å®ä½“ç±»å‚æ•°ï¼Œéšåè¿›è¡Œæ ¡éªŒï¼Œ@NotBlankå¯è‡ªå®šä¹‰messageï¼Œæ ¡éªŒå¤±è´¥è¿”å›å¯¹åº”ä¿¡æ¯ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯å†™ä¸€ä¸ªç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†ç±»ï¼Œä½¿ç”¨@ControllerAdvice</p><p>JSR303è¿˜å¯è¿›è¡Œåˆ†ç»„æ ¡éªŒã€‚ä½¿ç”¨è±¡å¾æ€§æ¥å£è¿›è¡Œæ ‡è¯†ã€‚</p><h2 id="å±æ€§åˆ†ç»„"><a href="#å±æ€§åˆ†ç»„" class="headerlink" title="å±æ€§åˆ†ç»„"></a>å±æ€§åˆ†ç»„</h2><p>SPUç›¸å½“äºä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¦‚ç±³8æ‰‹æœºã€‚</p><p>SKUæ˜¯å…·ä½“æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯ç±³8æ‰‹æœºçš„å…·ä½“é…ç½®ï¼Œé…ç½®ä¸åŒä»·å€¼ä¹Ÿä¸åŒã€‚</p><p>æ•°æ®åº“åŸºäºè¿™ä¸ªæ¦‚å¿µè¿›è¡Œåˆ†ç±»ï¼Œå¦‚ç±³8 128gï¼Œåªæœ‰é»‘è‰²ã€ç™½è‰²å†…å­˜å¤§å°8gï¼Œç±³8 256gï¼Œæœ‰é»‘ç™½è“ç»¿ç­‰é¢œè‰²ï¼Œå†…å­˜å¤§å°16gï¼Œä¸åŒçš„SKUå…·ä½“å®ç°çš„å†…å®¹ä¸åŒã€‚</p><h2 id="å…³è”åˆ†ç±»"><a href="#å…³è”åˆ†ç±»" class="headerlink" title="å…³è”åˆ†ç±»"></a>å…³è”åˆ†ç±»</h2><p>å“ç‰Œç®¡ç†å¯å°†å“ç‰Œå’Œåˆ†ç±»çš„å…³ç³»å­˜åˆ°ä¸€å¼ è¡¨è®°å½•ï¼Œæˆ‘ä»¬ä¿®æ”¹å“ç‰Œä¸åˆ†ç±»åæ—¶ï¼Œè¦è”åŠ¨ä¿®æ”¹è¿™ä¸ªè¡¨çš„æ•°æ®ã€‚</p><h2 id="VO"><a href="#VO" class="headerlink" title="VO"></a>VO</h2><p>view objectï¼Œæˆ‘ä»¬å®ä½“ç±»ä¸€èˆ¬ç”¨äºæ•°æ®åº“æ“ä½œï¼Œæœ‰æ—¶å¼•å…¥å…¶ä»–å­—æ®µè¿˜éœ€è¦æ³¨è§£æ ‡æ˜å­—æ®µä¸å±äºæ•°æ®åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¤šè¿›è¡Œä¸€å±‚å°è£…ï¼Œç»§æ‰¿å®ä½“ç±»ï¼Œæ·»åŠ ç”¨äºè§†å›¾è¿”å›çš„å­—æ®µã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ ¹æ®åº”ç”¨åœºæ™¯çš„ä¸åŒï¼Œå¯¹åŸå®ä½“ç±»ç»§æ‰¿åäºŒæ¬¡å°è£…ï¼Œé˜²æ­¢å®ä½“ç±»æ³¨è§£å†—ä½™ã€‚</p><h2 id="ç”Ÿæˆå•†å“Vo"><a href="#ç”Ÿæˆå•†å“Vo" class="headerlink" title="ç”Ÿæˆå•†å“Vo"></a>ç”Ÿæˆå•†å“Vo</h2><p>å…ˆåˆ›å»ºjsonæ•°æ®ï¼Œç„¶åä½¿ç”¨å·¥å…·åå‘ç”Ÿæˆvoï¼Œå¯¼å…¥voç„¶åç”¨è¿™ä¸ªå®ä½“å»è¿›è¡Œä¿å­˜ã€‚ä¸ºäº†ä¿è¯ç²¾åº¦ï¼Œå°æ•°æ“ä½œå€¼ä½¿ç”¨BigDecimalï¼Œidä½¿ç”¨longã€‚</p><h2 id="Transactional"><a href="#Transactional" class="headerlink" title="@Transactional"></a>@Transactional</h2><p>å¯¹å•†å“è¿›è¡Œæ·»åŠ æ—¶ï¼Œä¼šå½±å“å¤šä¸ªè¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº‹åŠ¡è¿›è¡Œæ§åˆ¶</p><h2 id="feignæœåŠ¡è°ƒç”¨"><a href="#feignæœåŠ¡è°ƒç”¨" class="headerlink" title="feignæœåŠ¡è°ƒç”¨"></a>feignæœåŠ¡è°ƒç”¨</h2><p>spuéœ€è¦è®°å½•ä¼˜æƒ ä¿¡æ¯ï¼Œè°ƒç”¨å…¶ä»–æœåŠ¡çš„æ¥å£ï¼Œä½¿ç”¨TOä¼ è¾“ï¼Œè·¨æœåŠ¡ä¼ è¾“ï¼Œå¯åœ¨å¸¸ç”¨æœåŠ¡ç»„ä»¶ä¸­å°è£…TOã€‚</p><p>æœåŠ¡è°ƒç”¨æ—¶ï¼Œfeignæ¥å£è°ƒç”¨å‚æ•°éœ€è¦å’ŒæœåŠ¡ä¸€è‡´ï¼Ÿï¼Ÿï¼Ÿå‚æ•°éœ€è¦<code>@RequestBody</code>æ³¨è§£ï¼Œè½¬ä¸ºjsonä¼ è¾“ï¼ˆå¦‚æœä¼ çš„æ˜¯å¯¹è±¡å®ä¾‹ï¼‰ï¼Œå¯ä»¥å’ŒæœåŠ¡ç«¯å®ä¾‹ä¸åŒï¼Œåªè¦ä¸¤ä¸ªè½¬æ¢çš„jsonèƒ½ç›¸äº’è½¬æ¢å³å¯ã€‚ä½†æ˜¯ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨åŒä¸€ä¸ªä¼ è¾“å¯¹è±¡ä½œä¸ºä¿å‡†æ¯”è¾ƒå¥½å¯¹åº”ã€‚</p><p>ä½†è¿™é‡Œæˆ‘ä»¬è°ƒç”¨è¿œç«¯æœåŠ¡ä½¿ç”¨çš„æ˜¯é€†å‘å·¥ç¨‹ç›´æ¥åˆ›å»ºçš„æ–¹æ³•ï¼Œå‚æ•°ä¸å¥½æ”¹ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å®ä½“ç±»ï¼Œå› ä¸ºjsonå¯ä»¥äº’è½¬ã€‚</p><h2 id="å•†å“è¯¦æƒ…"><a href="#å•†å“è¯¦æƒ…" class="headerlink" title="å•†å“è¯¦æƒ…"></a>å•†å“è¯¦æƒ…</h2><p>é‡‡ç”¨CompletableFutureå¼‚æ­¥ç¼–æ’è¿›è¡Œä¼˜åŒ–ï¼Œå•†å“ä¿¡æ¯æ˜¯é€ä¸ªæŸ¥è¯¢çš„ï¼Œé‡‡ç”¨å¼‚æ­¥ç¼–æ’ï¼Œè‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œå¯¹å•†å“æŸ¥è¯¢è¿›è¡Œå¤šçº¿ç¨‹ä»»åŠ¡ï¼ŒåŠ å¿«ä¿¡æ¯çš„æŸ¥è¯¢é€Ÿåº¦ã€‚</p><h1 id="é˜¿é‡Œäº‘ç¬¬ä¸‰æ–¹æœåŠ¡"><a href="#é˜¿é‡Œäº‘ç¬¬ä¸‰æ–¹æœåŠ¡" class="headerlink" title="é˜¿é‡Œäº‘ç¬¬ä¸‰æ–¹æœåŠ¡"></a>é˜¿é‡Œäº‘ç¬¬ä¸‰æ–¹æœåŠ¡</h1><h2 id="ç¬¬ä¸‰æ–¹æœåŠ¡äº‘å­˜å‚¨OSS"><a href="#ç¬¬ä¸‰æ–¹æœåŠ¡äº‘å­˜å‚¨OSS" class="headerlink" title="ç¬¬ä¸‰æ–¹æœåŠ¡äº‘å­˜å‚¨OSS"></a>ç¬¬ä¸‰æ–¹æœåŠ¡äº‘å­˜å‚¨OSS</h2><p>ç”±äºå¾®æœåŠ¡è´Ÿè½½å‡è¡¡ï¼Œå›¾ç‰‡ç­‰æœ¬åœ°å­˜å‚¨èµ„æºä¸èƒ½å­˜æ”¾äºæœåŠ¡å™¨ï¼Œå¦åˆ™å…¶ä»–æœåŠ¡å™¨æ‰¾ä¸åˆ°æœåŠ¡ã€‚æˆ‘ä»¬è·¨åŸŸç»Ÿä¸€å­˜æ”¾è¿™ç±»èµ„æºåˆ°äº‘æœåŠ¡å™¨ä¸Šï¼Œè¿›è¡Œç»Ÿä¸€çš„è°ƒç”¨ã€‚é˜¿é‡Œäº‘OSS</p><p>æ–‡ä»¶ä¸Šä¼ ï¼Œ<strong>ä½¿ç”¨æœåŠ¡ç«¯ç­¾ååç›´ä¼ </strong>ï¼Œå€ŸåŠ©é˜¿é‡Œäº‘å°è£…çš„sdkå®Œæˆä¸Šä¼ </p><p><a href="https://help.aliyun.com/document_detail/32009.html">https://help.aliyun.com/document_detail/32009.html</a></p><p><a href="https://github.com/alibaba/aliyun-spring-boot/tree/master/aliyun-spring-boot-samples/aliyun-oss-spring-boot-sample">https://github.com/alibaba/aliyun-spring-boot/tree/master/aliyun-spring-boot-samples/aliyun-oss-spring-boot-sample</a></p><p>å®˜æ–¹ä¾èµ–æœ‰å‘ï¼Œymlä¹Ÿå‘ï¼Œè¿™é‡Œå»ºè®®æ¯”å¯¹ç½‘ç»œåšå®¢</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alicloud-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment"># é˜¿é‡Œäº‘æœåŠ¡é…ç½®</span></span><br><span class="line">    <span class="attr">alicloud:</span></span><br><span class="line">      <span class="attr">access-key:</span> </span><br><span class="line">      <span class="attr">secret-key:</span> </span><br><span class="line">      <span class="attr">oss:</span> </span><br><span class="line">        <span class="attr">endpoint:</span> <span class="string">oss-cn-shanghai.aliyuncs.com</span></span><br></pre></td></tr></table></figure><h2 id="çŸ­ä¿¡éªŒè¯ç "><a href="#çŸ­ä¿¡éªŒè¯ç " class="headerlink" title="çŸ­ä¿¡éªŒè¯ç "></a>çŸ­ä¿¡éªŒè¯ç </h2><p>å»é˜¿é‡Œäº‘éšä¾¿æ‰¾ä¸€å®¶çŸ­ä¿¡æœåŠ¡æä¾›å•†å…è´¹æµ‹è¯•å³å¯ï¼Œ0å…ƒ20æ¬¡å¥—é¤å¤Ÿç”¨äº†ï¼Œçœ‹å®˜æ–¹çš„æ¥å£æ–‡æ¡£è¿›è¡Œå‚æ•°é…ç½®ã€‚</p><p>è°ƒç”¨å®˜æ–¹å°è£…çš„javaç±»ï¼Œè‡ªå®šä¹‰ä¼ å‚å³å¯ã€‚è¿˜å¯æŠ½å–é…ç½®æ–‡ä»¶ï¼Œå°†è·¯å¾„ã€apiç­‰ä¿¡æ¯å†é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼Œä½¿ç”¨@ConfigurationPropertiesæ³¨è§£è‡ªå®šä¹‰é…ç½®æ–‡ä»¶å±æ€§ã€‚</p><ul><li>æ¥å£é˜²åˆ·</li><li>éªŒè¯ç å¤šæ¬¡æ ¡éªŒ</li></ul><h1 id="Elasticsearchï¼ˆ7-6-2ï¼‰"><a href="#Elasticsearchï¼ˆ7-6-2ï¼‰" class="headerlink" title="Elasticsearchï¼ˆ7.6.2ï¼‰"></a>Elasticsearchï¼ˆ7.6.2ï¼‰</h1><p>ç´¢å¼•ã€æ–‡æ¡£ã€å€’æ’ç´¢å¼•ã€åˆ†è¯åŒ¹é…ã€‚</p><p>elasticsearch + kibanaï¼Œåˆ†è¯å™¨ik-analyzerã€‚</p><p>æˆ‘ä»¬é¡¹ç›®ä½¿ç”¨esä½¿ç”¨9200ç«¯å£ï¼Œ9300ç›¸å…³è¿æ¥æ–¹æ³•å·²èˆå¼ƒï¼Œåªæ”¯æŒ6.xã€‚å¯é€šè¿‡Elasticsearch-Rest-Clientï¼Œè·Ÿè¿›æ–°ç‰ˆæœ¬è¿­ä»£ï¼Œæ”¯æŒ7.xã€‚</p><p>å®˜æ–¹ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/7.6/java-rest-high.html">https://www.elastic.co/guide/en/elasticsearch/client/java-rest/7.6/java-rest-high.html</a></p><h2 id="å•†å“ä¸Šæ¶"><a href="#å•†å“ä¸Šæ¶" class="headerlink" title="å•†å“ä¸Šæ¶"></a>å•†å“ä¸Šæ¶</h2><p>ESåªæ£€ç´¢ä¸Šæ¶çš„å•†å“ï¼Œä¸Šæ¶å•†å“æ”¹å˜çŠ¶æ€ï¼Œå¹¶å­˜æ”¾åˆ°ESï¼Œåªé€‰æ‹©å­˜å‚¨å…³é”®ä¿¡æ¯ï¼Œå¦‚å•†å“æ ‡é¢˜å­—æ®µå°±æ˜¯å…³é”®ï¼Œè¿˜è¦é…ç½®åˆ†è¯å™¨ï¼Œå…¶ä»–çš„ä¸€äº›å±•ç¤ºå­—æ®µå¦‚å›¾ç‰‡ç­‰åˆ™ä¸å‚ä¸èšåˆæ“ä½œï¼Œåªæ˜¯ä¸ºäº†æ˜¾ç¤º.</p><h2 id="æ£€ç´¢åŠŸèƒ½"><a href="#æ£€ç´¢åŠŸèƒ½" class="headerlink" title="æ£€ç´¢åŠŸèƒ½"></a>æ£€ç´¢åŠŸèƒ½</h2><p>æ£€ç´¢æœ‰å¤šä¸ªæ–¹å¼ï¼Œå¦‚å…³é”®å­—æ£€ç´¢ã€åˆ†ç±»æ£€ç´¢ã€æ’åºã€è¿‡æ»¤ç­‰ã€‚å°†æ£€ç´¢é¡µé¢éœ€è¦ç”¨åˆ°çš„æ¡ä»¶ï¼Œå…¨éƒ¨å°è£…æˆä¸€ä¸ªå¯¹è±¡ã€‚</p><p>å…ˆå°è£…dslè¯·æ±‚æ£€ç´¢è¯­å¥ï¼Œå°†è¯­å¥é€šè¿‡eså¯¹è±¡searchåï¼Œå°è£…å…¶è¿”å›æ•°æ®äº¤äºˆå‰ç«¯ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ESæœ‰æ›´æ–°å’Œæ£€ç´¢ä¸¤ä¸ªåŠŸèƒ½ï¼Œæ›´æ–°åœ¨å•†å“ä¸Šæ¶æ—¶ï¼Œç”±productè¿œç¨‹è°ƒç”¨ï¼Œæ£€ç´¢åˆ™æ˜¯é¡µé¢æœç´¢æ¡†è°ƒç”¨ï¼Œå…¶urlæ‹¼æ¥æ¡ä»¶è¿›è¡Œæ£€ç´¢ï¼Œæ ¹æ®ä¸åŒæƒ…å†µå†™å…¨æ‹¼æ¥çš„çŠ¶æ€ï¼Œå¦‚å…³é”®è¯æœç´¢ï¼Œä¼šå¯¹æ£€ç´¢å…³é”®å­—è‡ªè¡Œå‰ç«¯æ ‡ç­¾çš„æ‹¼æ¥ï¼Œä½¿å…¶åœ¨å…¶å‰ç«¯å±•ç¤ºæ—¶ï¼Œå–å‡ºé«˜äº®çš„å‰ç«¯æ ‡ç­¾å­—æ®µã€‚</p><h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><p>ESæ›´æ–°æ“ä½œæ€ä¹ˆå¤„ç†ï¼Ÿæˆ‘ä»¬å…ˆå°†å•†å“ä¸‹æ¶ï¼Œåˆ é™¤ESï¼Œéšåä¸Šæ¶å†æ›´æ–°ï¼Ÿ</p><h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><p>åŠ¨é™åˆ†ç¦»ï¼Œnginxåˆ†ç¦»é™æ€èµ„æºå’ŒåŠ¨æ€èµ„æºã€‚ä¿®æ”¹hostsï¼Œé…ç½®è™šæ‹Ÿæœºipæ˜ å°„ã€‚ä½¿ç”¨æ’ä»¶SwitchHostsã€‚</p><p>nginxä»£ç†ç½‘å…³æ—¶ï¼Œä¼šä¸¢å¤±hostç­‰ä¿¡æ¯ã€‚è¯·æ±‚å‘é€åˆ°nginxï¼Œnginxè½¬å‘åˆ°ç½‘å…³è¿›ä¸€æ­¥åˆ†é…ã€‚</p><p>ä¿®æ”¹hostå°†å•†åŸåŸŸåæ˜ å°„åˆ°linuxçš„ip</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.56.11 mall.com</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    listen  [::]:80;</span><br><span class="line">    server_name  mall.com *.mall.com;</span><br><span class="line">    </span><br><span class="line">    location /static/ &#123;</span><br><span class="line">        root /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_pass http://mall;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">upstream mall&#123;</span><br><span class="line">server 192.168.158.1:3000;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†æä»¥ä¸Šé…ç½®ï¼Œè®¿é—®mall.comä»¥åŠå…¶å­åŸŸåï¼Œä¼šèµ°nginxï¼Œè‹¥æ˜¯é™æ€èµ„æºï¼Œå…¶åé“¾æ¥ä¼šè·Ÿstaticï¼Œç„¶åèµ°confçš„é…ç½®ï¼Œè¯·æ±‚å»æŸ¥çœ‹nginxçš„é™æ€èµ„æºã€‚å…¶ä»–çš„æ­£å¸¸è¿æ¥ï¼Œåˆ™èµ°ç½‘å…³ä»£ç†ï¼Œç½‘å…³çš„ipæˆ‘ä»¬ä¼šåœ¨nginx.confä¸­é…ç½®ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸»æœºçš„ç½‘å…³ipå’Œç«¯å£ã€‚è€Œä¸”è¦è®¾ç½®hostå€¼ï¼Œnginxä»£ç†ä¼šä¸¢å¤±ã€‚</p><p>ç„¶åæˆ‘ä»¬åœ¨ç½‘å…³ä¸­è¿›è¡Œhostæ˜ å°„é…ç½®ã€‚nginxè½¬å‘åˆ°ç½‘å…³è¿›è¡Œä»£ç†ï¼Œä¼šæœ‰ä¸€å¼€å§‹è¾“å…¥çš„åŸŸåhostï¼Œè¿™ä¸ªhoståˆ™å¯¹åº”ç½‘å…³é…ç½®çš„æ˜ å°„ï¼Œè·¯ç”±åˆ°å¯¹åº”çš„å¾®æœåŠ¡ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">mall_host_route</span></span><br><span class="line"><span class="attr">uri:</span> <span class="string">lb://mall-product</span></span><br><span class="line">    <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Host=mall.com,item.mall.com</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">mall_search_route</span></span><br><span class="line"><span class="attr">uri:</span> <span class="string">lb://mall-search</span></span><br><span class="line">    <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Host=search.mall.com</span></span><br></pre></td></tr></table></figure><h2 id="åŠ¨é™åˆ†ç¦»"><a href="#åŠ¨é™åˆ†ç¦»" class="headerlink" title="åŠ¨é™åˆ†ç¦»"></a>åŠ¨é™åˆ†ç¦»</h2><p>é™æ€èµ„æºæ”¾ç½®äºnginxï¼Œè€Œä¸æ˜¯é¡¹ç›®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">location /static/ &#123;</span><br><span class="line">root /usr/share/nginx/html;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">proxy_set_header Host $host;</span><br><span class="line">proxy_pass http://mall;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®è¯·æ±‚è·¯å¾„çš„åˆ†å‘ç­–ç•¥ï¼Œé¡µé¢æ‰€æœ‰é™æ€èµ„æº+staticå‰ç¼€ï¼Œå¯¹åº”nginxæ¥åŒ¹é…å…¶staticè·¯å¾„ä¸‹çš„èµ„æºï¼Œå…¶ä»–çš„æ¥å£urlèµ°é¡¹ç›®ã€‚é™æ€èµ„æºç”±nginxå¤„ç†ï¼Œå’Œæˆ‘ä»¬æœåŠ¡å™¨æ— å…³ã€‚</p><p>å‰ç«¯é¡µé¢æœ‰staticå‰ç¼€èµ„æºå°±èµ°nginxå†…éƒ¨è¯·æ±‚ï¼Œå…¶ä»–è¯·æ±‚èµ°é¡µé¢è¯·æ±‚ã€‚</p><h1 id="æµ‹è¯•ä¸è°ƒä¼˜"><a href="#æµ‹è¯•ä¸è°ƒä¼˜" class="headerlink" title="æµ‹è¯•ä¸è°ƒä¼˜"></a>æµ‹è¯•ä¸è°ƒä¼˜</h1><p>ä½¿ç”¨Jmeterå‹åŠ›æµ‹è¯•ï¼ŒJvisualvmæ“ä½œJVMï¼ˆjdkè‡ªå¸¦ï¼Œç›´æ¥å‘½ä»¤è¡Œå¯åŠ¨ï¼‰ã€‚é€šè¿‡æµ‹è¯•æ¥åˆ¤æ–­ç¨‹åºæ€§èƒ½ï¼Œè¿›è€Œå¯¹æ•°æ®åº“å’Œä»£ç è¿›è¡Œè°ƒä¼˜ã€‚</p><p>ä»£ç é€»è¾‘åº”å°½å°‘äºæ•°æ®åº“äº¤äº’ï¼Œä»¥æ­¤æ¥ä¼˜åŒ–ä»£ç ã€‚æ‰€ä»¥éœ€è¦ä½¿ç”¨ç¼“å­˜æ¥æé«˜æ€§èƒ½ã€‚</p><h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="redisç¼“å­˜"><a href="#redisç¼“å­˜" class="headerlink" title="redisç¼“å­˜"></a>redisç¼“å­˜</h2><p>è®¾è®¡ç¼“å­˜æ˜¯ä¸ºäº†å‡å°‘æ•°æ®åº“çš„å‹åŠ›ï¼Œå°†éƒ¨åˆ†æ•°æ®å­˜æ”¾åˆ°ç¼“å­˜ä¸­ï¼Œæ¯”å¦‚ï¼š</p><ul><li>é«˜è®¿é—®é‡ï¼Œä¸”æ›´æ–°é¢‘ç‡å°çš„æ•°æ®ï¼Œå¤šè¯»å°‘å†™ï¼ˆé«˜é¢‘çƒ­ç‚¹æ•°æ®ï¼‰</li><li>å¯¹å³æ—¶æ€§ã€æ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„æ•°æ®</li></ul><p>æˆ‘ä»¬æ³¨å…¥redisçš„startä¾èµ–ï¼Œä½¿ç”¨StringRedisTemplateæ“çºµredis</p><p>å¯¹å³æ—¶æ€§ã€ä¸€è‡´æ€§è¦æ±‚é«˜çš„æ•°æ®å°±åº”è¯¥å»æŸ¥æ•°æ®åº“ï¼Œä¸è¦æ±‚çš„æ•°æ®åˆ™æ”¾å…¥ç¼“å­˜ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ä¿è¯éš”æ®µæ—¶é—´è·å¾—æœ€æ–°æ•°æ®ã€‚</p><h2 id="åˆ†å¸ƒå¼é”ï¼ˆRedissonï¼‰"><a href="#åˆ†å¸ƒå¼é”ï¼ˆRedissonï¼‰" class="headerlink" title="åˆ†å¸ƒå¼é”ï¼ˆRedissonï¼‰"></a>åˆ†å¸ƒå¼é”ï¼ˆRedissonï¼‰</h2><p>ä¿è¯å¤šæœåŠ¡è°ƒç”¨çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p><p>å®˜æ–¹é…ç½®äº†ä¸åŒè¯­è¨€çš„åˆ†å¸ƒå¼é”å®ç°ï¼ŒJava å¯¹åº” Redissonã€‚</p><p>Redissonå’ŒJUCé”çš„ä½¿ç”¨ç›¸å¯¹åº”ã€‚</p><h2 id="SpringCache"><a href="#SpringCache" class="headerlink" title="SpringCache"></a>SpringCache</h2><p>ä¸»å¯åŠ¨ç±» + @EnableCaching</p><p>æ–¹æ³• + @Cacheableç­‰æ³¨è§£ï¼Œä¸åŒæ³¨è§£æ•ˆæœä¸åŒï¼Œé»˜è®¤æ˜¯å¯¹æ³¨è§£æ–¹æ³•çš„ç»“æœè¿›è¡Œç¼“å­˜æ“ä½œï¼Œè‹¥ç»“æœå­˜åœ¨åˆ™ä¸è°ƒç”¨æ–¹æ³•ã€‚</p><p>@CacheEvictç¼“å­˜å¤±æ•ˆæ¨¡å¼</p><p>@Cachingå¤šä¸ªç¼“å­˜æ“ä½œè¿›è¡Œç»„åˆ</p><p>ä½¿ç”¨SpringCacheæ˜¯å†è¿›è¡Œå¤æ‚æŸ¥è¯¢æ“ä½œæ—¶ä½¿ç”¨ï¼Œå°†ç»“æœè¿›è¡Œç¼“å­˜ï¼Œè‹¥åœ¨æ–¹æ³•å†…éƒ¨æƒ³ä½¿ç”¨ç¼“å­˜å¯ç›´æ¥æ“ä½œredisTemplateå¯¹è±¡ï¼Œè¿™ä¸ªæ³¨è§£åªæ˜¯ç”¨äºç¼“å­˜è¿”å›å€¼ã€‚</p><h2 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h2><ul><li>ç™»å½•éªŒè¯ç </li><li>å¤šæ¬¡æŸ¥è¯¢çš„æ•°æ®ï¼Œå¦‚å¤šçº§èœå•</li><li>å…¨å±€ç»Ÿä¸€å­˜å‚¨session</li><li>è´­ç‰©è½¦ä¿¡æ¯</li><li>çƒ­ç‚¹æ•°æ®</li></ul><h1 id="ç³»ç»Ÿç™»å½•"><a href="#ç³»ç»Ÿç™»å½•" class="headerlink" title="ç³»ç»Ÿç™»å½•"></a>ç³»ç»Ÿç™»å½•</h1><h2 id="é¡µé¢è·³è½¬"><a href="#é¡µé¢è·³è½¬" class="headerlink" title="é¡µé¢è·³è½¬"></a>é¡µé¢è·³è½¬</h2><p>ä»¥å‰éƒ½æ˜¯ä½¿ç”¨controllerï¼Œè¿›è¡Œmappingè·¯å¾„æ˜ å°„è¿”å›stringèµ°å¯¹åº”é¡µé¢ï¼Œç°åœ¨ç”±äºè¯·æ±‚è·¯å¾„è¿‡å¤šï¼Œé…ç½®ä¸€ä¸ªconfigå®ç°WebMvcConfigureræ¥å£ï¼Œè°ƒç”¨addViewControllersæ·»åŠ è·¯å¾„æ˜ å°„ã€‚ä»¥é˜²controlleræœ‰å¤ªå¤šç©ºè¯·æ±‚æ–¹æ³•ï¼Œå¯¼è‡´ä»£ç å†—ä½™ã€‚</p><h2 id="æ³¨å†Œæ—¶å‘é€éªŒè¯ç "><a href="#æ³¨å†Œæ—¶å‘é€éªŒè¯ç " class="headerlink" title="æ³¨å†Œæ—¶å‘é€éªŒè¯ç "></a>æ³¨å†Œæ—¶å‘é€éªŒè¯ç </h2><p>éªŒè¯ç æœ‰å¾ˆå¤šç§æƒ…å†µï¼Œæˆ‘ä»¬ä¸€ä¸ªè´¦æˆ·å½“ç„¶å¯ä»¥è¦å¾ˆå¤šä¸ªéªŒè¯ç ï¼Œä¸€èˆ¬è¿‡æœŸæ—¶é—´æ—¶5minï¼Œä½†é—´éš”è¯·æ±‚æ—¶é—´æ˜¯60sã€‚</p><p>ç”±äºå‰ç«¯è§„å®šéªŒè¯ç è·å–æ˜¯60sä¸€æ¬¡ï¼Œä½†å¯ä»¥é€šè¿‡ç›´æ¥æ¥å£è°ƒç”¨ç­‰æ‰‹æ®µé¿å¼€å‰ç«¯åˆ¤æ–­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åç«¯è¿›è¡Œé€»è¾‘éªŒè¯ã€‚</p><p>åœ¨ç”ŸæˆéªŒè¯ç æ—¶ï¼Œæˆ‘ä»¬æ˜¯éšæœºæ•°UUIDç”Ÿæˆï¼Œç„¶åå¯åœ¨å…¶åæ‹¼æ¥ä¸€ä¸ªç³»ç»Ÿæ—¶é—´ã€‚</p><p>å½“å‰ç«¯è¯·æ±‚éªŒè¯ç æ—¶ï¼Œå…ˆåœ¨ç¼“å­˜ä¸­è·å–å½“å‰æ‰‹æœºçš„éªŒè¯ç ä¿¡æ¯ï¼Œè‹¥éªŒè¯ç ä¿¡æ¯ä¸ä¸ºç©ºåˆ™ç»§ç»­åˆ¤æ–­ï¼Œè‹¥å…¶ç”Ÿæˆæ—¶é—´å’Œå½“å‰æ—¶é—´é—´éš”ä¸åˆ°60sï¼Œåˆ™éœ€è¦ç­‰å¾…ï¼Œè¿”å›æŠ¥é”™ä¿¡æ¯ï¼Œè¿™æ˜¯åç«¯è¿›è¡Œæ¥å£å±‚ä¸Šçš„é€»è¾‘å®Œå–„ã€‚</p><p>å½“ç„¶éªŒè¯ç æˆ‘ä»¬æ‹¼æ¥äº†ç³»ç»Ÿæ—¶é—´ï¼Œå¯ä»¥é€šè¿‡æˆªå–å­—ç¬¦ä¸²æ¥è·å–å‰å‡ ä½çš„æ ¡éªŒå­—æ®µå‘ç»™ç”¨æˆ·ï¼Œåå‡ ä½æˆªå–è®°ä¸ºæ ‡è®°æ—¶é—´ã€‚</p><h2 id="æ³¨å†Œä¿¡æ¯æ ¡éªŒ"><a href="#æ³¨å†Œä¿¡æ¯æ ¡éªŒ" class="headerlink" title="æ³¨å†Œä¿¡æ¯æ ¡éªŒ"></a>æ³¨å†Œä¿¡æ¯æ ¡éªŒ</h2><h2 id="å¯†ç "><a href="#å¯†ç " class="headerlink" title="å¯†ç "></a>å¯†ç </h2><p>åˆæ˜¯md5 + ç›å€¼ã€‚ã€‚ã€‚</p><p>ä¸è¿‡æœ‰æ”¹è¿›ï¼Œå¯ä»¥ä½¿ç”¨springçš„<code>BCryptPasswordEncoder</code>ï¼Œä¸ç”¨å¦è¡Œå­˜å‚¨ç›å€¼ï¼Œå…¶ç”Ÿæˆå¯†æ–‡é€šè¿‡ç®—æ³•å¯è‡ªè¡Œè§£æç›å€¼ï¼Œçœå»äº†åœ¨æ•°æ®åº“ä¸­è¿›è¡Œç›å€¼å­˜å‚¨ï¼Œè¿›ä¸€æ­¥åŠ å¼ºäº†å®‰å…¨ã€‚</p><p>åŒä¸€ä¸ªå¯†ç æ˜æ–‡ + ä¸åŒç›å€¼ç”Ÿæˆçš„ä¸åŒéšæœºæ•°ï¼Œç»è¿‡ç®—æ³•è§£å¯†åå¯å¾—åˆ°åŒä¸€ä¸ªæ˜æ–‡ï¼Œæ‰€ä»¥åŒä¸€ä¸ªå¯†ç æ— å½±å“ï¼Œç®—æ³•è‡ªèº«ä¼šè§£æç›å€¼ã€‚</p><p>è€Œç™»å½•è¿›è¡ŒéªŒè¯æ—¶ï¼Œè°ƒç”¨<code>BCryptPasswordEncoder</code>çš„<strong>matchesæ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(CharSequence rawPassword, String encodedPassword)</span></span></span><br></pre></td></tr></table></figure><p>å‚æ•°ä¸€æ˜¯é¡µé¢è¾“å…¥åŸå¯†ç ï¼Œå‚æ•°äºŒæ˜¯æ•°æ®åº“å­˜å‚¨åŠ å¯†å¯†ç ï¼Œç”±äºè¿™ä¸ªåŠ å¯†æ˜¯è¯¥æ–¹æ³•è‡ªè¡Œç”Ÿæˆçš„ï¼Œæ‰€ä»¥å¯è‡ªè¡ŒéªŒè¯é¡µé¢åŸå¯†ç çš„æ­£ç¡®æ€§ã€‚è¿”å›booleanã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">encode</span><span class="params">(CharSequence rawPassword)</span></span></span><br></pre></td></tr></table></figure><p>é€šè¿‡è°ƒç”¨encodeæ–¹æ³•å¯¹åŸå¯†ç åŠ å¯†ã€‚</p><h2 id="ç¤¾äº¤ç™»å½•-OAuth2-0åè®®"><a href="#ç¤¾äº¤ç™»å½•-OAuth2-0åè®®" class="headerlink" title="ç¤¾äº¤ç™»å½• OAuth2.0åè®®"></a>ç¤¾äº¤ç™»å½• OAuth2.0åè®®</h2><p>ç³»ç»Ÿç™»å½•å‘ç”¨æˆ·ç”³è¯·ç¬¬ä¸‰æ–¹è¯·æ±‚è®¤è¯ï¼Œç”¨æˆ·å‰å¾€ç¬¬ä¸‰æ–¹æœåŠ¡å™¨è¿›è¡Œç™»å½•æ“ä½œï¼Œé€šè¿‡éªŒè¯åï¼Œç”±ç¬¬ä¸‰æ–¹å‘ç³»ç»Ÿå‘é€ç™»å½•ä»¤ç‰Œï¼Œæˆ‘ä»¬ç³»ç»Ÿå¯é€šè¿‡ç™»å½•ä»¤ç‰Œè®¿é—®ç¬¬ä¸‰æ–¹æœåŠ¡å™¨è·å–å¤´åƒã€æ˜µç§°ç­‰å…¬å¼€èµ„æºã€‚</p><p>ä½¿ç”¨QQä½œä¸ºç¤¾äº¤ç™»å½•ï¼Œè‡ªè¡ŒéªŒè¯èº«ä»½å¹¶åˆ›å»ºåº”ç”¨ã€‚</p><p><a href="https://op.open.qq.com/appregv2/">https://op.open.qq.com/appregv2/</a></p><p><a href="https://connect.qq.com/manage.html#/">https://connect.qq.com/manage.html#/</a></p><p>å¯ä»¥æ ¹æ®å®˜æ–¹apiè·å–ä¸€äº›æ•°æ®ã€‚</p><p>ã€‚ã€‚ã€‚ã€‚ã€‚å®¡æ ¸å¤ªæ¶å¿ƒï¼Œä¸åšäº†ã€‚æ³¨æ„ç¤¾äº¤ç™»å½•ä¹Ÿåº”å°†ä¿¡æ¯æ³¨å†Œåˆ°ç³»ç»Ÿçš„æ•°æ®åº“ã€‚</p><h2 id="Sessionçš„çŠ¶æ€è®°å½•"><a href="#Sessionçš„çŠ¶æ€è®°å½•" class="headerlink" title="Sessionçš„çŠ¶æ€è®°å½•"></a>Sessionçš„çŠ¶æ€è®°å½•</h2><p>ä»¥å‰çš„å•ä½“é¡¹ç›®å¯ä»¥ä½¿ç”¨Sessionï¼Œä½†Sessionä¸èƒ½è·¨åŸŸåå…±äº«ã€‚</p><p>ä½†ç°åœ¨æ˜¯å¾®æœåŠ¡çš„é¡¹ç›®ï¼ŒæœåŠ¡æ˜¯åˆ†æ¨¡å—çš„ï¼Œä¸åŒæœåŠ¡é—´çš„Sessionä¹Ÿæ˜¯ä¸å…±äº«çš„ï¼Œé›†ç¾¤ä¹Ÿæ˜¯ã€‚</p><ul><li><p>åŒä¸€ä¸ªæœåŠ¡ï¼Œä¸åŒæœºå™¨ï¼Œä¹Ÿå°±æ˜¯åŒä¸€ä¸ªæœåŠ¡çš„é›†ç¾¤sessionå…±äº«è§£å†³ï¼š</p><ul><li><strong>sessionå¤åˆ¶</strong>ï¼Œè¿›è¡Œé›†ç¾¤é—´æœºå™¨çš„sessionåŒæ­¥ï¼Œä½†æ˜¯åŒæ­¥æ•°æ®éœ€è¦æ•°æ®ä¼ è¾“ï¼Œå ç”¨ç½‘ç»œèµ„æºï¼Œä¸”ä¸ºäº†ä¿è¯åŒæ­¥ï¼Œæ‰€æœ‰çš„æœåŠ¡å™¨éƒ½è¦ä¿å­˜ï¼Œæ¯å°æœåŠ¡éƒ½è¦å¼€è¾Ÿè¿™ä¸ªsessionçš„ç©ºé—´ï¼Œå¯¹äºåˆ†å¸ƒå¼é›†ç¾¤å¾ˆä¸å‹å¥½ã€‚</li><li><strong>å®¢æˆ·ç«¯å­˜å‚¨</strong>ï¼Œç”¨æˆ·è‡ªè¡Œä¿å­˜sessionåˆ°cookieï¼Œä¸å®‰å…¨ï¼Œè€Œä¸”cookieä¸èƒ½å­˜å‚¨å¤§é‡æ•°æ®ã€‚</li><li><strong>hashä¸€è‡´æ€§</strong>ï¼Œæ ¹æ®æœåŠ¡ipï¼Œå°†åŒä¸€ä¸ªipçš„è¯·æ±‚éƒ½åˆ†é…åˆ°åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œä¹Ÿå°±æ˜¯è´Ÿè½½å‡è¡¡æ˜¯åˆ†é…ä¸åŒipçš„ï¼ŒåŒä¸€ä¸ªipä¸€ç›´ç”¨åŒä¸€ä¸ªæœåŠ¡å™¨ï¼Œä½†æ˜¯æœºå™¨æ°´å¹³æ‰©å±•ä¼šå¯¼è‡´hashç®—æ³•å‡ºç°é—®é¢˜ã€‚</li><li><strong>ç»Ÿä¸€å­˜å‚¨</strong>ï¼Œå°†sessionä¸å­˜åˆ°æœåŠ¡å™¨ï¼Œè€Œæ˜¯redisæˆ–å…¶ä»–æ•°æ®åº“ï¼Œæ²¡æœ‰å®‰å…¨éšæ‚£ï¼Œæ°´å¹³æ‰©å±•é›†ç¾¤ä¸ä¼šå½±å“ï¼Œä½†ç¼ºç‚¹æ˜¯éœ€è¦å¤šè¿›è¡Œä¸€æ¬¡ç½‘ç»œè¿æ¥æ•°æ®åº“ï¼Œä¸”æŸ¥è¯¢æ•°æ®åº“ä¸€å®šæ¯”ç›´æ¥çš„å†…å­˜æŸ¥è¯¢æ…¢ã€‚</li></ul><p><strong>æ¨èä½¿ç”¨hashä¸€è‡´æ€§ æˆ– æ•°æ®åº“ç»Ÿä¸€å­˜å‚¨ã€‚</strong></p></li></ul><h2 id="SpringSession"><a href="#SpringSession" class="headerlink" title="SpringSession"></a>SpringSession</h2><p><a href="https://docs.spring.io/spring-session/docs/2.4.6/reference/html5/#samples">https://docs.spring.io/spring-session/docs/2.4.6/reference/html5/#samples</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.session<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-session-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ymléœ€è¦æŒ‡å®šsessionçš„å­˜å‚¨æ•°æ®åº“ï¼Œä¸»å¯åŠ¨ç±»åŠ ä¸Šæ³¨è§£@EnableRedisHttpSessionï¼Œéœ€è¦ä¿®æ”¹sessionçš„ä½œç”¨åŸŸï¼Œä½œç”¨äºçˆ¶åŸŸåˆ™æ‰€æœ‰å­åŸŸéƒ½ä¼šè¢«è¾å°„åˆ°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MallSessionConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CookieSerializer <span class="title">cookieSerializer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        DefaultCookieSerializer cookieSerializer = <span class="keyword">new</span> DefaultCookieSerializer();</span><br><span class="line">        <span class="comment">// æ‰©å¤§ä½œç”¨åŸŸ</span></span><br><span class="line">        cookieSerializer.setDomainName(<span class="string">&quot;mall.com&quot;</span>);</span><br><span class="line">        cookieSerializer.setCookieName(<span class="string">&quot;MALL_SESSION&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> cookieSerializer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisSerializer&lt;Object&gt; <span class="title">springSessionDefaultRedisSerializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> GenericJackson2JsonRedisSerializer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¯ä¸ªæœåŠ¡éœ€è¦ç”¨åˆ°sessionæ—¶ï¼Œéœ€è¦åŠ è½½pomã€configé…ç½®ç±»ã€ä¸»å¯åŠ¨ç±»æ³¨è§£ã€ymlçš„é…ç½®ï¼ˆredisã€session-typeï¼‰</p><ul><li>spring-sessionï¼Œymlé…ç½®å…¶ç¼“å­˜ä½¿ç”¨çš„æ•°æ®åº“ï¼Œæˆ‘ä»¬ä½¿ç”¨redis</li><li>sessionéœ€è¦å­˜å‚¨çš„å®ä½“ç±»å®ç°åºåˆ—åŒ–Serializableæ¥å£ï¼Œç„¶ååœ¨configä¸­è‡ªè¡Œé…ç½®æ”¾å¤§ä½œç”¨åŸŸï¼Œä»¥åŠredisçš„jsonåºåˆ—åŒ–å­˜å‚¨ã€‚å› ä¸ºæˆ‘ä»¬æ˜¯ç”¨æˆ·ç™»å½•æœåŠ¡è¿›è¡Œç™»å½•çš„ï¼Œæ˜¯äºŒçº§åŸŸåï¼Œéœ€è¦æ”¾å¤§ä½œç”¨åŸŸï¼Œä»¥ä¾¿è¾å°„å…¶ä»–æœåŠ¡ã€‚</li><li>sessioné¦–æ¬¡è¢«setæ˜¯æŒ‰kvè®¾ç½®çš„ï¼Œæˆ‘ä»¬åç»­ä»rediså–ï¼Œä¹Ÿæ˜¯ç”¨è¿™ä¸ªkeyå»æ‹¿ã€‚</li></ul><h2 id="å•ç‚¹ç™»å½•"><a href="#å•ç‚¹ç™»å½•" class="headerlink" title="å•ç‚¹ç™»å½•"></a>å•ç‚¹ç™»å½•</h2><p>å¤šç³»ç»Ÿé—´ç™»å½•äº’é€šï¼Œæ¯”å¦‚ç™»å½•ç™¾åº¦è´¦å·ï¼Œæ‰€æœ‰ç™¾åº¦çš„åº”ç”¨éƒ½ä¼šè‡ªè¡Œç™»å½•ã€‚</p><p>æˆ‘ä»¬å‰é¢ä½¿ç”¨sessionæ˜¯å¯¹å­åŸŸåæ¥è¯´çš„ï¼Œå³mall.comæ˜¯é¡¶çº§åŸŸåï¼Œsearch.mall.comå’Œauth.mall.coméƒ½æ˜¯å…¶å­åŸŸåã€‚è€Œå•ç‚¹ç™»å½•æ˜¯ä½œç”¨äºå®Œå…¨ä¸åŒçš„å‡ ä¸ªåŸŸåä¹‹é—´çš„ä¸åŒ1.comã€2.comã€3.comã€‚</p><p><a href="https://gitee.com/xuxueli0323/xxl-sso?_from=gitee_search">https://gitee.com/xuxueli0323/xxl-sso?_from=gitee_search</a></p><p>å•ç‚¹ç™»å½•ä¸€èˆ¬æœ‰ä¸€ä¸ªè®¤è¯æœåŠ¡å™¨ï¼Œé€šè¿‡è¯¥æœåŠ¡å™¨è¿›è¡Œè·³è½¬ã€‚</p><h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨å­åŸŸåè¿›è¡Œæ³¨å†Œæ“ä½œï¼Œå¯¼è‡´è¦ä½¿ç”¨ç»Ÿä¸€å­˜å‚¨sessionï¼Œå¹¶è‡ªå®šä¹‰sesssionæ‰©åŸŸçš„configé…ç½®ï¼Œredisç¼“å­˜sessionï¼Œè®©æ¯ä¸ªåŸŸåéƒ½æ¥ä½¿ç”¨sessionã€‚è¿™ä¸ªé¡¹ç›®ç”¨ä¸åˆ°å•ç‚¹ç™»å½•ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªåŸŸåï¼Œå…¶ä½™éƒ½æ˜¯å…¶å­åŸŸåã€‚</p><h1 id="è´­ç‰©è½¦ï¼ˆredis-hashå­˜å‚¨ï¼‰"><a href="#è´­ç‰©è½¦ï¼ˆredis-hashå­˜å‚¨ï¼‰" class="headerlink" title="è´­ç‰©è½¦ï¼ˆredis hashå­˜å‚¨ï¼‰"></a>è´­ç‰©è½¦ï¼ˆredis hashå­˜å‚¨ï¼‰</h1><h2 id="å­˜å‚¨ç»“æ„"><a href="#å­˜å‚¨ç»“æ„" class="headerlink" title="å­˜å‚¨ç»“æ„"></a>å­˜å‚¨ç»“æ„</h2><p>è´­ç‰©è½¦ç¼“å­˜ä½¿ç”¨hashå­˜å‚¨ï¼Œkeyæ˜¯å›ºå®šå°è£…å‰ç¼€ + ç”¨æˆ·idï¼Œä»sessionå–ç”¨æˆ·idï¼Œvalueæ˜¯å•†å“idå’Œå•†å“ä¿¡æ¯çš„kvç»„åˆï¼Œå•†å“ä¿¡æ¯æ˜¯è¿œç¨‹å•†å“æœåŠ¡è°ƒç”¨æŸ¥è¯¢çš„ã€‚</p><h2 id="åˆ†ææ¦‚è¿°"><a href="#åˆ†ææ¦‚è¿°" class="headerlink" title="åˆ†ææ¦‚è¿°"></a>åˆ†ææ¦‚è¿°</h2><p>è´­ç‰©è½¦é¦–å…ˆåˆ†ä¸¤ç§æƒ…å†µï¼Œç™»å½•ç”¨æˆ·å’Œæ¸¸å®¢ã€‚</p><ul><li>ç™»å½•ç”¨æˆ·ï¼šé€‰æ‹©redisï¼Œç”±äºè´­ç‰©è½¦éœ€è¦å¤šè¯»å†™ä¸åº”ä½¿ç”¨mysqlé€ æˆå‹åŠ›ï¼Œå¯ä½¿ç”¨nosqlé¢‘ç¹è¯»å†™ã€‚</li><li>æ¸¸å®¢ï¼šå¯ä»¥å­˜å‚¨åˆ°æœ¬åœ°çš„cookieæˆ–localstorageï¼Œä½†è¿™äº›æ•°æ®æˆ‘ä»¬æœåŠ¡å™¨åç«¯æ˜¯æ²¡æœ‰æ•°æ®çš„ï¼Œå°±æ— æ³•å¯¹ç”¨æˆ·çš„å–œå¥½è¿›è¡Œåˆ†æè¿›è€Œæ¨é€æ•°æ®ï¼Œç»¼åˆå¤§æ•°æ®æ—¶ä»£çš„ç°çŠ¶ï¼Œæ¸¸å®¢æ•°æ®ä¹Ÿä¼šå­˜å‚¨åˆ°redisã€‚</li></ul><p>å½“ç„¶å¤§æ•°æ®æ˜¯ä½¿ç”¨redisï¼Œå‡è½»mysqlçš„å‹åŠ›ï¼Œå°æ•°æ®é‡ä½¿ç”¨mysqlä¹Ÿå¯ä»¥ã€‚ä½†æ˜¯åŸºäºç°åœ¨çš„å•†åŸä¸šåŠ¡ï¼Œç¦»çº¿è´­ç‰©è½¦è¿™ä¸ªåº”è¯¥èˆå¼ƒï¼Œå› ä¸ºè¿è´¦å·éƒ½æ²¡æœ‰çš„ç”¨æˆ·ï¼Œæ›´å®¹æ˜“åˆ©ç”¨è¿™ä¸€ç‚¹å­˜å‚¨åƒåœ¾æ•°æ®ã€‚</p><p>rediså­˜å‚¨ä½¿ç”¨hashç»“æ„ã€‚</p><h2 id="ç»†èŠ‚"><a href="#ç»†èŠ‚" class="headerlink" title="ç»†èŠ‚"></a>ç»†èŠ‚</h2><p>rediså­˜å‚¨è´­ç‰©è½¦ï¼Œå…ˆæŸ¥sessionæ‹¿idï¼Œæ·»åŠ è´­ç‰©è½¦æ—¶ï¼Œè‹¥å·²ç»æ‹¥æœ‰åˆ™ç›´æ¥ä¿®æ”¹ï¼Œæ²¡æœ‰åˆ™æ–°å¢ã€‚</p><p>ä½¿ç”¨ThreadLocalï¼Œè®©serviceå±‚å¯ä»¥ä½¿ç”¨sessionä¿¡æ¯ï¼Œé…ç½®åˆ°è‡ªå®šä¹‰æ‹¦æˆªå™¨ä¸­ï¼Œç„¶åå°†è‡ªå®šä¹‰æ‹¦æˆªå™¨æ³¨å…¥ã€‚</p><p>æ·»åŠ è´­ç‰©è½¦æ•°æ®é‡‡ç”¨å¼‚æ­¥ä»»åŠ¡ï¼Œæé«˜æ•ˆç‡ã€‚</p><p>å…³äºä»·æ ¼ï¼Œæˆ‘ä»¬å°è£…ç±»å°±é‡å†™äº†getã€setæ–¹æ³•ï¼Œåœ¨getã€setæ—¶ä¼šè®¡ç®—å€¼ã€‚</p><h2 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h2><p>æŠŠThreadLocalé…ç½®åˆ°æ‹¦æˆªå™¨ä¸­ï¼Œsessionå­˜åœ¨åˆ™å­˜å‚¨åˆ°threadlocalä¸­ï¼Œä¿è¯å½“å‰çº¿ç¨‹çš„sessionå…±äº«ï¼Œåç»­è®¢å•æœåŠ¡ä¹Ÿè¦ä½¿ç”¨è¿™ä¸ªã€‚</p><h1 id="è®¢å•æœåŠ¡"><a href="#è®¢å•æœåŠ¡" class="headerlink" title="è®¢å•æœåŠ¡"></a>è®¢å•æœåŠ¡</h1><h2 id="Serviceå±‚è·å–Session"><a href="#Serviceå±‚è·å–Session" class="headerlink" title="Serviceå±‚è·å–Session"></a>Serviceå±‚è·å–Session</h2><p>æˆ‘ä»¬è®¾ç½®mvcæ‹¦æˆªå™¨ï¼Œé™¤äº†æ‹¦æˆªæœªç™»å½•ç”¨æˆ·å¤–ï¼Œè¿˜å¯ä»¥å®šä¹‰ä¸€ä¸ªThreadLocalå˜é‡ï¼Œè¯¥å˜é‡åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ä¸ä¼šæ”¹å˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ‹¦æˆªå™¨ä¸­ï¼Œé€šè¿‡requestè·å–sessionï¼Œç„¶åå°†sessionçš„å€¼å­˜å‚¨åˆ°ThreadLocalä¸­ï¼Œåœ¨Serviceå±‚å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ThreadLocalçš„å­˜å‚¨æ•°æ®å³å¯ï¼Œè§£å†³äº†serviceå±‚è·å–sessionçš„é—®é¢˜ã€‚</p><p>æˆ–è€…æ³¨å…¥HttpSessionï¼Œåœ¨Serviceè·å–sessionä¿¡æ¯ï¼Œä½†æ‹¦æˆªå™¨æœ¬æ¥å°±è¦è·å–sessionï¼Œå¯ä»¥ç›´æ¥åœ¨æ‹¦æˆªå™¨é‡Œè·å–ã€‚è¿™ä¹Ÿä¸ºäº†å®æˆ˜ThreadLocalã€‚</p><h2 id="è¿œç¨‹è°ƒç”¨ä¸sessionå†²çª"><a href="#è¿œç¨‹è°ƒç”¨ä¸sessionå†²çª" class="headerlink" title="è¿œç¨‹è°ƒç”¨ä¸sessionå†²çª"></a>è¿œç¨‹è°ƒç”¨ä¸sessionå†²çª</h2><p>åœºæ™¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æˆ‘ä»¬ç¡®è®¤è®¢å•ä¿¡æ¯ï¼Œè¿œç¨‹è°ƒç”¨æœåŠ¡ï¼Œé¦–å…ˆä½¿ç”¨ç”¨æˆ·æœåŠ¡è·å–ç”¨æˆ·åœ°å€ï¼Œæˆ‘ä»¬è¿™ä¸ªè¿œç¨‹æœåŠ¡ä¼ å…¥äº†è¯¥çº¿ç¨‹ä¸­çš„sessionç›¸å…³æ•°æ®ï¼ŒæˆåŠŸè°ƒç”¨ã€‚</span><br><span class="line">ç„¶åæˆ‘ä»¬è¦è·å–æ‰€æœ‰è´­ç‰©è½¦çš„å†…å®¹ï¼Œè°ƒç”¨è´­ç‰©è½¦è¿œç¨‹æœåŠ¡ï¼Œä½†æ˜¯è´­ç‰©è½¦è¿™ä¸ªè¿œç¨‹æœåŠ¡æ— éœ€å‚æ•°ï¼Œå½“æ—¶å†™åŠŸèƒ½æ—¶ï¼Œå°±æ˜¯è®©å®ƒé€šè¿‡å½“å‰æ‹¦æˆªå™¨ThreadLocalæ‹¿Sessionæ•°æ®è¿›è¡Œå¤„ç†çš„ã€‚ç»“æœè¿™é‡Œè¿œç¨‹è°ƒç”¨å‡ºç°çš„äº†é—®é¢˜ï¼ŒThreadLocalæ‹¿ä¸åˆ°æ•°æ®ã€‚</span><br></pre></td></tr></table></figure><p>åŸå› æ˜¯<strong>feignè¿œç¨‹è°ƒç”¨ä¼šä¸¢å¤±è¯·æ±‚å¤´ä¿¡æ¯</strong>ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°è¯·æ±‚å»è®¿é—®è¿œç«¯æœåŠ¡ï¼Œä½†åŸè¯·æ±‚çš„è¯·æ±‚å¤´ä¿¡æ¯å°±æ²¡æœ‰äº†ã€‚è¿™æ—¶è¿œç¨‹è´­ç‰©è½¦æœåŠ¡ä¼šåˆ¤æ–­æˆ‘ä»¬æ²¡æœ‰ç™»å½•ï¼Œæ‰€ä»¥æ‹¿ä¸åˆ°sessionï¼ŒThreadLocalè‚¯å®šæ‹¿ä¸åˆ°å€¼ã€‚</p><p><strong>è§£å†³åŠæ³•ï¼šæ·»åŠ ä¸€ä¸ªfeignè°ƒç”¨çš„è¯·æ±‚æ‹¦æˆªå™¨ï¼Œå°†åŸè¯·æ±‚Cookieä¿¡æ¯å­˜å‚¨åˆ°æ–°çš„è¿œç¨‹è°ƒç”¨è¯·æ±‚ã€‚é…ç½®RequestInterceptorè¿™ä¸ªæ‹¦æˆªå™¨ã€‚</strong></p><p>å› ä¸ºfeignå¤„ç†è¿œç¨‹æœåŠ¡ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªåˆå§‹åŒ–çš„æ‹¦æˆªå™¨ï¼Œæˆ‘ä»¬å¯¹è¿™ä¸ªæ‹¦æˆªå™¨è¿›è¡Œé…ç½®ï¼Œå¯å°†åŸè¯·æ±‚çš„cookieå°è£…åˆ°æ–°è¯·æ±‚ã€‚é˜²æ­¢Cookieä¿¡æ¯ä¸¢å¤±ã€‚</p><h2 id="å¼‚æ­¥ä»»åŠ¡ä¸feignè°ƒç”¨å†²çª"><a href="#å¼‚æ­¥ä»»åŠ¡ä¸feignè°ƒç”¨å†²çª" class="headerlink" title="å¼‚æ­¥ä»»åŠ¡ä¸feignè°ƒç”¨å†²çª"></a>å¼‚æ­¥ä»»åŠ¡ä¸feignè°ƒç”¨å†²çª</h2><p>ThreadLocalåªèƒ½åŒä¸€ä¸ªçº¿ç¨‹ä¸­å˜é‡å…±äº«ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨CompletableFutureå¼‚æ­¥ä»»åŠ¡åŠ å¿«æœåŠ¡æ“ä½œçš„æ•ˆç‡ï¼Œä½†ä¿¡æ¯ä¸èƒ½å…±äº«ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸»çº¿ç¨‹è·å–ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œç„¶ååœ¨å­çº¿ç¨‹æ‰§è¡Œæ“ä½œæ—¶å…ˆå°†ä¸Šä¸‹æ–‡ä¿¡æ¯ä¿å­˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RequestContextHolder.setRequestAttributes(requestAttributes);</span><br></pre></td></tr></table></figure><h2 id="æ¥å£å¹‚ç­‰æ€§é—®é¢˜"><a href="#æ¥å£å¹‚ç­‰æ€§é—®é¢˜" class="headerlink" title="æ¥å£å¹‚ç­‰æ€§é—®é¢˜"></a>æ¥å£å¹‚ç­‰æ€§é—®é¢˜</h2><p>å¯¹äºæäº¤è®¢å•è¿™ä¸ªæ“ä½œï¼Œç”¨æˆ·å¸‚ä¸èƒ½å¯¹ä¸€ä¸ªè®¢å•è¿›è¡Œå¤šæ¬¡æäº¤æ“ä½œçš„ï¼Œä¹Ÿå°±æ˜¯å¹‚ç­‰æ€§é—®é¢˜ã€‚</p><p>å¹‚ç­‰æ€§å³å¤šæ¬¡è¯·æ±‚ç»“æœä¸€è‡´ï¼Œå¤šæ¬¡æ¥å£è¯·æ±‚åªæäº¤ä¸€æ¬¡è®¢å•ã€‚ä¸€äº›åœºæ™¯å¦‚ä¸‹ï¼š</p><ul><li>ç”¨æˆ·å¤šæ¬¡æ“ä½œ</li><li>é¡µé¢å›é€€åè¿”å›å†æ¬¡æäº¤</li><li>å¾®æœåŠ¡é—´çš„è°ƒç”¨ï¼Œå¦‚åº“å­˜å…‹æ‰£é—®é¢˜ã€‚</li></ul><p>è§£å†³æ–¹æ³•æœ‰ï¼š</p><ul><li>æ•°æ®åº“è®¾è®¡å”¯ä¸€ï¼Œæ ‡è®°å”¯ä¸€æ ‡è¯†ï¼Œå¦‚æ•°æ®åº“å”¯ä¸€ç´¢å¼•</li><li>æºå¸¦tokenï¼Œä»¤ç‰Œæœºåˆ¶ï¼Œå…¶ä»¤ç‰Œæ“ä½œè¦ä¿è¯åŸå­æ€§ï¼Œrediså­˜å‚¨tokenå¯ä½¿ç”¨luaè¿›è¡Œè¾…åŠ©</li><li>æ‚²è§‚é”ã€ä¹è§‚é”</li><li>åˆ†å¸ƒå¼é”</li><li>æºå¸¦å…¨å±€çš„å”¯ä¸€id</li></ul><h2 id="Tokenä»¤ç‰Œé˜²é‡"><a href="#Tokenä»¤ç‰Œé˜²é‡" class="headerlink" title="Tokenä»¤ç‰Œé˜²é‡"></a>Tokenä»¤ç‰Œé˜²é‡</h2><p>rediså­˜å‚¨ä»¤ç‰Œï¼Œä½¿ç”¨stringç»“æ„ï¼Œkæ˜¯ç”¨æˆ·idï¼Œvæ˜¯uuidç”Ÿæˆçš„tokenï¼Œå¹¶è®¾ç½®30minè¿‡æœŸæ—¶é—´ã€‚åç»­æäº¤è®¢å•è¦é€šè¿‡tokenè¿›è¡Œé˜²é‡æ“ä½œã€‚</p><p>åœ¨è´­ç‰©è½¦ç¡®è®¤å¹¶ç”Ÿæˆè®¢å•ï¼Œå°è£…è®¢å•ä¿¡æ¯æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªé˜²é‡ä»¤ç‰Œå¹¶ç¼“å­˜åˆ°redisï¼ˆtokenæ˜¯stringç»“æ„ï¼Œåå¤ç¡®è®¤è®¢å•ä¼šæŠŠä¸Šæ¬¡çš„tokenè¦†ç›–ï¼‰ï¼Œç„¶åcontrollerä¼šå°†å°è£…ä¿¡æ¯è®¾ç½®åˆ°modelä¸­å¹¶è·³è½¬åˆ°è®¢å•æäº¤é¡µï¼Œæäº¤è®¢å•å»ç»“ç®—æ—¶ï¼Œä¼šä½¿ç”¨luaè„šæœ¬æ¯”å¯¹ç¼“å­˜ä¸è®¢å•ä¿¡æ¯çš„tokenï¼Œæ¯”å¯¹é€šè¿‡å°±åˆ é™¤tokenï¼Œå¹¶åˆ›å»ºè®¢å•ã€é”åº“å­˜ï¼Œç„¶åé€šè¿‡mqè¿›è¡Œè§£é”åˆ¤å®šå¤„ç†ã€‚è®¢å•åˆ›å»ºå®Œåå°†è´­ç‰©è½¦sessionä¿¡æ¯åˆ é™¤ã€‚</p><p>ä½¿ç”¨luaè„šæœ¬æ˜¯ä¸ºäº†ä¿è¯ä»¤ç‰Œçš„è·å–ã€æ¯”è¾ƒã€åˆ é™¤ä¸‰ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œé˜²æ­¢å¤šæ¬¡è¯·æ±‚åŒæ—¶å®Œæˆæ“ä½œï¼Œå¯¼è‡´è®¢å•é‡å¤åˆ›å»ºã€‚</p><h2 id="æäº¤è®¢å•"><a href="#æäº¤è®¢å•" class="headerlink" title="æäº¤è®¢å•"></a>æäº¤è®¢å•</h2><p>ç›´æ¥å»è´­ç‰©è½¦è·å–ä¿¡æ¯ï¼Œè€Œä¸æ˜¯æäº¤é¡µé¢ï¼Œå› ä¸ºç”¨æˆ·å¯èƒ½æå‰æ‰“å¼€æäº¤é¡µé¢ï¼Œç„¶åå†å»è´­ç‰©è½¦æ“ä½œæ•°æ®ï¼Œæ‰€ä»¥ç›´æ¥å»è´­ç‰©è½¦æ‹¿æ•°æ®å³å¯ã€‚</p><p>æäº¤è®¢å•åï¼Œå¯ä»¥åˆ†æˆä»¥ä¸‹æ“ä½œã€‚</p><ul><li><p>ä¸‹å•</p></li><li><p>åˆ›å»ºè®¢å•</p></li><li><p>éªŒè¯ä»¤ç‰Œå¹¶åˆ é™¤</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> </span><br><span class="line">    redis.call(<span class="string">&#x27;get&#x27;</span>, KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] </span><br><span class="line">    <span class="keyword">then</span> <span class="keyword">return</span> redis.call(<span class="string">&#x27;del&#x27;</span>, KEYS[<span class="number">1</span>]) <span class="keyword">else</span> </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> </span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨luaè„šæœ¬ä¿è¯ä»¤ç‰ŒéªŒè¯ä¸åˆ é™¤æ“ä½œçš„åŸå­æ€§ã€‚</p><p>ä»¤ç‰Œå³ç”¨å³åˆ ï¼Œé˜²æ­¢å…¶ä»–è®¢å•ä½¿ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String orderToken = vo.getOrderToken();</span><br><span class="line">Long result = stringRedisTemplate.execute(</span><br><span class="line">        <span class="keyword">new</span> DefaultRedisScript&lt;Long&gt;(script, Long.class),</span><br><span class="line">        Arrays.asList(OrderConstant.USER_ORDER_TOKEN_PREFIX + memberResponseVo.getId()),</span><br><span class="line">        orderToken</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œscriptå³ä¸Šè¿°è„šæœ¬ï¼Œæˆ‘ä»¬åœ¨è´­ç‰©è½¦ç¡®è®¤è®¢å•ç•Œé¢ï¼Œä¼šåœ¨rediså­˜å‚¨tokenï¼Œkvç¤ºä¾‹ä¸Šé¢è¯´è¿‡ï¼Œç„¶ååœ¨æäº¤è®¢å•åˆ°æ”¯ä»˜ç•Œé¢è¿›è¡ŒtokenäºŒæ¬¡ç¡®è®¤ã€‚è·å–å½“å‰è®¢å•idï¼Œä»rediså–tokenå¹¶ä¸å½“å‰è®¢å•è‡ªèº«æºå¸¦çš„tokenè¿›è¡Œå¯¹æ¯”ï¼ŒäºŒè€…ç›¸åŒè¯´æ˜æ˜¯åŒä¸€ä¸ªè®¢å•æœªè¢«æ¶ˆè´¹ï¼Œç„¶åå»ä»˜æ¬¾ã€‚æ ¡éªŒåé©¬ä¸Šåˆ é™¤redisçš„tokenï¼Œç¡®ä¿è®¢å•ä¸ä¼šè¢«é‡å¤åˆ›å»ºã€‚</p></li><li><p>éªŒè¯ä»·æ ¼</p><p>å°†é¡µé¢ä»·æ ¼ä¸è´­ç‰©è½¦ä»·æ ¼è®¡ç®—åæ ¡éªŒã€‚</p></li><li><p>é”åº“å­˜</p><p>å…ˆé”åœ¨å–ï¼Œè®¢å•è¿œç¨‹è°ƒç”¨åº“å­˜æœåŠ¡çš„æ–¹æ³•ï¼Œä½¿ç”¨äº‹åŠ¡ã€‚</p><p>ç”±äºå­˜åœ¨è¿œç¨‹æœåŠ¡è°ƒç”¨ï¼Œå¯¹äºé”åº“å­˜æ¶‰åŠåˆ°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p></li></ul><p><strong>é¦–å…ˆæ•´ä¸ªè®¢å•æäº¤æœåŠ¡æ˜¯ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ï¼Œæœ‰å¤šæ¬¡æ ¡éªŒï¼Œä»¤ç‰Œæ ¡éªŒã€ä»·æ ¼æ ¡éªŒï¼ˆè®¢å•æ€»é¢ä¸è´­ç‰©è½¦æ€»é¢å¯¹æ¯”ï¼Œé˜²æ­¢ç”¨æˆ·åœ¨è®¢å•é¡µå»ä¿®æ”¹è´­ç‰©è½¦ï¼‰ã€åº“å­˜æ ¡éªŒï¼Œä¸€æ¬¡æ ¡éªŒå¤±è´¥å°±ä¼šè¿”å›å¯¹åº”æŠ¥é”™ä¿¡æ¯ï¼Œå¹¶æ‰§è¡Œå›æ»šæ“ä½œï¼›è€Œå…¶è¿œç¨‹è°ƒç”¨åº“å­˜æ¶‰åŠåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé‡‡ç”¨MQå®ç°æœ€ç»ˆä¸€è‡´æ€§æ¥è§£å†³</strong></p><h2 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h2><p>ç”±äºæˆ‘ä»¬æœåŠ¡ä¼šè¿œç¨‹è°ƒç”¨æœåŠ¡ï¼Œå¦‚aã€bä¸¤æ¬¡è¿œç¨‹è°ƒç”¨ï¼ŒaæˆåŠŸï¼Œbå¤±è´¥ï¼Œä½†bå¤±è´¥åªä¼šå¯¼è‡´bæœåŠ¡ä¸å½“å‰æœåŠ¡å›æ»šï¼ŒaæœåŠ¡å› ä¸ºè¿œç¨‹è°ƒç”¨å¹¶é€šè¿‡ï¼Œåç»­å›æ»šå®ƒå´ä¸ä¼šæ¥æ”¶åˆ°ä¿¡æ¯ã€‚</p><p>åœ¨åˆ†å¸ƒå¼é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½æœåŠ¡åµŒå¥—è°ƒç”¨ï¼Œä»¥å¾€çš„æœ¬åœ°äº‹åŠ¡å°±ä¸åœ¨é€‚ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><p>åº“å­˜å›æ»šä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ã€‚CAPæ€§è´¨ä¿è¯APï¼Œå³å¯ç”¨æ€§ï¼Œä¸€è‡´æ€§ä¸ç”¨ç‰¹åˆ«å¼ºåˆ¶ã€‚</p><p>å¯ä»¥ä½¿ç”¨å¾®æœåŠ¡ç»„ä»¶seataè§£å†³åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><h2 id="seata"><a href="#seata" class="headerlink" title="seata"></a>seata</h2><p>é¦–å…ˆæ•°æ®åº“ä¸­æ¯ä¸ªå¾®æœåŠ¡éœ€è¦åˆ›å»ºundo_logå›æ»šæ—¥å¿—è®°å½•è¡¨ï¼Œè¿™æ˜¯å®˜æ–¹è§„å®šçš„ã€‚ç„¶åå¯åŠ¨seataæœåŠ¡å™¨ã€‚</p><p>åœ¨éœ€è¦çš„ç±»ä¸Šæ·»åŠ <code>@GlobalTransactional</code>å¼€å¯å…¨å±€äº‹åŠ¡ã€‚</p><p>è€Œå¯¹äºéœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡çš„å¾®æœåŠ¡ï¼Œéœ€è¦ç”±seataä»£ç†å…¶æ•°æ®æºã€‚</p><p>åˆ†å¸ƒå¼äº‹åŠ¡ä¸»å…¥å£æ ‡æ˜å…¨å±€äº‹åŠ¡ï¼Œå…¶ä»–çš„è¿œç«¯è°ƒç”¨ä»ä½¿ç”¨æœ¬åœ°äº‹åŠ¡æ³¨è§£å³å¯ã€‚</p><h2 id="æ¶ˆæ¯é˜Ÿåˆ—æœ€ç»ˆä¸€è‡´æ€§"><a href="#æ¶ˆæ¯é˜Ÿåˆ—æœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—æœ€ç»ˆä¸€è‡´æ€§"></a>æ¶ˆæ¯é˜Ÿåˆ—æœ€ç»ˆä¸€è‡´æ€§</h2><p>å®šæ—¶ä»»åŠ¡ï¼Œè®¢å•è¶…æ—¶å…³é—­è®¢å•ï¼Œè€Œä¸‹å•çš„æ—¶å€™ä¼šé”å®šåº“å­˜ï¼Œåº“å­˜è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œè‹¥ä¸€å®šæ—¶é—´åè®¢å•ä¸å­˜åœ¨ï¼Œåˆ™ç›¸åº”çš„åº“å­˜è‡ªè¡Œè§£é”ã€‚ä½†å®šæ—¶ä»»åŠ¡èµ„æºå¼€é”€å¤§ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚</p><p>å»¶è¿Ÿé˜Ÿåˆ—ï¼Œè®¢å•åˆ›å»ºåè¿›è¡Œé”åº“å­˜ï¼Œé”åº“å­˜å­˜å…¥å»¶è¿Ÿé˜Ÿåˆ—ï¼Œè¿‡æœŸåäº¤äºˆè§£é”åº“å­˜æœåŠ¡ï¼Œæ­¤æ—¶è§£åº“å­˜å†å»çœ‹è®¢å•æ˜¯å¦å­˜åœ¨è¿›è€Œåˆ¤æ–­æ˜¯å¦è§£åº“å­˜ã€‚é‡‡ç”¨ä¸»é¢˜æ¨¡å¼ï¼Œæ¶ˆæ¯è¿›æ¥æŒ‰ç…§è·¯ç”±é”®èµ°æ­»ä¿¡ï¼Œè¿‡æœŸåè®¾ç½®è·¯ç”±é”®èµ°è§£åº“å­˜é˜Ÿåˆ—ã€‚</p><p>å»¶è¿Ÿé˜Ÿåˆ—ç›¸æ¯”äºå®šæ—¶ä»»åŠ¡ï¼Œä¼˜ç‚¹åœ¨äºå…¶å¤„ç†ä¸€å®šåœ¨å½“å‰è®¢å•è¿‡æœŸæ—¶é—´ä¹‹åï¼Œå®šæ—¶ä»»åŠ¡åˆ™ä¸ç¨³å®šã€‚</p><h2 id="åº“å­˜è§£é”ï¼ï¼ï¼"><a href="#åº“å­˜è§£é”ï¼ï¼ï¼" class="headerlink" title="åº“å­˜è§£é”ï¼ï¼ï¼"></a>åº“å­˜è§£é”ï¼ï¼ï¼</h2><p>æŸ”æ€§äº‹åŠ¡ï¼Œæœ€ç»ˆä¸€è‡´æ€§ï¼š<a href="https://www.jianshu.com/p/d70df89665b9">https://www.jianshu.com/p/d70df89665b9</a></p><p>mqä½¿ç”¨æ—¶é€‰æ‹©æ‰‹åŠ¨åº”ç­”ackã€‚åªæœ‰æ­»ä¿¡é˜Ÿåˆ—è½¬å‘åçš„è®¢å•è¡¨ä¿¡æ¯ï¼Œå…¶è®¢å•ä¸å­˜åœ¨æˆ–è®¢å•å–æ¶ˆæ”¯ä»˜ï¼Œæ­¤æ—¶å°†ä¼šè§£åº“å­˜ã€‚æ‰‹åŠ¨ackæ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿ä¸šåŠ¡æ‰§è¡Œå®Œæ¯•åœ¨åº”ç­”é˜Ÿåˆ—ã€‚</p><p>ç”±æ­»ä¿¡è½¬å‘åˆ°è§£åº“å­˜çš„æ¶ˆæ¯ï¼Œè‹¥å½“å‰æœºå™¨æœåŠ¡å‡ºç°å¼‚å¸¸æˆ–å®•æœºï¼Œåˆ™å°†æ¶ˆæ¯é‡æ–°æ”¾å…¥é˜Ÿåˆ—ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡çš„æ¶ˆè´¹ã€‚ç›´åˆ°æ¶ˆæ¯å…¨éƒ¨æ¶ˆè´¹ã€‚</p><p>å–æ¶ˆè®¢å•åä¸»åŠ¨å‘æ¶ˆæ¯ç»™è§£åº“å­˜MQã€‚</p><p>ä¸€å¼€å§‹è®¾ç½®è®¢å•æ”¯ä»˜ç­‰å¾…1minï¼Œåº“å­˜è§£é”ç­‰å¾…2minï¼Œè§£åº“å­˜mqæ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œè®¢å•çŠ¶æ€è‚¯å®šä»æ–°å»ºå˜ä¸ºäº†æ”¯ä»˜æˆ–å–æ¶ˆï¼Œè¿™æ˜¯æ­£å¸¸çŠ¶æ€ï¼Œä½†å¦‚æœæˆ‘ä»¬é‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œå¯¼è‡´è®¢å•æ”¯ä»˜åœ¨è§£åº“å­˜åæ‰å“åº”ï¼Œè§£åº“å­˜åˆ¤æ–­çŠ¶æ€æ˜¯æ–°å»ºåˆ™ä¸ä¼šæœ‰åŠ¨ä½œï¼Œæ‰€ä»¥ä¸ºäº†ä¿åº•ï¼Œæˆ‘ä»¬å–æ¶ˆè®¢å•æ—¶è¦å»é€šçŸ¥è§£åº“å­˜mqï¼Œä»¥é˜²ä¸Šè¿°æƒ…å†µå‘ç”Ÿï¼Œå½“ç„¶æ”¯ä»˜æˆåŠŸå°±ä¸ç”¨é€šçŸ¥ã€‚</p><p>æ¶ˆæ¯çš„æ‰‹åŠ¨æ¥æ”¶å’Œä¸šåŠ¡å¤„ç†éƒ½æ˜¯å†™åœ¨try-catchä¸­ï¼Œæ•è·å¼‚å¸¸å°±æ‹’æ”¶æ¶ˆæ¯å¹¶å°†å…¶é‡å…¥é˜Ÿã€‚</p><h2 id="æ¶ˆæ¯ç¡®è®¤ã€é‡å¤"><a href="#æ¶ˆæ¯ç¡®è®¤ã€é‡å¤" class="headerlink" title="æ¶ˆæ¯ç¡®è®¤ã€é‡å¤"></a>æ¶ˆæ¯ç¡®è®¤ã€é‡å¤</h2><p>é˜Ÿåˆ—å’Œäº¤æ¢æœºä¸€å®šæ˜¯å¼€å¯æŒä¹…åŒ–ï¼Œä¿å­˜åˆ°ç£ç›˜ä¸Šã€‚</p><p>ä¿è¯æ‰‹åŠ¨ackï¼Œä¸šåŠ¡æ‰§è¡Œæ— è¯¯å†è¿›è¡Œæ¶ˆæ¯ç¡®è®¤ï¼Œå…³é—­è‡ªåŠ¨ackã€‚</p><p>ç”±äºæœåŠ¡å™¨å®•æœºç­‰å› ç´ ï¼Œä¸šåŠ¡å®Œæˆåæ²¡æœ‰åŠæ—¶åº”ç­”ï¼Œå¯¼è‡´æ¶ˆæ¯é‡å›é˜Ÿåˆ—è¿›è¡Œæ¶ˆè´¹ï¼Œæˆ‘ä»¬å¯ä»¥å†ä¸šåŠ¡ç›¸å…³å¤„ç†ä¸­è®¾ç½®çŠ¶æ€ï¼Œæ¯”æ–¹è¯´ä¸Šè¿°è®¢å•è§£åº“å­˜ï¼Œåªå¤„ç†è¢«å–æ¶ˆçš„è®¢å•å’Œä¸å­˜åœ¨çš„è®¢å•ï¼Œä¸”è§£åº“å­˜æ—¶åªå¤„ç†è¢«é”å®šçš„åº“å­˜ï¼Œå·²è§£é”è¿‡çš„å½“ç„¶ä¸ç”¨äºŒæ¬¡å¤„ç†äº†ã€‚ä¿è¯ä¸šåŠ¡çš„å¹‚ç­‰æ€§ã€‚</p><h2 id="æ”¯ä»˜å®æ²™ç®±æ¨¡æ‹Ÿæ”¯ä»˜"><a href="#æ”¯ä»˜å®æ²™ç®±æ¨¡æ‹Ÿæ”¯ä»˜" class="headerlink" title="æ”¯ä»˜å®æ²™ç®±æ¨¡æ‹Ÿæ”¯ä»˜"></a>æ”¯ä»˜å®æ²™ç®±æ¨¡æ‹Ÿæ”¯ä»˜</h2><p>è°ƒç”¨å®˜æ–¹sdkï¼Œå¼•ç”¨æ–¹æ³•å³å¯æ”¯ä»˜é€‰æ‹©æ”¯ä»˜å®ï¼ŒæˆåŠŸåè·³è½¬å›æˆ‘ä»¬çš„ç»“ç®—é¡µé¢ã€‚è¿˜å¯ä»¥é…ç½®æ”¯ä»˜å®æä¾›çš„è‡ªåŠ¨æ”¶å•ï¼Œå› ä¸ºè®¢å•ä¼šåœ¨è§„å®šæ—¶é—´å†…å¤±æ•ˆï¼Œå¦‚æœç­‰åˆ°è®¢å•å¤±æ•ˆåå†æ”¯ä»˜ï¼Œæˆ‘ä»¬åº“å­˜éƒ½å›æ»šäº†ï¼Œä½†æ”¯ä»˜æˆåŠŸè®¢å•ä»å˜ä¸ºäº†å·²ä»˜æ¬¾ï¼Œè¿™æ ·è‚¯å®šæ˜¯é€»è¾‘é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬é…ç½®è‡ªåŠ¨æ”¶å•ï¼Œä¿è¯ä»˜æ¬¾çª—å£çš„æœ‰æ•ˆæœŸä¸è¶…è¿‡è®¢å•è¿‡æœŸåŒºé—´ã€‚ä¿è¯è®¢å•è¿‡æœŸåä¸èƒ½ä»˜æ¬¾ã€‚</p><h1 id="ç§’æ€"><a href="#ç§’æ€" class="headerlink" title="ç§’æ€"></a>ç§’æ€</h1><ul><li><p>å®šæ—¶ä»»åŠ¡ï¼Œåº“å­˜é¢„çƒ­</p><p>ç§’æ€å•†å“ä¸Šæ¶ä½¿ç”¨å®šæ—¶ä»»åŠ¡ï¼Œæ‰§è¡Œå¼‚æ­¥ç¼–æ’ã€‚é‡‡ç”¨cronè¡¨è¾¾å¼ + æ³¨è§£å®Œæˆå®šæ—¶ä»»åŠ¡ã€‚</p><p><code>@EnableScheduling</code>ï¼šå®šæ—¶è°ƒåº¦ï¼Œ<code>@EnableAsync</code>ï¼šå¼‚æ­¥ä»»åŠ¡</p><p>æˆ–è€…ç›´æ¥æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ã€‚</p><p>å®šæ—¶ä¸Šæ¶ï¼Œé€‰æ‹©æµé‡è¾ƒå°çš„æ·±å¤œé”™å³°ä¸Šæ¶ã€‚æå‰3å¤©æ‰«æç§’æ€æ´»åŠ¨åœºæ¬¡ï¼Œæå‰å°†æ•°æ®ç¼“å­˜åˆ°redis</p></li><li><p>æ—¶é—´å¤„ç†</p><p>ä½¿ç”¨java8æ–°å¢çš„æ—¶é—´å¤„ç†ç±»ï¼ŒLocalTimeï¼ŒLocalDateï¼Œè·å–å½“å¤©å‡†ç¡®æ—¥æœŸã€æ—¶é—´ï¼Œå®Œæˆç§’æ€è·å–3å¤©å•†å“çš„æ—¶é—´éœ€æ±‚ã€‚</p></li><li><p>ç§’æ€åŠ å¯†</p><p>æºå¸¦éšæœºç ï¼Œè·å–ç§’æ€å•†å“æ•°æ®æ—¶ï¼Œä¼šè¿›è¡Œæ—¶é—´æ ¡éªŒï¼Œåªæœ‰åˆ°æ—¶äº†æ‰ä¼šç»™å½“å‰å•†å“æ·»åŠ éšæœºç ï¼Œä¹Ÿå°±æ˜¯ç§’æ€ç”Ÿæ•ˆï¼Œå…¶ä½™æ—¶é—´è¿˜æ˜¯æ­£å¸¸ä»·ã€‚</p></li><li><p>åŠ¨é™åˆ†ç¦»</p><p>åªè®©åç«¯æ‰¿å—åŠ¨æ€è¯·æ±‚ï¼Œé™ä½é™æ€è¯·æ±‚å¸¦æ¥çš„å‹åŠ›ã€‚</p></li><li><p><strong>ä¿¡å·é‡é™æµ</strong></p><p>ä¿¡å·é‡å³redisåº“å­˜ï¼Œé è¿™ä¸ªä¿è¯åº“å­˜</p><p>è®¾ç½®Redissonä¿¡å·é‡</p><p><a href="https://blog.csdn.net/weixin_43931625/article/details/103232670">https://blog.csdn.net/weixin_43931625/article/details/103232670</a></p></li><li><p>æµé‡é”™å³°</p><p>éªŒè¯ç è¿‡æ»¤ï¼Œä¸æ˜¯å³ç‚¹å³ç”¨ã€‚åŠ å…¥è´­ç‰©è½¦</p></li><li><p>é™æµã€ç†”æ–­ã€é™çº§ sentinel</p><p>é¡µé¢é™çº§ï¼Œç‚¹å‡»é¢‘ç‡è¿‡é«˜å°±æŒ‚æ‰</p></li><li><p>é˜Ÿåˆ—æ¶ˆå³°</p><p>ä¿¡å·é‡å†redisï¼Œæ‰£å‡æ˜¯åŸå­æ€§æ“ä½œ</p></li></ul><h2 id="åº“å­˜"><a href="#åº“å­˜" class="headerlink" title="åº“å­˜"></a>åº“å­˜</h2><p>åº“å­˜åœ¨ä¸Šæ¶å‰æå‰æ‰£å‡äº†ï¼Œæ´»åŠ¨ç»“æŸåå†æ ¹æ®å¤±æ•ˆè®¢å•è¿›è¡Œè§£é”ï¼Œä¸Šæ¶åº“å­˜å°±ä»¥ä¿¡å·é‡ä¿å­˜åˆ°redisä¸­ï¼Œé€šè¿‡redissonåˆ†å¸ƒå¼é”å®ŒæˆåŸå­æ€§æ‰£å‡ï¼Œä¿è¯ä¸ä¼šè¶…å–ï¼Œä¿¡å·é‡ç”¨å®Œå³æ­¢ã€‚</p><h2 id="ç§’æ€è®¾è®¡"><a href="#ç§’æ€è®¾è®¡" class="headerlink" title="ç§’æ€è®¾è®¡"></a>ç§’æ€è®¾è®¡</h2><p>è®¾ç½®ç§’æ€é™åˆ¶æ•°ï¼Œé™åˆ¶å•†å“çš„æŠ¢è´­ä»¶æ•°ã€‚</p><p>ä¸Šæ¶æ—¶ä¼šè®¾ç½®å•†å“éšæœºç ï¼Œåœ¨ä¸»é¡µ<strong>è¿›å…¥å•†å“é¡µ</strong>æ—¶ï¼Œä¼šå…ˆåˆ¤æ–­å½“å‰å•†å“æ˜¯å¦ç§’æ€ï¼Œå¦‚æœç§’æ€ï¼Œåœ¨åˆ¤æ–­å½“å‰æ˜¯å¦å¤„äºç§’æ€æ—¶é—´æ®µï¼ˆå°è£…äº†èµ·å§‹æ—¶é—´ï¼‰ï¼Œ<strong>ä¸å­˜åœ¨æ—¶é—´æ®µå°±å°†éšæœºç è‡³null</strong>ï¼Œç„¶åä¼ åˆ°å‰ç«¯ï¼Œå•†å“çš„å°è£…åŒ…æ‹¬äº†ç§’æ€ä¿¡æ¯ã€‚åœ¨<strong>ç§’æ€å•†å“é¡µé¢è¿›è¡Œç§’æ€clickæ—¶</strong>ï¼Œä¼šä¼ å…¥å½“å‰å•†å“çš„ç§’æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç§’æ€å•†å“idã€ç§’æ€å•†å“çš„éšæœºç ã€ç§’æ€æ•°é‡ï¼Œç„¶åè¿›è¡Œè¯·æ±‚ï¼Œç§’æ€æ—¶è¿›è¡Œæ ¡éªŒï¼Œé€šè¿‡ç§’æ€idè·å–ç¼“å­˜ä¸­çš„å¯¹åº”å•†å“ï¼Œæ ¡éªŒé¡µé¢éšæœºç å’Œç¼“å­˜æ˜¯å¦ç›¸ç­‰ï¼Œè‹¥å½“å‰å•†å“ä¸æ˜¯åœ¨ç§’æ€æ—¶é—´å†…è¿›å…¥åˆ™éšæœºç ä¸ºnullï¼Œæ— æ³•é€šè¿‡æ ¡éªŒã€‚</p><h2 id="ç†”æ–­é™çº§"><a href="#ç†”æ–­é™çº§" class="headerlink" title="ç†”æ–­é™çº§"></a>ç†”æ–­é™çº§</h2><p>ç†”æ–­ï¼šå¤šæœåŠ¡ç›¸äº’è°ƒç”¨ï¼ŒæŸä¸ªæœåŠ¡çš„è°ƒç”¨å¤±è´¥æ¯”ä¾‹è¶…è¿‡è®¾å®šå€¼ï¼Œæˆ–è°ƒç”¨å¤±è´¥é¢‘ç‡è¶…è¿‡è®¾å®šå€¼ã€‚åˆ™å°†å¼‚å¸¸æœåŠ¡åœæ­¢ï¼Œä½†åç»­ä¼šæ ¹æ®ç­–ç•¥å¯¹è¯¥æœåŠ¡æµ‹è¯•ï¼Œè‹¥è¯¥æœåŠ¡è°ƒç”¨æ¯”ä¾‹æ¢å¤åˆ°æ­£å¸¸å€¼ï¼Œåˆ™é‡æ–°å¯ç”¨æœåŠ¡ã€‚</p><p>é™çº§ï¼šå¯¹æŸä¸ªæ–¹æ³•ã€æ¥å£é‡‡ç”¨å…œåº•æ–¹æ³•ï¼Œå³æŸä¸ªæ–¹æ³•ã€æ¥å£è¯·æ±‚é¢‘ç‡è¾¾åˆ°ä¸€å®šæ¬¡æ•°å°±è¿”å›å…œåº•æ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œé˜²æ­¢å¤§é‡è¯·æ±‚è¿›è¡Œè®¿é—®ã€‚</p><h1 id="é¢è¯•mark"><a href="#é¢è¯•mark" class="headerlink" title="é¢è¯•mark"></a>é¢è¯•mark</h1><ul><li><p>å¦‚ä½•ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“çš„åŒå†™ä¸€è‡´æ€§ï¼Ÿ</p><p>åŒå†™ï¼ˆmysqlä¿®æ”¹åä¿®æ”¹redisï¼‰</p><p>å¤±æ•ˆï¼ˆmysqlä¿®æ”¹ååˆ é™¤redisç¼“å­˜ï¼‰</p><p><strong>å¯¹äºè´­ç‰©è½¦ç¼“å­˜æƒ…å†µå¦‚ä½•å¤„ç†</strong></p></li><li><p>Javaè®¾è®¡ç¼“å­˜ï¼ˆMapæœ¬åœ°ç¼“å­˜ï¼‰</p><p>å’Œå•ä¾‹æ¨¡å¼çš„åŒé‡é”å®šç±»ä¼¼ã€‚</p><p>å¯¹äºåˆ†å¸ƒå¼å¾®æœåŠ¡ï¼Œä¸èƒ½ä½¿ç”¨ï¼Œå› ä¸ºæœ¬åœ°ç¼“å­˜æ—¶ç›¸äº’éš”ç¦»çš„ï¼ŒæœåŠ¡æ¯æ¬¡è´Ÿè½½å‡è¡¡åˆ°å…¶ä»–æœåŠ¡å™¨è¿˜è¦é‡æ–°åŠ è½½ç¼“å­˜ã€‚ä¸”å¤šä¸ªæœåŠ¡å™¨é—´è¿˜æœ‰æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ã€‚</p><p><a href="https://blog.csdn.net/u010452388/article/details/82725299">https://blog.csdn.net/u010452388/article/details/82725299</a></p></li><li><p>ç‚¹èµåŠŸèƒ½è®¾è®¡</p><p><a href="https://www.cnblogs.com/liuyupen/p/14015407.html">https://www.cnblogs.com/liuyupen/p/14015407.html</a></p><p><a href="https://www.zhangshengrong.com/p/281oD6Yawz/">https://www.zhangshengrong.com/p/281oD6Yawz/</a></p></li><li><p>è´¦å·é‡å¤ç™»å½•é—®é¢˜</p><p>å»ºç«‹åœ¨çº¿æ´»è·ƒç”¨æˆ·è¡¨</p><p><a href="https://blog.csdn.net/weixin_38295272/article/details/117964982">https://blog.csdn.net/weixin_38295272/article/details/117964982</a></p><p>ç™»å½•å­˜å‚¨å®¢æˆ·ç«¯ipï¼Œè‹¥å¤šæ¬¡ç™»å½•ipä¸åŒï¼Œè¯´æ˜æ˜¯ä¸åŒipç™»å½•ï¼Œæé†’ä¸Šæ¬¡ç™»å½•ç”¨æˆ·ã€‚å¯ä»¥kvå­˜redisï¼Œkæ˜¯ç”¨æˆ·idï¼Œvæ˜¯å®¢æˆ·ç«¯ipã€‚è¿˜è¦è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœæ­£å¸¸ä¸‹çº¿ï¼Œä¼šå‘è¯·æ±‚åˆ é™¤ï¼Œéæ­£å¸¸ä¸‹çº¿è‡ªåŠ¨è¿‡æœŸã€‚ä¸€ç›´åœ¨çº¿ä¼šè‡ªåŠ¨ç»­æœŸã€‚ä¹Ÿå°±æ˜¯æ´»è·ƒæ“ä½œç»­æœŸã€‚</p><p>æ–‡ç« ä¸­ç”¨tokenï¼Œè¿™ä¸ªå¯èƒ½ä¼šå—æµè§ˆå™¨å½±å“ï¼Œæˆ‘ä»¬å¯ä½¿ç”¨ç”¨æˆ·çš„ipã€‚</p></li><li><p>å¹‚ç­‰æ€§</p></li><li><p>rabbitmqæ€ä¹ˆä¿è¯æ¶ˆæ¯å¯é ï¼šå¼€å¯é˜Ÿåˆ—ã€äº¤æ¢æœºçš„æŒä¹…åŒ–ï¼Œå¼€å¯æ‰‹åŠ¨ackæ¨¡å¼ã€‚</p><p>å‘ç”Ÿæ—¶æ¶ˆæ¯ä¸¢å¤±ã€å‘é€åæ¶ˆæ¯ä¸¢å¤±ï¼šä¿è¯åŒç«¯ç¡®è®¤ï¼Œæ¶ˆè´¹è€…æ‰‹åŠ¨ackï¼Œå‡ºç°å¼‚å¸¸æ‹’æ”¶æ¶ˆæ¯å°†æ¶ˆæ¯é‡å…¥é˜Ÿã€‚</p><p>æ¶ˆæ¯é‡å¤ï¼šä¸šåŠ¡é€»è¾‘é¿å…ï¼Œå¦‚æˆ‘ä»¬è§£åº“å­˜ä¸šåŠ¡ï¼Œæ¶ˆæ¯æ¥äº†ï¼Œè¦è§£åº“å­˜ï¼Œä¼šåˆ¤æ–­å•†å“åº“å­˜ï¼Œåªå¤„ç†é”å®šçŠ¶æ€çš„å•†å“ã€‚</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;è™šæ‹Ÿæœºç¯å¢ƒé…ç½®&quot;&gt;&lt;a href=&quot;#è™šæ‹Ÿæœºç¯å¢ƒé…ç½®&quot; class=&quot;headerlink&quot; title=&quot;è™šæ‹Ÿæœºç¯å¢ƒé…ç½®&quot;&gt;&lt;/a&gt;è™šæ‹Ÿæœºç¯å¢ƒé…ç½®&lt;/h1&gt;&lt;p&gt;è¿™æ¬¡ä½¿ç”¨Virtual Box + Vagrantå®Œæˆè™šæ‹Ÿæœºå®‰è£…ï¼Œæ¯”ä¼ ç»ŸVMwareé…ç½®é•œåƒæ›´æ–¹ä¾¿ï¼Œ</summary>
      
    
    
    
    <category term="åç«¯" scheme="http://aidianfirst.com/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼å…«è‚¡</title>
    <link href="http://aidianfirst.com/2021/10/07/%E5%85%AB%E8%82%A1/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%85%AB%E8%82%A1/"/>
    <id>http://aidianfirst.com/2021/10/07/%E5%85%AB%E8%82%A1/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%85%AB%E8%82%A1/</id>
    <published>2021-10-07T11:04:07.000Z</published>
    <updated>2023-07-30T11:20:17.732Z</updated>
    
    <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼ä¸ƒå¤§åŸåˆ™"><a href="#è®¾è®¡æ¨¡å¼ä¸ƒå¤§åŸåˆ™" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¸ƒå¤§åŸåˆ™"></a>è®¾è®¡æ¨¡å¼ä¸ƒå¤§åŸåˆ™</h1><ul><li><strong>å•ä¸€èŒè´£åŸåˆ™ï¼š</strong>ä¸€ä¸ªç±»åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½ï¼Œé™ä½è€¦åˆæ€§ï¼Œæ–¹ä¾¿è¿­ä»£ç»´æŠ¤ã€‚</li><li><strong>å¼€æ”¾å°é—­åŸåˆ™ï¼š</strong>ç±»ã€æ–¹æ³•å¯ä»¥è¿›è¡ŒåŠŸèƒ½æ‰©å±•ï¼Œä½†ä¸èƒ½ä¿®æ”¹ã€‚å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­ã€‚</li><li><strong>ä¾èµ–å€’ç½®åŸåˆ™ï¼š</strong>é«˜çº§æ¨¡å—ä¸èƒ½ä¾èµ–ä½çº§æ¨¡å—ï¼Œéƒ½åº”è¯¥ä¾èµ–äºæ¥å£ã€‚å…ˆå°†ç±»è¿›è¡ŒæŠ½è±¡ï¼Œå…ˆè®¾è®¡åŠŸèƒ½æ¥å£ï¼Œå†å¯¹æ¥å£è¿›è¡ŒåŠŸèƒ½ç»†èŠ‚çš„å®ç°ã€‚</li><li><strong>æ¥å£éš”ç¦»åŸåˆ™ï¼š</strong>ä¸åŒæ¥å£å®šä¹‰ä¸åŒçš„åŠŸèƒ½ã€‚</li><li><strong>é‡Œæ°ä»£æ¢åŸåˆ™ï¼š</strong>å­ç±»å¯æ›¿æ¢å…¶çˆ¶ç±»ã€‚</li><li><strong>è¿ªç±³ç‰¹åŸåˆ™ï¼š</strong>æ¯ä¸ªæ¨¡å—é—´è¦å°½å¯èƒ½å°‘çš„ç›¸äº’è°ƒç”¨ï¼Œå‡å°‘ä¾èµ–ï¼Œé™ä½è€¦åˆæ€§ã€‚</li></ul><p>è®¾è®¡æ¨¡å¼è®²è§£é“¾æ¥ï¼š</p><p><a href="http://www.cyc2018.xyz/%E5%85%B6%E5%AE%83/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%20-%20%E7%9B%AE%E5%BD%95.html#%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80">http://www.cyc2018.xyz/%E5%85%B6%E5%AE%83/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%20-%20%E7%9B%AE%E5%BD%95.html#%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80</a></p><h1 id="å•ä¾‹æ¨¡å¼å®ç°"><a href="#å•ä¾‹æ¨¡å¼å®ç°" class="headerlink" title="å•ä¾‹æ¨¡å¼å®ç°"></a>å•ä¾‹æ¨¡å¼å®ç°</h1><h2 id="æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰"><a href="#æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰" class="headerlink" title="æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰"></a>æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lazy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Lazy lazyInstance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Lazy</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Lazy <span class="title">getLazyInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(lazyInstance == <span class="keyword">null</span>)&#123;</span><br><span class="line">            lazyInstance = <span class="keyword">new</span> Lazy();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lazyInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‡’æ±‰å¼æ˜¯æŒ‡å…ˆä¸åˆ›å»ºå®ä¾‹ï¼Œå½“é¦–æ¬¡è°ƒç”¨åå†åˆ›å»ºã€‚</p><p>ç§æœ‰åŒ–æ„é€ æ–¹æ³•ï¼Œä¸èƒ½ä½¿ç”¨ new è¿›è¡Œå®ä¾‹åŒ–ï¼Œä½¿ç”¨æ–¹æ³•åˆ¤æ–­å½“å‰å®ä¾‹æ˜¯å¦å·²å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œä¿è¯å®ä¾‹çš„å•ä¸€æ€§ã€‚</p><p><strong>çº¿ç¨‹ä¸å®‰å…¨ï¼Œ</strong>åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œå¯èƒ½é¦–æ¬¡ä¼šæœ‰å¤šä¸ªçº¿ç¨‹ä¸€èµ·è°ƒç”¨ getLazyInstanceæ–¹æ³• ï¼Œé‚£ä¹ˆæ­¤æ—¶å®ä¾‹ä¸ºç©ºï¼Œä¼šåŒæ—¶åˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚</p><h2 id="é¥¿æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰"><a href="#é¥¿æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰" class="headerlink" title="é¥¿æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰"></a>é¥¿æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hungry</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Hungry hungryInstance = <span class="keyword">new</span> Hungry();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Hungry</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Hungry <span class="title">getHungryInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hungryInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¥¿æ±‰å¼æŒ‡æ— è®ºæ˜¯å¦è¦ä½¿ç”¨å®ä¾‹ï¼Œå…ˆè¿›è¡Œä¸€æ¬¡å®ä¾‹åŒ–ï¼Œéšåéœ€è¦å®ä¾‹æ—¶ç›´æ¥è°ƒç”¨æ–¹æ³•è¿”å›å³å¯ï¼›</p><p><strong>çº¿ç¨‹å®‰å…¨ï¼Œ</strong>å› ä¸ºåˆå§‹åŒ–ç±»æ—¶å·²ç»è¿›è¡Œäº†å®ä¾‹åŒ–ã€‚ä½†è‹¥é•¿æ—¶é—´ä¸ä½¿ç”¨è¯¥å®ä¾‹ä¼šé€ æˆèµ„æºæµªè´¹ã€‚</p><h2 id="æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰"><a href="#æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰" class="headerlink" title="æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰"></a>æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyConcurrent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazyConcurrent lazyInstance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LazyConcurrent</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> LazyConcurrent <span class="title">getLazyInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(lazyInstance == <span class="keyword">null</span>)&#123;</span><br><span class="line">            lazyInstance = <span class="keyword">new</span> LazyConcurrent();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lazyInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å®ä¾‹åŒ–æ‰§è¡Œæ–¹æ³•ä¸ŠåŠ é”ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p><p><strong>çº¿ç¨‹å®‰å…¨ï¼Œ</strong>ä½†æ•ˆç‡ä½ï¼Œå¤šçº¿ç¨‹äº‰å¤ºé”ä¼šé€ æˆçº¿ç¨‹é˜»å¡ã€‚</p><h2 id="åŒé‡æ£€æŸ¥é”å®ç°ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰"><a href="#åŒé‡æ£€æŸ¥é”å®ç°ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰" class="headerlink" title="åŒé‡æ£€æŸ¥é”å®ç°ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰"></a>åŒé‡æ£€æŸ¥é”å®ç°ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DoubleCheck</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> DoubleCheck doubleCheckInstance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">DoubleCheck</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DoubleCheck <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(doubleCheckInstance == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (DoubleCheck.class)&#123;</span><br><span class="line">                <span class="keyword">if</span>(doubleCheckInstance == <span class="keyword">null</span>)&#123;</span><br><span class="line">                    doubleCheckInstance = <span class="keyword">new</span> DoubleCheck();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> doubleCheckInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒé‡æ£€æŸ¥é”ç›¸å½“äºæ˜¯çº¿ç¨‹å®‰å…¨æ‡’æ±‰å¼çš„ä¼˜åŒ–ç‰ˆã€‚</p><p><strong>é¦–å…ˆæˆ‘ä»¬ä¸æ˜¯åœ¨æ‰§è¡Œæ–¹æ³•ä¸ŠåŠ é”ï¼Œè€Œæ˜¯åœ¨æ–¹æ³•å†…éƒ¨åŠ é”ã€‚</strong>å…ˆè¿›è¡Œä¸€æ¬¡å®ä¾‹åˆ¤æ–­ï¼Œå¦‚æœä¸ºç©ºåˆ™è·å¾—é”ç„¶åå†è¿›è¡Œä¸€æ¬¡åˆ¤æ–­ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡åˆ¤æ–­å¯èƒ½æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶é€šè¿‡ï¼Œè€Œè·å–é”åéœ€è¦ç¬¬äºŒæ¬¡åˆ¤æ–­å†å®ä¾‹å¯¹è±¡ï¼Œä»¥é˜²åŒæ—¶é€šè¿‡ç¬¬ä¸€æ¬¡åˆ¤æ–­çº¿ç¨‹è¿›è¡Œå¤šæ¬¡å®ä¾‹åŒ–ã€‚</p><p><strong>å®ä¾‹å˜é‡ä½¿ç”¨volatileä¿®é¥°ã€‚</strong>æˆ‘ä»¬æ­£å¸¸ä»£ç å®ä¾‹åŒ–æ‰§è¡Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">doubleCheckInstance &#x3D; new DoubleCheck();</span><br><span class="line">1ã€ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´</span><br><span class="line">2ã€åˆå§‹åŒ–å¯¹è±¡</span><br><span class="line">3ã€å°†å¯¹è±¡æŒ‡å‘åˆ†é…å¥½çš„å†…å­˜ç©ºé—´</span><br></pre></td></tr></table></figure><p>ç”±äºJVMçš„æŒ‡ä»¤é‡æ’æœºåˆ¶ï¼ŒæŒ‡ä»¤æ‰§è¡Œé¡ºåºå¯èƒ½ä¼šç”±åŸæ¥çš„123å˜ä¸º132ã€‚è€Œåœ¨å¤šçº¿ç¨‹çš„å½±å“ä¸‹ï¼Œä¼šå¯¼è‡´çº¿ç¨‹å¾—åˆ°ä¸€ä¸ªå°šæœªåˆå§‹åŒ–çš„å®ä¾‹ã€‚ä¸ºäº†è§£å†³è¯¥é—®é¢˜å¯ä»¥åœ¨å£°æ˜å®ä¾‹å˜é‡æ—¶åŠ ä¸Š volatileï¼Œç¦æ­¢JVMè¿›è¡ŒæŒ‡ä»¤é‡æ’ï¼Œä¿è¯å¤šçº¿ç¨‹çš„å®‰å…¨ã€‚</p><h2 id="é™æ€å†…éƒ¨ç±»å®ç°ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰"><a href="#é™æ€å†…éƒ¨ç±»å®ç°ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰" class="headerlink" title="é™æ€å†…éƒ¨ç±»å®ç°ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰"></a>é™æ€å†…éƒ¨ç±»å®ç°ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Single</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Single</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleInner</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Single instance = <span class="keyword">new</span> Single();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Single <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingleInner.instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“å¤–éƒ¨ç±»SingleåŠ è½½æ—¶ï¼Œå…¶é™æ€å†…éƒ¨ç±»SingleInnerå¹¶æœªåŠ è½½ï¼Œå½“è°ƒç”¨å®ä¾‹è·å–æ–¹æ³•èµ°åˆ°è¿”å›å€¼æ—¶ï¼Œæ‰ä¼šå»åŠ è½½é™æ€å†…éƒ¨ç±»ï¼Œå¹¶è¿›è¡Œå®ä¾‹åŒ–ã€‚</p><p>ä½¿ç”¨é™æ€å†…éƒ¨ç±»å¯ä»¥å»¶è¿Ÿå®ä¾‹åŒ–ï¼ŒèŠ‚çœèµ„æºï¼Œå¹¶ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p><h2 id="æšä¸¾å®ç°ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰"><a href="#æšä¸¾å®ç°ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰" class="headerlink" title="æšä¸¾å®ç°ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰"></a>æšä¸¾å®ç°ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Unique</span> </span>&#123;</span><br><span class="line">    INTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æšä¸¾é»˜è®¤å³çº¿ç¨‹å®‰å…¨ + å•ä¾‹ï¼Œè¿˜å¯é˜²èŒƒä¸€ç³»åˆ—åå°„ç ´è§£å•ä¾‹çš„æ“ä½œã€‚</p><h1 id="å·¥å‚æ¨¡å¼ï¼ˆç®€å•å·¥å‚ã€å·¥å‚ã€æŠ½è±¡å·¥å‚ï¼‰"><a href="#å·¥å‚æ¨¡å¼ï¼ˆç®€å•å·¥å‚ã€å·¥å‚ã€æŠ½è±¡å·¥å‚ï¼‰" class="headerlink" title="å·¥å‚æ¨¡å¼ï¼ˆç®€å•å·¥å‚ã€å·¥å‚ã€æŠ½è±¡å·¥å‚ï¼‰"></a>å·¥å‚æ¨¡å¼ï¼ˆç®€å•å·¥å‚ã€å·¥å‚ã€æŠ½è±¡å·¥å‚ï¼‰</h1><h2 id="ç®€å•å·¥å‚"><a href="#ç®€å•å·¥å‚" class="headerlink" title="ç®€å•å·¥å‚"></a>ç®€å•å·¥å‚</h2><p>ä¸€ä¸ªäº§å“æ¥å£ï¼Œæœ‰å¤šç§å…·ä½“å®ç°ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå·¥å‚ç±»ï¼Œå£°æ˜ä¸€ä¸ªå®ä¾‹è·å–çš„æ–¹æ³•ï¼Œæ ¹æ®å‚æ•°å’Œif - elseåˆ¤æ–­ç”Ÿæˆå“ªä¸€ä¸ªå…·ä½“çš„äº§å“å®ä¾‹ã€‚ç„¶åå¯ä»¥ä½¿ç”¨è¯¥å®ä¾‹ã€‚</p><p>å·¥å‚ç±»ä½¿ç”¨if - elseåˆ¤æ–­ï¼Œæ‰©å±•æ€§å·®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/1.jpg" alt="1.jpg"></p><h2 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h2><p>å°†å·¥å‚æŠ½è±¡åŒ–ï¼Œé€šè¿‡å·¥å‚çš„å…·ä½“å­ç±»åˆ›å»ºå…·ä½“äº§å“å®ä¾‹ï¼Œå·¥å‚æŠ½è±¡ç±»ä¸­å°†å®ä¾‹äº§å“çš„æ–¹æ³•æŠ½è±¡åŒ–ï¼Œäº¤ç”±å…·ä½“å­ç±»å®ç°ï¼Œè€Œå…¶ä»–çš„åŠŸèƒ½æ–¹æ³•åˆ™å¯ä»¥ç›´æ¥å†™ã€‚</p><p>è¿™æ ·æˆ‘ä»¬æœ‰æ–°äº§å“åŠ å…¥æ—¶ï¼Œåªéœ€è¦åˆ›å»ºå¯¹åº”çš„å­å·¥å‚ç»§æ‰¿æŠ½è±¡å·¥å‚ï¼Œç„¶åä½¿ç”¨å­å·¥å‚è¿›è¡Œæ“ä½œå³å¯ï¼Œä¸ç”¨ä¿®æ”¹å…¶ä»–ç±»ã€‚</p><p>ä½†å¦‚æœæˆ‘ä»¬äº§å“ç§ç±»å¾ˆå¤šæ—¶ï¼Œä¸å¯èƒ½ä¸ºæ¯ä¸€ä¸ªäº§å“éƒ½åˆ›å»ºä¸€ä¸ªå­å·¥å‚ï¼Œè¿™ä¼šå¤§å¤§å¢åŠ ä»£ç çš„å¤æ‚åº¦ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/2.jpg" alt="2.jpg"></p><h2 id="æŠ½è±¡å·¥å‚"><a href="#æŠ½è±¡å·¥å‚" class="headerlink" title="æŠ½è±¡å·¥å‚"></a>æŠ½è±¡å·¥å‚</h2><p>ä¸ºäº†ç¼©å‡å·¥å‚å­ç±»çš„æ•°é‡ï¼Œæˆ‘ä»¬ä¸å¿…ä¸ºæ¯ä¸€ä¸ªäº§å“åˆ†é…ä¸€ä¸ªå·¥å‚ç±»ï¼Œå¯å°†äº§å“åˆ†ç»„ï¼Œæ¯”å¦‚æœ‰äº§å“é”®ç›˜å’Œé¼ æ ‡ï¼Œç„¶åæˆ‘ä»¬å°†å·¥å‚åˆ†ç±»ï¼Œå·¥å‚æ¥å£å£°æ˜å¯åˆ›å»ºå¾ˆå¤šäº§å“ï¼ˆé”®ç›˜ã€é¼ æ ‡ç­‰ï¼‰ï¼Œç„¶ååˆ›å»ºå…·ä½“å“ç‰Œå·¥å‚å®ç°æ¥å£ï¼Œå£°æ˜å„å“ç‰Œçš„é”®ç›˜é¼ æ ‡ã€‚æ¯”å¦‚æˆ´å°”å·¥å‚æœ‰æˆ´å°”çš„é”®ç›˜å’Œé¼ æ ‡ï¼Œè”æƒ³å·¥å‚æœ‰è”æƒ³çš„é”®ç›˜å’Œé¼ æ ‡ã€‚æ­¤æ—¶éœ€è¦å“ªä¸ªå“ç‰Œçš„å“ªç§äº§å“ç›´æ¥å»å¯¹åº”å“ç‰Œå·¥å‚è·å–å³å¯ã€‚</p><p>ä½†æ˜¯æŠ½è±¡å·¥å‚æ¯æ¬¡æ–°å¢ä¸€ä¸ªäº§å“éœ€è¦è¿›è¡Œå¾ˆå¤šæ‰©å±•ï¼Œå¯¹äº§å“å’Œå·¥å‚éƒ½è¦æ–°å¢ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/3.jpg" alt="3.jpg"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li>ç®€å•å·¥å‚ï¼šå•ä¸€å·¥å‚ç±»ï¼Œå•ä¸€äº§å“æ¥å£ï¼Œåˆ›å»ºå·¥å‚æ ¹æ®æ–¹æ³•çš„å…¥å‚åˆ¤æ–­éœ€è¦åˆ›å»ºçš„å…·ä½“äº§å“å®ä¾‹ã€‚</li><li>å·¥å‚ï¼šå¤šä¸ªå·¥å‚ç±»ï¼Œå•ä¸€äº§å“æ¥å£ï¼Œé€šè¿‡å­å·¥å‚å®ç°å¤šæ€ï¼Œå®Œæˆä¸åŒäº§å“å®ä¾‹çš„åˆ›å»ºï¼Œé¿å…å…¥å‚åˆ¤æ–­ã€‚</li><li>æŠ½è±¡å·¥å‚ï¼šå¤šä¸ªå·¥å‚ç±»ï¼Œå¤šä¸ªäº§å“æŠ½è±¡ç±»ï¼Œäº§å“ä¼šæ ¹æ®å­ç±»åˆ†ç»„ï¼ŒåŒä¸€ä¸ªäº§å“å·¥å‚å®ç°åŒç§ç»„ä»¶ï¼Œå‡å°‘äº†å·¥å‚å­ç±»çš„æ•°é‡ã€‚</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;è®¾è®¡æ¨¡å¼ä¸ƒå¤§åŸåˆ™&quot;&gt;&lt;a href=&quot;#è®¾è®¡æ¨¡å¼ä¸ƒå¤§åŸåˆ™&quot; class=&quot;headerlink&quot; title=&quot;è®¾è®¡æ¨¡å¼ä¸ƒå¤§åŸåˆ™&quot;&gt;&lt;/a&gt;è®¾è®¡æ¨¡å¼ä¸ƒå¤§åŸåˆ™&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å•ä¸€èŒè´£åŸåˆ™ï¼š&lt;/strong&gt;ä¸€ä¸ªç±»åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½ï¼Œé™ä½è€¦åˆæ€§</summary>
      
    
    
    
    <category term="å…«è‚¡" scheme="http://aidianfirst.com/categories/%E5%85%AB%E8%82%A1/"/>
    
    
  </entry>
  
  <entry>
    <title>Spring Cloudç®€å•å­¦ä¹ </title>
    <link href="http://aidianfirst.com/2021/10/06/%E5%90%8E%E7%AB%AF/Spring%20Cloud%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/"/>
    <id>http://aidianfirst.com/2021/10/06/%E5%90%8E%E7%AB%AF/Spring%20Cloud%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/</id>
    <published>2021-10-06T07:58:39.000Z</published>
    <updated>2023-07-30T11:20:17.735Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring-Cloudç®€è¿°"><a href="#Spring-Cloudç®€è¿°" class="headerlink" title="Spring Cloudç®€è¿°"></a>Spring Cloudç®€è¿°</h1><p>Spring Cloudå¾®æœåŠ¡æ˜¯ç”±å¤šåŠŸèƒ½æ¨¡å—ç»„æˆçš„ï¼Œæ¯ä¸ªæ¨¡å—å®ç°è€¦åˆæ€§é™ä½ã€‚</p><p>æ³¨æ„å¾®æœåŠ¡æ˜¯å¤šä¸ªæ¨¡å—è¿›è¡Œç»„åˆï¼Œæˆ‘ä»¬å¯¹ç‰ˆæœ¬çš„æ§åˆ¶å¿…é¡»ä¸¥è°¨ã€‚</p><p>é€šè¿‡urlï¼š</p><p><a href="https://start.spring.io/actuator/info">https://start.spring.io/actuator/info</a> è·å–jsonæ•°æ®ï¼ŒæŸ¥çœ‹ç‰ˆæœ¬å¯¹åº”å…³ç³»ã€‚</p><p>æˆ– <a href="https://spring.io/projects/spring-cloud#learn">https://spring.io/projects/spring-cloud#learn</a> è‡ªè¡ŒæŸ¥çœ‹ç‰ˆæœ¬å¯¹åº”å…³ç³»ã€‚</p><p>Spring Cloudæ¨¡å—åˆ†å¸ƒå¦‚ä¸‹ï¼š</p><ul><li>æ³¨å†Œä¸­å¿ƒï¼šNacosã€Eurekaã€Zookeeperã€Consul</li><li>æœåŠ¡è°ƒç”¨ï¼šLoadBalancerã€Ribbonã€OpenFeignï¼ˆFeignï¼‰</li><li>æœåŠ¡ç†”æ–­ï¼šSentinelã€Resilience4jã€Hystrix</li><li>æœåŠ¡ç½‘å…³ï¼šGatewayã€Zuul</li><li>æœåŠ¡é…ç½®ï¼šNacosã€Config</li><li>æœåŠ¡æ€»çº¿ï¼šNacosã€Bus</li></ul><p><strong>Spring Cloud Alibabaå®˜ç½‘ï¼š</strong><a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md">https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md</a></p><p><strong>Spring Cloud Alibabaç»„ä»¶ç‰ˆæœ¬å…³ç³»ï¼š</strong><a href="https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E">https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E</a></p><h1 id="åŸºç¡€å›é¡¾"><a href="#åŸºç¡€å›é¡¾" class="headerlink" title="åŸºç¡€å›é¡¾"></a>åŸºç¡€å›é¡¾</h1><p>å…ˆå¼€å¯ä¸€ä¸ªå¹²å‡€çš„mavençˆ¶å·¥ç¨‹ï¼Œéšåä¼šå±•å¼€æ¨¡å—ï¼Œpomæ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.tang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>SpringCloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  ç‰ˆæœ¬ç®¡ç† --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">lombok.version</span>&gt;</span>1.18.20<span class="tag">&lt;/<span class="name">lombok.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.1.17<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis.spring.boot.version</span>&gt;</span>2.1.4<span class="tag">&lt;/<span class="name">mybatis.spring.boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>Hoxton.SR9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.spring.boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;lombok.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">fork</span>&gt;</span>true<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">addResources</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addResources</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="æ¨¡å—é…ç½®-ä¾èµ–-yml"><a href="#æ¨¡å—é…ç½®-ä¾èµ–-yml" class="headerlink" title="æ¨¡å—é…ç½® + ä¾èµ– + yml"></a>æ¨¡å—é…ç½® + ä¾èµ– + yml</h2><p>ä½¿ç”¨çˆ¶å­å·¥ç¨‹é…ç½®å„ä¸ªæ¨¡å—ã€‚</p><p>å­æ¨¡å—ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mysql-connector-java--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--jdbc--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>application.ymlé…ç½®å‚æ•°</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"> <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-payment-service</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span>     <span class="comment"># mysqlé©±åŠ¨</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/spring_cloud?useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">111111</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.tang.springcloud.entity</span></span><br></pre></td></tr></table></figure><h2 id="å¾®æœåŠ¡æ”¯ä»˜æœåŠ¡ç«¯-entity-dao-service-controller"><a href="#å¾®æœåŠ¡æ”¯ä»˜æœåŠ¡ç«¯-entity-dao-service-controller" class="headerlink" title="å¾®æœåŠ¡æ”¯ä»˜æœåŠ¡ç«¯ entity-dao-service-controller"></a>å¾®æœåŠ¡æ”¯ä»˜æœåŠ¡ç«¯ entity-dao-service-controller</h2><p>æˆ‘ä»¬æŒ‰ç…§å‰åç«¯åˆ†ç¦»çš„è§„èŒƒï¼Œæ¯æ¬¡æ‰§è¡Œæ“ä½œåï¼Œå‘å‰ç«¯è¿”å›çŠ¶æ€ç ä¿¡æ¯ï¼Œæ‰€ä»¥è¿˜è¦å†™ä¸€ä¸ªçŠ¶æ€ç çš„å°è£…ç±»</p><ul><li><p>CommonResult</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonResult</span> &lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CommonResult</span><span class="params">(Integer code, String message)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(code, message, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>PaymentMapper</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PaymentMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">create</span> <span class="params">(Payment payment)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Payment <span class="title">getPaymentById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>PaymentMapper.xml</p><p>ä¸ºäº†è§„èŒƒä¸€èˆ¬éƒ½ä¼šè‡ªè¡Œå°è£…ä¸€ä¸ªresultmapä½œä¸ºè¿”å›ç±»å‹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.tang.springcloud.dao.PaymentMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- useGeneratedKeys æ·»åŠ è¯­å¥æ‰§è¡Œåè¿”å›è‡ªå¢ä¸»é”®</span></span><br><span class="line"><span class="comment">         keyProperty æ˜¯é…åˆè‡ªå¢ä¸»é”®ä½¿ç”¨çš„ï¼Œå°†å€¼è¿”å›ç»™å®ä½“ç±»çš„å¯¹åº”å±æ€§ï¼Œç„¶ågetè·å– --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;create&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Payment&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">        insert into payment(serial) values(#&#123;serial&#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.tang.springcloud.entity.Payment&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;serial&quot;</span> <span class="attr">property</span>=<span class="string">&quot;serial&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getPaymentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Long&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">        select * from payment where id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>PaymentServiceImpl</p><p>æ¥å£çœç•¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentServiceImpl</span> <span class="keyword">implements</span> <span class="title">PaymentService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentMapper paymentMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">create</span><span class="params">(Payment payment)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> paymentMapper.create(payment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Payment <span class="title">getPaymentById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> paymentMapper.getPaymentById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>PaymentController</p><p>å¯¹åº”urlçš„httpæ–¹æ³•ï¼špostå¢ã€deleteåˆ ã€putæ”¹ã€getæŸ¥</p><p>æ³¨æ„å¯¹è±¡å‚æ•°è¦ä½¿ç”¨@RequestBodyï¼Œæ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/payment/create&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">create</span><span class="params">(<span class="meta">@RequestBody</span> Payment payment)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = paymentService.create(payment);</span><br><span class="line">        log.info(<span class="string">&quot;æ·»åŠ çš„ç»“æœ&quot;</span> + result);</span><br><span class="line">        <span class="keyword">if</span>(result &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">200</span>, <span class="string">&quot;æ’å…¥æˆåŠŸ&quot;</span>, result);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">404</span>, <span class="string">&quot;æ’å…¥å¤±è´¥&quot;</span>, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>&#123;</span><br><span class="line">        Payment payment = paymentService.getPaymentById(id);</span><br><span class="line">        log.info(<span class="string">&quot;æŸ¥è¯¢ç»“æœ&quot;</span> + payment);</span><br><span class="line">        <span class="keyword">if</span>(payment != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">200</span>, <span class="string">&quot;æŸ¥è¯¢æˆåŠŸ&quot;</span>, payment);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">404</span>, <span class="string">&quot;æŸ¥è¯¢å¤±è´¥ï¼Œå¤±è´¥idæ˜¯&quot;</span> + id, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="æµ‹è¯•åŠŸèƒ½"><a href="#æµ‹è¯•åŠŸèƒ½" class="headerlink" title="æµ‹è¯•åŠŸèƒ½"></a>æµ‹è¯•åŠŸèƒ½</h2><p>ç”±äºæµè§ˆå™¨é™åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Postmanæµ‹è¯•postã€getç­‰è¯·æ±‚</p><p>localhost:8001/payment/get/1</p><p>localhost:8001/payment/create?serial=wewewew</p><h2 id="Devtoolså¼€å¯çƒ­éƒ¨ç½²"><a href="#Devtoolså¼€å¯çƒ­éƒ¨ç½²" class="headerlink" title="Devtoolså¼€å¯çƒ­éƒ¨ç½²"></a>Devtoolså¼€å¯çƒ­éƒ¨ç½²</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- çƒ­éƒ¨ç½²ä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- çˆ¶ç±»å·¥ç¨‹å¯ç”¨æ’ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">fork</span>&gt;</span>true<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">addResources</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addResources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>åœ¨settingâ€“Buildâ€“Compilerä¸‹å‹¾é€‰ï¼Œä»¥ä¸‹å››ä¸ªå¼€å¤´çš„æ¡ä»¶ï¼š</p><p>AutoÂ·Â·Â·ã€DisplayÂ·Â·Â·ã€BuildÂ·Â·Â·ã€CompileÂ·Â·Â·ã€‚</p></li><li><p>ç»„åˆé”®ï¼šctrl + alt + shift + å·¦æ–œæ ï¼Œé€‰ä¸­1ã€RegistryÂ·Â·Â·ï¼Œå‹¾é€‰ï¼š</p><p>compiler.automake.allow.when.app.running</p><p>actionSystem.assertFocusAccessFromEdt</p></li></ul><h2 id="å¾®æœåŠ¡å®¢æˆ·ç«¯-entity-controller"><a href="#å¾®æœåŠ¡å®¢æˆ·ç«¯-entity-controller" class="headerlink" title="å¾®æœåŠ¡å®¢æˆ·ç«¯ entity-controller"></a>å¾®æœåŠ¡å®¢æˆ·ç«¯ entity-controller</h2><p>å®¢æˆ·è‚¯å®šæ˜¯ä¸èƒ½æ“ä½œä¸šåŠ¡çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è‚¯å®šæ²¡æœ‰serviceè¿›è¡Œè°ƒç”¨ï¼Œ<strong>ä½¿ç”¨RestTemplate</strong>ã€‚</p><p>RestTemplateæ˜¯HTTPè¯·æ±‚å·¥å…·ï¼Œæä¾›äº†å¸¸è§çš„è¯·æ±‚æ–¹æ¡ˆæ¨¡æ¿ã€‚</p><p>è¿™é‡Œå®¢æˆ·ç«¯ä½¿ç”¨httpé»˜è®¤ç«¯å£80ï¼Œä¸ç”¨ä¸»åŠ¨æŒ‡æ˜ç«¯å£å·ï¼Œå› ä¸ºå®¢æˆ·æ˜¯ä¸ç”¨å…³å¿ƒç«¯å£çš„ï¼Œåªç”¨è¾“å…¥å¯¹åº”çš„urlå³å¯ã€‚</p><ul><li><p>entityå®ä½“ç±»å’ŒæœåŠ¡ç«¯ä¸€è‡´</p></li><li><p>AppliCationContextConfigé…ç½®RestTemplate</p><p>å°†ç»„ä»¶è¿›è¡Œæ‰‹åŠ¨æ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationContextConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>OrderController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PAYMENT_URL = <span class="string">&quot;http://localhost:8001&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/create&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">create</span><span class="params">(Payment payment)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.postForObject(PAYMENT_URL + <span class="string">&quot;/payment/create&quot;</span>, payment, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">getPayemntById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>å®¢æˆ·ç«¯ï¼š<a href="http://localhost/consumer/payment/get/1">http://localhost/consumer/payment/get/1</a></p><p>æ— éœ€ç«¯å£å·ï¼Œå¯¹æœåŠ¡å™¨è¿›è¡Œè®¿é—®ã€‚</p><h2 id="å·¥ç¨‹é‡æ„"><a href="#å·¥ç¨‹é‡æ„" class="headerlink" title="å·¥ç¨‹é‡æ„"></a>å·¥ç¨‹é‡æ„</h2><p>æˆ‘ä»¬å‘ç°å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å®ä½“ç±»é‡å¤ï¼Œå¸Œæœ›è¿›è¡Œå¤ç”¨æ“ä½œã€‚å•ç‹¬åˆ†ä¸€ä¸ªæ¨¡å—æ–¹å®ä½“ç±»ã€å·¥å…·ç±»ç­‰ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ç»¼åˆå·¥å…·åŒ…ï¼Œæ—¶é—´ã€é’±ç­‰è½¬æ¢ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠå®ä½“ç±»å’Œå·¥å…·ç±»éƒ½å†™åˆ°è¿™ä¸ªæ¨¡å—ï¼Œåœ¨mavenå·¥å…·ä¸Šè¿›è¡Œclean-installæ“ä½œæ‰“åŒ…ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å»ä¹‹å‰çš„æ¨¡å—æŠŠå®ä½“ç±»åˆ é™¤ï¼Œåœ¨pomä¸­å¼•ç”¨æ”¹æ¨¡å—çš„ä¾èµ–å³å¯å¯¼å…¥ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- è‡ªå®šä¹‰apiåŒ…é€šè¿‡mavenç”Ÿæˆ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.tang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="æ³¨å†Œä¸­å¿ƒ"><a href="#æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="æ³¨å†Œä¸­å¿ƒ"></a>æ³¨å†Œä¸­å¿ƒ</h1><h2 id="Eureka"><a href="#Eureka" class="headerlink" title="Eureka"></a>Eureka</h2><p>æœåŠ¡çš„ä¸­è½¬ç«™ï¼Œå‘ç°å¹¶ç»´æŠ¤æœåŠ¡ï¼Œè®©åæä¾›æœåŠ¡ç»™å®¢æˆ·ï¼Œæ¯”å¦‚é•¿æ—¶é—´æœªä½¿ç”¨çš„æœåŠ¡åˆ™è‡ªè¡Œåˆ é™¤ï¼Œä¸å†æä¾›ç»™å®¢æˆ·ã€‚</p><p>Eurekaåˆ†ä¸ºæœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ³¨å†Œä¸­å¿ƒçš„å¯åŠ¨å™¨å…¥å£ä¸Šè¿›è¡ŒæœåŠ¡ç«¯é…ç½®ï¼Œå…¶ä½™ç»„ä»¶è¿›è¡Œå®¢æˆ·ç«¯é…ç½®ã€‚</p><ul><li><p>Eureka Server</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>Eureka Client</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="åŸºç¡€é…ç½®ï¼ˆæœåŠ¡ç«¯ï¼‰"><a href="#åŸºç¡€é…ç½®ï¼ˆæœåŠ¡ç«¯ï¼‰" class="headerlink" title="åŸºç¡€é…ç½®ï¼ˆæœåŠ¡ç«¯ï¼‰"></a>åŸºç¡€é…ç½®ï¼ˆæœåŠ¡ç«¯ï¼‰</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--eureka-server--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- è‡ªå®šä¹‰apiåŒ…é€šè¿‡mavenç”Ÿæˆ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.tang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--boot web actuator--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä¸€èˆ¬é€šç”¨é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span>     <span class="comment"># eurekaæœåŠ¡ç«¯å®ä¾‹åç§°</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment"># falseè¡¨ç¤ºè‡ªå·±ä¸ä¼šæ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span>   </span><br><span class="line">    <span class="comment"># è‡ªèº«å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œä¸éœ€è¦æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span>         </span><br><span class="line">    <span class="comment"># ä¸Eurekaè¿›è¡ŒæŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éœ€è¦ç”¨åˆ°çš„åœ°å€</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defalutZone:</span> <span class="string">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EurekaMain7001</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(EurekaMain7001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŸºç¡€é…ç½®ï¼ˆå®¢æˆ·ç«¯ï¼‰"><a href="#åŸºç¡€é…ç½®ï¼ˆå®¢æˆ·ç«¯ï¼‰" class="headerlink" title="åŸºç¡€é…ç½®ï¼ˆå®¢æˆ·ç«¯ï¼‰"></a>åŸºç¡€é…ç½®ï¼ˆå®¢æˆ·ç«¯ï¼‰</h3><p>pomå¯¼å…¥Eureka-clientçš„ä¾èµ–ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment"># å¼€å¯Eurekaå¯¹1ç»„ä»¶è¿›è¡Œæ£€ç´¢ä¸æ³¨å†Œ</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br></pre></td></tr></table></figure><p>åœ¨å¯åŠ¨å…¥å£ä¸Šæ·»åŠ æ³¨è§£ï¼š@EnableEurekaServerã€‚</p><p>ç„¶ååœ¨7001ç«¯å£çš„eurekaå¯ä»¥çœ‹åˆ°æ³¨å†Œè¿›æ¥çš„8001ç»„ä»¶ã€‚</p><h3 id="Eurekaé›†ç¾¤"><a href="#Eurekaé›†ç¾¤" class="headerlink" title="Eurekaé›†ç¾¤"></a>Eurekaé›†ç¾¤</h3><p>EurekaåŒ…æ‹¬å¤šå°æœåŠ¡å™¨ï¼Œæ¯å°æœåŠ¡å™¨éƒ½ä¼šæ³¨å†Œé™¤è‡ªå·±ä»¥å¤–çš„æ‰€æœ‰æœåŠ¡å™¨ï¼Œä¿è¯èƒ½è·å–å…¶ä»–æœåŠ¡å™¨çš„ä¿¡æ¯ã€‚ä»¥ä¾¿åˆ‡æ¢ã€‚</p><p>ä¿®æ”¹hostæ–‡ä»¶ï¼ŒåŠ å…¥è‡ªå·±eurekaçš„å¤šæœºipé…ç½®</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1       eureka7001.com</span><br><span class="line">127.0.0.1       eureka7002.com</span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨ä¿®æ”¹ymlï¼Œæ¯ä¸ªæœåŠ¡å™¨é…ç½®å…¶ä»–æ‰€æœ‰æœåŠ¡å™¨ï¼Œé€—å·åˆ†éš”ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7001.com</span>     <span class="comment"># eurekaæœåŠ¡ç«¯å®ä¾‹åç§°</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment"># falseè¡¨ç¤ºè‡ªå·±ä¸ä¼šæ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment"># è‡ªèº«å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œä¸éœ€è¦æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment"># ä¸Eurekaè¿›è¡ŒæŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éœ€è¦ç”¨åˆ°çš„åœ°å€</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7002.com:7002/eureka</span></span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ä¿®æ”¹yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment"># å¼€å¯Eurekaå¯¹1ç»„ä»¶è¿›è¡Œæ£€ç´¢ä¸æ³¨å†Œ</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span></span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å‘ç°é›†ç¾¤çš„eurekaéƒ½æ³¨å†Œäº†å®ä¾‹ï¼Œä¸”é›†ç¾¤ä¹‹é—´æœåŠ¡å™¨éƒ½ç›¸äº’åŠ è½½ã€‚</p><h3 id="æ”¯ä»˜æœåŠ¡ç«¯é›†ç¾¤"><a href="#æ”¯ä»˜æœåŠ¡ç«¯é›†ç¾¤" class="headerlink" title="æ”¯ä»˜æœåŠ¡ç«¯é›†ç¾¤"></a>æ”¯ä»˜æœåŠ¡ç«¯é›†ç¾¤</h3><p>æ‹·è´ä¸€ä¸ª8002æ”¯ä»˜å·¥ç¨‹ï¼Œå’Œ8001ä¸€æ¨¡ä¸€æ ·ï¼Œæ³¨æ„æ”¹ç«¯å£å·ã€‚åœ¨Controllerä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œå¹¶åœ¨åç»­æ“ä½œä¸­è¿”å›ç«¯å£å·ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">200</span>, <span class="string">&quot;æŸ¥è¯¢æˆåŠŸ,serverPort:&quot;</span> + serverPort, payment);</span><br></pre></td></tr></table></figure><p><strong>æ­¤æ—¶å®¢æˆ·ç«¯ä¸èƒ½å†™æ­»ç«¯å£å·ï¼Œè½¬å˜æˆå¾®æœåŠ¡åï¼Œä¸”è¦å¼€å¯è´Ÿè½½å‡è¡¡ï¼Œå› ä¸ºé›†ç¾¤æœåŠ¡åç›¸åŒï¼Œæ²¡æœ‰é…ç½®è´Ÿè½½å‡è¡¡åˆ™æ— æ³•è¯†åˆ«ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// urlæ”¹å˜ä¸ºæœåŠ¡åç§°ï¼Œä¸æ˜¯å†™æ­»çš„ç«¯å£å·</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PAYMENT_URL = <span class="string">&quot;http://cloud-payment-service&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯configä¸­ï¼Œç»™restTemplateç»„ä»¶æ·»åŠ æ³¨è§£</span></span><br><span class="line"><span class="comment">// @LoadBalancedå¼€å¯è´Ÿè½½å‡è¡¡</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®å¥½åå‘ç°é›†ç¾¤æœåŠ¡å™¨ä¼šäº¤æ›¿ä½¿ç”¨ï¼Œè´Ÿè½½å‡è¡¡ã€‚</p><h3 id="å®Œå–„å¤„ç†"><a href="#å®Œå–„å¤„ç†" class="headerlink" title="å®Œå–„å¤„ç†"></a>å®Œå–„å¤„ç†</h3><p>åœ¨eurekaç•Œé¢å‘ç°å„ä¸ªæœåŠ¡çš„é»˜è®¤åæ˜¯å¸¦æœ‰ä¸»æœºçš„ï¼Œå¾ˆå†—æ‚ï¼Œå¯ä»¥è‡ªå®šä¹‰åç§°ï¼Œå¹¶ä¸”å¯ä»¥å¼€å¯æœåŠ¡çš„æ­£ç¡®ipè·³è½¬ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">payment8001</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="æœåŠ¡å‘ç°Discovery"><a href="#æœåŠ¡å‘ç°Discovery" class="headerlink" title="æœåŠ¡å‘ç°Discovery"></a>æœåŠ¡å‘ç°Discovery</h3><p>é…ç½®æ”¯ä»˜æœåŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> DiscoveryClient discoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/payment/discovery&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">discovery</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// å‘ç°æœåŠ¡</span></span><br><span class="line">        List&lt;String&gt; services = discoveryClient.getServices();</span><br><span class="line">        <span class="keyword">for</span>(String s : services)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;æœåŠ¡ï¼š&quot;</span> + s);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘ç°æœåŠ¡ä¸‹æ˜¯å®ä¾‹</span></span><br><span class="line">        List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="string">&quot;cloud-payment-service&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(ServiceInstance instance : instances)&#123;</span><br><span class="line">            log.info(instance.getServiceId() + <span class="string">&quot;\t&quot;</span> + instance.getHost() + <span class="string">&quot;\t&quot;</span> + instance.getPort() + <span class="string">&quot;\t&quot;</span> + instance.getUri());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.discoveryClient;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>@EnableDiscoveryClient</strong>éœ€è¦åŠ åˆ°æœåŠ¡å¯åŠ¨ç±»ä¸Šå¼€å¯æœåŠ¡å‘ç°</p><h3 id="Eurekaè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶"><a href="#Eurekaè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶" class="headerlink" title="Eurekaè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶"></a>Eurekaè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶</h3><p>å½“ä¸€ä¸ªå¾®æœåŠ¡ä¸èƒ½ä½¿ç”¨æ—¶ï¼Œeurekaä¸ä¼šé©¬ä¸Šè¿›è¡Œæ¸…ç†ï¼Œè€Œæ˜¯å¯¹è¯¥æœåŠ¡ä¿¡æ¯è¿›è¡Œä¿å­˜ã€‚</p><p><strong>åœ¨åˆ†å¸ƒå¼æ¶æ„CAPç†è®ºä¸­å±äºAPåˆ†æ”¯ã€‚</strong></p><h2 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h2><p>apacheå®˜æ–¹ä¸‹è½½zookeeperï¼Œåœ¨linuxå®Œæˆè§£å‹</p><p><a href="https://dlcdn.apache.org/zookeeper/zookeeper-3.6.3/apache-zookeeper-3.6.3-bin.tar.gz">https://dlcdn.apache.org/zookeeper/zookeeper-3.6.3/apache-zookeeper-3.6.3-bin.tar.gz</a></p><p>è§£å‹åè¿›å…¥binç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./zkServer.sh start</span><br><span class="line">./zkCli.sh</span><br></pre></td></tr></table></figure><h3 id="æ”¯ä»˜ä¸šåŠ¡æ³¨å†Œåˆ°zookeeper"><a href="#æ”¯ä»˜ä¸šåŠ¡æ³¨å†Œåˆ°zookeeper" class="headerlink" title="æ”¯ä»˜ä¸šåŠ¡æ³¨å†Œåˆ°zookeeper"></a>æ”¯ä»˜ä¸šåŠ¡æ³¨å†Œåˆ°zookeeper</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆzookeeperå®¢æˆ·ç«¯ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zookeeper-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8004</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-provider-payment</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">zookeeper:</span></span><br><span class="line">      <span class="attr">connect-string:</span> <span class="number">192.168</span><span class="number">.158</span><span class="number">.137</span><span class="string">:2181</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentMain8004</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8004.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ŒæˆåŸºç¡€é…ç½®ï¼Œå¯åŠ¨æœåŠ¡ï¼Œåœ¨linuxæŸ¥çœ‹zookeeperæ³¨å†Œæƒ…å†µæ˜¯å¦æˆåŠŸ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 4] ls /</span><br><span class="line">[services, zookeeper]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 5] ls /services</span><br><span class="line">[cloud-provider-payment]</span><br></pre></td></tr></table></figure><p>ä¸šåŠ¡æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/payment/zk&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentzk</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;springcloud with zookeeper:&quot;</span> + serverPort + <span class="string">&quot;\t&quot;</span> + UUID.randomUUID().toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>èµ°<a href="http://localhost:8004/payment/zk%EF%BC%8C%E5%8F%91%E7%8E%B0uuid%E8%BF%94%E5%9B%9E%E6%88%90%E5%8A%9F">http://localhost:8004/payment/zkï¼Œå‘ç°uuidè¿”å›æˆåŠŸ</a></p><h3 id="èŠ‚ç‚¹ç±»å‹"><a href="#èŠ‚ç‚¹ç±»å‹" class="headerlink" title="èŠ‚ç‚¹ç±»å‹"></a>èŠ‚ç‚¹ç±»å‹</h3><p>å¯å¯¹æ¯”Eurekaè‡ªæˆ‘ä¿æŠ¤ï¼Œzookeeperæ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œå½“æœåŠ¡å®•æœºåï¼Œè¿‡äº†ä¸€ä¸ªå¿ƒè·³æ—¶é—´ä¸ä¼šä¿å­˜æœåŠ¡ã€‚é‡å¯æœåŠ¡ååˆ™æ˜¯æ–°å¼€çš„ä¸€ä¸ªæœåŠ¡ã€‚</p><h3 id="å®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡"><a href="#å®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡" class="headerlink" title="å®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡"></a>å®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡</h3><p>pomæœåŠ¡ç«¯ä¸€è‡´</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-consumer-order</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">zookeeper:</span></span><br><span class="line">      <span class="attr">connect-string:</span> <span class="number">192.168</span><span class="number">.158</span><span class="number">.138</span><span class="string">:2181</span></span><br></pre></td></tr></table></figure><p>controllerè°ƒæœåŠ¡ï¼Œtemplateéœ€è¦å…ˆæ³¨å†Œï¼Œå’Œä¹‹å‰ä¸€æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderZKController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String INVOKE_URL = <span class="string">&quot;http://cloud-provider-payment&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/zk&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String result = restTemplate.getForObject(INVOKE_URL + <span class="string">&quot;/payment/zk&quot;</span>, String.class);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åå‘ç°å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ï¼Œä¸”linuxä¸Šçš„zookeeperä¹Ÿèƒ½å‘ç°ä¸¤ä¸ªæœåŠ¡ã€‚</p><h2 id="Consul"><a href="#Consul" class="headerlink" title="Consul"></a>Consul</h2><p>å®˜æ–¹ä¸‹è½½windowsç‰ˆæœ¬ï¼š<a href="https://www.consul.io/downloads">https://www.consul.io/downloads</a></p><p>è§£å‹åè¿›å…¥æ–‡ä»¶ç›®å½•å‘½ä»¤è¡Œæ‰§è¡Œ<strong>consul agent -dev</strong>å¼€å¯consulå¯è§†åŒ–ç•Œé¢</p><p><a href="http://localhost:8500/ui/dc1/services">http://localhost:8500/ui/dc1/services</a> è®¿é—®å¯è§†åŒ–ç•Œé¢</p><h3 id="æœåŠ¡ç«¯æ³¨å†Œ"><a href="#æœåŠ¡ç«¯æ³¨å†Œ" class="headerlink" title="æœåŠ¡ç«¯æ³¨å†Œ"></a>æœåŠ¡ç«¯æ³¨å†Œ</h3><p>ç›¸å…³é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8006</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">consul-provider-payment</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">consul:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">service-name:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸šåŠ¡å’Œzookeeperä¸€æ ·ï¼Œè¿›è¡Œç®€å•ç«¯å£è¿”å›æµ‹è¯•ï¼ŒæŸ¥çœ‹consulæ˜¯å¦æ³¨å†ŒæˆåŠŸã€‚ä¸»å¯åŠ¨ç±»ä½¿ç”¨@EnableDiscoveryClientã€‚</p><h3 id="å®¢æˆ·ç«¯æ³¨å†Œè°ƒç”¨æœåŠ¡"><a href="#å®¢æˆ·ç«¯æ³¨å†Œè°ƒç”¨æœåŠ¡" class="headerlink" title="å®¢æˆ·ç«¯æ³¨å†Œè°ƒç”¨æœåŠ¡"></a>å®¢æˆ·ç«¯æ³¨å†Œè°ƒç”¨æœåŠ¡</h3><p>pomåŒæœåŠ¡ç«¯ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">consul-consumer-order</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">consul:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">service-name:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br></pre></td></tr></table></figure><p>configæ³¨å†Œtemplateç»„ä»¶ï¼Œç„¶åcontrollerä½¿ç”¨ç½‘ç»œè¿æ¥è°ƒç”¨æœåŠ¡ç«¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderZKController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String INVOKE_URL = <span class="string">&quot;http://consul-provider-payment&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/consul&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String result = restTemplate.getForObject(INVOKE_URL + <span class="string">&quot;/payment/consul&quot;</span>, String.class);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åurlæµ‹è¯•ï¼ŒæœåŠ¡è°ƒç”¨æˆåŠŸã€‚</p><h2 id="æ³¨å†Œä¸­å¿ƒçš„é€‰æ‹©"><a href="#æ³¨å†Œä¸­å¿ƒçš„é€‰æ‹©" class="headerlink" title="æ³¨å†Œä¸­å¿ƒçš„é€‰æ‹©"></a>æ³¨å†Œä¸­å¿ƒçš„é€‰æ‹©</h2><p>æ³¨å†Œä¸­å¿ƒä½œç”¨éƒ½ä¸€æ ·ï¼Œä½†æ¯ä¸€ä¸ªåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å®šä½ä¸åŒï¼Œä¹Ÿå°±æ˜¯CAPå®ç°ä¸åŒã€‚</p><ul><li>Cï¼šConsistencyï¼ˆå¼ºä¸€è‡´æ€§ï¼‰ï¼Œæ‰€æœ‰èŠ‚ç‚¹åœ¨é›†ç¾¤ä¸­å…·æœ‰ç›¸åŒæ•°æ®</li><li>Aï¼šAvaliabilityï¼ˆå¯ç”¨æ€§ï¼‰ï¼Œä¿è¯è¯·æ±‚æ— è®ºæˆåŠŸå¤±è´¥éƒ½æœ‰å“åº”ï¼Œä½†å¯èƒ½æ¥æ”¶åˆ°çš„æ•°æ®èŠ‚ç‚¹æ˜¯è¿‡æ—¶æˆ–é”™çš„ã€‚</li><li>Pï¼šPartitionï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰ï¼Œå¯¹äºåˆ†å¸ƒå¼åˆ†åŒºå®¹é”™æ˜¯å¿…å¤‡çš„ï¼Œä¹Ÿå°±æ˜¯é›†ç¾¤ä¸­éƒ¨åˆ†æœºå™¨å®•æœºï¼Œä¸ä¼šå½±å“æ•´ä¸ªç³»ç»Ÿçš„è¿ä½œã€‚</li></ul><p>ä¸€èˆ¬æ¥è¯´åˆ†å¸ƒå¼ç³»ç»Ÿå¿…é¡»å®ç°Pï¼Œä½†å…¨éƒ¨ç‰¹æ€§åˆä¸èƒ½åŒæ—¶æ»¡è¶³ï¼Œæ‰€ä»¥ä¸€èˆ¬æ˜¯CPã€APä¸¤ç§æ–¹å¼ã€‚</p><ul><li>CAï¼šå•ç‚¹é›†ç¾¤ï¼Œæ»¡è¶³ä¸€è‡´æ€§ï¼Œä¸€èˆ¬ä¸åˆ©äºæ‰©å±•ã€‚ã€</li><li><strong>CP(Zookeeperã€Consul)ï¼š</strong>æ»¡è¶³ä¸€è‡´æ€§ã€åˆ†åŒºå®¹é”™ï¼Œä½†æ€§èƒ½ä¸é«˜ã€‚</li><li><strong>AP(Eureka)ï¼š</strong>æ»¡è¶³å¯ç”¨æ€§ã€åˆ†åŒºå®¹é”™ï¼Œå¯¹ä¸€è‡´æ€§è¦æ±‚ä½ã€‚</li></ul><h1 id="æœåŠ¡è°ƒç”¨ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰"><a href="#æœåŠ¡è°ƒç”¨ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰" class="headerlink" title="æœåŠ¡è°ƒç”¨ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰"></a>æœåŠ¡è°ƒç”¨ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰</h1><h2 id="Ribbon"><a href="#Ribbon" class="headerlink" title="Ribbon"></a>Ribbon</h2><p>æˆ‘ä»¬åœ¨eurekaé›†ç¾¤ç¯å¢ƒä¸‹æµ‹è¯•è¯¥æŠ€æœ¯</p><p>Ribbonä¸»è¦å®ç°è´Ÿè½½å‡è¡¡ï¼ˆLoad Balanceï¼‰</p><ul><li>é›†ä¸­å¼LBï¼ˆNginxï¼‰ï¼šåœ¨æœåŠ¡æ¶ˆè´¹è€…ä¸æä¾›æ–¹ä¹‹é—´ç‹¬ç«‹çš„è´Ÿè½½å‡è¡¡è®¾æ–½ï¼Œå¦‚Nginxåå‘ä»£ç†ï¼Œç”±è¯¥è®¾å¤‡å°†è¯·æ±‚é€šè¿‡ç­–ç•¥è½¬å‘ç»™æœåŠ¡çš„æä¾›æ–¹ã€‚</li><li>è¿›ç¨‹å†…LBï¼ˆRibbonï¼‰ï¼šå°†è´Ÿè½½å‡è¡¡é€»è¾‘é›†æˆåˆ°æ¶ˆè´¹è€…ï¼Œç”±æ¶ˆè´¹è€…ä»æ³¨å†Œä¸­å¿ƒé€‰å–åˆé€‚çš„æœåŠ¡å™¨è¿›è¡Œè°ƒç”¨ã€‚</li></ul><p>å¯¹åº”ä¾èµ–ï¼ˆä¸é€‚ç”¨ï¼‰ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-ribbon<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="RestTemplate"><a href="#RestTemplate" class="headerlink" title="RestTemplate"></a>RestTemplate</h3><p>æˆ‘ä»¬åœ¨æ³¨å†Œä¸­å¿ƒçš„å®¢æˆ·ç«¯å°±ä½¿ç”¨è¿‡@LoadBalance + RestTemplateå®ŒæˆæœåŠ¡è°ƒç”¨åŠè´Ÿè½½å‡è¡¡ã€‚è¿™é‡Œè¦è¯´è¯´RestTemplateã€‚</p><p>RestTemplateå¯¹åº”getã€postéƒ½æœ‰ä¸¤ç§è¯·æ±‚æ–¹æ³•ï¼Œè¿™é‡Œä»¥getä¸¾ä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å›json</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">getPayemntById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›ResponseEntityå¯¹è±¡ï¼ŒåŒ…å«å“åº”å¤´ã€å“åº”ä½“ã€çŠ¶æ€ç ç­‰ï¼Œå¯è·å–æ›´å¤šä¿¡æ¯</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/getForEntity/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">getPayemntById2</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>&#123;</span><br><span class="line">    ResponseEntity&lt;CommonResult&gt; entity = restTemplate.getForEntity(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹è±¡å¯æ ¹æ®çŠ¶æ€ç è¿›è¡Œåˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span>(entity.getStatusCode().is2xxSuccessful())&#123;</span><br><span class="line">        <span class="keyword">return</span> entity.getBody();</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult&lt;&gt;(<span class="number">404</span>, <span class="string">&quot;æ“ä½œå¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>getForObjectï¼šè·å–å“åº”æ•°æ®ï¼Œç±»ä¼¼ä¸€ä¸ªjson</li><li>getForEntityï¼šè·å–æ•´ä¸ªå“åº”ï¼Œä¿¡æ¯æ›´å¤šã€‚</li></ul><p>åˆ†æƒ…å†µä½¿ç”¨ï¼Œpostå’Œgetä¸€æ ·ï¼Œåªæ˜¯æ¢äº†å‰ç¼€ã€‚</p><h3 id="è´Ÿè½½å‡è¡¡ç®—æ³•æ›¿æ¢"><a href="#è´Ÿè½½å‡è¡¡ç®—æ³•æ›¿æ¢" class="headerlink" title="è´Ÿè½½å‡è¡¡ç®—æ³•æ›¿æ¢"></a>è´Ÿè½½å‡è¡¡ç®—æ³•æ›¿æ¢</h3><p>Ribbonä¾èµ–ä¸­æœ‰ä¸€ä¸ªæ¥å£IRuleï¼Œä¸€èˆ¬å®ç°è¯¥æ¥å£çš„ç±»å°±å¯¹åº”äº†ä¸€ç§ç®—æ³•ï¼ŒæŠ½è±¡ç±»é™¤å¤–ã€‚æœ‰è½®è¯¢ã€éšæœºç­‰ã€‚</p><p>æˆ‘ä»¬ä¸æƒ³ä½¿ç”¨é»˜è®¤çš„è½®è¯¢ç®—æ³•ã€‚å¯ä»¥è‡ªè¡Œæ„é€ ä¸€ä¸ªæ–°ç®—æ³•è§„åˆ™ï¼Œä½†å®˜æ–¹è§„å®šè¿™ä¸ªè§„åˆ™ä¸åº”è¯¥æ”¾åœ¨@ComponentScanèƒ½æ‰«æçš„åŒ…ä¸­ï¼Œè¿™æ ·åšä¸åˆ°ç‰¹æ®ŠåŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¦è·³å‡ºä¸»å¯åŠ¨ç±»æ‰€åœ¨åŒ…ï¼Œæ–°å»ºä¸€ä¸ªè§„åˆ™åŒ…æ¥å®ç°è§„åˆ™ã€‚</p><p><strong>æ³¨æ„å‘ï¼Œç°åœ¨ç‰ˆæœ¬eureka-clientæ²¡æœ‰é›†æˆribbonï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥ä½¿ç”¨IRuleè‡ªå®šä¹‰ç­–ç•¥ï¼Œéœ€è¦å»å¯¼å…¥RibbonåŒ…ï¼Œä½†æˆ‘æ‰§è¡Œå¯¼å…¥Ribbonè¿è¡Œéƒ½ä¼šå†²çªæŠ¥é”™ï¼Œæ²¡æ‰¾åˆ°åŸå› ï¼Œåªèƒ½è¯´è€æŠ€æœ¯æ²¡äººç»´æŠ¤æ˜¯è¿™æ ·çš„ï¼Œèµ¶ç´§å¾€åå­¦Nacosé…åˆFeignï¼Œè´Ÿè½½å‡è¡¡ç­–ç•¥éƒ½å¯ä»¥åœ¨ymlæ”¹ï¼Œä¸ç”¨è‡ªå®šä¹‰ç±»è¿‡äºéº»çƒ¦ã€‚</strong></p><p>è§£å†³åŠæ³•ï¼š<a href="https://blog.csdn.net/Curtain_show01/article/details/116838815">https://blog.csdn.net/Curtain_show01/article/details/116838815</a></p><p>æˆ– <a href="https://www.cnblogs.com/minejava/p/14851495.html">https://www.cnblogs.com/minejava/p/14851495.html</a></p><p>æˆ‘ä»¬ä½¿ç”¨Spring Cloud LoadBalanceré¡¶æ›¿Ribbonï¼ŒLoadBalancerè¢«Eurekaæ‰€é›†æˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç®—æ³•é…ç½®ï¼Œä¸ç”¨@Configurationæ³¨å†Œ</span></span><br><span class="line"><span class="comment">// ä½†æµ‹è¯•åå‘ç°åŠ ä¸åŠ @Configurationéƒ½å¯ï¼Œåº”è¯¥æ˜¯ä¸ç”¨æ³¨å†Œæˆç»„ä»¶çš„ï¼Œè¿™é‡Œä¸å¤ªæ¸…æ¥š</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLoadBalance</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">ReactorLoadBalancer&lt;ServiceInstance&gt; <span class="title">randomLoadBalancer</span><span class="params">(Environment environment,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                            LoadBalancerClientFactory loadBalancerClientFactory)</span> </span>&#123;</span><br><span class="line">        String name = environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RandomLoadBalancer(loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class), name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨åŸæœ¬çš„RestTemplateè®¾ç½®ç±»ä¸­ä½¿ç”¨æ³¨è§£@LoadBalancerClientä¿®æ”¹é…ç½®</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@LoadBalancerClient(name = &quot;cloud-payment-service&quot;, configuration = MyLoadBalance.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationContextConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å†ä½¿ç”¨æ”¹å®¢æˆ·ç«¯å³å¯å®Œæˆéšæœºç®—æ³•çš„è´Ÿè½½å‡è¡¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬äºŒç§æ–¹æ³•æ˜¯è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡é…ç½®åŠ ä¸Š@Configurationè¿›è¡Œæ³¨å†Œï¼Œç„¶ååœ¨ä¸»å¯åŠ¨ç±»åŠ ä¸Šä»¥ä¸‹æ³¨è§£</span></span><br><span class="line"><span class="meta">@LoadBalancerClients(defaultConfiguration = MyLoadBalance.class)</span></span><br></pre></td></tr></table></figure><h2 id="OpenFeign"><a href="#OpenFeign" class="headerlink" title="OpenFeign"></a>OpenFeign</h2><p>ä¼ ç»ŸRibbon + RestTemplateå¯¹httpè¯·æ±‚å°è£…ï¼Œå½¢æˆæ¨¡æ¿åŒ–è°ƒç”¨æ–¹æ³•ï¼Œè€ŒFeignåœ¨è¯¥åŸºç¡€ä¸Šè¿›ä¸€æ­¥å°è£…ï¼Œé€šè¿‡æ¥å£ + æ³¨è§£è¿›è¡Œé…ç½®ï¼Œè¿›ä¸€æ­¥ç®€åŒ–æ“ä½œã€‚ï¼ˆç±»æ¯”Daoå±‚é…åˆMapperæ³¨è§£ï¼‰</p><h3 id="æœåŠ¡è°ƒç”¨"><a href="#æœåŠ¡è°ƒç”¨" class="headerlink" title="æœåŠ¡è°ƒç”¨"></a>æœåŠ¡è°ƒç”¨</h3><p>åŸºç¡€é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span> </span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span></span><br></pre></td></tr></table></figure><p>serviceå¯¹åº”ä½ è¦è°ƒç”¨çš„æœåŠ¡ç«¯æœåŠ¡ï¼Œæˆ‘ä»¬åŸæœ¬ä¸šåŠ¡æ˜¯ä½¿ç”¨RestTemplate + é€»è¾‘è‡ªè¡Œå®ç°Controllerï¼Œè€ŒOpenFeignæ˜¯å…ˆå®šä¹‰æœåŠ¡çš„æ¥å£ï¼ŒæŒ‡æ˜æœåŠ¡ä¸ä¸šåŠ¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;cloud-payment-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PaymentFeignService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function">CommonResult&lt;Payment&gt; <span class="title">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Controllerç›´æ¥è·å–ä¸šåŠ¡æ¥å£çš„å®ä¾‹ï¼Œé€šè¿‡å®ƒè°ƒç”¨æœåŠ¡ç«¯çš„ä¸šåŠ¡ï¼Œä¸ç”¨æ³¨å…¥RestTemplateã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderFeignController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentFeignService paymentFeignService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">getPaymetById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> paymentFeignService.getPaymentById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸»å¯åŠ¨ç±»ä½¿ç”¨@EnableFeignClientsï¼Œå¼€å¯OpenFeign</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderFeignMain80</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(OrderFeignMain80.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å®¢æˆ·ç«¯é“¾æ¥ï¼Œå‘ç°èƒ½è°ƒç”¨ä¸šåŠ¡ï¼Œä¸”å¼€å¯äº†è½®è¯¢è´Ÿè½½å‡è¡¡ã€‚</p><h3 id="è¶…æ—¶æ§åˆ¶"><a href="#è¶…æ—¶æ§åˆ¶" class="headerlink" title="è¶…æ—¶æ§åˆ¶"></a>è¶…æ—¶æ§åˆ¶</h3><p>OpenFeigné»˜è®¤ç­‰å¾…æœåŠ¡1sï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿä¸šåŠ¡ç­‰å¾…3sï¼Œå®¢æˆ·ç«¯è°ƒç”¨åä¼šæŠ¥é”™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡ç«¯</span></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/payment/feign/timeout&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">paymentFeignTimeOut</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">10</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> serverPort;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¥å£</span></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/payment/feign/timeout&quot;)</span></span><br><span class="line"><span class="function">String <span class="title">paymentFeignTimeOut</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// å®ç°ç±»</span></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/consumer/payment/feign/timeout&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">paymentFeignTimeOut</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> paymentFeignService.paymentFeignTimeOut();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">ReadTimeout:</span> <span class="number">1000</span></span><br><span class="line">  <span class="attr">ConnectTimeout:</span> <span class="number">1000</span></span><br></pre></td></tr></table></figure><p>é…ç½®ymlå¯å»¶é•¿è¶…æ—¶æ—¶é—´ã€‚</p><p><strong>psï¼šä¸çŸ¥é“æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘å®¢æˆ·ç«¯ä¸€ç›´åœ¨ç­‰å¾…ï¼Œæ²¡æœ‰é»˜è®¤1sçš„åˆ¤æ–­ï¼Ÿï¼Ÿï¼Ÿä¸ç®¡äº†åæ­£åªæ˜¯ä¸€ä¸ªå°ç‚¹</strong></p><h3 id="OpenFeignè‡ªå¸¦æ—¥å¿—è¾“å‡º"><a href="#OpenFeignè‡ªå¸¦æ—¥å¿—è¾“å‡º" class="headerlink" title="OpenFeignè‡ªå¸¦æ—¥å¿—è¾“å‡º"></a>OpenFeignè‡ªå¸¦æ—¥å¿—è¾“å‡º</h3><ul><li>NONEï¼šé»˜è®¤ä¸æ˜¾ç¤ºæ—¥å¿—</li><li>BASICï¼šè®°å½•è¯·æ±‚æ–¹æ³•ã€URLã€å“åº”çŠ¶æ€ç ã€æ‰§è¡Œæ—¶é—´</li><li>HEADERSï¼šé™¤BASICå®šä¹‰çš„ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯</li><li>FULLï¼šé™¤HEADERSå®šä¹‰çš„ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰è¯·æ±‚ä¸å“åº”çš„æ­£æ–‡ã€å…ƒæ•°æ®</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// configç±»</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FeignConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    Logger.<span class="function">Level <span class="title">feignLogLevel</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.FULL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ymlé…ç½®éœ€æ‰“å°æ—¥å¿—çš„æ¥å£çš„ç­‰çº§</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.tang.springcloud.service.PaymentFeignService:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure><h1 id="Hystrix"><a href="#Hystrix" class="headerlink" title="Hystrix"></a>Hystrix</h1><p>å½“å¾®æœåŠ¡é…ç½®å¤šäº†ï¼Œä¸€ä¸ªå¾®æœåŠ¡ä¼šè°ƒç”¨å¤šä¸ªå¾®æœåŠ¡ï¼Œä¹Ÿå°±æ˜¯æ‰‡å‡ºï¼ˆå¹¿æ’­ï¼‰ï¼Œè€Œå…¶ä¸­æŸä¸€ä¸ªå¾®æœåŠ¡å‡ºç°é—®é¢˜ï¼Œä¼šå½±å“å…¶ä»–æ‰€æœ‰å¾®æœåŠ¡ï¼Œå¥½æ¯”é›ªå´©ã€‚ç®€å•å°±æ˜¯è¯´é«˜å¯ç”¨è¢«ç ´åã€‚</p><p><strong>Hystrixåœ¨æŸä¸€ä¸ªæœåŠ¡å‡ºç°é—®é¢˜æ—¶ï¼Œä¸ä¼šå¯¼è‡´æ•´ä¸ªæœåŠ¡å…¨éƒ¨å¤±è´¥ï¼Œé¿å…çº§è”æ•…éšœï¼Œå¯ä»¥æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼¹æ€§ã€‚</strong></p><h2 id="åŸºç¡€æœåŠ¡æ„å»º"><a href="#åŸºç¡€æœåŠ¡æ„å»º" class="headerlink" title="åŸºç¡€æœåŠ¡æ„å»º"></a>åŸºç¡€æœåŠ¡æ„å»º</h2><ul><li>æœåŠ¡ç«¯ï¼š</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-provider-hystrix-payment</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span> </span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com/7001/eureka</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸šåŠ¡æ¨¡æ‹Ÿï¼Œä¸€ä¸ªè€—æ—¶çŸ­ï¼Œä¸€ä¸ªè€—æ—¶é•¿</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_OK</span><span class="params">(Integer id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± ï¼š&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;paymentInfo_OK, id:&quot;</span> + id + <span class="string">&quot;\t&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_TimeOut</span><span class="params">(Integer id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> time = <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(time);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± ï¼š&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;paymentInfo_TimeOut, id:&quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;è€—æ—¶&quot;</span> + time + <span class="string">&quot;s&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨å…¥Controller</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>&#123;</span><br><span class="line">        String result = paymentService.paymentInfo_OK(id);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>&#123;</span><br><span class="line">        String result = paymentService.paymentInfo_TimeOut(id);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å®¢æˆ·ç«¯ï¼š</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Feignæ¥å£è°ƒæœåŠ¡</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;CLOUD-PROVIDER-HYSTRIX-PAYMENT&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PaymentHystrixService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function">String <span class="title">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function">String <span class="title">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ControlleræœåŠ¡æ³¨å…¥</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderHystrixController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentHystrixService paymentHystrixService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function">String <span class="title">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>&#123;</span><br><span class="line">        String result = paymentHystrixService.paymentInfo_OK(id);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function">String <span class="title">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>&#123;</span><br><span class="line">        String result = paymentHystrixService.paymentInfo_TimeOut(id);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬ç°åœ¨å¯¹æœåŠ¡ç«¯æ–½åŠ å‹åŠ›æµ‹è¯•ï¼Œå¤šçº¿ç¨‹æ‰§è¡ŒæœåŠ¡ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ‰§è¡Œæ“ä½œæ—¶éƒ½ä¼šå˜æ…¢ï¼ŒåŠ è½½æ—¶é—´å˜é•¿ï¼Œæ­¤æ—¶éœ€è¦ç›¸åº”æªæ–½ã€‚</p><h2 id="æœåŠ¡é™çº§ï¼ˆfallbackï¼‰"><a href="#æœåŠ¡é™çº§ï¼ˆfallbackï¼‰" class="headerlink" title="æœåŠ¡é™çº§ï¼ˆfallbackï¼‰"></a>æœåŠ¡é™çº§ï¼ˆfallbackï¼‰</h2><p>æœåŠ¡å™¨å‹åŠ›å‰§å¢ï¼Œå¯å¯¹ä¸é‡è¦çš„æœåŠ¡è¿›è¡Œå»¶è¿Ÿæˆ–æš‚åœå¤„ç†ï¼Œä»¥ä¾¿é‡Šæ”¾æœåŠ¡å™¨èµ„æºï¼Œä¿è¯æ ¸å¿ƒæœåŠ¡æ­£å¸¸è¿è¡Œã€‚</p><p>æœåŠ¡ç«¯è®¾ç½®æœåŠ¡æ—¶é—´é˜ˆå€¼ï¼Œè‹¥è¶…æ—¶åˆ™æ‰§è¡Œå…œåº•æ–¹æ³•å¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¿›è¡Œé™çº§æ“ä½œã€‚ä¸”ä»¥ä¸‹æƒ…å†µéƒ½ä¼šå‘ç”ŸæœåŠ¡é™çº§ï¼š<strong>ç¨‹åºè¿è¡Œå¼‚å¸¸</strong> + <strong>è¶…æ—¶</strong>ã€‚</p><p><strong>æ³¨æ„ï¼Œä»¥ä¸‹é…ç½®è¶…æ—¶æ—¶é—´ï¼Œä¸é…ç½®åˆ™ä½¿ç”¨é»˜è®¤å€¼1sã€‚</strong></p><h3 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸»å¯åŠ¨ç±»å¼€å¯Hystrix</span></span><br><span class="line"><span class="meta">@EnableHystrix</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çº¿ç¨‹è¶…æ—¶ï¼Œæ‰§è¡Œå…œåº•æ–¹æ³•ï¼Œå‚æ•°1å…œåº•æ–¹æ³•ï¼Œå‚æ•°2è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="comment">// æœåŠ¡å‡ºç°å¼‚å¸¸ä¹Ÿä¼šç›´æ¥è¿›è¡Œé™çº§æ“ä½œï¼Œæ¯”å¦‚æ‰§è¡Œ10/0</span></span><br><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentInfo_TimeOutHandle&quot;, commandProperties = &#123;</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;,value=&quot;3000&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_TimeOut</span><span class="params">(Integer id)</span></span>&#123;</span><br><span class="line">    <span class="comment">// int i= 10 / 0;</span></span><br><span class="line">    <span class="keyword">int</span> time = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(time);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± ï¼š&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;paymentInfo_TimeOut, id:&quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;è€—æ—¶&quot;</span> + time + <span class="string">&quot;s&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_TimeOutHandle</span><span class="params">(Integer id)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± ï¼š&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;paymentInfo_TimeOutHandle, id:&quot;</span> + id + <span class="string">&quot;\t&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><p>å¯ä»¥å‘ç°ä¸¤ç«¯å¯¹åº”æ—¶é—´é…ç½®å¯ä»¥ä¸ä¸€æ ·çš„ï¼Œè¿™é‡ŒæœåŠ¡å“åº”æ˜¯3sï¼ŒåˆšåˆšæœåŠ¡ç«¯é…ç½®5så¯ä»¥å“åº”ï¼Œç°åœ¨å®¢æˆ·ç«¯åªé…ç½®1såˆ™ä¸èƒ½å“åº”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸»å¯åŠ¨ç±»å¼€å¯Hystrix</span></span><br><span class="line"><span class="meta">@EnableHystrix</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentInfo_TimeOutHandle&quot;, commandProperties = &#123;</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;,value=&quot;1000&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/consumer/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function">String <span class="title">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>&#123;</span><br><span class="line">    String result = paymentHystrixService.paymentInfo_TimeOut(id);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_TimeOutHandle</span><span class="params">(Integer id)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± ï¼š&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;paymentInfo_TimeOutHandle, id:&quot;</span> + id + <span class="string">&quot;\t&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŠ€æœ¯é‡æ„â€“å…¨å±€fallbacké…ç½®"><a href="#æŠ€æœ¯é‡æ„â€“å…¨å±€fallbacké…ç½®" class="headerlink" title="æŠ€æœ¯é‡æ„â€“å…¨å±€fallbacké…ç½®"></a>æŠ€æœ¯é‡æ„â€“å…¨å±€fallbacké…ç½®</h3><p>å¯¹äºå…œåº•æ–¹æ³•å¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–ï¼Œè®¾ç½®ä¸€ä¸ªå…¨å±€å…œåº•ï¼Œæ²¡æœ‰è‡ªè¡Œé…ç½®åˆ™èµ°æ•´ä¸ªæ–¹æ³•ï¼Œä¸ç”¨æ¯æ¬¡æœåŠ¡é™çº§éƒ½è¦è‡ªè¡Œé…ç½®å…œåº•æ–¹æ³•ã€‚ä»¥ä¸‹ä¸ºæ”¹å˜åçš„å®¢æˆ·ç«¯ï¼Œä½¿ç”¨ <strong>@DefaultProperties</strong> å…¨å±€å…œåº•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@DefaultProperties(defaultFallback = &quot;paymentGlobalFallbackMethod&quot;, commandProperties = &#123;</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value = &quot;5000&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderHystrixController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentHystrixService paymentHystrixService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function">String <span class="title">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">        String result = paymentHystrixService.paymentInfo_OK(id);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@HystrixCommand</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function">String <span class="title">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">        String result = paymentHystrixService.paymentInfo_TimeOut(id);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¨å±€fallback</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentGlobalFallbackMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;å…¨å±€å¼‚å¸¸ï¼Œç¨åé‡è¯•&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…¨å±€fallbackï¼Œå¯åº”å¯¹æœåŠ¡ç«¯å®•æœº"><a href="#å…¨å±€fallbackï¼Œå¯åº”å¯¹æœåŠ¡ç«¯å®•æœº" class="headerlink" title="å…¨å±€fallbackï¼Œå¯åº”å¯¹æœåŠ¡ç«¯å®•æœº"></a>å…¨å±€fallbackï¼Œå¯åº”å¯¹æœåŠ¡ç«¯å®•æœº</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®¢æˆ·ç«¯é…ç½®ç†”æ–­å™¨</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">circuitbreaker:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é…ç½®å…¨å±€Fallbackï¼Œç›´æ¥å®ç°ä¸šåŠ¡æ¥å£</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentFallbackService</span> <span class="keyword">implements</span> <span class="title">PaymentHystrixService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_OK</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;paymentInfo_OK,NO&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_TimeOut</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;paymentInfo_TimeOut,NO&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸šåŠ¡æ¥å£fallbackå±æ€§å£°æ˜å®ç°æ¥å£çš„Fallbackç±»</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;CLOUD-PROVIDER-HYSTRIX-PAYMENT&quot;, fallback = PaymentFallbackService.class)</span></span><br></pre></td></tr></table></figure><p><strong>ç»è¿‡å®éªŒï¼Œä½¿ç”¨è¯¥æ–¹æ³•å¼€å¯å…¨å±€fallbackï¼Œå¯åº”å¯¹æœåŠ¡ç«¯å®•æœºï¼Œå®•æœºåä¸ä¼šæ˜¾ç¤ºæœåŠ¡404ï¼Œè€Œæ˜¯èµ°å…¨å±€fallbackè¿›è¡ŒæœåŠ¡æé†’ã€‚è€Œä¸”æ³¨é‡Šå‰é¢çš„ @HystrixCommand + @DefaultPropertiesï¼Œæˆ‘ä»¬æœåŠ¡è¶…æ—¶å’Œè¿è¡Œå¼‚å¸¸ä¹Ÿä¼šèµ°è¿™ä¸ªå…¨å±€fallbackï¼Œå¯ä»¥è¯´è¿™ä¸ªå®ç°æ¥å£çš„å…¨å±€fallbackæ˜¯æœ€ä½³æ–¹æ¡ˆï¼Œå…¶ä»–å‡ ç§å¯ç”¨æ¥é…ç½®ç‰¹æ®Šæƒ…å†µã€‚</strong></p><h2 id="æœåŠ¡ç†”æ–­"><a href="#æœåŠ¡ç†”æ–­" class="headerlink" title="æœåŠ¡ç†”æ–­"></a>æœåŠ¡ç†”æ–­</h2><p>å¯ç±»æ¯”ä¿é™©ä¸ï¼Œå½“æŸä¸ªæœåŠ¡ä¸å¯ç”¨æˆ–å“åº”è¶…æ—¶æ—¶ï¼Œæ€¥æ—¶åœæ­¢è¯¥æœåŠ¡ï¼Œé˜²æ­¢ç³»ç»Ÿé›ªå´©ç°è±¡å‡ºç°ã€‚<strong>è€Œå½“æ£€æµ‹åˆ°æŸä¸ªå¾®æœåŠ¡å“åº”æ­£å¸¸åï¼Œæ¢å¤è°ƒç”¨é“¾è·¯ã€‚</strong></p><p><strong>HystrixCommandProperties</strong>ï¼Œè¿™ä¸ªæŠ½è±¡ç±»åŒ…å«äº†æˆ‘ä»¬å¯ä»¥é…ç½®çš„å‚æ•°ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//serviceï¼ŒæœåŠ¡ç«¯é…ç½®ç†”æ–­</span></span><br><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentCircuitBreaker_fallback&quot;, commandProperties = &#123;</span></span><br><span class="line"><span class="meta">    @HystrixProperty(name = &quot;circuitBreaker.enabled&quot;, value = &quot;true&quot;), //æ–­è·¯å™¨æ˜¯å¦å¼€å¯</span></span><br><span class="line"><span class="meta">    @HystrixProperty(name = &quot;circuitBreaker.requestVolumeThreshold&quot;, value = &quot;10&quot;), //è¯·æ±‚æ¬¡æ•°</span></span><br><span class="line"><span class="meta">    @HystrixProperty(name = &quot;circuitBreaker.sleepWindowInMilliseconds&quot;, value = &quot;10000&quot;), //è¯·æ±‚æ—¶é—´ms</span></span><br><span class="line"><span class="meta">    @HystrixProperty(name = &quot;circuitBreaker.errorThresholdPercentage&quot;, value = &quot;60&quot;) //å¤±è´¥ç‡ï¼Œè¾¾åˆ°å°±ç†”æ–­</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">paymentCircuitBreaker</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(id &lt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;------è´Ÿæ•°-------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è‡ªè¡Œå°è£…çš„mavenä¾èµ–ä¸­å¼•ç”¨äº†hutoolå·¥å…·åŒ…ï¼Œéšæœºç”Ÿæˆuuid</span></span><br><span class="line">    String serialNumber = IdUtil.simpleUUID();</span><br><span class="line">    <span class="keyword">return</span> Thread.currentThread().getName()+<span class="string">&quot;\t&quot;</span>+<span class="string">&quot;è°ƒç”¨æˆåŠŸï¼Œæµæ°´å·: &quot;</span> + serialNumber;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æœåŠ¡é™çº§è°ƒç”¨æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">paymentCircuitBreaker_fallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;id ä¸èƒ½æ˜¯è´Ÿæ•°ï¼Œè¯·ç¨åå†è¯•ï¼Œid: &quot;</span> +id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//controller</span></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/payment/circuit/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">paymentCircuitBreaker</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>&#123;</span><br><span class="line">    String result = paymentService.paymentCircuitBreaker(id);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£é‡Šä»¥ä¸‹é…ç½®çš„å‚æ•°ï¼Œå¼€å¯æ–­è·¯å™¨ï¼Œè‹¥10så†…10æ¬¡è¯·æ±‚å¤±è´¥ç‡è¾¾åˆ°60%ï¼Œåˆ™ç†”æ–­ã€‚è€Œåç»­æ­£ç¡®å›å‡åˆ™ä¼šæ¢å¤é“¾è·¯ã€‚æˆ‘ä»¬æµ‹è¯•æ—¶å…ˆè¾“å…¥æ­£æ•°ä¼šæˆåŠŸè°ƒç”¨è¿”å›uuidï¼Œè¾“å…¥è´Ÿæ•°åˆ™æŠ›å¼‚å¸¸èµ°å…œåº•æ–¹æ³•å¤„ç†ã€‚ä½†10så†…å¤šæ¬¡å¤±è´¥åï¼Œæˆ‘ä»¬å†å»è¾“å…¥æ•´æ•°ï¼Œè¿”å›çš„æ˜¯å…œåº•æ–¹æ³•ï¼Œå› ä¸ºå¤±è´¥ç‡è¾¾åˆ°60%è¢«ç†”æ–­äº†ï¼Œè€Œæˆ‘ä»¬åç»­å¤šæ¬¡è°ƒç”¨æ­£æ•°ï¼Œå¤±è´¥ç‡é™ä½ï¼Œåˆå¯ä»¥èµ°æ­£å¸¸æ–¹æ³•è¿”å›uuidã€‚</p><p>ç†”æ–­åä¸å†èµ°æ­£å¸¸é€»è¾‘ï¼Œè€Œæ˜¯æ‰§è¡ŒæœåŠ¡é™çº§çš„å…œåº•æ–¹æ³•ï¼Œä½†ç†”æ–­å¯ä»¥è‡ªè¡Œæ¢å¤é“¾è·¯é‡æ–°æ‰§è¡Œæ­£å¸¸é€»è¾‘ã€‚</p><h2 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="headerlink" title="å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹</h2><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/43.png" alt="43.png"></p><h2 id="å›¾å½¢åŒ–Dashboard"><a href="#å›¾å½¢åŒ–Dashboard" class="headerlink" title="å›¾å½¢åŒ–Dashboard"></a>å›¾å½¢åŒ–Dashboard</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableHystrixDashboard</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HystrixDashboardMain9001</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(HystrixDashboardMain9001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å…¶ä»–æ¨¡å—è®°å¾—é…ç½®actuatorï¼Œè¿›è¡Œå›¾å½¢åŒ–ç›‘æ§ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** åœ¨è¢«ç›‘æ§çš„æ¨¡å—ä¸»å¯åŠ¨å™¨ä¸Šæ³¨å…¥</span></span><br><span class="line"><span class="comment"> *æ­¤é…ç½®æ˜¯ä¸ºäº†æœåŠ¡ç›‘æ§è€Œé…ç½®ï¼Œä¸æœåŠ¡å®¹é”™æœ¬èº«æ— å…³ï¼Œspringcloudå‡çº§åçš„å‘</span></span><br><span class="line"><span class="comment"> *ServletRegistrationBeanå› ä¸ºspringbootçš„é»˜è®¤è·¯å¾„ä¸æ˜¯&quot;/hystrix.stream&quot;ï¼Œ</span></span><br><span class="line"><span class="comment"> *åªè¦åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œé…ç½®ä¸Šä¸‹é¢çš„servletå°±å¯ä»¥äº†</span></span><br><span class="line"><span class="comment"> *å¦åˆ™ï¼ŒUnable to connect to Command Metric Stream 404</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">getServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    HystrixMetricsStreamServlet streamServlet = <span class="keyword">new</span> HystrixMetricsStreamServlet();</span><br><span class="line">    ServletRegistrationBean registrationBean = <span class="keyword">new</span> ServletRegistrationBean(streamServlet);</span><br><span class="line">    registrationBean.setLoadOnStartup(<span class="number">1</span>);</span><br><span class="line">    registrationBean.addUrlMappings(<span class="string">&quot;/hystrix.stream&quot;</span>);</span><br><span class="line">    registrationBean.setName(<span class="string">&quot;HystrixMetricsStreamServlet&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®ä»ªè¡¨ç›˜ç•Œé¢ï¼š<a href="http://localhost:9001/hystrix%EF%BC%8C%E8%BE%93%E5%85%A5">http://localhost:9001/hystrixï¼Œè¾“å…¥</a> <a href="http://localhost:8001/hystrix.stream">http://localhost:8001/hystrix.stream</a> å¯¹æœåŠ¡è¿›è¡Œå›¾å½¢åŒ–ç›‘æ§ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥ç›‘æ§æœåŠ¡ç†”æ–­demoçš„æµç¨‹ã€‚</p><h1 id="Gatewayç½‘å…³"><a href="#Gatewayç½‘å…³" class="headerlink" title="Gatewayç½‘å…³"></a>Gatewayç½‘å…³</h1><h2 id="å·¥ä½œæµç¨‹-1"><a href="#å·¥ä½œæµç¨‹-1" class="headerlink" title="å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹</h2><ul><li>è·¯ç”±ï¼ˆRouteï¼‰ï¼šåŒ¹é…è§„åˆ™ï¼Œç”±ä¸€ç³»åˆ—æ–­è¨€å’Œè¿‡æ»¤å™¨ç»„æˆï¼Œè‹¥æ–­è¨€åŒ¹é…æˆåŠŸåˆ™é€‰æ‹©è¯¥è·¯ç”±ã€‚</li><li>æ–­è¨€ï¼ˆPredicateï¼‰ï¼šå¯ä»¥åŒ¹é…HTTPè¯·æ±‚çš„å…¨éƒ¨å†…å®¹ï¼Œæ–­è¨€åˆ¤æ–­ä¸ºtrueåˆ™ç»§ç»­è¿›è¡Œè·¯ç”±ï¼Œå³é€‰æ‹©è·¯ç”±çš„è·¯å¾„ã€‚</li><li>è¿‡æ»¤ï¼ˆFilterï¼‰ï¼šSpringçš„GatewayFilterå®ä¾‹ï¼Œä½¿ç”¨è¿‡æ»¤å™¨å¯åœ¨è¯·æ±‚è¢«è·¯ç”±å‰åå¯¹è¯·æ±‚è¿›è¡Œä¿®æ”¹ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/44.png" alt="44.png"></p><p>å®¢æˆ·ç«¯ç»è¿‡ç½‘å…³çš„è·¯ç”±ã€Predicateã€ä»¥åŠè¿‡æ»¤å™¨çš„ç­›é€‰åè¾¾åˆ°æœåŠ¡ç«¯ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯åŒå‘çš„ï¼Œå…¶ä¸­è¿‡æ»¤å™¨åˆ†ä¸ºpreã€postä¸¤ç±»ï¼Œpreæ˜¯è¿‡æ»¤å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯ï¼Œpostè¿‡æ»¤æœåŠ¡ç«¯åˆ°å®¢æˆ·ç«¯ã€‚</p><h2 id="ç½‘å…³æ­å»º"><a href="#ç½‘å…³æ­å»º" class="headerlink" title="ç½‘å…³æ­å»º"></a>ç½‘å…³æ­å»º</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç½‘å…³ä¸æ˜¯webå·¥ç¨‹ï¼Œæ— éœ€é…ç½®webã€actuatorå¯åŠ¨å™¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9527</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-gateway</span></span><br><span class="line">  <span class="comment"># åœ¨9527ç½‘å…³ä¸Šé…ç½®8001æœåŠ¡ä¿¡æ¯</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_route</span>           <span class="comment">#è·¯ç”±çš„ID</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">http://localhost:8001</span>  <span class="comment">#åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/payment/get/**</span>    <span class="comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line"></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_route2</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">http://localhost:8001</span>  <span class="comment">#åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/payment/feign/**</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br></pre></td></tr></table></figure><p>ç„¶åè¿è¡Œ8001æœåŠ¡ä¸9527ç½‘å…³ï¼Œåˆ†åˆ«è®¿é—®;</p><p><a href="http://localhost:8001/payment/feign/timeout">http://localhost:8001/payment/feign/timeout</a> å’Œ <a href="http://localhost:9527/payment/feign/timeout">http://localhost:9527/payment/feign/timeout</a></p><p>å¯ä»¥é€šè¿‡9527è®¿é—®8001çš„æœåŠ¡ï¼Œè¿”å›çš„ç«¯å£å·ä¾æ—§æ˜¯8001ï¼Œé€šè¿‡ç½‘å…³è¿›è¡Œä¸­è½¬ï¼Œæˆ‘ä»¬æ— éœ€æš´éœ²çœŸå®æœåŠ¡ç«¯å£ã€‚</p><h2 id="åŠ¨æ€è·¯ç”±é…ç½®"><a href="#åŠ¨æ€è·¯ç”±é…ç½®" class="headerlink" title="åŠ¨æ€è·¯ç”±é…ç½®"></a>åŠ¨æ€è·¯ç”±é…ç½®</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">locator:</span></span><br><span class="line">          <span class="comment">#å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„è¿‡ç¨‹ï¼Œé€šè¿‡å¾®æœåŠ¡åè¿›è¡Œè·¯ç”±</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/payment/get/**</span></span><br><span class="line"></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_route2</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/payment/feign/**</span></span><br></pre></td></tr></table></figure><p>å…ˆå¼€å¯åŠ¨æ€è·¯ç”±é…ç½®ï¼Œç„¶åå¯¹ç½‘å…³é…ç½®ä¸­å†™æ­»çš„<strong>uri</strong>è¿›è¡Œæ›¿æ¢ï¼Œä»æ³¨å†Œä¸­å¿ƒè·å–åŠ¨æ€è·¯ç”±ï¼Œæ ¼å¼æ˜¯lb://å¾®æœåŠ¡åï¼Œæ–­è¨€è·¯å¾„ä¸å˜ã€‚</p><h2 id="å¸¸ç”¨çš„preticates"><a href="#å¸¸ç”¨çš„preticates" class="headerlink" title="å¸¸ç”¨çš„preticates"></a>å¸¸ç”¨çš„preticates</h2><p>å®˜æ–¹é…ç½®ï¼š<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories</a></p><ul><li>æ—¶é—´é™åˆ¶</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ—¶åŒºæ—¶é—´çš„ç”Ÿæˆï¼šZonedDateTime time = ZonedDateTime.now();</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_route2</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">Path=/payment/feign/**</span></span><br><span class="line"><span class="comment"># æå‰ä¸Šçº¿ï¼Œå®šæ—¶èµ·æ•ˆ</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">After=2021-10-17T10:40:00.781+08:00[Asia/Shanghai]</span></span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼šæˆ‘ä»¬å°†ä¸Šé¢çš„è·¯ç”±è®¾ç½®Afteræ—¶åŒºï¼Œè§„å®šåªæœ‰åœ¨è¿™æ®µæ—¶é—´ä¹‹åæœåŠ¡ç½‘å…³æ‰ä¼šç”Ÿæ•ˆï¼Œç±»ä¼¼çš„è¿˜æœ‰beforeã€between</p><ul><li>cookieé™åˆ¶</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">predicates:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Cookie=username,tang</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸å¸¦cookieæ— æ³•é€šè¿‡ï¼Œå¸¦cookieå¯ä»¥é€šè¿‡</span></span><br><span class="line">curl http://localhost:9527/payment/feign/timeout</span><br><span class="line">curl http://localhost:9527/payment/feign/timeout --cookie <span class="string">&quot;username=tang&quot;</span></span><br></pre></td></tr></table></figure><p>è®¾ç½®cookieçš„kvé”®å€¼å¯¹ï¼Œåªæœ‰å¯¹åº”é”®å€¼å¯¹çš„è¯·æ±‚å¯ä»¥æ­£å¸¸è®¿é—®ã€‚</p><ul><li>Headeré™åˆ¶</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">predicates:</span><br><span class="line">  - Header=X-Request-Id, \d+</span><br></pre></td></tr></table></figure><p>è¯·æ±‚å¤´è¦æœ‰X-Request-Idè¿™ä¸ªå±æ€§ï¼Œä¸”å€¼ä¸ºæ•´æ•°ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¸¦æœ‰å¯¹åº”è¯·æ±‚å¤´çš„è¯·æ±‚æ‰èƒ½æ­£å¸¸è®¿é—®</span></span><br><span class="line">curl http://localhost:9527/payment/feign/timeout -H <span class="string">&quot;X-Request-Id:123&quot;</span></span><br></pre></td></tr></table></figure><h2 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h2><p>å¯åœ¨è¯·æ±‚è¢«è·¯ç”±å‰åå¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚</p><p>å®˜æ–¹é…ç½®ï¼š<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gatewayfilter-factories">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gatewayfilter-factories</a></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ymlå¯è¿›è¡Œç®€å•çš„è¯·æ±‚å¤´æ·»åŠ ï¼Œä½†æŒ‰ç…§å·¥ä½œæµç¨‹ï¼Œfilteræ˜¯åœ¨predicatesåæ‰§è¡Œçš„</span></span><br><span class="line"><span class="comment"># æ‰€ä»¥è¿™é‡Œæ·»åŠ è¯·æ±‚å¤´ä¸ä¼šå½±å“predicatesçš„è¯·æ±‚å¤´ç­›é€‰åˆ¤æ–­</span></span><br><span class="line"><span class="attr">filters:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">AddRequestHeader=X-Request-Id,123</span></span><br></pre></td></tr></table></figure><p><strong>æ¨èä½¿ç”¨å…¨å±€Filterï¼ŒåŠŸèƒ½æ›´ä¸°å¯Œï¼Œå¯è‡ªè¡Œé…ç½®æ—¥å¿—è¾“å‡ºã€‚ä¸»è¦æ˜¯å®ç°ä¸¤ä¸ªæ¥å£ï¼ŒGlobalFilterå’ŒOrdered</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogGatewayFilter</span> <span class="keyword">implements</span> <span class="title">GlobalFilter</span>, <span class="title">Ordered</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è¯·æ±‚è¿‡æ»¤ï¼Œä¸ä¸ºç©ºé“¾è·¯æ”¾è¡Œï¼Œä¸ºç©ºæ‰“å°æ—¥å¿—</span></span><br><span class="line">        log.info(<span class="string">&quot;FilterLog&quot;</span> + <span class="keyword">new</span> Date());</span><br><span class="line">        String name = exchange.getRequest().getQueryParams().getFirst(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(name == <span class="keyword">null</span>)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;ç”¨æˆ·åä¸ºnullï¼Ÿï¼Ÿï¼Ÿ&quot;</span>);</span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.NOT_ACCEPTABLE);</span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="http://localhost:9527/payment/get/1?name=tang">http://localhost:9527/payment/get/1?name=tang</a> ç¬¦åˆè¿‡æ»¤å™¨çš„è§„åˆ™å¯ä»¥æ­£å¸¸è®¿é—®ã€‚</p><p><a href="http://localhost:9527/payment/get/1?username=xxx">http://localhost:9527/payment/get/1?username=xxx</a> åªè¦ä¸ç¬¦åˆç›´æ¥404ï¼Œæ— è¿æ¥ï¼Œåå°ä¹Ÿä¼šæ‰“å°æ—¥å¿—ã€‚</p><h1 id="æœåŠ¡é…ç½®"><a href="#æœåŠ¡é…ç½®" class="headerlink" title="æœåŠ¡é…ç½®"></a>æœåŠ¡é…ç½®</h1><h2 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h2><h3 id="æœåŠ¡ç«¯é…ç½®"><a href="#æœåŠ¡ç«¯é…ç½®" class="headerlink" title="æœåŠ¡ç«¯é…ç½®"></a>æœåŠ¡ç«¯é…ç½®</h3><p>æ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä½†æœåŠ¡å¤šäº†ä»¥åä¸€ä¸ªä¸ªä¿®æ”¹é…ç½®æ•ˆç‡å¤ªä½å¹¶ä»»æ„å‡ºé”™ï¼Œæ‰€ä»¥ä½¿ç”¨é…ç½®ä¸­å¿ƒé¿å…é‡å¤é…ç½®ã€‚ä¸ºä¸åŒçš„å¾®æœåŠ¡ç¯å¢ƒæä¾›ä¸­å¿ƒåŒ–çš„å¤–éƒ¨é…ç½®ã€‚è¿™ä¸ªå¤–éƒ¨é…ç½®æŒ‡çš„æ˜¯æŠŠé…ç½®æ–‡ä»¶ä¸Šä¼ åˆ°github/giteeä¸Šï¼Œç„¶åé€šè¿‡ymlè¯»å–ä»“åº“çš„é…ç½®ã€‚ </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableConfigServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigMain3344</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ConfigMain3344.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="http://config-3344.com:3344/master/config-dev.yml">http://config-3344.com:3344/master/config-dev.yml</a></p><p><a href="http://config-3344.com:3344/master/config-prod.yml">http://config-3344.com:3344/master/config-prod.yml</a></p><p><a href="http://config-3344.com:3344/master/config-test.yml">http://config-3344.com:3344/master/config-test.yml</a></p><p>é€šè¿‡ä»¥ä¸Šæ ¼å¼ï¼Œ/åˆ†æ”¯/æ–‡ä»¶åè¯»å–é…ç½®</p><h3 id="å®¢æˆ·ç«¯é…ç½®"><a href="#å®¢æˆ·ç«¯é…ç½®" class="headerlink" title="å®¢æˆ·ç«¯é…ç½®"></a>å®¢æˆ·ç«¯é…ç½®</h3><p><strong>application.yml</strong>æ˜¯ç”¨æˆ·çº§èµ„æºé…ç½®ï¼Œ<strong>bootstrap.yml</strong>æ˜¯ç³»ç»Ÿçº§èµ„æºé…ç½®ï¼Œä¼˜å…ˆçº§æ›´é«˜ã€‚æˆ‘ä»¬ä¸ºäº†å¼•å…¥å¤–éƒ¨çš„é…ç½®æ–‡ä»¶ï¼Œéœ€è¦ä½¿ç”¨bootstrap.ymlï¼Œå…¶å…ˆäºapplicationåŠ è½½ï¼Œæˆ‘ä»¬æ‹‰å–å¤–éƒ¨é…ç½®åï¼Œå†åŠ è½½applicationã€‚</p><p>springcloudé»˜è®¤å…³é—­bootstrapï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åŠ å…¥ä¾èµ–å¼€å¯ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3355</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">config-client</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment">#Configå®¢æˆ·ç«¯é…ç½®</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">master</span> <span class="comment">#åˆ†æ”¯åç§°</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">config</span> <span class="comment">#é…ç½®æ–‡ä»¶åç§°</span></span><br><span class="line">      <span class="attr">profile:</span> <span class="string">dev</span> <span class="comment">#è¯»å–åç¼€åç§°</span></span><br><span class="line">      <span class="comment">#ä¸Šè¿°3ä¸ªç»¼åˆï¼šmasteråˆ†æ”¯ä¸Šconfig-dev.ymlè¢«è¯»å–http://config-3344.com:3344/master/config-dev.yml</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">http://config-3344.com:3344</span> <span class="comment">#é…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡è·¯å¾„æŸ¥çœ‹æ˜¯å¦åŠ è½½äº†æ­£ç¡®çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigClientController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/configInfo&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getConfigInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> configInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—® <a href="http://localhost:3355/configInfo%EF%BC%8C%E5%92%8C%E4%B9%8B%E5%89%8Dconfig-dev%E5%86%85%E5%AE%B9%E4%B8%80%E8%87%B4%E3%80%82">http://localhost:3355/configInfoï¼Œå’Œä¹‹å‰config-devå†…å®¹ä¸€è‡´ã€‚</a></p><h3 id="å®¢æˆ·ç«¯æ‰‹åŠ¨åŠ¨æ€åˆ·æ–°"><a href="#å®¢æˆ·ç«¯æ‰‹åŠ¨åŠ¨æ€åˆ·æ–°" class="headerlink" title="å®¢æˆ·ç«¯æ‰‹åŠ¨åŠ¨æ€åˆ·æ–°"></a>å®¢æˆ·ç«¯æ‰‹åŠ¨åŠ¨æ€åˆ·æ–°</h3><p>æˆ‘ä»¬å®æ—¶ä¿®æ”¹ä»“åº“å†…çš„é…ç½®ï¼Œ3344å¯ä»¥å®æ—¶æ›´æ–°ï¼Œè€Œ3355æœåŠ¡è¯»å–é…ç½®å´æ²¡æœ‰å®æ—¶æ›´æ–°ï¼Œéœ€è¦æˆ‘ä»¬é‡å¯æœåŠ¡æ‰èƒ½æ›´æ–°é…ç½®ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼€å¯åŠ¨æ€åˆ·æ–°è§£å†³è¯¥é—®é¢˜ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æš´éœ²ç›‘æ§ç«¯ç‚¹</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨åˆšåˆšèµ„æºè®¿é—®è·¯å¾„ä¸šåŠ¡ç±»ä¸Šæ·»åŠ åˆ·æ–°æ³¨è§£</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ç›´æ¥ç½‘é¡µåˆ·æ–°æ˜¯ä¸ä¼šå˜çš„ã€‚æˆ‘ä»¬å¿…é¡»å‘é€POSTè¯·æ±‚è®©æœåŠ¡åˆ·æ–°é…ç½®ï¼Œä½†ä¸ç”¨é‡å¯æœåŠ¡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cmdå‘é€postï¼Œç„¶åå†æŸ¥çœ‹é…ç½®å‘ç°å·²æ›´æ–°</span></span><br><span class="line">curl -X POST <span class="string">&quot;http://localhost:3355/actuator/refresh&quot;</span></span><br></pre></td></tr></table></figure><h2 id="Busï¼ˆjaråŒ…é—®é¢˜ï¼‰"><a href="#Busï¼ˆjaråŒ…é—®é¢˜ï¼‰" class="headerlink" title="Busï¼ˆjaråŒ…é—®é¢˜ï¼‰"></a><del>Busï¼ˆjaråŒ…é—®é¢˜ï¼‰</del></h2><p>ä¸Šé¢Configå¹¶æ²¡æœ‰å®ç°å®æ—¶çš„æ›´æ–°ï¼Œåªæ˜¯ä»é‡å¯æœåŠ¡å˜ä¸ºäº†å‘é€è¯·æ±‚åæ›´æ”¹ï¼Œä½¿ç”¨Busæ¶ˆæ¯æ€»çº¿å®Œæˆè‡ªåŠ¨åŠ¨æ€åˆ·æ–°é…ç½®ã€‚Busæ¶ˆæ¯ä»£ç†æ”¯æŒRabbitMQå’ŒKafkaã€‚</p><p>å…ˆå†linuxå¼€å¯mqï¼Œè®¿é—®mqå›¾å½¢åŒ–ç•Œé¢ <a href="http://192.168.158.138:15672ã€‚">http://192.168.158.138:15672ã€‚</a></p><p>è‡ªåŠ¨åŠ¨æ€åˆ·æ–°çš„ä¸¤ç§å®ç°ï¼š</p><ul><li>Busè§¦å‘ä¸€ä¸ªå®¢æˆ·ç«¯çš„åˆ·æ–°ï¼Œè¿›è€Œä¼ æ’­æ‰€æœ‰å®¢æˆ·ç«¯éƒ½åˆ·æ–°ã€‚</li><li>Busè§¦å‘æœåŠ¡ç«¯ConfigServerçš„åˆ·æ–°ï¼Œç„¶åç”±æœåŠ¡ç«¯å¹¿æ’­æ‰€æœ‰å®¢æˆ·ç«¯è¿›è¡Œåˆ·æ–°ã€‚</li></ul><p>æˆ‘ä»¬é€‰æ‹©ç”±æœåŠ¡ç«¯è¿›è¡Œå¹¿æ’­çš„æ¨¡å¼å—ï¼Œè¿™ç§è‚¯å®šæ˜¯æ›´ä¼˜çš„ã€‚</p><h3 id="æœåŠ¡ç«¯å¹¿æ’­åŠ¨æ€åˆ·æ–°"><a href="#æœåŠ¡ç«¯å¹¿æ’­åŠ¨æ€åˆ·æ–°" class="headerlink" title="æœåŠ¡ç«¯å¹¿æ’­åŠ¨æ€åˆ·æ–°"></a>æœåŠ¡ç«¯å¹¿æ’­åŠ¨æ€åˆ·æ–°</h3><p>æ–°å»ºä¸€ä¸ªå®¢æˆ·ç«¯3366ä¸€èµ·æµ‹è¯•ï¼Œä¸šåŠ¡è¾“å‡ºç«¯å£å·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigClientController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/configInfo&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getConfigInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> serverPort + <span class="string">&quot;,&quot;</span> + configInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨3344æœåŠ¡ç«¯å’Œ3355ã€3366å®¢æˆ·ç«¯åŠ å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶ä¹Ÿè¦å¼•å…¥mqç›¸å…³ï¼Œbus-refreshæ˜¯å®˜æ–¹æŒ‡å®šçš„åˆ·æ–°ç«¯ç‚¹ã€‚å®¢æˆ·ç«¯ä¹Ÿè¦é…ç½®mqçš„ç›¸å…³å±æ€§</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.158</span><span class="number">.138</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line"><span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line"><span class="attr">password:</span> <span class="number">111</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#rabbitmqç›¸å…³é…ç½®ï¼Œæš´éœ²busåˆ·æ–°é…ç½®çš„ç«¯ç‚¹</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;bus-refresh&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST <span class="string">&quot;http://localhost:3344/actuator/bus-refresh&quot;</span></span><br></pre></td></tr></table></figure><p><strong>æŒ‰ç†æ¥è¯´æˆ‘ä»¬å¯åŠ¨æœåŠ¡ç«¯å’Œå¤šä¸ªå®¢æˆ·ç«¯ï¼Œæ›´æ–°ä¾èµ–åï¼Œå¾€æœåŠ¡ç«¯ç«¯ç‚¹bus-refreshå‘é€POSTè¯·æ±‚å³å¯å¹¿æ’­å…¨éƒ¨çš„å®¢æˆ·ç«¯ã€‚ä½†æˆ‘åœ¨ä½¿ç”¨bus-amqpè¿™ä¸ªmqè¿æ¥ä¾èµ–æ—¶é‡åˆ°äº†é—®é¢˜ï¼Œè¯´ç¼ºå¤±ç±»ï¼ˆå½“å‰ä¾èµ–ç¼ºå¤±éœ€è¦çš„ç±»ï¼Œä½¿ç”¨å…¶ä»–ä¾èµ–ç‰ˆæœ¬ï¼‰ï¼Œè‡ªå·±åˆ é™¤jaråŒ…å¯¼å…¥ä½ç‰ˆæœ¬ä»æ— æ³•è§£å†³ï¼Œæ‰€ä»¥Busçš„å¹¿æ’­æ¨¡æ‹Ÿå¤±è´¥ï¼Œç‰ˆæœ¬æ‰æ˜¯å”¯ä¸€ç¥ï¼Œæ›´æ–°æ¢ä»£å¤ªå¿«äº†ï¼Œç½‘ä¸Šä¹Ÿæœç´¢ä¸åˆ°è§£å†³åŠæ³•å°±å¾ˆéš¾å—ï¼Œè¿˜å¾—çœ‹æˆ‘Nacosã€‚</strong></p><h1 id="Streamï¼ˆjaråŒ…é—®é¢˜ï¼‰"><a href="#Streamï¼ˆjaråŒ…é—®é¢˜ï¼‰" class="headerlink" title="Streamï¼ˆjaråŒ…é—®é¢˜ï¼‰"></a><del>Streamï¼ˆjaråŒ…é—®é¢˜ï¼‰</del></h1><p>MQæœ‰å¤šç§æ¬¾å¼ï¼Œå¯ä½¿ç”¨Streamè¿›è¡Œç»Ÿä¸€ã€‚streamä¼šå¿½ç•¥åº•å±‚ä½¿ç”¨çš„MQå·®å¼‚ï¼Œé€‚é…ä¸åŒç‰ˆæœ¬çš„MQã€‚</p><p>é€šè¿‡Streamçš„Binderå¯¹è±¡è¿›è¡Œä¸­é—´ä»¶çš„äº¤äº’ã€‚å®šä¹‰ç»‘å®šå™¨Binderä½œä¸ºä¸­é—´å±‚ï¼Œå®ç°äº†ä¸­é—´ä»¶çš„ç‰ˆæœ¬éš”ç¦»ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-stream-rabbit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨æ³¨è§£"><a href="#å¸¸ç”¨æ³¨è§£" class="headerlink" title="å¸¸ç”¨æ³¨è§£"></a>å¸¸ç”¨æ³¨è§£</h2><table><thead><tr><th>æ³¨è§£</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>@Input</td><td>æ³¨è§£æ ‡è¯†è¾“å…¥é€šé“ï¼Œé€šè¿‡è¯¥è¾“ä¹é€šé“æ¥æ”¶åˆ°çš„æ¶ˆæ¯è¿›å…¥åº”ç”¨ç¨‹åº</td></tr><tr><td>@Output</td><td>æ³¨è§£æ ‡è¯†è¾“å‡ºé€šé“ï¼Œå‘å¸ƒçš„æ¶ˆæ¯å°†é€šè¿‡è¯¥é€šé“ç¦»å¼€åº”ç”¨ç¨‹åº</td></tr><tr><td>@StreamListener</td><td>ç›‘å¬é˜Ÿåˆ—ï¼Œç”¨äºæ¶ˆè´¹è€…çš„é˜Ÿåˆ—çš„æ¶ˆæ¯æ¥æ”¶</td></tr><tr><td>@EnableBinding</td><td>å°†ä¿¡é“channelå’Œexchangeç»‘å®šåœ¨ä¸€èµ·</td></tr></tbody></table><p>ç°åœ¨è¿™ä¸ªç»‘å®šæ³¨è§£ä¾æ—§è¿‡æ—¶äº†ï¼Œå¯å‚è€ƒå¸–å­ä¸‹é¢çš„å®˜æ–¹æ–‡æ¡£è®¾ç½®<a href="https://www.5axxw.com/questions/content/0b9xic%EF%BC%8C%E8%99%BD%E7%84%B6%E6%B3%A8%E8%A7%A3%E8%BF%87%E6%97%B6%E4%BA%86%E4%BD%86%E8%BF%98%E6%98%AF%E5%8F%AF%E4%BB%A5%E7%94%A8%E7%9A%84%E3%80%82">https://www.5axxw.com/questions/content/0b9xicï¼Œè™½ç„¶æ³¨è§£è¿‡æ—¶äº†ä½†è¿˜æ˜¯å¯ä»¥ç”¨çš„ã€‚</a></p><h2 id="æ¶ˆæ¯ç”Ÿäº§è€…ï¼ˆoutputï¼‰"><a href="#æ¶ˆæ¯ç”Ÿäº§è€…ï¼ˆoutputï¼‰" class="headerlink" title="æ¶ˆæ¯ç”Ÿäº§è€…ï¼ˆoutputï¼‰"></a>æ¶ˆæ¯ç”Ÿäº§è€…ï¼ˆoutputï¼‰</h2><p>ä¾èµ–åŠé…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-stream-rabbit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8801</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-stream-provider</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="attr">binders:</span> <span class="comment"># åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„rabbitmqçš„æœåŠ¡ä¿¡æ¯ï¼›</span></span><br><span class="line">        <span class="attr">defaultRabbit:</span> <span class="comment"># è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äºäºbindingæ•´åˆ</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">rabbit</span> <span class="comment"># æ¶ˆæ¯ç»„ä»¶ç±»å‹</span></span><br><span class="line">          <span class="attr">environment:</span> <span class="comment"># è®¾ç½®rabbitmqçš„ç›¸å…³çš„ç¯å¢ƒé…ç½®</span></span><br><span class="line">            <span class="attr">spring:</span></span><br><span class="line">              <span class="attr">rabbitmq:</span></span><br><span class="line">                <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.158</span><span class="number">.139</span></span><br><span class="line">                <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">                <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">                <span class="attr">password:</span> <span class="number">111</span></span><br><span class="line">      <span class="attr">bindings:</span> <span class="comment"># æœåŠ¡çš„æ•´åˆå¤„ç†</span></span><br><span class="line">        <span class="attr">output:</span> <span class="comment"># è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§°</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">studyExchange</span> <span class="comment"># è¡¨ç¤ºè¦ä½¿ç”¨çš„Exchangeåç§°å®šä¹‰</span></span><br><span class="line">          <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸ºjsonï¼Œæ–‡æœ¬åˆ™è®¾ç½®â€œtext/plainâ€</span></span><br><span class="line">          <span class="attr">binder:</span> <span class="string">defaultRabbit</span> <span class="comment"># è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">2</span> <span class="comment"># è®¾ç½®å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼ˆé»˜è®¤æ˜¯30ç§’ï¼‰</span></span><br><span class="line">    <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">5</span> <span class="comment"># å¦‚æœç°åœ¨è¶…è¿‡äº†5ç§’çš„é—´éš”ï¼ˆé»˜è®¤æ˜¯90ç§’ï¼‰</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">send-8801.com</span>  <span class="comment"># åœ¨ä¿¡æ¯åˆ—è¡¨æ—¶æ˜¾ç¤ºä¸»æœºåç§°</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>æ¥å£ + å®ç°ç±» + ä¸šåŠ¡Controllerï¼Œå¯åŠ¨eureka7001ï¼Œè®¿é—®<a href="http://localhost:8801/sendMsg%EF%BC%8C%E5%8F%91%E7%8E%B0%E5%90%8E%E5%8F%B0%E6%9C%89%E9%9A%8F%E6%9C%BA%E6%95%B0%EF%BC%8C%E4%B8%94MQ%E5%86%85%E5%88%9B%E5%BB%BA%E7%9A%84channel%E4%BA%A7%E7%94%9F%E4%BA%86%E6%B6%88%E6%81%AF%E3%80%82">http://localhost:8801/sendMsgï¼Œå‘ç°åå°æœ‰éšæœºæ•°ï¼Œä¸”MQå†…åˆ›å»ºçš„channeläº§ç”Ÿäº†æ¶ˆæ¯ã€‚</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MessageProvider</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">send</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableBinding(Source.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageProviderImpl</span> <span class="keyword">implements</span> <span class="title">MessageProvider</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> MessageChannel output;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">send</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String serial = UUID.randomUUID().toString();</span><br><span class="line">        output.send(MessageBuilder.withPayload(serial).build());</span><br><span class="line">        System.out.println(serial);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SendMessageController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> MessageProvider messageProvider;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendMsg&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sendMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> messageProvider.send();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¶ˆæ¯æ¶ˆè´¹è€…ï¼ˆinputï¼‰"><a href="#æ¶ˆæ¯æ¶ˆè´¹è€…ï¼ˆinputï¼‰" class="headerlink" title="æ¶ˆæ¯æ¶ˆè´¹è€…ï¼ˆinputï¼‰"></a>æ¶ˆæ¯æ¶ˆè´¹è€…ï¼ˆinputï¼‰</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8802</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-stream-consumer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="attr">binders:</span> <span class="comment"># åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„rabbitmqçš„æœåŠ¡ä¿¡æ¯ï¼›</span></span><br><span class="line">        <span class="attr">defaultRabbit:</span> <span class="comment"># è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äºäºbindingæ•´åˆ</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">rabbit</span> <span class="comment"># æ¶ˆæ¯ç»„ä»¶ç±»å‹</span></span><br><span class="line">          <span class="attr">environment:</span> <span class="comment"># è®¾ç½®rabbitmqçš„ç›¸å…³çš„ç¯å¢ƒé…ç½®</span></span><br><span class="line">            <span class="attr">spring:</span></span><br><span class="line">              <span class="attr">rabbitmq:</span></span><br><span class="line">                <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.158</span><span class="number">.139</span></span><br><span class="line">                <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">                <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">                <span class="attr">password:</span> <span class="number">111</span></span><br><span class="line">      <span class="attr">bindings:</span> <span class="comment"># æœåŠ¡çš„æ•´åˆå¤„ç†</span></span><br><span class="line">        <span class="attr">input:</span> <span class="comment"># è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§°</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">studyExchange</span> <span class="comment"># è¡¨ç¤ºè¦ä½¿ç”¨çš„Exchangeåç§°å®šä¹‰</span></span><br><span class="line">          <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸ºå¯¹è±¡jsonï¼Œå¦‚æœæ˜¯æ–‡æœ¬åˆ™è®¾ç½®â€œtext/plainâ€</span></span><br><span class="line">          <span class="attr">binder:</span> <span class="string">defaultRabbit</span> <span class="comment"># è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">receive-8802.com</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@EnableBinding(Sink.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReceiverMessageController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@StreamListener(Sink.INPUT)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">input</span><span class="params">(Message&lt;String&gt; msg)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1ï¼Œæ¶ˆæ¯ï¼š&quot;</span> + msg.getPayload() + <span class="string">&quot;\t port: &quot;</span> + serverPort);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿäº§è€…å‘é€éšæœºåºåˆ—å·ï¼Œé€šè¿‡withPayloadå‘é€ï¼Œæ¶ˆè´¹è€…é€šè¿‡getPayloadè·å–åºåˆ—å·è¿›è¡Œæ¶ˆè´¹ã€‚å¼€å¯8802æ¶ˆè´¹8801ä¿¡æ¯ï¼Œ<strong>ç„¶ååˆé‡åˆ°Busçš„jaråŒ…é—®é¢˜ï¼Œè¿˜å¥½è¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—çš„å¤„ç†ä¸å…³é”®ï¼Œæˆ‘ä»¬è®°å½•ä¸€ä¸ªå¤§æ¦‚å³å¯ï¼Œå®åœ¨æ˜¯ä¸çŸ¥é“jaråŒ…é—®é¢˜è¯¥å¦‚ä½•å¤„ç†Â·Â·Â·Â·Â·Â·</strong></p><h1 id="Sleuthé“¾è·¯è·Ÿè¸ª"><a href="#Sleuthé“¾è·¯è·Ÿè¸ª" class="headerlink" title="Sleuthé“¾è·¯è·Ÿè¸ª"></a>Sleuthé“¾è·¯è·Ÿè¸ª</h1><p>zipkinå®‰è£…åŠå¯åŠ¨ <a href="https://zipkin.io/">https://zipkin.io/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># get the latest source</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/openzipkin/zipkin</span><br><span class="line"><span class="built_in">cd</span> zipkin</span><br><span class="line"><span class="comment"># Build the server and also make its dependencies</span></span><br><span class="line">./mvnw -DskipTests --also-make -pl zipkin-server clean install</span><br><span class="line"><span class="comment"># Run the server</span></span><br><span class="line">java -jar ./zipkin-server/target/zipkin-server-*exec.jar</span><br></pre></td></tr></table></figure><p>è®¿é—® <a href="http://localhost:9411/">http://localhost:9411/</a> zipkinç•Œé¢ã€‚</p><p>åœ¨æœåŠ¡8001å’Œæ¶ˆè´¹è€…80æ·»åŠ ä¾èµ–å’Œæ–°çš„é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">zipkin:</span></span><br><span class="line">    <span class="attr">base-url:</span> <span class="string">http://localhost:9411</span></span><br><span class="line">  <span class="attr">sleuth:</span></span><br><span class="line">    <span class="attr">sampler:</span></span><br><span class="line">      <span class="comment">#é‡‡æ ·ç‡å€¼ä»‹äº 0 åˆ° 1 ä¹‹é—´ï¼Œ1 åˆ™è¡¨ç¤ºå…¨éƒ¨é‡‡é›†</span></span><br><span class="line">      <span class="attr">probability:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡ä¸šåŠ¡ç±»æ·»åŠ é“¾è·¯è¯·æ±‚è·¯å¾„</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/payment/zipkin&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">paymentZipkin</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Zipkin&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¶ˆè´¹è€…è°ƒç”¨æœåŠ¡ç«¯</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/zipkin&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">paymentZipkin</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String result = restTemplate.getForObject(<span class="string">&quot;http://localhost:8001&quot;</span> + <span class="string">&quot;/payment/zipkin&quot;</span>, String.class);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ¶ˆè´¹è€…è°ƒç”¨æœåŠ¡ï¼Œ9411ç«¯å£ä¼šå‡ºç°è®°å½•ã€‚æ³¨æ„ä½¿ç”¨å•æœºç¯å¢ƒè¦å…ˆæŠŠé›†ç¾¤çš„é…ç½®å’Œè´Ÿè½½å‡è¡¡å…³é—­ï¼Œä¸ç„¶ä¼šæŠ¥é”™ã€‚</p><h1 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h1><h2 id="ä¸‹è½½åŠå¯åŠ¨"><a href="#ä¸‹è½½åŠå¯åŠ¨" class="headerlink" title="ä¸‹è½½åŠå¯åŠ¨"></a>ä¸‹è½½åŠå¯åŠ¨</h2><p>Nacoså……å½“æœåŠ¡é…ç½®ä¸­å¿ƒï¼ŒNacos = Eureka + Config + Bus</p><p>åœ¨å®˜æ–¹è¿›è¡Œä¸‹è½½ï¼š<a href="https://github.com/alibaba/nacos/releases/tag/1.4.2">https://github.com/alibaba/nacos/releases/tag/1.4.2</a></p><p>åœ¨å‘½ä»¤è¡Œè¿›å…¥bin/startup.cmdè¿›è¡Œå¯åŠ¨ï¼Œå¾®ç›Ÿå•æœºæ¨¡å¼éœ€è¦ä¿®æ”¹.cmdçš„é…ç½®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤é›†ç¾¤</span></span><br><span class="line"><span class="built_in">set</span> MODE=<span class="string">&quot;cluster&quot;</span></span><br><span class="line"><span class="comment"># åˆ‡æ¢å•ä¾‹</span></span><br><span class="line"><span class="built_in">set</span> MODE=<span class="string">&quot;standalone&quot;</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨åè®¿é—®ï¼š<a href="http://localhost:8848/nacos%EF%BC%8C%E5%88%9D%E5%A7%8B%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81%E5%9D%87%E4%B8%BAnacos%E3%80%82">http://localhost:8848/nacosï¼Œåˆå§‹è´¦å·å¯†ç å‡ä¸ºnacosã€‚</a></p><h2 id="æœåŠ¡æä¾›è€…"><a href="#æœåŠ¡æä¾›è€…" class="headerlink" title="æœåŠ¡æä¾›è€…"></a>æœåŠ¡æä¾›è€…</h2><p>å®˜æ–¹2.2.6ç‰ˆæœ¬ç›¸å…³é…ç½®ï¼š<a href="https://spring-cloud-alibaba-group.github.io/github-pages/hoxton/en-us/index.html#_introduction">https://spring-cloud-alibaba-group.github.io/github-pages/hoxton/en-us/index.html#_introduction</a></p><p>çˆ¶ç±»è¿›è¡Œpomç®¡ç†ï¼Œå­ç±»é…ç½®ä¾èµ–æ— éœ€ç‰ˆæœ¬å·ï¼Œåœ¨ymlä¸­å°†9001ç«¯å£é…ç½®åˆ°nacosã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencymanagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>Hoxton.SR9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencymanagement</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-payment-provider</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#é…ç½®Nacosåœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸šåŠ¡ç±»</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/nacos/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;nacos registry, serverPort: &quot;</span>+ serverPort+<span class="string">&quot;\t id&quot;</span>+id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸»å¯åŠ¨</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentMain9001</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(PaymentMain9001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬åœ¨8848nacosä¸Šçš„æœåŠ¡åˆ—è¡¨ä¸­ï¼Œå¯ä»¥æ‰¾åˆ°æ³¨å†Œçš„æœåŠ¡ã€‚</p><p>å»ºç«‹ä¸¤ä¸ªä¸€æ ·çš„æœåŠ¡ç«¯9001ã€9002ï¼Œæ–¹ä¾¿å®¢æˆ·ç«¯æµ‹è¯•Nacosè´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚</p><h2 id="å®¢æˆ·ç«¯æ¶ˆè´¹è€…"><a href="#å®¢æˆ·ç«¯æ¶ˆè´¹è€…" class="headerlink" title="å®¢æˆ·ç«¯æ¶ˆè´¹è€…"></a>å®¢æˆ·ç«¯æ¶ˆè´¹è€…</h2><p>nacosä¾èµ–é›†æˆribbonï¼Œå®ç°è´Ÿè½½å‡è¡¡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">83</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-order-consumer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¶ˆè´¹è€…å°†è¦å»è®¿é—®çš„å¾®æœåŠ¡åç§°(æ³¨å†ŒæˆåŠŸè¿›nacosçš„å¾®æœåŠ¡æä¾›è€…)</span></span><br><span class="line"><span class="attr">service-url:</span></span><br><span class="line">  <span class="attr">nacos-user-service:</span> <span class="string">http://nacos-payment-provider</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderMain83</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(OrderMain83.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationContextConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;service-url.nacos-user-service&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverURL;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/nacos/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(serverURL + <span class="string">&quot;/payment/nacos/&quot;</span> + id, String.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤šæ¬¡è®¿é—®è¯·æ±‚localhost:83/consumer/payment/nacos/1ï¼Œå‘ç°æœåŠ¡ç«¯è½®è¯¢è°ƒç”¨ï¼Œå®ç°äº†è´Ÿè½½å‡è¡¡ã€‚</p><h2 id="æ³¨å†Œä¸­å¿ƒå¯¹æ¯”"><a href="#æ³¨å†Œä¸­å¿ƒå¯¹æ¯”" class="headerlink" title="æ³¨å†Œä¸­å¿ƒå¯¹æ¯”"></a>æ³¨å†Œä¸­å¿ƒå¯¹æ¯”</h2><p>Eurekaï¼šAP</p><p>Zookeeperï¼šCP</p><p>Consulï¼šCP</p><p>Nacosï¼šAP &amp; CPï¼ˆå¯åˆ‡æ¢ï¼‰</p><h2 id="æœåŠ¡é…ç½®ä¸­å¿ƒ"><a href="#æœåŠ¡é…ç½®ä¸­å¿ƒ" class="headerlink" title="æœåŠ¡é…ç½®ä¸­å¿ƒ"></a>æœåŠ¡é…ç½®ä¸­å¿ƒ</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä¸¤ä¸ªç›¸å…³ä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å’Œconfigä¸€æ ·ï¼Œbootstrapä¼˜å…ˆçº§é«˜äºapplicationï¼Œè€Œä½¿ç”¨nacosåï¼Œbootstrapè¯»é…ç½®å¯ä»¥ä»nacosä¸Šè¯»å–ï¼Œä¸ç”¨å»gitè¯»å–ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bootstrap</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3377</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-config-client</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#Nacosä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yml</span> <span class="comment">#æŒ‡å®šymlæ ¼å¼çš„é…ç½®</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># è¡¨ç¤ºå¼€å‘ç¯å¢ƒ</span></span><br><span class="line">    <span class="comment">#active: test # è¡¨ç¤ºæµ‹è¯•ç¯å¢ƒ</span></span><br><span class="line">    <span class="comment">#active: info</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„é…ç½®æ³¨è§£@RefreshScopeï¼ŒåŠ¨æ€æ›´æ–°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span> <span class="comment">//æ”¯æŒNacosçš„åŠ¨æ€åˆ·æ–°åŠŸèƒ½ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigClientController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/config/info&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getConfigInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> configInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®˜æ–¹ï¼š<a href="https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html">https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html</a></p><p>åœ¨ Nacos Spring Cloud ä¸­ï¼Œ<code>dataId</code> çš„å®Œæ•´æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;prefix&#125;-$&#123;spring.profiles.active&#125;.$&#123;file-extension&#125;</span><br></pre></td></tr></table></figure><ul><li><code>prefix</code> é»˜è®¤ä¸º <code>spring.application.name</code> çš„å€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é…ç½®é¡¹ <code>spring.cloud.nacos.config.prefix</code>æ¥é…ç½®ã€‚</li><li><code>spring.profiles.active</code> å³ä¸ºå½“å‰ç¯å¢ƒå¯¹åº”çš„ profileï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒ <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-profiles.html#boot-features-profiles">Spring Bootæ–‡æ¡£</a>ã€‚ <strong>æ³¨æ„ï¼šå½“ <code>spring.profiles.active</code> ä¸ºç©ºæ—¶ï¼Œå¯¹åº”çš„è¿æ¥ç¬¦ <code>-</code> ä¹Ÿå°†ä¸å­˜åœ¨ï¼ŒdataId çš„æ‹¼æ¥æ ¼å¼å˜æˆ <code>$&#123;prefix&#125;.$&#123;file-extension&#125;</code></strong></li><li><code>file-exetension</code> ä¸ºé…ç½®å†…å®¹çš„æ•°æ®æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹ <code>spring.cloud.nacos.config.file-extension</code> æ¥é…ç½®ã€‚ç›®å‰åªæ”¯æŒ <code>properties</code> å’Œ <code>yaml</code> ç±»å‹ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;spring.application.name&#125;</span>-<span class="variable">$&#123;spring.profile.active&#125;</span>.<span class="variable">$&#123;spring.cloud.nacos.config.file-extension&#125;</span></span><br><span class="line"><span class="comment"># æˆ‘ä»¬nacosä¸Šçš„é…ç½®æ–‡ä»¶éœ€è¦æŒ‰ç…§å®˜æ–¹è¦æ±‚ä¹¦å†™ï¼ŒæœåŠ¡å-é…ç½®ç±»å‹-æ–‡ä»¶ç±»å‹</span></span><br><span class="line"><span class="comment"># ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢bootstrapå’Œapplicationçš„å†…å®¹</span></span><br><span class="line">nacos-config-client-dev.yml</span><br><span class="line">nacos-config-client-test.yml</span><br></pre></td></tr></table></figure><p>åœ¨nacosä¸Šdata idè¿›è¡Œå¯¹åº”å£°æ˜ï¼Œå†…å®¹åˆ™æ˜¯yml/propertiesæ ¼å¼é…ç½®ã€‚</p><p>æœ€åèµ°è¯·æ±‚ localhost:3377/config/info å¯è¯»å–é…ç½®æ–‡ä»¶çš„config:info: å†…å®¹ï¼Œä¸”ä¿®æ”¹ç‰ˆæœ¬åä¼šåŠ¨æ€åˆ·æ–°ï¼Œç›¸æ¯”äºconfig + busï¼Œnacosåˆå¿«åˆå¥½ã€‚</p><h2 id="Nacosé…ç½®è¯¦è§£"><a href="#Nacosé…ç½®è¯¦è§£" class="headerlink" title="Nacosé…ç½®è¯¦è§£"></a>Nacosé…ç½®è¯¦è§£</h2><p><strong>Nacosé…ç½®ç”±NameSpace + Group + Data Idæ„æˆï¼Œä¹Ÿå°±æ˜¯é€å±‚åˆ†ç±»ã€‚</strong></p><p>NameSpaceå‘½åç©ºé—´ï¼Œå®ç°ç¯å¢ƒéš”ç¦»ï¼Œå¦‚ç”Ÿäº§ã€æµ‹è¯•ã€å¼€å‘ä¸‰ä¸ªç¯å¢ƒï¼Œå®ƒä»¬ä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚</p><p>Groupï¼Œé»˜è®¤ä¸ºDEFAULT_GROUPï¼ŒGroupå¯å°†ä¸åŒå¾®æœåŠ¡åˆ’åˆ†åˆ°åŒä¸€ä¸ªåˆ†ç»„ä¸­ã€‚</p><p>Data Idä¹Ÿå°±æ˜¯ServiceæœåŠ¡ï¼Œä¸€ä¸ªæœåŠ¡å¯åŒ…å«å¤šä¸ªé›†ç¾¤ã€‚</p><h3 id="Data-Id"><a href="#Data-Id" class="headerlink" title="Data Id"></a>Data Id</h3><p>åˆšåˆšåˆ†æäº†Data Idçš„å®˜æ–¹é…ç½®ï¼š<code>$&#123;prefix&#125;-$&#123;spring.profiles.active&#125;.$&#123;file-extension&#125;</code></p><p>æˆ‘ä»¬é…ç½®æ˜¯å¯¹åº”Data Idåˆ†ä¸ºbootstrap å’Œ applicationä¸¤ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­bootstrapç”¨äºè¯»å–nacosé…ç½®ä¿¡æ¯ï¼Œåç»­ä¸ä¿®æ”¹ï¼Œapplitionè®°å½•é…ç½®ç±»å‹ï¼Œå³ç”Ÿäº§ã€æµ‹è¯•ç­‰ç‰ˆæœ¬ã€‚ä¹Ÿå°±æ˜¯è¦ä¿®æ”¹çš„å•ç‹¬æ”¾ã€‚ä¹‹ååªç”¨æ”¹applicationå°±èƒ½æ¢ç‰ˆæœ¬ï¼Œæ— éœ€æ”¹å˜bootstrapã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># è¡¨ç¤ºå¼€å‘ç¯å¢ƒ</span></span><br><span class="line"><span class="comment">#    active: test # è¡¨ç¤ºæµ‹è¯•ç¯å¢ƒ</span></span><br></pre></td></tr></table></figure><p>nacos-config-client-dev.ymlã€ nacos-config-client-test.ymlï¼Œæ”¹é…ç½®æ–‡ä»¶spring.profiles.activeå±æ€§å³å¯æŒ‡æ˜è¦ä½¿ç”¨çš„ç¯å¢ƒã€‚</p><h3 id="Group"><a href="#Group" class="headerlink" title="Group"></a>Group</h3><table><thead><tr><th>Data Id</th><th>GROUP</th></tr></thead><tbody><tr><td>nacos-config-client-info.yml</td><td>DEV_GROUP</td></tr><tr><td>nacos-config-client-info.yml</td><td>TEST_GROUP</td></tr></tbody></table><p>é…ç½®æœåŠ¡åç›¸åŒï¼Œç»„åˆ†é…çš„ä¸åŒçš„ä¸¤ä¸ªæœåŠ¡ã€‚é€šè¿‡configä¸‹groupåˆ‡æ¢ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">TEST_GROUP</span></span><br></pre></td></tr></table></figure><h3 id="NameSpace"><a href="#NameSpace" class="headerlink" title="NameSpace"></a>NameSpace</h3><p>åœ¨Nacoså‘½åç©ºé—´å¤„å£°æ˜æ–°çš„å‘½åç©ºé—´ï¼Œé»˜è®¤ä¸ºpublicä¿ç•™ç©ºé—´ä¸å¯åˆ é™¤ï¼Œåœ¨configä¸‹namespaceç”Ÿæˆçš„å°†å‘½åç©ºé—´idè¿›è¡Œé…ç½®ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">d52c7eba-1ada-4ed1-8934-69f388dbdbe9</span></span><br></pre></td></tr></table></figure><h2 id="NacosæŒä¹…åŒ–"><a href="#NacosæŒä¹…åŒ–" class="headerlink" title="NacosæŒä¹…åŒ–"></a>NacosæŒä¹…åŒ–</h2><p>å®˜ç½‘é…ç½®ä¿¡æ¯ï¼š<a href="https://nacos.io/zh-cn/docs/deployment.html">https://nacos.io/zh-cn/docs/deployment.html</a></p><p>NacosåŸæœ¬ä½¿ç”¨å†…ç½®æ•°æ®åº“derbyè¿›è¡ŒæŒä¹…åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æŒä¹…åŒ–å­˜å‚¨çš„æ•°æ®åº“è¿›è¡Œé…ç½®ã€‚å°†è„šæœ¬è¡¨åœ¨æœ¬åœ°mysqlä¸­æ„å»ºï¼Œç„¶åé…ç½®nacosçš„applicationã€‚</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.datasource.platform</span>=<span class="string">mysql</span></span><br><span class="line"></span><br><span class="line"><span class="meta">db.num</span>=<span class="string">1</span></span><br><span class="line"><span class="meta">db.url.0</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="meta">db.user.0</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">db.password.0</span>=<span class="string">111111</span></span><br></pre></td></tr></table></figure><h2 id="Nacosé›†ç¾¤"><a href="#Nacosé›†ç¾¤" class="headerlink" title="Nacosé›†ç¾¤"></a>Nacosé›†ç¾¤</h2><p>åˆ‡è®°linuxå¼€å¯nacosé›†ç¾¤ï¼Œåœ¨start.shä¸­è®¾ç½®jvmå¤§å°é™åˆ¶ä»¥å…è¶Šç•Œï¼Œè™šæ‹Ÿæœºå®¹é‡å»ºè®®åˆ†é…å¤šä¸€ç‚¹ã€‚</p><p>nginx + nacosé›†ç¾¤æ¨¡æ‹Ÿï¼Œå°†é›†ç¾¤ipæ˜ å°„åˆ°nginxä¸Šè¿›è¡Œåå‘ä»£ç†ï¼Œå…³äºnginxå’Œnacosçš„ç›¸å…³é…ç½®å°±ä¸èµ˜è¿°äº†ï¼Œèµ„æ–™å¾ˆå¤šã€‚</p><h1 id="Sentinelï¼ˆç†”æ–­-é™çº§-é™æµï¼‰"><a href="#Sentinelï¼ˆç†”æ–­-é™çº§-é™æµï¼‰" class="headerlink" title="Sentinelï¼ˆç†”æ–­ + é™çº§ + é™æµï¼‰"></a>Sentinelï¼ˆç†”æ–­ + é™çº§ + é™æµï¼‰</h1><h2 id="ä¸‹è½½ã€å®‰è£…"><a href="#ä¸‹è½½ã€å®‰è£…" class="headerlink" title="ä¸‹è½½ã€å®‰è£…"></a>ä¸‹è½½ã€å®‰è£…</h2><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://sentinelguard.io/zh-cn/docs/introduction.html">https://sentinelguard.io/zh-cn/docs/introduction.html</a></p><p>ç„¶åæˆ‘ä»¬æŒ‰ç…§å®˜æ–¹æ–‡æ¡£çš„ç‰ˆæœ¬å¯¹åº”ï¼Œcloud2.2.6å¯¹åº”sentinel1.8.1ï¼š<a href="https://github.com/alibaba/Sentinel/releases/tag/1.8.1">https://github.com/alibaba/Sentinel/releases/tag/1.8.1</a></p><p>åœ¨jaråŒ…ç›®å½•ä¸‹æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar sentinel-dashboard-1.8.1.jar</span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—®æœ¬æœº8080ä¾¿æ˜¯å›¾å½¢åŒ–ç•Œé¢ï¼Œè´¦å·å¯†ç éƒ½æ˜¯sentinelã€‚</p><h2 id="ç›‘æ§åˆå§‹åŒ–"><a href="#ç›‘æ§åˆå§‹åŒ–" class="headerlink" title="ç›‘æ§åˆå§‹åŒ–"></a>ç›‘æ§åˆå§‹åŒ–</h2><p>xmlæ–°å¼•å…¥sentinelç›¸å…³ä¾èµ–ï¼Œå’Œnacosæ­é…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--SpringCloud ailibaba sentinel-datasource-nacos åç»­åšæŒä¹…åŒ–ç”¨åˆ°--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--SpringCloud ailibaba sentinel --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8401</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">sentinel-service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span> <span class="comment">#é…ç½®Sentinel dashboardåœ°å€</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8719</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># æ¿€æ´»Sentinelå¯¹Feignçš„æ”¯æŒ</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SentinelMain8401</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SentinelMain8401.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯•ä¸šåŠ¡</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowLimitController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testA&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;------testA&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testB&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;...testB&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;------testB&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Sentinelé‡‡ç”¨æ‡’åŠ è½½æœºåˆ¶ï¼Œæˆ‘ä»¬å¼€å¯æœåŠ¡åä¸ä¼šä¸»åŠ¨ç›‘æµ‹ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡æœåŠ¡è¢«è°ƒç”¨åæ‰ä¼šè¢«ç›‘æ§ã€‚</p><p>æˆ‘ä»¬åœ¨ç°‡ç‚¹é“¾è·¯å¯ä»¥æŸ¥çœ‹æœåŠ¡é“¾æ¥ï¼Œå¹¶å¯¹å®ƒè¿›è¡Œæµæ§ã€é™çº§ã€çƒ­ç‚¹ã€æˆæƒç­‰æ“ä½œã€‚</p><h2 id="æµæ§è§„åˆ™ï¼ˆå•æœºï¼‰"><a href="#æµæ§è§„åˆ™ï¼ˆå•æœºï¼‰" class="headerlink" title="æµæ§è§„åˆ™ï¼ˆå•æœºï¼‰"></a>æµæ§è§„åˆ™ï¼ˆå•æœºï¼‰</h2><ul><li>QPSï¼šæ¯ç§’è¯·æ±‚æ•°ï¼Œå¯è®¾ç½®é˜ˆå€¼<ul><li>æµæ§æ¨¡å¼<ul><li>ç›´æ¥ï¼šapiæ¥å£è¾¾åˆ°é™æµæ¡ä»¶æ—¶ï¼Œè¿›è¡Œé™æµ</li><li>å…³è”ï¼šAå…³è”Bèµ„æºï¼ŒBè¾¾åˆ°é˜ˆå€¼æ—¶ï¼ŒAè‡ªè¡Œé™æµ</li><li>é“¾è·¯ï¼šå±‚çº§é“¾è·¯ï¼Œè®¾ç½®ä¸Šå±‚å…¥å£ç›‘æ§ï¼Œè‹¥å¯¹åº”çš„ä¸‹å±‚èµ„æºè¾¾åˆ°é˜ˆå€¼ï¼Œåˆ™å¯¹å…¥å£è¿›è¡Œé™æµã€‚</li></ul></li><li>æµæ§æ•ˆæœ<ul><li>å¿«é€Ÿå¤±è´¥ï¼šç›´æ¥æŠ¥é”™ï¼ŒBlocked by Sentinel (flow limiting)</li><li>Warm Upï¼šå†·åŠ è½½ã€é¢„çƒ­ï¼Œå®˜æ–¹é»˜è®¤coldFactorä¸º3ï¼Œåˆæ¬¡QPSé˜ˆå€¼ä¸º é˜ˆå€¼/coldFactorï¼Œç„¶åéšç€æ—¶é—´çš„é¢„çƒ­ï¼Œæ…¢æ…¢å°†é˜ˆå€¼æ¢å¤åˆ°è®¾å®šçš„å€¼ã€‚è®©æµé‡é€æ­¥å¢åŠ ï¼Œè€Œä¸æ˜¯ç¬é—´ååº”ã€‚</li><li>æ’é˜Ÿç­‰å¾…ï¼šæ’é˜ŸåŒ€é€Ÿé€šè¿‡ï¼Œè¶…æ—¶åˆ™æ’é˜Ÿï¼Œä¼šè®¾ç½®è¶…æ—¶ç­‰å¾…æ—¶é—´ã€‚</li></ul></li></ul></li></ul><p>ä¸€å¼€å§‹ä½¿ç”¨ç›´æ¥å¤±è´¥çš„é…ç½®ï¼Œå½“å‰ç‚¹å‡»è¶…è¿‡1æ¬¡/sï¼Œsentinelä¼šè‡ªè¡Œé™æµæ§åˆ¶ï¼ˆBlocked by Sentinel (flow limiting)ï¼‰</p><p>ä½¿ç”¨å…³è”æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨Postmanè®¾ç½®å¤šæ¬¡è¯·æ±‚Bï¼Œæ­¤æ—¶æ‰‹åŠ¨è®¿é—®Aå‘ç°è¢«é™æµã€‚</p><ul><li>çº¿ç¨‹æ•°ï¼šæ¯ç§’çº¿ç¨‹å¤„ç†æ•°é‡ï¼Œå¯è®¾é˜ˆå€¼</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testA&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        TimeUnit.MILLISECONDS.sleep(<span class="number">10000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------testA&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è®¾ç½®é˜ˆå€¼ä¸º1ï¼Œè®©ç¬¬ä¸€ä¸ªçº¿ç¨‹è¿›æ¥åç¡10sï¼Œç„¶åä¸æ–­å‘èµ·è¯·æ±‚ï¼Œå‰é¢çš„çº¿ç¨‹ç”±äºç¡çœ å¹¶æ²¡æœ‰å¤„ç†å®Œä¸šåŠ¡ï¼Œç„¶åå½“å‰ç”³è¯·çš„çº¿ç¨‹æ•°è¶…è¿‡é˜ˆå€¼ï¼Œåˆ™ä¼šè¿›è¡Œé™æµã€‚</p><p>çº¿ç¨‹æ•°åªæœ‰æµæ§æ¨¡å¼ï¼Œæ²¡æœ‰æµæ§æ•ˆæœé€‰æ‹©ï¼ˆé»˜è®¤ä¸ºç›´æ¥å¤±è´¥ï¼‰ã€‚</p><h2 id="é™çº§è§„åˆ™"><a href="#é™çº§è§„åˆ™" class="headerlink" title="é™çº§è§„åˆ™"></a>é™çº§è§„åˆ™</h2><p><a href="https://sentinelguard.io/zh-cn/docs/circuit-breaking.html">https://sentinelguard.io/zh-cn/docs/circuit-breaking.html</a></p><ul><li><p>æ…¢è°ƒç”¨æ¯”ä¾‹</p><p>è®¾ç½®RTæœ€å¤§å“åº”æ—¶é—´ï¼Œå½“å‰å“åº”æ—¶é—´å¤§äºè¯¥å€¼ï¼Œåˆ™è®°ä¸ºæ…¢è°ƒç”¨ï¼ŒåŒæ—¶è§„å®šæ—¶é•¿ã€è¯·æ±‚æ•°ã€é˜ˆå€¼æ¯”ä¾‹ã€‚è‹¥åœ¨è§„å®šæ—¶é•¿å†…ï¼Œè¾¾åˆ°è¯·æ±‚æ•°ä¸”æ…¢è°ƒç”¨æ¯”ä¾‹è¶…è¿‡é˜ˆå€¼ï¼Œåˆ™å‘ç”Ÿç†”æ–­ã€‚æ­¤åç»è¿‡ä¸€æ®µç†”æ–­æ—¶é•¿è¿›å…¥half-openåŠå¼€çŠ¶æ€ï¼Œå¹¶æ”¾è¡Œä¸€æ¬¡è¯·æ±‚åšæµ‹è¯•ï¼Œè‹¥å½“å‰å“åº”è¶…è¿‡RTç»§ç»­ç†”æ–­ï¼Œåä¹‹ç»“æŸç†”æ–­ã€‚</p></li><li><p>å¼‚å¸¸æ¯”ä¾‹</p><p>è§„å®šæ—¶é—´å†…ï¼Œè¯·æ±‚è¾¾åˆ°æœ€å°è¯·æ±‚æ•°ï¼Œä¸”å¼‚å¸¸å‘ç”Ÿçš„æ¯”ä¾‹è¶…è¿‡é˜ˆå€¼ï¼Œåˆ™å‘ç”Ÿç†”æ–­ã€‚ç»è¿‡ä¸€æ®µç†”æ–­æ—¶é•¿åè¿›å…¥half-openï¼Œé€šè¿‡æ”¾è¡Œä¸€æ¬¡è¯·æ±‚æ¥åˆ¤æ–­æ˜¯å¦ç»“æŸç†”æ–­ã€‚æ¯”ä¾‹èŒƒå›´0% ~ 100%ã€‚</p></li><li><p>å¼‚å¸¸æ•°</p><p>è§„å®šæ—¶é—´å†…ï¼Œè¯·æ±‚è¾¾åˆ°æœ€å°è¯·æ±‚æ•°ï¼Œä¸”å¼‚å¸¸å‘ç”Ÿæ¬¡æ•°è¶…è¿‡é˜ˆå€¼ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿åè¿›å…¥half-openï¼Œæ”¾è¡Œä¸€æ¬¡è¯·æ±‚åˆ¤æ–­æ˜¯å¦ç»“æŸç†”æ–­ã€‚</p></li></ul><h2 id="çƒ­ç‚¹è§„åˆ™"><a href="#çƒ­ç‚¹è§„åˆ™" class="headerlink" title="çƒ­ç‚¹è§„åˆ™"></a>çƒ­ç‚¹è§„åˆ™</h2><p>çƒ­ç‚¹æœç´¢è®¿é—®é‡å¤§ï¼Œå¯¹çƒ­ç‚¹æ•°æ®è¿›è¡Œé™åˆ¶ã€‚</p><p>controlleræ–°å¢å…œåº•æ–¹æ³•ï¼Œä½¿ç”¨**@SentinelResource<strong>å¯¹åº”Hystrixçš„</strong>@HystrixCommand**ã€‚</p><p><strong>@SentinelResource</strong>åªèƒ½å¤„ç†è¿åæ§åˆ¶å°é…ç½®çš„æƒ…å†µï¼Œå¹¶ä½¿ç”¨å…œåº•æ–¹æ³•å¤„ç†ã€‚å¦‚æœæ˜¯ä»£ç æœ¬èº«æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ï¼Œæ˜¯ä¸ä¼šç”¨å…œåº•æ–¹æ³•å¤„ç†çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testHotKey&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;testHotKey&quot;,blockHandler = &quot;deal_testHotKey&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testHotKey</span><span class="params">(<span class="meta">@RequestParam(value = &quot;p1&quot;,required = false)</span> String p1,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="meta">@RequestParam(value = &quot;p2&quot;,required = false)</span> String p2)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//int age = 10/0;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------testHotKey&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å…œåº•æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">deal_testHotKey</span> <span class="params">(String p1, String p2, BlockException exception)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//sentinelç³»ç»Ÿé»˜è®¤çš„æç¤ºï¼šBlocked by Sentinel (flow limiting)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------deal_testHotKey,o(â•¥ï¹â•¥)o&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è®¾ç½®çƒ­ç‚¹è§„åˆ™ï¼Œèµ„æºåå³@SentinelResourceè®¾ç½®çš„valueï¼Œè®¾ç½®çš„å‚æ•°ç´¢å¼•å¯¹åº”æˆ‘ä»¬æœåŠ¡çš„å‚æ•°ï¼Œä»0å¼€å§‹å¯¹åº”ï¼Œä¹Ÿå°±æ˜¯0å¯¹åº”ç¬¬ä¸€ä¸ªå‚æ•°ã€‚åªè¦å½“æˆ‘ä»¬è¯·æ±‚ä¸­æœ‰è¿™ä¸ªå‚æ•°æ—¶å°±ä¼šèµ°çƒ­ç‚¹ç›‘æ§ã€‚è¶…è¿‡è®¾ç½®çš„é˜ˆå€¼å°±ä¼šèµ°å…œåº•æ–¹æ³•ï¼Œè‹¥æˆ‘ä»¬æ²¡æœ‰å…œåº•æ–¹æ³•åˆ™ç›´æ¥æŠ¥é”™ã€‚</p><p><strong>å‚æ•°ä¾‹å¤–é¡¹ï¼šå½“é…ç½®å‚æ•°æ—¶æŸä¸ªç‰¹æ®Šå€¼æ—¶ï¼Œé˜ˆå€¼ä¼šä¸ä¸€æ ·ï¼Œå¯è‡ªè¡Œç¡®è®¤å€¼çš„ç±»å‹å’Œå€¼ã€‚</strong></p><h2 id="ç³»ç»Ÿè§„åˆ™"><a href="#ç³»ç»Ÿè§„åˆ™" class="headerlink" title="ç³»ç»Ÿè§„åˆ™"></a>ç³»ç»Ÿè§„åˆ™</h2><p><a href="https://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81">https://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81</a></p><p>ç³»ç»Ÿä¿æŠ¤è§„åˆ™æ˜¯ä»åº”ç”¨çº§åˆ«çš„å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œä»å•å°æœºå™¨çš„ loadã€CPU ä½¿ç”¨ç‡ã€å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦ç›‘æ§åº”ç”¨æŒ‡æ ‡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚</p><p>ç›¸å½“äºä¸€ä¸ªå…¨å±€å…¥å£é…ç½®ã€‚</p><h2 id="SentinelResource"><a href="#SentinelResource" class="headerlink" title="@SentinelResource"></a>@SentinelResource</h2><h3 id="blockHandler"><a href="#blockHandler" class="headerlink" title="blockHandler"></a>blockHandler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RateLimitController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/byResource&quot;)</span></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;byResource&quot;, blockHandler = &quot;handleException&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">byResource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">200</span>, <span class="string">&quot;æŒ‰èµ„æºåç§°é™æµæµ‹è¯•OK&quot;</span>, <span class="keyword">new</span> Payment(<span class="number">2020L</span>, <span class="string">&quot;serial001&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">handleException</span><span class="params">(BlockException exception)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">444</span>, exception.getClass().getCanonicalName() + <span class="string">&quot;\t æœåŠ¡ä¸å¯ç”¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/rateLimit/byUrl&quot;)</span></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;byUrl&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">byUrl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">200</span>, <span class="string">&quot;æŒ‰urlé™æµæµ‹è¯•OK&quot;</span>, <span class="keyword">new</span> Payment(<span class="number">2020L</span>, <span class="string">&quot;serial002&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯¹èµ„æºè¿›è¡Œé™æµå¤„ç†æ—¶ï¼Œå¯ä»¥å¯¹@SentinelResourceå£°æ˜çš„valueå¤„ç†ï¼Œé™æµä¼šèµ°è‡ªå®šä¹‰æ–¹æ³•ï¼Œæ²¡æœ‰é…ç½®åˆ™èµ°é»˜è®¤ã€‚æˆ–æ˜¯ç›´æ¥èµ°@GetMappingçš„urlï¼Œé™æµåªä¼šèµ°è‡ªå®šä¹‰çš„æ–¹æ³•ã€‚</p><p>è€Œå…œåº•æ–¹æ³•æ¯æ¬¡éƒ½è¦é…ç½®ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œè§£è€¦æ“ä½œã€‚è®¾ç½®è‡ªå®šä¹‰é™æµå¤„ç†ç±»ï¼šCustomerBlockHandler</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerBlockHandler</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CommonResult <span class="title">handlerException</span><span class="params">(BlockException exception)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">4444</span>, <span class="string">&quot;æŒ‰å®¢æˆ¶è‡ªå®šä¹‰,global handlerException----1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CommonResult <span class="title">handlerException2</span><span class="params">(BlockException exception)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">4444</span>, <span class="string">&quot;æŒ‰å®¢æˆ¶è‡ªå®šä¹‰,global handlerException----2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//controllerè°ƒç”¨å…œåº•æ–¹æ³•å¤„ç†ç±»</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/rateLimit/customerBlockHandler&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;customerBlockHandler&quot;,</span></span><br><span class="line"><span class="meta">        blockHandlerClass = CustomerBlockHandler.class,</span></span><br><span class="line"><span class="meta">        blockHandler = &quot;handlerException2&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CommonResult <span class="title">customerBlockHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">200</span>, <span class="string">&quot;æŒ‰å®¢æˆ¶è‡ªå®šä¹‰&quot;</span>, <span class="keyword">new</span> Payment(<span class="number">2020L</span>, <span class="string">&quot;serial003&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="fallback"><a href="#fallback" class="headerlink" title="fallback"></a>fallback</h3><p>é…é¥°é…ç½®æœåŠ¡9003/9004å’Œæ¶ˆè´¹è€…84ï¼Œæ¶ˆè´¹è€…é…ç½®sentinelã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 9003/9004çš„ä¸šåŠ¡ç±»</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line">    <span class="comment">//æ¨¡æ‹Ÿæ•°æ®åº“</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;Long, Payment&gt; hashMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        hashMap.put(<span class="number">1L</span>, <span class="keyword">new</span> Payment(<span class="number">1L</span>, <span class="string">&quot;28a8c1e3bc2742d8848569891fb42181&quot;</span>));</span><br><span class="line">        hashMap.put(<span class="number">2L</span>, <span class="keyword">new</span> Payment(<span class="number">2L</span>, <span class="string">&quot;bba8c1e3bc2742d8848569891ac32182&quot;</span>));</span><br><span class="line">        hashMap.put(<span class="number">3L</span>, <span class="keyword">new</span> Payment(<span class="number">3L</span>, <span class="string">&quot;6ua8c1e3bc2742d8848569891xt92183&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/paymentSQL/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">paymentSQL</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> </span>&#123;</span><br><span class="line">        Payment payment = hashMap.get(id);</span><br><span class="line">        CommonResult&lt;Payment&gt; result = <span class="keyword">new</span> CommonResult(<span class="number">200</span>, <span class="string">&quot;from mysql,serverPort:  &quot;</span> + serverPort, payment);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CircleBreakerController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SERVICE_URL = <span class="string">&quot;http://nacos-payment-provider&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/consumer/fallback/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;fallback&quot;, blockHandler = &quot;blockHandler&quot;, fallback = &quot;handlerFallback&quot;ï¼Œ exceptionsToIgnore = IllegalArgumentException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">fallback</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> </span>&#123;</span><br><span class="line">        CommonResult&lt;Payment&gt; result = restTemplate.getForObject(SERVICE_URL + <span class="string">&quot;/paymentSQL/&quot;</span> + id, CommonResult.class, id);</span><br><span class="line">        <span class="keyword">if</span> (id == <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;IllegalArgumentException,éæ³•å‚æ•°å¼‚å¸¸....&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (result.getData() == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">&quot;NullPointerException,è¯¥IDæ²¡æœ‰å¯¹åº”è®°å½•,ç©ºæŒ‡é’ˆå¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">handlerFallback</span><span class="params">(<span class="meta">@PathVariable</span> Long id, Throwable e)</span> </span>&#123;</span><br><span class="line">        Payment payment = <span class="keyword">new</span> Payment(id, <span class="string">&quot;null&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult&lt;&gt;(<span class="number">444</span>, <span class="string">&quot;å…œåº•å¼‚å¸¸handlerFallback,exceptionå†…å®¹  &quot;</span> + e.getMessage(), payment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">blockHandler</span><span class="params">(<span class="meta">@PathVariable</span>  Long id, BlockException blockException)</span> </span>&#123;</span><br><span class="line">        Payment payment = <span class="keyword">new</span> Payment(id,<span class="string">&quot;null&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult&lt;&gt;(<span class="number">445</span>,<span class="string">&quot;blockHandler-sentinelé™æµ,æ— æ­¤æµæ°´: blockException  &quot;</span>+blockException.getMessage(),payment);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡ï¼Œå‘ç°ribbonç”Ÿæ•ˆï¼Œé»˜è®¤è½®è¯¢è°ƒç”¨ä¸¤ä¸ªæœåŠ¡ç«¯å£ï¼Œä¸”@SentinelResourceå¯é…ç½®fallback å’Œ blockHandlerã€‚äºŒè€…åŒæ—¶é…ç½®æ—¶ï¼Œå› æ§åˆ¶å°é™æµã€é™çº§æŠ›å‡ºçš„å¼‚å¸¸ä¼˜å…ˆç”±blockHandlerå¤„ç†ã€‚</p><ul><li><p>fallbackå¯è®¾ç½®ä¸šåŠ¡ä»£ç å¼‚å¸¸çš„å…œåº•æ–¹æ³•ã€‚</p></li><li><p>blockHandlerå¯è®¾ç½®æ§åˆ¶å°é…ç½®çš„ç†”æ–­é™çº§å¤„ç†çš„å…œåº•æ–¹æ³•ã€‚</p></li><li><p>exceptionsToIgnoreé…ç½®å¼‚å¸¸è¿›è¡Œè¿‡æ»¤ï¼Œå…œåº•æ–¹æ³•ä¸ä¼šå¤„ç†ã€‚</p></li></ul><h2 id="æ•´åˆOpenFeign"><a href="#æ•´åˆOpenFeign" class="headerlink" title="æ•´åˆOpenFeign"></a>æ•´åˆOpenFeign</h2><p>ä¿®æ”¹84æ¶ˆè´¹è€…çš„é…ç½®ï¼Œæ³¨æ„OpenFeignä¼šä¸devtoolsä¾èµ–å†²çªï¼Œéœ€å»æ‰devtools</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>ä¸»å¯åŠ¨ç±»åŠ ä¸Š@EnableFeignClientsæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;nacos-payment-provider&quot;, fallback = PaymentFallbackService.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PaymentService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/paymentSQL/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function">CommonResult&lt;Payment&gt; <span class="title">paymentSQL</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentFallbackService</span> <span class="keyword">implements</span> <span class="title">PaymentService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">paymentSQL</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult&lt;&gt;(<span class="number">444</span>, <span class="string">&quot;æœåŠ¡é™çº§ï¼ŒPaymentFallbackService&quot;</span>, <span class="keyword">new</span> Payment(id, <span class="string">&quot;errorSerial&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// controllerä½¿ç”¨Feigné…ç½®å…œåº•æ–¹æ³•</span></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/consumer/paymentSQL/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">paymentSQL</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> paymentService.paymentSQL(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨OpenFeigné…ç½®ç†”æ–­çš„å…œåº•æ–¹æ³•ï¼Œæ¥å£å£°æ˜æœåŠ¡ï¼Œå®ç°æ¥å£ä½œä¸ºfallbackä¸ºæœåŠ¡ç†”æ–­åçš„å¤„ç†å…·ä½“å®ç°ã€‚ç„¶ååœ¨controllerä¸­æ— éœ€ä½¿ç”¨restTemplateï¼Œç›´æ¥ä½¿ç”¨æ¥å£çš„ç»„ä»¶è°ƒç”¨æœåŠ¡ã€‚</p><h2 id="SentinelæŒä¹…åŒ–"><a href="#SentinelæŒä¹…åŒ–" class="headerlink" title="SentinelæŒä¹…åŒ–"></a>SentinelæŒä¹…åŒ–</h2><p>æ¯æ¬¡é‡å¯åº”ç”¨ï¼Œè§„åˆ™é…ç½®éƒ½ä¼šé‡ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›è¡ŒæŒä¹…åŒ–æ“ä½œã€‚è¿™é‡Œä½¿ç”¨8401æœåŠ¡æ¨¡æ‹Ÿã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nacosæ•°æ®æºé…ç½®</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">datasource:</span> </span><br><span class="line">        <span class="attr">ds1:</span></span><br><span class="line">          <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">            <span class="attr">dataId:</span> <span class="string">sentinel-service</span></span><br><span class="line">            <span class="attr">groupId:</span> <span class="string">DEFAULT_GROUP</span></span><br><span class="line">            <span class="attr">data-type:</span> <span class="string">json</span></span><br><span class="line">            <span class="attr">rule-type:</span> <span class="string">flow</span></span><br></pre></td></tr></table></figure><p>å®Œæˆä¾èµ–åŠé…ç½®åï¼Œè¿›å…¥Nacosxiæ–°å¢é…ç½®ï¼Œé…ç½®åå³æˆ‘ä»¬çš„æœåŠ¡åsentinel-serviceï¼Œé€‰æ‹©jsonæ•°æ®ç±»å‹è¿›è¡Œä»¥ä¸‹é…ç½®ã€‚ç„¶ååœ¨sentinelä¸­æˆ‘ä»¬å°±ä¼šåŠ è½½è¿™ä¸ªé™æµçš„é…ç½®ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[&#123;</span><br><span class="line">    <span class="attr">&quot;resource&quot;</span>: <span class="string">&quot;/rateLimit/byUrl&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;IimitApp&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;grade&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;count&quot;</span>: <span class="number">1</span>, </span><br><span class="line">    <span class="attr">&quot;strategy&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;controlBehavior&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;clusterMode&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure><ul><li>resourceï¼šèµ„æºåç§°</li><li>limitAppï¼šæ¥æºåº”ç”¨</li><li>gradeï¼šé˜ˆå€¼ç±»å‹ï¼Œ0è¡¨ç¤ºçº¿ç¨‹æ•°, 1è¡¨ç¤ºQPS</li><li>countï¼šå•æœºé˜ˆå€¼</li><li>strategyï¼šæµæ§æ¨¡å¼ï¼Œ0è¡¨ç¤ºç›´æ¥ï¼Œ1è¡¨ç¤ºå…³è”ï¼Œ2è¡¨ç¤ºé“¾è·¯</li><li>controlBehaviorï¼šæµæ§æ•ˆæœï¼Œ0è¡¨ç¤ºå¿«é€Ÿå¤±è´¥ï¼Œ1è¡¨ç¤ºWarm Upï¼Œ2è¡¨ç¤ºæ’é˜Ÿç­‰å¾…</li><li>clusterModeï¼šæ˜¯å¦é›†ç¾¤</li></ul><p>å®ŒæˆæŒä¹…åŒ–é…ç½®åï¼Œæˆ‘ä»¬æ¯æ¬¡è°ƒç”¨æœåŠ¡åï¼Œsentinelä¼šç›‘å¬åˆ°æœåŠ¡ï¼Œå¹¶åŠ è½½Nacosä¸­å¯¹åº”æœåŠ¡çš„æµæ§é…ç½®ã€‚</p><h1 id="Seataï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰"><a href="#Seataï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰" class="headerlink" title="Seataï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰"></a>Seataï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰</h1><p>å®˜ç½‘ï¼š<a href="http://seata.io/zh-cn/docs/overview/what-is-seata.html">http://seata.io/zh-cn/docs/overview/what-is-seata.html</a></p><p>åˆ†å¸ƒå¼äº‹åŠ¡è¦ä¿è¯å…¨å±€æ•°æ®ä¸€è‡´æ€§ã€‚Seataç”±1 + 3ç»„æˆï¼Œå³ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„äº‹åŠ¡ID + TC + TM + RMæ„æˆã€‚</p><ul><li><p>TC (Transaction Coordinator) - äº‹åŠ¡åè°ƒè€…</p><p>ç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œé©±åŠ¨å…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p></li><li><p>TM (Transaction Manager) - äº‹åŠ¡ç®¡ç†å™¨</p><p>å®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼šå¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚</p></li><li><p>RM (Resource Manager) - èµ„æºç®¡ç†å™¨</p><p>ç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸TCäº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Spring-Cloudç®€è¿°&quot;&gt;&lt;a href=&quot;#Spring-Cloudç®€è¿°&quot; class=&quot;headerlink&quot; title=&quot;Spring Cloudç®€è¿°&quot;&gt;&lt;/a&gt;Spring Cloudç®€è¿°&lt;/h1&gt;&lt;p&gt;Spring Cloudå¾®æœåŠ¡æ˜¯ç”±å¤šåŠŸèƒ½æ¨¡å—</summary>
      
    
    
    
    <category term="åç«¯" scheme="http://aidianfirst.com/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>ç§½ç¿¼çš„å°¤æ–¯è’‚å¨…</title>
    <link href="http://aidianfirst.com/2021/10/06/%E7%94%9F%E6%B4%BB/%E7%A7%BD%E7%BF%BC%E7%9A%84%E5%B0%A4%E6%96%AF%E8%92%82%E5%A8%85/"/>
    <id>http://aidianfirst.com/2021/10/06/%E7%94%9F%E6%B4%BB/%E7%A7%BD%E7%BF%BC%E7%9A%84%E5%B0%A4%E6%96%AF%E8%92%82%E5%A8%85/</id>
    <published>2021-10-06T07:15:27.000Z</published>
    <updated>2023-07-30T11:20:17.737Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç§½ç¿¼çš„å°¤æ–¯è’‚å¨…"><a href="#ç§½ç¿¼çš„å°¤æ–¯è’‚å¨…" class="headerlink" title="ç§½ç¿¼çš„å°¤æ–¯è’‚å¨…"></a>ç§½ç¿¼çš„å°¤æ–¯è’‚å¨…</h1><p>å› ä¸ºè‡ªå·±ç©è¿‡ä¸€äº›å‰§æƒ…ä½œï¼Œæ‰€ä»¥æ„Ÿè§‰ç§½ç¿¼åœ¨å‰§æƒ…ä¸Šå¹¶æ²¡æœ‰è®©äººç‰¹åˆ«æƒŠè‰³ï¼Œä½†æ˜¯ç§½ç¿¼åœ¨è§’è‰²åˆ»ç”»ä»¥åŠæ•´ä½“ä¸–ç•Œè§‚çš„æ„å»ºä¸Šè¿˜æ˜¯åšçš„ä¸é”™çš„ã€‚æ‰“å®Œåæœ€ç›´æ¥çš„æ„Ÿå—å°±æ˜¯è¿™æ˜¯ä¸€éƒ¨ä½³ä½œï¼Œé€‚åˆèŒæ–°å…¥å‘ï¼Œç›¸ä¿¡ä¸é‚£ä¹ˆå®Œç¾çš„ç»“å±€å¯¹èŒæ–°æ¥è¯´æ˜¯ä¸€ä¸ªç¾å¥½çš„åˆä½“éªŒï¼ˆç¬‘ï¼‰ï¼Œç‰¹åˆ«æ˜¯ç»“å°¾CVæ”¾å®Œåï¼Œæˆ‘è¿˜ä»¥ä¸ºæœ‰å°¾å£°å‰§æƒ…ï¼Œæ²¡æƒ³åˆ°ç›´æ¥æ¥äº†ä¸ªç»å…¸CGï¼Œåœ¨ä¼¤å£ä¸Šæ’’ç›äº†å±äºæ˜¯ã€‚</p><p>ä¸ªäººæ„Ÿè§‰ç§½ç¿¼åšæˆå…¨å¹´é¾„å‘é£Ÿç”¨æ›´ä½³ã€‚</p><p>æœ€åè´´ä¸€ä¸ªæ¼«é›¨å¤§å¤§çš„æ‚è°ˆï¼Œåˆ†æè¿˜æ˜¯å¾ˆåˆ°ä½çš„ï¼š<a href="https://www.bilibili.com/video/BV174411i73a">https://www.bilibili.com/video/BV174411i73a</a></p><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/huiyi.png" alt="huiyi.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ç§½ç¿¼çš„å°¤æ–¯è’‚å¨…&quot;&gt;&lt;a href=&quot;#ç§½ç¿¼çš„å°¤æ–¯è’‚å¨…&quot; class=&quot;headerlink&quot; title=&quot;ç§½ç¿¼çš„å°¤æ–¯è’‚å¨…&quot;&gt;&lt;/a&gt;ç§½ç¿¼çš„å°¤æ–¯è’‚å¨…&lt;/h1&gt;&lt;p&gt;å› ä¸ºè‡ªå·±ç©è¿‡ä¸€äº›å‰§æƒ…ä½œï¼Œæ‰€ä»¥æ„Ÿè§‰ç§½ç¿¼åœ¨å‰§æƒ…ä¸Šå¹¶æ²¡æœ‰è®©äººç‰¹åˆ«æƒŠè‰³ï¼Œä½†æ˜¯ç§½ç¿¼åœ¨è§’è‰²åˆ»ç”»ä»¥åŠæ•´ä½“ä¸–ç•Œè§‚çš„æ„</summary>
      
    
    
    
    <category term="ç”Ÿæ´»" scheme="http://aidianfirst.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>nginxç®€å•å­¦ä¹ </title>
    <link href="http://aidianfirst.com/2021/10/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/"/>
    <id>http://aidianfirst.com/2021/10/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/</id>
    <published>2021-10-05T03:05:02.000Z</published>
    <updated>2023-07-30T11:20:17.727Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Nginxç½‘ç»œä»£ç†"><a href="#Nginxç½‘ç»œä»£ç†" class="headerlink" title="Nginxç½‘ç»œä»£ç†"></a>Nginxç½‘ç»œä»£ç†</h1><ul><li><p>æ­£å‘ä»£ç†ï¼ˆå®¢æˆ·ç«¯ï¼‰ï¼š</p><p>å³ä»£ç†å®¢æˆ·ç«¯çš„è®¿é—®ï¼ŒVPNå°±æ˜¯å…¸å‹çš„æ­£å‘ä»£ç†ï¼Œæ­£å‘ä»£ç†ä¸­å®¢æˆ·ç«¯æ˜¯çŸ¥é“è¯·æ±‚çš„ç›®æ ‡çš„ï¼Œè€ŒæœåŠ¡å™¨ä¸çŸ¥é“å®¢æˆ·ç«¯æ˜¯é€šè¿‡ä¸­é—´å•†è®¿é—®çš„ï¼Œå®ƒä¼šè®¤ä¸ºæ˜¯VPNçš„èŠ‚ç‚¹åœ¨è®¿é—®ã€‚</p></li><li><p>åå‘ä»£ç†ï¼ˆæœåŠ¡ç«¯ï¼‰ï¼š</p><p>å½“æˆ‘ä»¬è®¿é—®å¤§å‹ç½‘ç«™æ—¶ï¼Œè‚¯å®šä¸æ˜¯æ‰€æœ‰äººéƒ½è®¿é—®ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ¯”å¦‚è®¿é—®ç™¾åº¦ï¼Œæˆ‘ä»¬ä½¿ç”¨å¤–ç½‘è®¿é—®å›ºå®šurlï¼š<code>www.baidu.com</code>ï¼Œè€Œå†…ç½‘ä¼šé€šè¿‡åå‘ä»£ç†ï¼Œå°†è®¿é—®è¯·æ±‚è½¬å‘åˆ°å„åœ°çš„æœåŠ¡å™¨ï¼Œæ˜¯ç”¨æ¥ä»£ç†æœåŠ¡ç«¯çš„è®¿é—®ã€‚</p></li></ul><h1 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h1><p>æ ¹æ®æœåŠ¡å™¨çš„æƒ…å†µè¿›è¡Œåˆ†é…ï¼Œnginxè´Ÿè½½å‡è¡¡æœ‰ä¸¤ç§ç­–ç•¥ï¼šå†…ç½®ç­–ç•¥å’Œæ‰©å±•ç­–ç•¥ã€‚</p><ul><li><p>å†…ç½®ç­–ç•¥</p><ul><li>è½®è¯¢ï¼šå‡è¡¡åˆ†é…ï¼Œä¸€ä¸ªä¸€ä¸ªæ¥</li><li>åŠ æƒè½®è¯¢ï¼šæŒ‰è‡ªå®šä¹‰çš„æƒé‡æ¯”ä¾‹è¿›è¡Œåˆ†é…</li><li>ip hashï¼šå¯¹å®¢æˆ·ç«¯urlè¯·æ±‚çš„ipè¿›è¡Œhashï¼Œç„¶åæ ¹æ®hashç»“æœåˆ†é…ç»™å¯¹åº”çš„æœåŠ¡å™¨ï¼Œå¯è§£å†³sessionä¸å…±äº«çš„é—®é¢˜ã€‚</li></ul></li><li><p>å¤–ç½®ç­–ç•¥ï¼šå³è‡ªè¡Œè®¾ç½®ç®—æ³•åˆ†é…</p></li></ul><h1 id="åŠ¨é™åˆ†ç¦»"><a href="#åŠ¨é™åˆ†ç¦»" class="headerlink" title="åŠ¨é™åˆ†ç¦»"></a>åŠ¨é™åˆ†ç¦»</h1><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/42.png" alt="42.png"></p><p>ç›¸å½“äºnginxå¯¹åå‘ä»£ç†çš„å®é™…åº”ç”¨ï¼Œä½¿ç”¨Nginxå¤„ç†è¯·æ±‚ï¼ŒåŠ¨é™åˆ†ç¦»èŠ‚çœæœåŠ¡å™¨èµ„æºã€‚</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>å®˜ç½‘è‡ªè¡Œä¸‹è½½linuxç‰ˆæœ¬</p><p><a href="http://nginx.org/en/download.html">http://nginx.org/en/download.html</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è§£å‹</span></span><br><span class="line">tar -zxvf &lt;å‹ç¼©åŒ…&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿›å…¥è§£å‹æ–‡ä»¶ï¼Œæ‰§è¡Œé…ç½®è„šæœ¬</span></span><br><span class="line">./configure</span><br><span class="line"><span class="meta">#</span><span class="bash"> è‹¥å‡ºç°nginx errorå¯æ‰§è¡Œ</span></span><br><span class="line">yum -y install pcre-devel</span><br><span class="line">yum -y install openssl openssl-devel</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰§è¡Œå®‰è£…å‘½ä»¤</span></span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h1 id="åŸºç¡€æŒ‡ä»¤"><a href="#åŸºç¡€æŒ‡ä»¤" class="headerlink" title="åŸºç¡€æŒ‡ä»¤"></a>åŸºç¡€æŒ‡ä»¤</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">nginx version: nginx/1.20.1</span><br><span class="line">Usage: nginx [-?hvVtTq] [-s signal] [-p prefix]</span><br><span class="line">             [-e filename] [-c filename] [-g directives]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -?,-h         : this help</span><br><span class="line">  -v            : show version and exit</span><br><span class="line">  -V            : show version and configure options then exit</span><br><span class="line">  -t            : test configuration and exit</span><br><span class="line">  -T            : test configuration, dump it and exit</span><br><span class="line">  -q            : suppress non-error messages during configuration testing</span><br><span class="line">  -s signal     : send signal to a master process: stop, quit, reopen, reload</span><br><span class="line">  -p prefix     : set prefix path (default: /usr/local/nginx/)</span><br><span class="line">  -e filename   : set error log file (default: logs/error.log)</span><br><span class="line">  -c filename   : set configuration file (default: conf/nginx.conf)</span><br><span class="line">  -g directives : set global directives out of configuration file</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Nginxç½‘ç»œä»£ç†&quot;&gt;&lt;a href=&quot;#Nginxç½‘ç»œä»£ç†&quot; class=&quot;headerlink&quot; title=&quot;Nginxç½‘ç»œä»£ç†&quot;&gt;&lt;/a&gt;Nginxç½‘ç»œä»£ç†&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;æ­£å‘ä»£ç†ï¼ˆå®¢æˆ·ç«¯ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;å³ä»£ç†å®¢æˆ·ç«¯çš„è®¿é—®ï¼ŒVPNå°±æ˜¯</summary>
      
    
    
    
    <category term="ä¸­é—´ä»¶" scheme="http://aidianfirst.com/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
    
  </entry>
  
  <entry>
    <title>äº†è§£JVMï¼ˆæ·±å…¥äº†è§£Javaè™šæ‹Ÿæœºæµ…è¯»ï¼‰</title>
    <link href="http://aidianfirst.com/2021/10/02/%E5%90%8E%E7%AB%AF/%E4%BA%86%E8%A7%A3JVM%EF%BC%88%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%B5%85%E8%AF%BB%EF%BC%89/"/>
    <id>http://aidianfirst.com/2021/10/02/%E5%90%8E%E7%AB%AF/%E4%BA%86%E8%A7%A3JVM%EF%BC%88%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%B5%85%E8%AF%BB%EF%BC%89/</id>
    <published>2021-10-02T09:59:30.000Z</published>
    <updated>2023-07-30T11:20:17.735Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2021-12-1 æ›´æ–°è®°å½•</span><br><span class="line">å‘¨å¿—æ˜è€å¸ˆè¿™æœ¬ä¹¦è®²çš„å¤ªæ·±äº†ï¼Œè‡ªå·±ä¸»è¦é’ˆå¯¹å…«è‚¡å¸¸é—®çš„ä¸€äº›ç‚¹è¿›è¡Œäº†é˜…è¯»ç†è§£ï¼Œå‘ç°ç½‘ä¸Šçš„å¥½å¤šæ–‡ç« éƒ½æ˜¯æ¥è‡ªäºæ­¤ğŸ˜‚ï¼Œç›¸å¯¹äºä¸Šæ¬¡èƒŒå…«è‚¡çš„JVMè®°å½•ï¼Œè¿™æ¬¡æµ…è¯»å¯¹è¿™äº›ç‚¹æœ‰äº†ä¸€å®šçš„ç†è§£ï¼Œç¡®å®å¾ˆç»†ï¼Œä»¥åå·¥ä½œäº†å¯ä»¥å†æŠ½ç©ºæ·±æŒ–ä¸€ä¸‹è™šæ‹Ÿæœºçš„å…¶ä»–å†…å®¹ã€‚</span><br></pre></td></tr></table></figure><h1 id="Javaå†…å­˜åŒºåŸŸ"><a href="#Javaå†…å­˜åŒºåŸŸ" class="headerlink" title="Javaå†…å­˜åŒºåŸŸ"></a>Javaå†…å­˜åŒºåŸŸ</h1><h2 id="è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ"><a href="#è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ" class="headerlink" title="è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ"></a>è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ</h2><ul><li>è¿›ç¨‹ä¸­çº¿ç¨‹å…±äº«ï¼š<ul><li>å †</li><li>æ–¹æ³•åŒº</li></ul></li><li>è¿›ç¨‹ä¸­çº¿ç¨‹ç§æœ‰ï¼š<ul><li>ç¨‹åºè®¡æ•°å™¨</li><li>è™šæ‹Ÿæœºæ ˆ</li><li>æœ¬åœ°æ–¹æ³•æ ˆ</li></ul></li></ul><h3 id="ç¨‹åºè®¡æ•°å™¨ï¼ˆä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼‰"><a href="#ç¨‹åºè®¡æ•°å™¨ï¼ˆä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼‰" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨ï¼ˆä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼‰"></a>ç¨‹åºè®¡æ•°å™¨ï¼ˆä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼‰</h3><ul><li>javaæ˜¯ç¼–è¯‘æˆå­—èŠ‚ç è¿è¡Œï¼Œç¨‹åºè®¡æ•°å™¨å¯çœ‹ä½œå½“å‰çº¿ç¨‹æ‰§è¡Œå­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚</li><li>å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œç¨‹åºè®¡æ•°å™¨ç”¨äºè®°å½•å½“å‰çº¿ç¨‹çš„æ‰§è¡Œä½ç½®ï¼Œå½“çº¿ç¨‹åˆ‡æ¢å›æ¥å¯çŸ¥é“çº¿ç¨‹ä¸Šæ¬¡è¿è¡Œçš„ä½ç½®ã€‚</li></ul><p>å„çº¿ç¨‹ä¹‹é—´ç¨‹åºè®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ï¼Œè¿™ä¸€å—å†…å­˜æ˜¯çº¿ç¨‹ç§æœ‰çš„å†…å­˜ã€‚</p><h3 id="è™šæ‹Ÿæœºæ ˆï¼ˆJavaæ–¹æ³•ï¼‰"><a href="#è™šæ‹Ÿæœºæ ˆï¼ˆJavaæ–¹æ³•ï¼‰" class="headerlink" title="è™šæ‹Ÿæœºæ ˆï¼ˆJavaæ–¹æ³•ï¼‰"></a>è™šæ‹Ÿæœºæ ˆï¼ˆJavaæ–¹æ³•ï¼‰</h3><p>ä¸ç¨‹åºè®¡æ•°å™¨ä¸€æ ·ï¼ŒJavaè™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œç”¨äºæè¿°Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼Œæ¯æ¬¡æ–¹æ³•è°ƒç”¨æ•°æ®éƒ½æ˜¯é€šè¿‡æ ˆä¼ é€’ã€‚</p><p>è™šæ‹Ÿæœºæ ˆç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ä¸€æ ·ï¼Œå½“æ–¹æ³•è¢«æ‰§è¡Œæ—¶ï¼ŒJVMä¼šåŒæ­¥åˆ›å»ºä¸€ä¸ª<strong>æ ˆå¸§</strong>ï¼ˆç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ï¼‰ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹å°±ç›¸å½“äºæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆåˆ°å‡ºæ ˆã€‚</p><p>Javaå†…å­˜å¯å¤§è‡´åˆ†ä¸ºå †å†…å­˜å’Œæ ˆå†…å­˜ï¼Œæ ˆæŒ‡çš„æ˜¯è™šæ‹Ÿæœºæ ˆï¼Œæˆ–è€…æ˜¯è™šæ‹Ÿæœºæ ˆçš„å±€éƒ¨å˜é‡è¡¨éƒ¨åˆ†ã€‚</p><p><strong>å±€éƒ¨å˜é‡è¡¨ç”¨äºå­˜æ”¾æ–¹æ³•å‚æ•°å’Œæ–¹æ³•å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡ã€‚å…¶å­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„8ç§åŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡å¼•ç”¨</strong>ï¼ˆreferenceç±»å‹ï¼Œå¹¶ä¸ç­‰äºå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–ä¸æ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®ï¼‰ã€<strong>returnAddressç±»å‹</strong>ï¼ˆæŒ‡å‘äº†ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•é€€å‡ºæ—¶çš„è¿”å›åœ°å€ï¼Œæœ‰æ­£å¸¸è°ƒç”¨é€€å‡ºå’Œå¼‚å¸¸è°ƒç”¨å®Œæˆé€€å‡ºä¸¤ç§æƒ…å†µï¼Œè¯¥å­—èŠ‚ç æ˜¯ä¸ºäº†æ–¹æ³•ç»“æŸæ—¶ï¼Œå°†ç»“æœè¿”å›ä¸Šå±‚è°ƒç”¨è€…ï¼‰ã€‚</p><h3 id="æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNativeæ–¹æ³•ï¼‰"><a href="#æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNativeæ–¹æ³•ï¼‰" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNativeæ–¹æ³•ï¼‰"></a>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNativeæ–¹æ³•ï¼‰</h3><p>ä½œç”¨ä¸è™šæ‹Ÿæœºæ ˆç›¸ä¼¼ï¼Œè™šæ‹Ÿæœºæ ˆä¸ºJVMä½¿ç”¨çš„Javaæ–¹æ³•æœåŠ¡ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸ºJVMä½¿ç”¨çš„Nativeæ–¹æ³•æœåŠ¡ã€‚åŠŸèƒ½å’Œè™šæ‹Ÿæœºæ ˆä¸€è‡´ã€‚</p><h3 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h3><p>JVMå†…å­˜ç®¡ç†ä¸­æœ€å¤§çš„ä¸€å—ï¼Œå †æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚<strong>è¯¥åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰å¯¹è±¡å®ä¾‹åŠæ•°ç»„éƒ½åœ¨è¿™åˆ†é…å†…å­˜ï¼ŒJavaå †æ˜¯åƒåœ¾æ”¶é›†å™¨çš„ä¸»è¦åŒºåŸŸï¼Œä¹Ÿè¢«ç§°ä½œGCå †ã€‚</strong></p><h3 id="æ–¹æ³•åŒº"><a href="#æ–¹æ³•åŒº" class="headerlink" title="æ–¹æ³•åŒº"></a>æ–¹æ³•åŒº</h3><p>ä¸å †ä¸€æ ·ï¼Œæ–¹æ³•åŒºæ˜¯çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå®ƒç”¨äºå­˜å‚¨å·²è¢«JVMåŠ è½½çš„ç±»å‹ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚ä¹Ÿç§°ä½œéå †ã€‚JDK8å‰æ–¹æ³•åŒºå®ç°ä¸ºæ°¸ä¹…ä»£ï¼ŒJDK8åå®ç°ä¸ºå…ƒç©ºé—´ã€‚</p><p><strong>JDK7å°†å­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡ç­‰ç§»è‡³å †ï¼ŒJDK8åç§»é™¤æ°¸ä¹…ä»£ï¼Œè¢«å…ƒç©ºé—´ä»£æ›¿ã€‚</strong></p><h3 id="è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="è¿è¡Œæ—¶å¸¸é‡æ± "></a>è¿è¡Œæ—¶å¸¸é‡æ± </h3><p>è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚</p><p>å­—ç¬¦ä¸²å¸¸é‡æ± åœ¨JDK7åç§»è‡³å †ï¼Œå±äºJVMå¸¸é‡æ± ï¼ŒåŒ…è£…ç±»å¸¸é‡æ± å‡†ç¡®è¯´æ—¶å¯¹è±¡æ± ï¼Œåªæ˜¯ç”¨äº†å¸¸é‡æ± æŠ€æœ¯è€Œå·²ï¼Œå…¶å±äºJavaå±‚é¢ã€‚å¦‚Integerå¸¸é‡æ± æ˜¯ä¸€ä¸ªcacheæ•°ç»„å­˜å‚¨ã€‚</p><h3 id="ç›´æ¥å†…å­˜"><a href="#ç›´æ¥å†…å­˜" class="headerlink" title="ç›´æ¥å†…å­˜"></a>ç›´æ¥å†…å­˜</h3><p>ç›´æ¥å†…å­˜å¹¶éæ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸã€‚</p><h2 id="HotSpot"><a href="#HotSpot" class="headerlink" title="HotSpot"></a>HotSpot</h2><p>JVMç›¸å½“äºä¸€ä¸ªè™šæ‹Ÿæœºè§„èŒƒï¼Œè€ŒHotSpotå°±æ˜¯è§„èŒƒçš„å…·ä½“å®ç°ã€‚ä»¥ä¸‹åŸºäºHotSpotã€‚</p><h3 id="å¯¹è±¡çš„åˆ›å»º"><a href="#å¯¹è±¡çš„åˆ›å»º" class="headerlink" title="å¯¹è±¡çš„åˆ›å»º"></a>å¯¹è±¡çš„åˆ›å»º</h3><ul><li><p>newï¼Œç±»åŠ è½½æ£€æŸ¥</p><p>è™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡newæŒ‡ä»¤æ—¶ï¼Œä¼šæ£€æŸ¥å½“å‰æŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶æ£€æŸ¥è¯¥ç¬¦å·å¼•ç”¨çš„ç±»æ˜¯å¦å·²åŠ è½½ã€‚è‹¥æ²¡æœ‰ï¼Œåˆ™æ‰§è¡Œç›¸åº”çš„ç±»åŠ è½½è¿‡ç¨‹ã€‚</p></li><li><p>åˆ†é…å†…å­˜</p><p>åœ¨ç±»åŠ è½½æ£€æŸ¥åï¼Œè™šæ‹Ÿæœºä¼šä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜ã€‚ç±»åŠ è½½å®Œæˆåå¯ç¡®å®šå¯¹è±¡æ‰€éœ€çš„å†…å­˜å¤§å°ï¼Œæ­¤æ—¶åªéœ€è¦å°†ç¡®å®šå¤§å°çš„å†…å­˜ä»Javaå †ä¸­åˆ’åˆ†å‡ºæ¥ã€‚Javaå †æœ‰ä¸¤ç§åˆ†é…æ–¹å¼ï¼š</p><ul><li><p><strong>æŒ‡é’ˆç¢°æ’</strong></p><p>å†…å­˜ç©ºé—´è§„æ•´ï¼Œå³ä¸€è¾¹æ˜¯ä½¿ç”¨è¿‡çš„å†…å­˜ï¼Œå¦ä¸€è¾¹æ˜¯ç©ºé—²å†…å­˜ï¼ŒæŒ‡é’ˆåªéœ€è¦åœ¨ä¸­é—´æŒªåŠ¨</p></li><li><p><strong>ç©ºé—²åˆ—è¡¨</strong></p><p>å†…å­˜ç©ºé—´åˆ†å¸ƒä¸è§„æ•´ï¼Œå ç”¨å†…å­˜å’Œç©ºé—²å†…å­˜ç›¸äº¤é”™ï¼ŒJVMéœ€è¦ç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨ï¼Œè®°å½•å¯ç”¨çš„å†…å­˜å—ã€‚</p></li></ul><p>åˆ†é…çš„æ–¹æ³•æ˜¯æ ¹æ®å…¶è§„æ•´æƒ…å†µï¼Œä¹Ÿå°±æ˜¯åƒåœ¾æ”¶é›†å™¨æ¥é€‰æ‹©ï¼Œå…¶å›æ”¶ç®—æ³•ä¸åŒï¼Œå¯¼è‡´å†…å­˜ç©ºé—´æƒ…å†µä¸åŒã€‚</p><p>è€Œå¯¹äºå¹¶å‘æƒ…å†µä¸‹çš„å†…å­˜åˆ†é…æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><ul><li>åˆ†é…æ“ä½œåŒæ­¥å¤„ç†ï¼ŒCAS + å¤±è´¥é‡è¯•ä¿è¯æ“ä½œåŸå­æ€§</li><li>æœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†²TLABï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨å †ä¸­é¢„å…ˆåˆ†é…å†…å­˜ï¼Œåœ¨å„è‡ªå†…å­˜è¿›è¡Œæ“ä½œ</li></ul></li><li><p>åˆå§‹åŒ–é›¶å€¼</p><p>å†…å­˜åˆ†é…åï¼Œè™šæ‹Ÿæœºå°†åˆ†é…çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼<strong>ï¼ˆä¸åŒ…æ‹¬å¯¹è±¡å¤´ï¼‰</strong>ï¼Œè¯¥æ“ä½œæ˜¯ä¸ºäº†ä¿è¯å¯¹è±¡çš„å®ä¾‹å­—æ®µå¯ä¸èµ‹åˆå§‹å€¼å°±ç›´æ¥ä½¿ç”¨ï¼Œç¨‹åºåˆ™ä¼šè®¿é—®è¯¥å®ä¾‹å­—æ®µå¯¹åº”ç±»å‹çš„åˆå§‹å€¼ã€‚</p></li><li><p>è®¾ç½®å¯¹è±¡å¤´</p><p>åˆå§‹åŒ–é›¶å€¼åï¼Œè™šæ‹Ÿæœºä¼šå°†å¯¹è±¡çš„ç›¸å…³ä¿¡æ¯å­˜æ”¾åˆ°å¯¹è±¡å¤´ä¸­ï¼Œå¦‚å“ˆå¸Œç ã€GCåˆ†ä»£å¹´é¾„ã€é”ç›¸å…³ä¿¡æ¯ã€ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ç­‰ã€‚</p></li><li><p>æ‰§è¡Œ<code>&lt;init&gt;()</code>æ–¹æ³•ï¼Œæ„é€ å‡½æ•°</p><p>è™šæ‹Ÿæœºå®Œæˆäº†å¯¹è±¡åˆ›å»ºï¼Œä½†å¯¹äºç¨‹åºæ¥è¯´ï¼Œå¯¹è±¡åˆ›å»ºæ‰åˆšå¼€å§‹ï¼Œæ­¤æ—¶æ‰§è¡Œinit()æ–¹æ³•ï¼Œåˆå§‹åŒ–å¯¹è±¡ã€‚newæŒ‡ä»¤åæ¥ç€æ‰§è¡Œ<code>&lt;init&gt;()</code>æ–¹æ³•ã€‚</p></li></ul><h3 id="å¯¹è±¡å†…å­˜å¸ƒå±€"><a href="#å¯¹è±¡å†…å­˜å¸ƒå±€" class="headerlink" title="å¯¹è±¡å†…å­˜å¸ƒå±€"></a>å¯¹è±¡å†…å­˜å¸ƒå±€</h3><p>å¯¹è±¡åœ¨å†…å­˜ä¸­å¸ƒå±€å¯åˆ†ä¸º3å¿«åŒºåŸŸï¼š<strong>å¯¹è±¡å¤´ã€å®ä¾‹æ•°æ®ã€å¯¹é½å¡«å……ã€‚</strong></p><ul><li><p><strong>å¯¹è±¡å¤´ï¼š</strong>åŒ…å«ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼Œä¸€éƒ¨åˆ†<strong>ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«è¿è¡Œæ—¶æ•°æ®</strong>ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯<strong>ç±»å‹æŒ‡é’ˆ</strong>ï¼ˆå¯¹è±¡æŒ‡å‘å…¶ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼‰ï¼Œè™šæ‹Ÿæœºé€šè¿‡è¯¥æŒ‡é’ˆç¡®å®šå¯¹è±¡æ˜¯æŸä¸ªç±»çš„å®ä¾‹ã€‚</p></li><li><p><strong>å®ä¾‹æ•°æ®ï¼šå¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ã€‚</strong></p></li><li><p><strong>å¯¹é½å¡«å……ï¼šä¸æ˜¯å¿…è¦çš„ï¼Œä»…ä»…èµ·å ä½ä½œç”¨ã€‚</strong>ç”±äºHotSpotè™šæ‹Ÿæœºè¦æ±‚å¯¹è±¡å¤§å°å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼Œé€šè¿‡å¯¹é½å¡«å……è¡¥é½ã€‚</p></li></ul><h3 id="å¯¹è±¡çš„è®¿é—®å®šä½"><a href="#å¯¹è±¡çš„è®¿é—®å®šä½" class="headerlink" title="å¯¹è±¡çš„è®¿é—®å®šä½"></a>å¯¹è±¡çš„è®¿é—®å®šä½</h3><p>é€šè¿‡<strong>å¥æŸ„</strong>å’Œ<strong>ç›´æ¥æŒ‡é’ˆ</strong>ä¸¤ç§æ–¹å¼å®ç°è®¿é—®å®šä½ã€‚</p><ul><li><p><strong>å¥æŸ„è®¿é—®</strong></p><p>Javaå †ä¼šåˆ’åˆ†å‡ºå¥æŸ„æ± çš„å†…å­˜ï¼Œreferenceå­˜æ”¾å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡å®ä¾‹æ•°æ®å’Œç±»å‹æ•°æ®çš„å…·ä½“åœ°å€ä¿¡æ¯ã€‚æ ¹æ®æƒ³è®¿é—®çš„ä¿¡æ¯ï¼Œè¿›è¡Œé—´æ¥è®¿é—®ã€‚</p><p>ä¼˜ç‚¹ï¼šreferenceå­˜å‚¨çš„å¥æŸ„åœ°å€ç¨³å®šï¼Œå¯¹è±¡è¢«ç§»åŠ¨æ—¶ï¼Œåªä¼šæ”¹å˜å¥æŸ„ä¸­çš„æŒ‡é’ˆä¿¡æ¯ï¼Œreferenceæœ¬èº«ä¸ä¼šä¿®æ”¹ã€‚</p></li><li><p><strong>ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼ˆHotSpotï¼‰</strong></p><p>referenceå­˜å‚¨çš„æ˜¯å¯¹è±¡åœ°å€ï¼Œæ­¤æ—¶Javaå †ä¸­å¯¹è±¡çš„å†…å­˜å¸ƒå±€éœ€è¦è€ƒè™‘å¦‚ä½•æ”¾ç½®è®¿é—®ç±»å‹æ•°æ®çš„ç›¸å…³ä¿¡æ¯ã€‚å¦‚æœä¹‹è®¿é—®å¯¹è±¡å®ä¾‹ä¿¡æ¯ï¼Œåˆ™æ— éœ€é—´æ¥è®¿é—®çš„å¼€é”€ï¼Œå› ä¸ºå¯¹è±¡å†…å­˜å¸ƒå±€åŒ…å«äº†å¯¹è±¡çš„å®ä¾‹ä¿¡æ¯ã€‚</p><p>ä¼˜ç‚¹ï¼šè®¿é—®é€Ÿåº¦å¿«ï¼ŒèŠ‚çœäº†æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€ã€‚</p></li></ul><p>javaå®ä¾‹æ•°æ®ï¼šå †ï¼ˆå¯¹è±¡å¸ƒå±€ï¼‰</p><p>javaç±»å‹æ•°æ®ï¼šæ–¹æ³•åŒº</p><h1 id="JVMåƒåœ¾å›æ”¶"><a href="#JVMåƒåœ¾å›æ”¶" class="headerlink" title="JVMåƒåœ¾å›æ”¶"></a>JVMåƒåœ¾å›æ”¶</h1><h2 id="å †ç©ºé—´åˆ†é…ä¸åƒåœ¾å›æ”¶"><a href="#å †ç©ºé—´åˆ†é…ä¸åƒåœ¾å›æ”¶" class="headerlink" title="å †ç©ºé—´åˆ†é…ä¸åƒåœ¾å›æ”¶"></a>å †ç©ºé—´åˆ†é…ä¸åƒåœ¾å›æ”¶</h2><p><strong>åŸºæœ¬ç»“æ„</strong></p><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/35.png" alt="35.png"></p><p>æ–°ç”Ÿä»£å†…å­˜ï¼šedenã€from survivor0ï¼ˆs0ï¼‰ã€to survivor1ï¼ˆs1ï¼‰</p><p>è€å¹´ä»£å†…å­˜ï¼šold memory</p><p>Minor GCï¼šæ–°ç”Ÿä»£åƒåœ¾å›æ”¶</p><p>Major GCï¼šè€å¹´ä»£åƒåœ¾å›æ”¶ï¼ŒCMS</p><p>Mixed GCï¼šå¯¹æ•´ä¸ªæ–°ç”Ÿä»£ä¸éƒ¨åˆ†è€å¹´ä»£è¿›è¡Œåƒåœ¾å›æ”¶ï¼ŒG1</p><p>Full GCï¼šæ¸…ç†æ•´ä¸ªJavaå †å’Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†</p><ul><li><p><strong>å¯¹è±¡ä¼šä¼˜å…ˆåœ¨edenåŒºåŸŸåˆ†é…</strong></p></li><li><p><strong>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œå¤§å¯¹è±¡å³å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„Javaå¯¹è±¡ï¼Œå¦‚é•¿å­—ç¬¦ä¸²ï¼Œå…ƒç´ æ•°é‡åºå¤§çš„æ•°ç»„</strong></p></li><li><p><strong>é•¿æœŸå­˜æ´»å¯¹è±¡è¿›å…¥è€å¹´ä»£ï¼ŒJVMä¸ºæ¯ä¸ªå¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡å¹´é¾„è®¡ç®—å™¨ï¼Œå­˜å‚¨åœ¨å¯¹è±¡å¤´ä¸­ï¼Œä¸€èˆ¬å¯¹è±¡åœ¨edenåŒºè¯ç”Ÿï¼Œè‹¥ç»è¿‡ä¸€æ¬¡Minor GCå¹¶è¢«SurvivoråŒºå®¹çº³ï¼Œåˆ™å¹´é¾„+1ï¼Œè¾¾åˆ°ä¸€å®šå€¼ï¼ˆé»˜è®¤15ï¼‰åˆ™æ™‹å‡ä¸ºè€å¹´ä»£ã€‚</strong></p></li></ul><h2 id="å¦‚ä½•åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯å›æ”¶"><a href="#å¦‚ä½•åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯å›æ”¶" class="headerlink" title="å¦‚ä½•åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯å›æ”¶"></a>å¦‚ä½•åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯å›æ”¶</h2><h3 id="å¼•ç”¨è®¡æ•°æ³•"><a href="#å¼•ç”¨è®¡æ•°æ³•" class="headerlink" title="å¼•ç”¨è®¡æ•°æ³•"></a>å¼•ç”¨è®¡æ•°æ³•</h3><p>ç»™å¯¹è±¡æ·»åŠ å¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯æ¬¡å¼•ç”¨+1ï¼Œå¼•ç”¨å¤±æ•ˆ-1ï¼Œè®¡æ•°å™¨=0å³å¯¹è±¡å¯å›æ”¶ã€‚</p><p><strong>ä½†ç”±äºå¯¹è±¡ä¹‹é—´ä¼šäº§ç”Ÿå¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œä¸»æµè™šæ‹Ÿæœºå¹¶æ²¡æœ‰ä½¿ç”¨è¯¥ç®—æ³•è¿›è¡Œå†…å­˜ç®¡ç†ã€‚</strong></p><h3 id="å¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#å¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="å¯è¾¾æ€§åˆ†æç®—æ³•"></a>å¯è¾¾æ€§åˆ†æç®—æ³•</h3><p>é€šè¿‡ä¸€ç³»åˆ—ç§°ä¸ºGC Rootsçš„æ ¹å¯¹è±¡ä½œä¸ºèµ·å§‹èŠ‚ç‚¹é›†ï¼Œæ‰€æœ‰è¯¥èŠ‚ç‚¹å¯è¾¾åˆ°çš„å¯¹è±¡æ˜¯å­˜æ´»çš„ï¼Œä¸å¯è¾¾çš„å¯¹è±¡å¯è¢«å›æ”¶ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/36.png" alt="36.png"></p><p>GC Rootsçš„é€‰å–ä¸€èˆ¬ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ï¼Œå¦‚æ–¹æ³•å‚æ•°ã€å±€éƒ¨å˜é‡ç­‰</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­ï¼ˆNativeæ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li><li>æ‰€æœ‰è¢«åŒæ­¥é”æŒæœ‰çš„å¯¹è±¡</li><li>JVMå†…éƒ¨å¼•ç”¨ï¼Œå¦‚åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„Classå¯¹è±¡</li></ul><p>åœ¨å¯è¾¾æ€§ç®—æ³•ä¸­ï¼Œä¸ºäº†å®Œæˆå¯¹è±¡å›¾çš„éå†ï¼Œå¼•å…¥äº†ä¸‰è‰²æ ‡è®°è¿›è¡Œè¾…åŠ©ï¼š</p><ul><li>ç™½è‰²ï¼šå½“å‰å¯¹è±¡å°šæœªè¢«è®¿é—®ï¼Œæœ€ç»ˆä»ä¸ºç™½è‰²çš„å¯¹è±¡å³ä¸å¯è¾¾çš„</li><li>é»‘è‰²ï¼šå¯¹è±¡åŠå…¶å¼•ç”¨éƒ½è¢«è®¿é—®è¿‡ï¼Œå…¨éƒ¨å­˜æ´»ï¼Œåç»­ä¸ä¼šé‡å¤æ‰«æ</li><li>ç°è‰²ï¼šå½“å‰å¯¹è±¡è¢«è®¿é—®è¿‡ï¼Œä½†å…¶å…³ç³»ä¸Šè‡³å°‘æœ‰ä¸€ä¸ªå¼•ç”¨æœªè¢«æ‰«æ</li></ul><p>åœ¨å¯è¾¾æ€§æ‰«æä¸­å¯èƒ½ä¼šé­é‡å¹¶å‘é—®é¢˜ï¼Œå¯¼è‡´é»‘è‰²å¯¹è±¡æ›´æ”¹åå…³ç³»é“¾ä¸Šå¤šå‡ºäº†ç™½è‰²å¯¹è±¡ï¼Œä¸€èˆ¬æ˜¯æ’å…¥æˆ–åˆ é™¤äº†ä¸€äº›å¼•ç”¨å¯¼è‡´çš„ï¼Œè¿›è€Œå¼•ç”³å‡ºä¸¤ç§è§£å†³æ–¹æ³• <strong>å¢é‡æ›´æ–°</strong> å’Œ <strong>åŸå§‹å¿«ç…§ï¼ˆSATBï¼‰</strong>ï¼Œå®ƒä»¬è§£å†³åŠæ³•éƒ½æ˜¯è®°å½•æ›´æ”¹ï¼Œåç»­é‡æ–°éå†å…³ç³»è¿›è¡Œç¡®è®¤ã€‚</p><h2 id="å››ç§å¼•ç”¨ç±»å‹"><a href="#å››ç§å¼•ç”¨ç±»å‹" class="headerlink" title="å››ç§å¼•ç”¨ç±»å‹"></a>å››ç§å¼•ç”¨ç±»å‹</h2><ul><li><p>å¼ºå¼•ç”¨</p><p><strong>è¢«å¼ºå¼•ç”¨å…³è”çš„å¯¹è±¡ä¸ä¼šå›æ”¶</strong>ã€‚</p><p>ä½¿ç”¨ new å…³é”®å­—æ¥åˆ›å»ºå¼ºå¼•ç”¨ã€‚</p></li><li><p>è½¯å¼•ç”¨</p><p><strong>è½¯å¼•ç”¨å…³è”å¯¹è±¡åªæœ‰åœ¨å†…å­˜ä¸è¶³æ—¶æ‰ä¼šè¢«å›æ”¶</strong>ã€‚</p><p>ä½¿ç”¨ SoftReferenceç±» æ¥åˆ›å»ºè½¯å¼•ç”¨ã€‚</p></li><li><p>å¼±å¼•ç”¨</p><p><strong>å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ä¸€å®šä¼šè¢«å›æ”¶ï¼Œåªèƒ½å­˜æ´»åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶å‘ç”Ÿä¹‹å‰ã€‚</strong></p><p>ä½¿ç”¨ WeakReferenceç±» æ¥åˆ›å»ºè½¯å¼•ç”¨ã€‚</p></li><li><p>è™šå¼•ç”¨</p><p><strong>ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´é€ æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨å¾—åˆ°å¯¹è±¡ã€‚</strong></p><p>ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨çš„å”¯ä¸€ä½œç”¨ï¼Œå°±æ˜¯è¯¥å¯¹è±¡è¢«å›æ”¶æ—¶ä¼šæ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚</p><p>ä½¿ç”¨ PhantomReferenceç±» æ¥åˆ›å»ºè™šå¼•ç”¨ã€‚</p></li></ul><h2 id="åƒåœ¾å›æ”¶ç®—æ³•"><a href="#åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="åƒåœ¾å›æ”¶ç®—æ³•"></a>åƒåœ¾å›æ”¶ç®—æ³•</h2><h3 id="åˆ†ä»£æ”¶é›†"><a href="#åˆ†ä»£æ”¶é›†" class="headerlink" title="åˆ†ä»£æ”¶é›†"></a>åˆ†ä»£æ”¶é›†</h3><p>åƒåœ¾æ”¶é›†ç®—æ³•å¯åˆ’åˆ†ä¸º <code>å¼•ç”¨è®¡æ•°å¼åƒåœ¾æ”¶é›†</code> å’Œ <code>è¿½è¸ªå¼åƒåœ¾æ”¶é›†</code> ä¸¤ç±»ï¼Œä¹Ÿå«åšç›´æ¥ã€é—´æ¥åƒåœ¾æ”¶é›†ï¼Œè€Œæˆ‘ä»¬ä¸»æµJVMä½¿ç”¨çš„ç®—æ³•éƒ½æ˜¯å±äº<code>è¿½è¸ªå¼åƒåœ¾æ”¶é›†</code>ã€‚</p><p>è€Œåƒåœ¾æ”¶é›†å™¨éƒ½æ˜¯ä»¥ <code>åˆ†ä»£æ”¶é›†</code> ç†è®ºä½œä¸ºåŸºç¡€çš„ï¼Œå…¶å»ºç«‹åœ¨å‡ ä¸ªå‡è¯´ä¹‹ä¸Šï¼š</p><ul><li>å¼±åˆ†ä»£å‡è¯´ï¼šå¤§éƒ¨åˆ†å¯¹è±¡éƒ½ä¼šæœç”Ÿå¤•ç­ï¼Œå³åœ¨æ–°ç”Ÿä»£å°±è¢«GCã€‚</li><li>å¼ºåˆ†ä»£å‡è¯´ï¼šå¯¹è±¡æ´»çš„è¶Šä¹…ï¼Œç»å†è¿‡æ›´å¤šæ¬¡çš„GCï¼Œè¯¥å¯¹è±¡å°±åŠŸèƒ½æ¶ˆäº¡ï¼Œä¹Ÿå°±æ˜¯æ™‹å‡ä¸ºè€å¹´ä»£ã€‚</li><li>è·¨ä»£å¼•ç”¨å‡è¯´ï¼šè·¨ä»£å¼•ç”¨ï¼Œå³ä¸¤ä¸ªç›¸äº’ä½œç”¨çš„å¯¹è±¡ï¼Œå…¶æ›´å€¾å‘äºåŒç”ŸåŒç­ï¼Œå¦‚æ–°ç”Ÿä»£å¯¹è±¡ä¸è€å¹´ä»£å¯¹è±¡ç›¸äº’ä½œç”¨ï¼Œé‚£ä¹ˆæ–°ç”Ÿä»£åœ¨GCæ—¶å› ä¸ºå¼•ç”¨å¾—ä»¥å­˜æ´»ï¼Œé€æ¸æ™‹å‡åˆ°è€å¹´ä»£ï¼Œè·¨ä»£å¼•ç”¨æ¶ˆé™¤ã€‚</li></ul><h3 id="æ ‡è®°â€“æ¸…é™¤ï¼ˆå†…å­˜åˆ†é…å¤æ‚ï¼Œè€å¹´ä»£ï¼‰"><a href="#æ ‡è®°â€“æ¸…é™¤ï¼ˆå†…å­˜åˆ†é…å¤æ‚ï¼Œè€å¹´ä»£ï¼‰" class="headerlink" title="æ ‡è®°â€“æ¸…é™¤ï¼ˆå†…å­˜åˆ†é…å¤æ‚ï¼Œè€å¹´ä»£ï¼‰"></a>æ ‡è®°â€“æ¸…é™¤ï¼ˆå†…å­˜åˆ†é…å¤æ‚ï¼Œè€å¹´ä»£ï¼‰</h3><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/37.png" alt="37.png"></p><p>æ ‡è®°æ‰€æœ‰è¦å›æ”¶ï¼ˆä¸è¦å›æ”¶ï¼‰çš„å¯¹è±¡ï¼Œæ ‡è®°å®Œæˆåï¼Œç»Ÿä¸€å›æ”¶æ‰€æœ‰æ ‡è®°ï¼ˆæœªè¢«æ ‡è®°ï¼‰çš„å¯¹è±¡ï¼Œè¯¥ç®—æ³•æ˜¯æœ€åŸºç¡€çš„å›æ”¶ç®—æ³•ï¼Œå…¶ä½™ç®—æ³•éƒ½æ˜¯å¯¹å®ƒçš„æ”¹è¿›ã€‚</p><p>ç¼ºç‚¹ï¼š</p><ul><li>æ ‡è®°==æ¸…é™¤æ‰§è¡Œæ•ˆç‡ä¸ç¨³å®šï¼Œä¼šéšç€å¯¹è±¡æ•°é‡å¢é•¿è€Œé™ä½</li><li>ä¼šå¯¼è‡´å†…å­˜ç©ºé—´ç¢ç‰‡åŒ–</li></ul><h3 id="æ ‡è®°â€“æ•´ç†ï¼ˆå†…å­˜å›æ”¶å¤æ‚ï¼Œè€å¹´ä»£ï¼‰"><a href="#æ ‡è®°â€“æ•´ç†ï¼ˆå†…å­˜å›æ”¶å¤æ‚ï¼Œè€å¹´ä»£ï¼‰" class="headerlink" title="æ ‡è®°â€“æ•´ç†ï¼ˆå†…å­˜å›æ”¶å¤æ‚ï¼Œè€å¹´ä»£ï¼‰"></a>æ ‡è®°â€“æ•´ç†ï¼ˆå†…å­˜å›æ”¶å¤æ‚ï¼Œè€å¹´ä»£ï¼‰</h3><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/38.png" alt="38.png"></p><p>è®©æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡å‘å†…å­˜ç©ºé—´ä¸€ç«¯ç§»åŠ¨ï¼Œéšåæ¸…ç†è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</p><p>ä¼˜ç‚¹ï¼šä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</p><p>ç¼ºç‚¹ï¼šç§»åŠ¨å¤§é‡å¯¹è±¡ï¼Œéœ€è¦æš‚åœç”¨æˆ·åº”ç”¨ç¨‹åºè¿›è¡Œï¼Œæ•ˆç‡ä½</p><h3 id="æ ‡è®°â€“å¤åˆ¶ï¼ˆæ–°ç”Ÿä»£ï¼‰"><a href="#æ ‡è®°â€“å¤åˆ¶ï¼ˆæ–°ç”Ÿä»£ï¼‰" class="headerlink" title="æ ‡è®°â€“å¤åˆ¶ï¼ˆæ–°ç”Ÿä»£ï¼‰"></a>æ ‡è®°â€“å¤åˆ¶ï¼ˆæ–°ç”Ÿä»£ï¼‰</h3><p> <img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/39.png" alt="39.png"></p><p>å°†å†…å­˜åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ï¼Œå½“è¿™ä¸€å—å†…å­˜ä½¿ç”¨å®Œåï¼Œå…ˆå°†å­˜æ´»å¯¹è±¡å…¨éƒ¨å¤åˆ¶åˆ°å¦ä¸€å—ä¸Šï¼Œç„¶åå†å°†è¿™ä¸€å—å†…å­˜æ¸…ç†ã€‚ä¿è¯æœ‰ä¸€åŠçš„åŒºåŸŸå……å½“å¤‡ç”¨ã€‚</p><p>åç»­Andrew Appelè¿›è¡Œä¼˜åŒ–ï¼Œç§°ä½œ Appelå¼å›æ”¶ï¼Œå°†æ–°ç”Ÿä»£åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„Edenç©ºé—´å’Œä¸¤å—è¾ƒå°çš„Survivorç©ºé—´ï¼Œè€Œæ¯æ¬¡çš„å†…å­˜åˆ†é…åªä½¿ç”¨Edenå’Œå…¶ä¸­ä¸€å—Survivorï¼Œå¤åˆ¶ç®—æ³•ä¼šä½“ç°åœ¨ä¸¤ä¸ªSurvivorç©ºé—´ä¸Šï¼Œå½“Survivorç©ºé—´æ²¡æœ‰ç©ºé—²æ—¶ï¼Œå¯¹è±¡å°†æœ‰åˆ†é…æ‹…ä¿æœºåˆ¶è¿›å…¥è€å¹´ä»£ã€‚</p><p>HotSpoté»˜è®¤åˆ†é…Edenå’ŒSurvivorçš„æ¯”ä¾‹æ˜¯8:1:1ï¼Œä¹Ÿå°±æ˜¯è¯´æ–°ç”Ÿä»£å¯ç”¨ç©ºé—´ä¸ºæ€»ç©ºé—´çš„90%ï¼Œåªæµªè´¹äº†10%çš„ç©ºé—´ã€‚</p><p>ç¼ºç‚¹ï¼šå†…å­˜åªèƒ½ä½¿ç”¨éƒ¨åˆ†ï¼Œç©ºé—´æµªè´¹ã€‚</p><h2 id="åƒåœ¾æ”¶é›†å™¨"><a href="#åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="åƒåœ¾æ”¶é›†å™¨"></a>åƒåœ¾æ”¶é›†å™¨</h2><h3 id="åƒåœ¾æ”¶é›†å™¨-1"><a href="#åƒåœ¾æ”¶é›†å™¨-1" class="headerlink" title="åƒåœ¾æ”¶é›†å™¨"></a>åƒåœ¾æ”¶é›†å™¨</h3><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/blog13.jpg" alt="blog13.png"></p><p><strong>æ–°ç”Ÿä»£ï¼ˆæ ‡è®°â€“å¤åˆ¶ï¼‰</strong></p><ul><li><p><strong>Serialæ”¶é›†å™¨ï¼ˆClientï¼Œå•çº¿ç¨‹ï¼‰</strong></p><p>å•çº¿ç¨‹æ”¶é›†å™¨ï¼ŒGCæ—¶ä¼šæš‚åœæ‰€æœ‰å…¶ä»–å·¥ä½œçº¿ç¨‹ï¼Œä½†ç›¸æ¯”å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹æ›´åŠ ç®€å•é«˜æ•ˆï¼Œä¸”å¯¹äºå†…å­˜å—é™çš„ç¯å¢ƒï¼Œå®ƒæ˜¯æ‰€æœ‰æ”¶é›†å™¨é‡Œé¢å¤–å†…å­˜æ¶ˆè€—æœ€å°çš„ï¼Œæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ã€‚</p></li><li><p><strong>ParNewæ”¶é›†å™¨ï¼ˆServerï¼Œå¤šçº¿ç¨‹ï¼‰</strong></p><p><strong>Serialçš„å¤šçº¿ç¨‹ç‰ˆæœ¬</strong>ï¼Œé™¤äº†æ”¯æŒå¤šçº¿ç¨‹å¤–å’ŒSerialä¸€è‡´ï¼Œé™¤äº†Serialå¤–ï¼Œåªæœ‰å®ƒå¯ä»¥å’ŒCMSæ”¶é›†å™¨é…åˆä½¿ç”¨ã€‚</p></li><li><p><strong>Parallel Scavengeæ”¶é›†å™¨ï¼ˆååé‡ä¼˜å…ˆï¼‰</strong></p><p>å¤šçº¿ç¨‹æ”¶é›†å™¨ï¼Œå…¶ä»–æ”¶é›†å™¨åœ¨æ„çš„æ˜¯ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼Œè€Œå®ƒçš„å…³æ³¨ç‚¹æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§çš„ååé‡ï¼Œå³é«˜æ•ˆåˆ©ç”¨CPUæ—¶é—´ã€‚é€‚åˆç”¨äºåå°è¿ç®—ä¸”æ— éœ€å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ã€‚</p></li></ul><p><strong>è€å¹´ä»£ï¼ˆæ ‡è®°â€“æ¸…é™¤ã€æ ‡è®°â€“æ•´ç†ï¼‰</strong></p><ul><li><p><strong>Serial Oldæ”¶é›†å™¨ï¼ˆClientï¼Œå•çº¿ç¨‹ï¼‰</strong></p><p><strong>Serialçš„è€å¹´ä»£ç‰ˆæœ¬</strong>ã€‚ä¸»è¦æœ‰ä¸¤å¤§ä½œç”¨ï¼šä¸€æ˜¯JDK1.5ä»¥å‰ä¸ Parallel Scavenge æ­é…ä½¿ç”¨ï¼ŒäºŒæ˜¯ä½œä¸ºCMSæ”¶é›†å™¨å‘é€å¤±è´¥çš„åå¤‡æ–¹æ¡ˆã€‚</p></li><li><p><strong>Parallel Oldæ”¶é›†å™¨ï¼ˆå¤šçº¿ç¨‹ï¼Œååé‡ï¼‰</strong></p><p><strong>Parallel Scavengeçš„è€å¹´ä»£ç‰ˆæœ¬</strong>ï¼Œæ³¨é‡ååé‡æˆ–CPUèµ„æºæ•æ„Ÿæ—¶ï¼Œå¯è€ƒè™‘ä½¿ç”¨Parallel Scavenge + Parallel Oldã€‚</p></li><li><p><strong>CMSæ”¶é›†å™¨ï¼ˆConcurrent Mark Sweepï¼‰</strong></p><p>CMSçš„MSå³Mark Sweepæ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œæ­¤å¤„å®ç°æ­¥éª¤åˆ†4æ­¥ï¼š</p><ul><li><strong>åˆå§‹æ ‡è®°ï¼š</strong>æ ‡è®°GC Rootsèƒ½ç›´æ¥å…³è”çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¿«ï¼Œéœ€è¦åœé¡¿ã€‚</li><li><strong>å¹¶å‘æ ‡è®°ï¼š</strong>ä»GC Rootsçš„ç›´æ¥å…³è”å¯¹è±¡éå†æ•´ä¸ªå¯¹è±¡å›¾çš„è¿‡ç¨‹ï¼Œåœ¨æ•´ä¸ªå›æ”¶è¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿ï¼Œæ— éœ€åœé¡¿ã€‚</li><li><strong>é‡æ–°æ ‡è®°ï¼š</strong>ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´ï¼Œå› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œï¼Œè¿›è€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œéœ€è¦åœé¡¿ã€‚ä¹Ÿå°±æ˜¯å¯è¾¾æ€§ç®—æ³•å¹¶å‘æƒ…å†µä¸‹å¢é‡æ›´æ–°è§£å†³çš„é—®é¢˜ã€‚</li><li><strong>å¹¶å‘æ¸…é™¤ï¼š</strong>æ¸…ç†æ ‡è®°é˜¶æ®µåˆ¤æ–­ä¸ºå·²æ­»äº¡çš„å¯¹è±¡ï¼Œæ— éœ€åœé¡¿ã€‚</li></ul><p>ä¼˜ç‚¹ï¼šå¹¶å‘æ”¶é›†ï¼Œä½åœé¡¿ã€‚</p><p>ç¼ºç‚¹ï¼š</p><ul><li>ååé‡ä½ï¼ŒCPUåˆ©ç”¨ç‡ä¸é«˜ã€‚</li><li>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼Œå¯å¯ç”¨Serial Oldè¿›è¡Œæ›¿ä»£ã€‚</li><li>æ ‡è®°â€“æ¸…é™¤ç®—æ³•ä¼šäº§ç”Ÿç©ºé—´ç¢ç‰‡ï¼Œä½¿å¾—æ²¡æœ‰å¤§ç©ºé—´æ¥åˆ†é…å¯¹è±¡ï¼Œè¿›è€Œå¯¼è‡´æå‰ä½¿ç”¨Full GCã€‚å¯ä»¥åœ¨å¤šæ¬¡ æ ‡è®°â€“æ¸…é™¤ åæ‰§è¡Œ æ ‡è®°â€“æ•´ç† é¿å…ç©ºé—´æµªè´¹ã€‚</li></ul></li><li><p><strong>G1æ”¶é›†å™¨ï¼ˆserverï¼‰</strong></p><p>G1ä¸åœ¨å±€é™äºåˆ†ä»£ï¼Œå®ƒå¯ä»¥å¤„ç†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œæ˜¯ç‰¹æ®Šçš„Mixed GCã€‚</p><p>G1ä¸åœ¨ä»¥å›ºå®šå¤§å°å’Œå›ºå®šæ•°é‡åˆ’åˆ†åˆ†ä»£ç©ºé—´ï¼Œè€Œæ˜¯å°†è¿ç»­çš„Javaå †åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸åŒçš„<strong>ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰</strong>ï¼Œæ¯ä¸€ä¸ªRegionæ ¹æ®éœ€æ±‚æ‰®æ¼”æ–°ç”Ÿä»£ï¼ˆEdenã€Survivorï¼‰ã€è€å¹´ä»£ã€‚</p><p>è¿ä½œè¿‡ç¨‹ï¼š</p><ul><li><strong>åˆå§‹æ ‡è®°ï¼š</strong>GC Rootsèƒ½ç›´æ¥å…³è”çš„å¯¹è±¡Â·Â·Â·Â·Â·ï¼Œéœ€è¦æš‚åœã€‚</li><li><strong>å¹¶å‘æ ‡è®°ï¼š</strong>ä»GC Rootsè¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œé€’å½’æ•´ä¸ªå¯¹è±¡å›¾</li><li><strong>æœ€ç»ˆæ ‡è®°ï¼š</strong>å¤„ç† åŸå§‹å¿«ç…§SATB é—®é¢˜ã€‚çŸ­æš‚æš‚åœã€‚</li><li><strong>ç­›é€‰å›æ”¶ï¼š</strong>æ›´æ–°Regionï¼Œå¯¹Regionå›æ”¶ä»·å€¼ä¸æˆæœ¬è¿›è¡Œæ’åºï¼Œç„¶åè¿›è¡Œå›æ”¶ã€‚éœ€è¦æš‚åœã€‚</li></ul><p>ç‰¹ç‚¹ï¼š</p><ul><li>ç©ºé—´æ•´åˆï¼šæ•´ä½“åŸºäº æ ‡è®°â€“æ•´ç† å®ç°ï¼Œå±€éƒ¨åŸºäº æ ‡è®°â€“å¤åˆ¶ å®ç°ï¼Œå³è¿è¡Œæ—¶ä¸ä¼šäº§ç”Ÿç©ºé—´ç¢ç‰‡ã€‚</li><li>å¯é¢„æµ‹åœé¡¿ï¼šæŒ‡æ˜ä½¿ç”¨è€…åœ¨æŸé•¿åº¦æ—¶é—´ç‰‡æ®µå†…ï¼ŒGCä¸å¾—è¶…è¿‡ç›¸åº”çš„è§„å®šæ—¶é—´ã€‚</li><li>åˆ†Regionçš„å†…å­˜åˆ†å¸ƒ</li></ul></li></ul><h3 id="ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨"><a href="#ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨" class="headerlink" title="ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨"></a>ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨</h3><ul><li>Shenandoahæ”¶é›†å™¨</li><li>ZGC</li></ul><p>äºŒè€…éƒ½æ˜¯åŸºäºRegionçš„å†…å­˜å¸ƒå±€ï¼ŒZGCæ›´ä¼˜ç§€ï¼Œ<strong>å¯åœ¨ä»»æ„å†…å­˜å¤§å°ä¸‹ï¼Œéƒ½å°†åƒåœ¾æ”¶é›†çš„åœé¡¿æ—¶é—´é™åˆ¶åœ¨10msä»¥å†…çš„ä½å»¶è¿Ÿ</strong>ã€‚</p><h1 id="ç±»åŠ è½½æœºåˆ¶"><a href="#ç±»åŠ è½½æœºåˆ¶" class="headerlink" title="ç±»åŠ è½½æœºåˆ¶"></a>ç±»åŠ è½½æœºåˆ¶</h1><h2 id="ç±»åŠ è½½æ—¶æœº"><a href="#ç±»åŠ è½½æ—¶æœº" class="headerlink" title="ç±»åŠ è½½æ—¶æœº"></a>ç±»åŠ è½½æ—¶æœº</h2><p><strong>åªæœ‰6ç§ä¸»åŠ¨å¼•ç”¨æ‰ä¼šè§¦å‘åˆå§‹åŒ–ï¼Œå…¶ä»–çš„å¼•ç”¨ç±»å‹æ–¹å¼éƒ½ä¸ä¼šè§¦å‘åˆå§‹åŒ–ï¼Œç§°ä¸ºè¢«åŠ¨å¼•ç”¨ã€‚</strong></p><p><strong>ä¸»åŠ¨å¼•ç”¨</strong></p><ul><li>é‡åˆ° <code>new</code>ã€<code>getstatic</code>ã€<code>putstatic</code>ã€<code>invokestatic</code>è¿™å››ä¸ªå­—èŠ‚ç æŒ‡ä»¤æ—¶ï¼Œè‹¥å½“å‰ç±»å‹æ²¡æœ‰åˆå§‹åŒ–åˆ™è§¦å‘å…¶åˆå§‹åŒ–ã€‚<ul><li>ä½¿ç”¨newå®ä¾‹åŒ–å¯¹è±¡</li><li>è¯»å– æˆ– è®¾ç½® ä¸€ä¸ªç±»å‹çš„é™æ€å­—æ®µæ—¶ï¼ˆè¢«finalä¿®é¥°çš„é™æ€å­—æ®µ å’Œ åœ¨ç¼–è¯‘å™¨å°†ç»“æœæ”¾å…¥å¸¸é‡æ± çš„é™æ€å­—æ®µ é™¤å¤–ï¼‰</li><li>è°ƒç”¨ä¸€ä¸ªç±»å‹çš„é™æ€å­—æ®µæ—¶</li></ul></li><li>å¯¹ç±»å‹è¿›è¡Œåå°„è°ƒç”¨æ—¶ï¼Œè¯¥ç±»å‹æ²¡æœ‰åˆå§‹åŒ–ã€‚</li><li>å½“åˆå§‹åŒ–ç±»æ—¶ï¼Œå…¶çˆ¶ç±»æœªåˆå§‹åŒ–ï¼Œåˆ™å…ˆå»åˆå§‹åŒ–è¯¥çˆ¶ç±»ï¼›è€Œæ¥å£åˆå§‹åŒ–æ—¶ï¼Œä¸è¦æ±‚å…¶çˆ¶æ¥å£å…¨éƒ¨åˆå§‹åŒ–ï¼Œåªæœ‰ç”¨åˆ°çˆ¶æ¥å£æ—¶æ‰ä¼šåˆå§‹åŒ–ã€‚</li><li>JVMå¯åŠ¨æ—¶ï¼Œä¼˜å…ˆåˆå§‹åŒ–ä¸»ç±»ï¼ˆå«main()çš„ç±»ï¼‰ã€‚</li><li>ä½¿ç”¨JDK7åŠ å…¥çš„åŠ¨æ€è¯­å¥æ”¯æŒï¼ŒæŸå®ä¾‹è§£æç»“æœä¸ºREF_getStaticã€REF_putStaticã€REF_invokeStaticã€REF_newInvokeSpecialï¼Œè¿™å››ç§ç±»å‹çš„æ–¹æ³•å¥æŸ„ï¼Œä¸”è¯¥æ–¹æ³•å¥æŸ„å¯¹åº”ç±»æœªè¿›è¡Œåˆå§‹åŒ–æ—¶ã€‚</li><li>å½“ä¸€ä¸ªæ¥å£å®šä¹‰äº†JDK8æ–°åŠ å…¥çš„é»˜è®¤æ–¹æ³•ï¼ˆdefaultå…³é”®å­—ä¿®é¥°ï¼‰ï¼Œè‹¥è¯¥æ¥å£çš„å®ç°ç±»å‘ç”Ÿäº†åˆå§‹åŒ–ï¼Œè¯¥æ¥å£è¦åœ¨å…¶ä¹‹å‰è¢«åˆå§‹åŒ–ã€‚</li></ul><p><strong>è¢«åŠ¨å¼•ç”¨ï¼ˆä¸¾ä¾‹ï¼‰</strong></p><ul><li>é€šè¿‡å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å­—æ®µï¼Œä¸ä¼šå¯¼è‡´å­ç±»åˆå§‹åŒ–ã€‚å¯¹äºé™æ€å­—æ®µï¼Œåªæœ‰ç›´æ¥å®šä¹‰è¯¥å­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ–ï¼Œæ‰€ä»¥å½“é™æ€å­—æ®µåœ¨çˆ¶ç±»æ—¶ï¼Œé€šè¿‡å­ç±»å¼•ç”¨è¯¥å­—æ®µï¼Œåªä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚</li><li>é€šè¿‡æ•°ç»„å®šä¹‰æ¥å¼•ç”¨ç±»ï¼Œä¸ä¼šè§¦å‘è¯¥ç±»çš„åˆå§‹åŒ–ã€‚å®šä¹‰ä¸€ä¸ªç±»çš„æ•°ç»„ï¼Œç›´æ¥ç”±è™šæ‹Ÿæœºè‡ªåŠ¨ç”Ÿæˆï¼Œç»§æ‰¿äºObjectï¼Œåˆ›å»ºåŠ¨ä½œç”±å­—èŠ‚ç æŒ‡ä»¤anewarrayè§¦å‘ï¼Œè€Œè¯¥ç±»ä¸ä¼šåˆå§‹åŒ–ã€‚</li><li>å¼•ç”¨ç±»çš„å¸¸é‡ï¼Œï¼ˆstatic finalï¼‰å¸¸é‡åœ¨ç¼–è¯‘é˜¶æ®µä¼šå­˜å…¥è°ƒç”¨ç±»çš„å¸¸é‡æ± ï¼Œæœ¬è´¨ä¸Šæ²¡æœ‰ç›´æ¥å¼•ç”¨åˆ°å®šä¹‰å¸¸é‡çš„ç±»ï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘å¸¸é‡æ‰€å±ç±»çš„åˆå§‹åŒ–ã€‚</li></ul><h2 id="ç±»çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#ç±»çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç±»çš„ç”Ÿå‘½å‘¨æœŸ"></a>ç±»çš„ç”Ÿå‘½å‘¨æœŸ</h2><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/40.png" alt="40.png"></p><ul><li><strong>åŠ è½½</strong></li><li><strong>éªŒè¯</strong></li><li><strong>å‡†å¤‡</strong></li><li><strong>è§£æ</strong></li><li><strong>åˆå§‹åŒ–</strong></li><li>ä½¿ç”¨</li><li>å¸è½½</li></ul><p>å…¶ä¸­éªŒè¯ã€å‡†å¤‡ã€è§£æï¼Œç»Ÿç§°ä¸ºè¿æ¥é˜¶æ®µã€‚</p><h2 id="ç±»åŠ è½½è¿‡ç¨‹"><a href="#ç±»åŠ è½½è¿‡ç¨‹" class="headerlink" title="ç±»åŠ è½½è¿‡ç¨‹"></a>ç±»åŠ è½½è¿‡ç¨‹</h2><p>åŒ…æ‹¬äº†åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–5ä¸ªé˜¶æ®µã€‚</p><h3 id="åŠ è½½"><a href="#åŠ è½½" class="headerlink" title="åŠ è½½"></a>åŠ è½½</h3><p>åœ¨åŠ è½½é˜¶æ®µï¼ŒJVMä¼šå®Œæˆä»¥ä¸‹ä¸‰ä»¶äº‹ï¼š</p><ul><li><p>é€šè¿‡ç±»çš„å…¨é™å®šåæ¥è·å–æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚</p></li><li><p>å°†å­—èŠ‚æµæ‰€ä»£è¡¨çš„ é™æ€å­˜å‚¨ç»“æ„ è½¬æ¢æˆæ–¹æ³•åŒºçš„ è¿è¡Œæ—¶å­˜å‚¨ç»“æ„ã€‚</p></li><li><p>åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºä¸­è¯¥ç±»å„ç§æ•°æ®çš„è®¿é—®å…¥å£ã€‚</p></li></ul><p>ä½†ä»¥ä¸Šä¸‰ç‚¹è¦æ±‚å¹¶ä¸å…·ä½“ï¼Œæœ‰å¾ˆå¤§çš„å‘æŒ¥ç©ºé—´ï¼Œå¦‚æ²¡æœ‰æ˜ç¡®æŒ‡æ˜ä»å“ªé‡Œè·å–ã€å¦‚ä½•è·å–ç­‰ã€‚ç”±æ­¤å¼•ç”³å‡ºäº†ä¸€äº›æŠ€æœ¯ï¼Œå¦‚ZIPå‹ç¼©åŒ…è¯»å–åŠ è½½ï¼Œå³JARã€WARç­‰ï¼›ç½‘ç»œè·å–ï¼›JSPç­‰ã€‚</p><p><strong>éæ•°ç»„ç±»å‹çš„åŠ è½½é˜¶æ®µå¯ä»¥ç”¨ä¸Šè¿°å¤šç§æ–¹å¼è¿›è¡Œï¼Œè€Œæ•°ç»„ç±»æœ¬èº«ä¸æä¾›ç±»åŠ è½½å™¨åˆ›å»ºï¼Œå…¶å…ƒç´ ç±»å‹æœ€ç»ˆè¿˜æ˜¯ç”±ç±»åŠ è½½å™¨å®ŒæˆåŠ è½½ã€‚</strong></p><p>åŠ è½½é˜¶æ®µä¸è¿æ¥é˜¶æ®µçš„éƒ¨åˆ†åŠ¨ä½œæ—¶äº¤å‰è¿›è¡Œçš„ã€‚</p><h3 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h3><p>éªŒè¯é˜¶æ®µå¤§è‡´å¯åˆ†ä¸ºå››æ­¥æ ¡éªŒåŠ¨ä½œï¼š</p><ul><li>æ–‡ä»¶æ ¼å¼éªŒè¯ï¼šå­—èŠ‚æµæ˜¯å¦ç¬¦å·Classæ–‡ä»¶æ ¼å¼è§„èŒƒ</li><li>å…ƒæ•°æ®éªŒè¯ï¼šå¯¹å­—èŠ‚ç æè¿°ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼ˆçˆ¶ç±»ã€æŠ½è±¡ç±»ã€ç»§æ‰¿ã€æ•°æ®ç±»å‹ç­‰ç›¸å…³æ ¡éªŒï¼‰</li><li>å­—èŠ‚ç éªŒè¯ï¼šé€šè¿‡æ•°æ®æµã€æ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯å¦åˆæ³•ï¼Œç¬¦åˆé€»è¾‘ã€‚ï¼ˆå¯¹æ–¹æ³•ä½“æ ¡éªŒï¼‰</li><li>ç¬¦å·å¼•ç”¨éªŒè¯ï¼šè¯¥é˜¶æ®µå®é™…å‘ç”Ÿåœ¨JVMå°†<strong>ç¬¦å·å¼•ç”¨</strong>è½¬åŒ–ä¸º<strong>ç›´æ¥å¼•ç”¨</strong>æ—¶ï¼Œæ˜¯è§£æé˜¶æ®µæ‰å‘ç”Ÿçš„ã€‚ï¼ˆè¯¥ç±»æ˜¯å¦ ç¼ºå°‘ æˆ– è¢«ç¦æ­¢è®¿é—® å®ƒä¾èµ–çš„èµ„æºï¼‰</li></ul><p>éªŒè¯é˜¶æ®µå¯¹äºJVMç±»åŠ è½½æœºåˆ¶æ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªé‡è¦ä½†ä¸æ˜¯å¿…è¦çš„é˜¶æ®µï¼Œå› ä¸ºè¯¥é˜¶æ®µåªæœ‰é€šè¿‡æˆ–ä¸é€šè¿‡çš„å·®åˆ«ï¼Œé€šè¿‡éªŒè¯å¯¹åç»­ç¨‹åºè¿è¡Œæ— å½±å“ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬çš„ç¨‹åºè¢«åå¤ä½¿ç”¨å’ŒéªŒè¯åï¼Œå¯åœ¨ç”Ÿäº§ç¯å¢ƒçš„å®æ–½é˜¶æ®µå…³é—­å¤§éƒ¨åˆ†çš„ç±»éªŒè¯æªæ–½ï¼ˆ-Xverify:noneï¼‰ï¼Œç¼©çŸ­JVMåŠ è½½çš„æ—¶é—´ã€‚</p><h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><p>ä¸ºç±»ä¸­å®šä¹‰çš„<strong>é™æ€å˜é‡</strong>åˆ†é…å†…å­˜å¹¶è®¾ç½®<strong>ç±»å˜é‡åˆå§‹å€¼</strong>çš„é˜¶æ®µï¼Œè¿™äº›å˜é‡å†…å­˜ç†è®ºä¸Šåº”åœ¨æ–¹æ³•åŒºåˆ†é…ã€‚è€Œé€»è¾‘ä¸Šçš„æ–¹æ³•åŒºæœ‰å…·ä½“çš„å®ç°ï¼ŒJDK7ä¹‹å‰ï¼Œæ˜¯æ°¸ä¹…ä»£å®ç°æ–¹æ³•åŒºï¼Œå˜é‡åˆ†é…åœ¨æ–¹æ³•åŒºä¸Šï¼›è€ŒJDK7å<strong>ç±»å˜é‡</strong>è¿ç§»åˆ°Javaå †ä¸­è¿›è¡Œåˆ†é…ã€‚</p><p>å½“ç„¶å‡†å¤‡é˜¶æ®µè¿›è¡Œå†…å­˜åˆ†é…çš„ä»…ä»…æ˜¯ç±»å˜é‡ï¼Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ï¼Œå®ä¾‹å˜é‡æ˜¯éšç€å¯¹è±¡å®ä¾‹åŒ–å’Œå¯¹è±¡ä¸€èµ·åˆ†é…åˆ°Javaå †ä¸­ã€‚</p><p>è®¾ç½®ç±»å˜é‡åˆå§‹å€¼ä¹Ÿåˆ†æƒ…å†µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> value = <span class="number">111</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> value = <span class="number">111</span>;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ç§valueåœ¨å‡†å¤‡é˜¶æ®µè®¾ç½®åˆå€¼=0ï¼Œè€Œä¸æ˜¯111ï¼Œå› ä¸ºæ­¤æ—¶å¹¶æœªæ‰§è¡ŒJavaæ–¹æ³•ï¼Œåªæœ‰valueèµ‹å€¼111çš„å¯¹åº”putstaticæŒ‡ä»¤è¢«ç¼–è¯‘åï¼Œæ‰ä¼šè¢«å¤åˆ¶ï¼Œä¹Ÿå°±æ˜¯åˆ°åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šèµ‹å€¼111ã€‚</p><p>å½“ç„¶ä¹Ÿæœ‰ä¾‹å¤–ï¼Œå¦‚æœç±»å­—æ®µçš„å­—æ®µå±æ€§è¡¨å­˜åœ¨ConstantValueå±æ€§ï¼Œå‡†å¤‡é˜¶æ®µå°±ä¼šåˆå§‹æˆè¯¥å€¼ã€‚è¢«finalä¿®é¥°çš„ç±»å˜é‡ï¼Œåœ¨ç¼–è¯‘æ—¶ä¼šç”ŸæˆConstantValueå±æ€§ï¼Œåœ¨å‡†å¤‡é˜¶æ®µJVMæ ¹æ®è¯¥å±æ€§èµ‹å€¼value=111ã€‚</p><h3 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h3><p>JVMå°†å¸¸é‡æ± <strong>ç¬¦å·å¼•ç”¨</strong>æ›¿æ¢æˆ<strong>ç›´æ¥å¼•ç”¨</strong>çš„è¿‡ç¨‹ã€‚</p><ul><li><p>ç¬¦å·å¼•ç”¨ï¼šä»¥ä¸€ç»„ç¬¦å·æè¿°å¼•ç”¨çš„ç›®æ ‡ï¼Œå¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ã€‚ä¸JVMå†…å­˜å¸ƒå±€æ— å…³ï¼Œå„è‡ªJVMå®ç°å†…å­˜å¸ƒå±€ä¸ç›¸åŒï¼Œä½†å®ƒä»¬æ¥å—ç¬¦å·å¼•ç”¨å¿…é¡»ä¸€è‡´ã€‚<strong>ï¼ˆå­—ç¬¦ä¸²ï¼‰</strong></p><p>ç¬¦å·å¼•ç”¨é€šå¸¸æŒ‡ä»£å…¨é™å®šåã€åŒ…åã€å­—æ®µå’Œæ–¹æ³•çš„åç§°ä¸æè¿°ç¬¦ã€‚</p></li><li><p>ç›´æ¥å¼•ç”¨ï¼šå¯ä»¥æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–ä¸€ä¸ªé—´æ¥å®šä½ç›®æ ‡çš„å¥æŸ„ã€‚ä¸JVMå†…å­˜å¸ƒå±€ç›´æ¥ç›¸å…³ï¼Œæœ‰äº†ç›´æ¥å¼•ç”¨ï¼Œè¯¥å¼•ç”¨çš„ç›®æ ‡å¿…å®šå­˜åœ¨äºJVMå†…å­˜ä¸­ã€‚<strong>ï¼ˆå†…å­˜åœ°å€ï¼‰</strong></p></li></ul><p>ä¹Ÿå°±æ˜¯è¯´å°†åŒ…åã€å…¨é™å®šåè¿™ç§å­—ç¬¦ä¸²è¡¨ç¤ºé‡è½¬æ¢æˆç›¸åº”çš„å†…å­˜åœ°å€ã€‚</p><h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p>åˆå§‹åŒ–é˜¶æ®µæ‰æ˜¯çœŸæ­£å¼€å§‹æ‰§è¡Œç±»ä¸­å®šä¹‰çš„Javaä»£ç ï¼Œè¿›è¡Œå‡†å¤‡é˜¶æ®µæ—¶ï¼Œå˜é‡å·²ç»è®¾ç½®äº†åˆå€¼ï¼Œåˆ°äº†åˆå§‹åŒ–é˜¶æ®µï¼Œä¼šæ ¹æ®ç¨‹åºç¼–ç å»åˆå§‹åŒ–ç±»å˜é‡å’Œèµ„æºã€‚<strong>åˆå§‹åŒ–é˜¶æ®µå°±æ˜¯æ‰§è¡Œç±»æ„é€ å™¨ <code>&lt;clinit&gt;()</code> æ–¹æ³•çš„è¿‡ç¨‹ã€‚</strong></p><p><code>&lt;clinit&gt;()</code> æ–¹æ³•æ˜¯ ç±»å˜é‡ + é™æ€è¯­å¥å—ã€‚</p><h2 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a>ç±»åŠ è½½å™¨</h2><p>ç±»åŠ è½½é˜¶æ®µä¸­ â€œé€šè¿‡ç±»å…¨é™å®šåè·å–è¯¥ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµâ€ï¼ŒJVMçš„è®¾è®¡å›¢é˜Ÿå¸Œæœ›è¿™ä¸ªåŠ¨ä½œå¯ä»¥æ”¾åˆ°JVMå¤–éƒ¨å»å®ç°ï¼Œä¹Ÿå°±æ˜¯è®©ç¨‹åºè‡ªè¡Œå†³å®šå¦‚ä½•å»è·å–æ‰€éœ€è¦çš„ç±»ã€‚ç±»åŠ è½½å™¨åªç”¨äºå®ç°ç±»çš„åŠ è½½åŠ¨ä½œï¼Œå¯ç¡®å®šç±»åœ¨JVMä¸­çš„å”¯ä¸€æ€§ï¼Œä¸”æ¯ä¸€ä¸ªç±»åŠ è½½å™¨æœ‰ç‹¬ç«‹çš„ç±»åç§°ç©ºé—´ã€‚</p><p>å¯ä»¥æ¯”è¾ƒä¸¤ä¸ªç±»æ˜¯å¦ â€œç›¸ç­‰â€ï¼Œåªæœ‰ä¸¤ä¸ªç±»æ˜¯åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„å‰æä¸‹æ‰ç›¸ç­‰ã€‚å³ä½¿ä¸¤ä¸ªç±»æ¥è‡ªåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªJVMåŠ è½½ï¼Œåªè¦å®ƒä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œè¿™ä¸¤ä¸ªç±»å°±ä¸ç›¸ç­‰ã€‚</p><p>å¯¹äºJVMæ¥è¯´ï¼Œåªå­˜åœ¨ä¸¤ç§ç±»åŠ è½½å™¨ï¼Œå¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆC++å®ç°ï¼Œæ˜¯JVMçš„ä¸€éƒ¨åˆ†ï¼‰ å’Œ å…¶ä»–æ‰€æœ‰çš„ç±»åŠ è½½å™¨ï¼ˆè¿™äº›æ˜¯ç”±Javaå®ç°çš„ï¼Œç‹¬ç«‹å­˜åœ¨äºJVMå¤–éƒ¨ï¼‰ã€‚</p><p>Javaä¸€è‡´ä¿æŒä¸‰å±‚ç±»åŠ è½½å™¨ã€åŒäº²å§”æ´¾çš„ç±»åŠ è½½ç»“æ„ã€‚</p><h3 id="ä¸‰å±‚ç±»åŠ è½½å™¨-åŒäº²å§”æ´¾æ¨¡å‹"><a href="#ä¸‰å±‚ç±»åŠ è½½å™¨-åŒäº²å§”æ´¾æ¨¡å‹" class="headerlink" title="ä¸‰å±‚ç±»åŠ è½½å™¨ + åŒäº²å§”æ´¾æ¨¡å‹"></a>ä¸‰å±‚ç±»åŠ è½½å™¨ + åŒäº²å§”æ´¾æ¨¡å‹</h3><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/41.png" alt="41.png"></p><ul><li><p>å¯åŠ¨ç±»åŠ è½½å™¨ï¼š</p><p>è´Ÿè´£åŠ è½½ <code>&lt;JAVA_HOME&gt;\lib</code> ç›®å½•ä¸‹ æˆ– -Xbootclasspathå‚æ•°æŒ‡å®šè·¯å¾„ çš„ç±»åº“ï¼ˆè¿˜å¿…é¡»æ—¶JVMå¯ä»¥è¯†åˆ«çš„ç±»åº“ï¼Œåå­—ä¸ç¬¦çš„ç±»åº“å³ä½¿è·¯å¾„æ­£ç¡®ä¹Ÿä¸ä¼šåŠ è½½ï¼‰ã€‚å¯åŠ¨ç±»åŠ è½½å™¨æ— æ³•è¢«Javaç¨‹åºç›´æ¥å¼•ç”¨ï¼Œç”¨æˆ·ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¯å°†åŠ è½½è¯·æ±‚å§”æ´¾ç»™å¯åŠ¨ç±»åŠ è½½å™¨å¤„ç†ã€‚</p></li><li><p>æ‰©å±•ç±»åŠ è½½å™¨ï¼š</p><p>è´Ÿè´£åŠ è½½ <code>&lt;JAVA_HOME&gt;\lib\ext</code> ç›®å½•ä¸‹ æˆ– java.ext.dirsç³»ç»Ÿå˜é‡æŒ‡å®šè·¯å¾„ çš„æ‰€æœ‰ç±»åº“ã€‚æ˜¯Javaç³»ç»Ÿç±»åº“çš„æ‰©å±•æœºåˆ¶ï¼Œå¯è‡ªè¡Œæ·»åŠ åˆ°extç›®å½•ä¸‹æ‰©å±•Java SEåŠŸèƒ½ã€‚</p></li><li><p>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨</p><p>åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆClassPathï¼‰ä¸Šçš„å…¨éƒ¨ç±»åº“ï¼Œå¦‚æœç¨‹åºä¸­æ²¡æœ‰è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå°±æ˜¯é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚</p></li><li><p>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</p><p>å¯è‡ªå®šä¹‰æ‹“å±•ï¼Œå¦‚å¢åŠ é™¤ç£ç›˜ä½ç½®å¤–çš„Classæ–‡ä»¶æ¥æºã€‚</p></li></ul><p><strong>å„ç§ç±»åŠ è½½å™¨ä¹‹é—´çš„å±‚æ¬¡å…³ç³»è¢«ç§°ä¸ºç±»åŠ è½½å™¨çš„ â€œåŒäº²å§”æ´¾æ¨¡å‹â€ã€‚</strong></p><p>åŒäº²å§”æ´¾æ¨¡å‹è¦æ±‚é™¤é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½è¦æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ã€‚è¿™é‡Œçˆ¶å­å…³ç³»é€šè¿‡ç»„åˆå…³ç³»å®ç°ï¼Œè€Œéç»§æ‰¿å…³ç³»ã€‚</p><ul><li><p>å·¥ä½œæµç¨‹</p><p>ä¸€ä¸ªç±»åŠ è½½å™¨é¦–å…ˆå°†ç±»åŠ è½½è¯·æ±‚å§”æ´¾ç»™çˆ¶åŠ è½½å™¨å®Œæˆï¼Œæ¯ä¸ªå±‚æ¬¡çš„ç±»åŠ è½½å™¨éƒ½æ˜¯å¦‚æ­¤ï¼Œæœ€ç»ˆæ‰€æœ‰çš„åŠ è½½è¯·æ±‚éƒ½ä¼šä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨æ— æ³•å®ŒæˆåŠ è½½è¯·æ±‚æ—¶ï¼ˆå…¶æœç´¢èŒƒå›´å†…æ²¡æœ‰éœ€è¦çš„ç±»ï¼‰ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªè¡ŒåŠ è½½ã€‚</p></li><li><p>ä¼˜ç‚¹</p><p>åŒäº²å§”æ´¾è®©ç±»åŠ è½½å™¨ä¹‹é—´å…·æœ‰ä¼˜å…ˆçº§çš„å±‚çº§å…³ç³»ï¼Œä½¿å¾—JavaåŸºç¡€ç±»ç¨³å®šè¿è¡Œï¼Œé¿å…ç±»é‡å¤åŠ è½½ã€‚</p><p>ç”±äºæœ€ç»ˆéƒ½æ˜¯å§”æ´¾ç»™å¯åŠ¨ç±»åŠ è½½å™¨ç±»è¿›è¡ŒåŠ è½½ï¼Œå› æ­¤Objectç±»åœ¨ç¨‹åºçš„å„ç§ç±»åŠ è½½å™¨ä¸­éƒ½èƒ½ä¿è¯æ˜¯åŒä¸€ä¸ªç±»ï¼Œè€Œæ²¡æœ‰åŒäº²å§”æ´¾æ¨¡å‹ï¼Œä»»ç”±å„ä¸ªç±»åŠ è½½å™¨è‡ªè¡ŒåŠ è½½ï¼Œæˆ‘ä»¬è‡ªè¡Œç¼–å†™ä¸€ä¸ªObjectç±»æ”¾åˆ°ClassPathä¸­ï¼Œç³»ç»Ÿä¸­å°±ä¼šå‡ºç°å¤šä¸ªä¸åŒçš„Objectç±»ï¼Œå¯¼è‡´Javaä½“ç³»çš„åŸºç¡€æ— ä»ä¿è¯ã€‚</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;</summary>
      
    
    
    
    <category term="åç«¯" scheme="http://aidianfirst.com/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Javaå…«è‚¡æ–‡-å®¹å™¨</title>
    <link href="http://aidianfirst.com/2021/09/30/%E5%85%AB%E8%82%A1/Java%E5%85%AB%E8%82%A1%E6%96%87-%E5%AE%B9%E5%99%A8/"/>
    <id>http://aidianfirst.com/2021/09/30/%E5%85%AB%E8%82%A1/Java%E5%85%AB%E8%82%A1%E6%96%87-%E5%AE%B9%E5%99%A8/</id>
    <published>2021-09-30T10:02:03.000Z</published>
    <updated>2023-07-30T11:20:17.727Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å®¹å™¨å¯¹æ¯”"><a href="#å®¹å™¨å¯¹æ¯”" class="headerlink" title="å®¹å™¨å¯¹æ¯”"></a>å®¹å™¨å¯¹æ¯”</h1><h2 id="é›†åˆæ¡†æ¶ç®€è¿°"><a href="#é›†åˆæ¡†æ¶ç®€è¿°" class="headerlink" title="é›†åˆæ¡†æ¶ç®€è¿°"></a>é›†åˆæ¡†æ¶ç®€è¿°</h2><ul><li>Collection<ul><li>Listï¼šæœ‰åºï¼Œå¯é‡å¤ã€‚ArrayListã€LinkedList</li><li>Setï¼šæ— åºï¼Œæ— é‡å¤ã€‚HashSetã€TreeSet</li><li>Queueï¼ˆDequeï¼‰ï¼šé˜Ÿåˆ—ï¼Œæœ‰åºï¼Œå¯é‡å¤ã€‚LinkedListã€PriorityQueue</li></ul></li><li>Mapï¼šé”®å€¼å¯¹key-valueå­˜å‚¨ï¼Œä¸€ä¸ªé”®å¯¹åº”ä¸€ä¸ªå€¼ã€‚HashMapã€TreeMapã€HashTableã€ConcurrentHashMap</li></ul><h2 id="ArrayListä¸LinkedListçš„åŒºåˆ«"><a href="#ArrayListä¸LinkedListçš„åŒºåˆ«" class="headerlink" title="ArrayListä¸LinkedListçš„åŒºåˆ«"></a>ArrayListä¸LinkedListçš„åŒºåˆ«</h2><ul><li><p><strong>çº¿ç¨‹å®‰å…¨ï¼š</strong>äºŒè€…éƒ½ä¸ä¿è¯çº¿ç¨‹å®‰å…¨ï¼ŒVectorå¯ä»¥å®ç°çº¿ç¨‹å®‰å…¨ã€‚</p></li><li><p><strong>åº•å±‚æ•°æ®ç»“æ„ï¼š</strong></p><p>ArrayListå¯¹åº”æ•°ç»„ã€‚</p><p>LinkedListå¯¹åº”åŒå‘é“¾è¡¨ï¼Œæ¯ä¸ªç»“ç‚¹æœ‰å‰é©±åç»§ä¸¤ä¸ªæŒ‡é’ˆã€‚</p></li><li><p>æŸ¥æ‰¾æ“ä½œå¤šä½¿ç”¨ArrayListï¼Œæ’å…¥ã€åˆ é™¤æ“ä½œå¤šä½¿ç”¨LinkedListã€‚</p></li><li><p><strong>å†…å­˜ç©ºé—´å ç”¨ï¼š</strong></p><p>ArrayListç”±äºæ˜¯æ•°ç»„å®ç°ï¼Œä¼šé¢„ç•™ä¸€å®šå®¹é‡ç©ºé—´ã€‚æ•´ä½“ç©ºé—´å æ¯”é«˜ã€‚</p><p>LinkedListæ¯ä¸€ä¸ªå…ƒç´ ç©ºé—´å æ¯”æ›´é«˜ï¼Œå› ä¸ºæœ‰å‰é©±åç»§ä¸¤ä¸ªæŒ‡é’ˆã€‚</p></li><li><p><strong>å®ç°RandomAccessæ¥å£</strong></p><p>ç”±äºArrayListå…·æœ‰å¿«é€Ÿéšæœºè®¿é—®çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å®ƒå®ç°äº†RandomAccessæ¥å£ï¼Œä½†RandomAccessæ¥å£æ˜¯æ²¡æœ‰å†…å®¹å®šä¹‰çš„ï¼Œä»…ä»…æ˜¯ä¸€ä¸ªæ ‡è¯†ï¼Œä»£è¡¨å¯ä»¥å¿«é€Ÿéšæœºè®¿é—®ï¼Œç›¸å¯¹çš„LinkedListæ²¡æœ‰å®ç°æ¥å£ï¼Œå› ä¸ºå…¶æœ¬èº«å°±ä¸å…·æœ‰å¿«é€Ÿéšæœºè®¿é—®çš„åŠŸèƒ½ï¼Œæ‰€ä»¥æ²¡æœ‰è¿™ä¸ªæ ‡è¯†ã€‚</p><p>RandomAccessä»…ä»…åªæ˜¯ä¸€ä¸ªæ ‡è¯†ï¼Œå¹¶ä¸æ˜¯è¯´å®ç°è¿™ä¸ªæ¥å£å°±å…·æœ‰å¿«é€Ÿéšæœºè®¿é—®åŠŸèƒ½ã€‚</p></li></ul><h2 id="HashMapä¸HashTableåŒºåˆ«"><a href="#HashMapä¸HashTableåŒºåˆ«" class="headerlink" title="HashMapä¸HashTableåŒºåˆ«"></a>HashMapä¸HashTableåŒºåˆ«</h2><ul><li><p><strong>çº¿ç¨‹å®‰å…¨ï¼š</strong></p><p>HashMapéçº¿ç¨‹å®‰å…¨ï¼ŒHashTableå†…éƒ¨æ–¹æ³•æœ‰synchronizedå¤„ç†æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†è¦ä¿è¯çº¿ç¨‹å®‰å…¨æ¨èä½¿ç”¨ConcurrentHashMapã€‚</p></li><li><p><strong>æ•ˆç‡ï¼š</strong>ç”±äºçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŒHashMapæ¯”HashTableæ•ˆç‡é«˜ï¼ŒHashTableåŸºæœ¬è¢«æ·˜æ±°ã€‚</p></li><li><p><strong>å¯¹ Null key å’Œ Null value çš„æ”¯æŒï¼š</strong></p><p>HashMapé”®å€¼å¯¹å¯å­˜å‚¨ç©ºå€¼ï¼ŒHashTableä¸å…è®¸é”®å€¼å¯¹å­˜å‚¨ç©ºå€¼ï¼Œä¼šæŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p></li><li><p><strong>åº•å±‚æ•°æ®ç»“æ„ï¼š</strong></p><p>HashMap1.7æ˜¯æ•°ç»„+é“¾è¡¨ï¼Œ1.8æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘</p><p>HashTableæ˜¯æ•°ç»„+é“¾è¡¨</p></li><li><p><strong>åˆå§‹å®¹é‡ä»¥åŠæ‰©å®¹å¤§å°ï¼š</strong></p><ul><li>åˆå§‹ä¸æŒ‡å®šå®¹é‡<ul><li>HashTableé»˜è®¤åˆå§‹å¤§å°11ï¼Œæ¯æ¬¡æ‰©å®¹å®¹é‡å˜ä¸ºåŸæ¥çš„2n+1</li><li>HashMapé»˜è®¤åˆå§‹å¤§å°16ï¼Œæ¯æ¬¡æ‰©å®¹å˜ä¸ºåŸæ¥2å€</li></ul></li><li>åˆ›å»ºæ—¶æŒ‡å®šåˆå§‹å®¹é‡<ul><li>HashTableç›´æ¥ä½¿ç”¨ç»™å®šçš„å®¹é‡å¤§å°</li><li>HashMapä¼šä»¥ç»™å®šå®¹é‡ä¸ºåŸºç¡€ï¼Œæ‰©å……ä¸º2çš„å¹‚çš„å¤§å°ï¼Œå› ä¸ºHashMapçš„å¤§å°è¦ä¿è¯æ˜¯2çš„å¹‚ï¼Œä¸ºäº†æé«˜ç®—æ³•æ•ˆç‡ä½¿ç”¨æŒ‰ä½ä¸è®¡ç®—ï¼Œå¿…é¡»æ˜¯2çš„å¹‚</li></ul></li></ul></li></ul><h2 id="HashMapä¸HashSetåŒºåˆ«"><a href="#HashMapä¸HashSetåŒºåˆ«" class="headerlink" title="HashMapä¸HashSetåŒºåˆ«"></a>HashMapä¸HashSetåŒºåˆ«</h2><p>HashSetåº•å±‚å…¶å®æ˜¯åŸºäºHashMapå®ç°ã€‚</p><p>HashMapå­˜å‚¨é”®å€¼å¯¹ï¼Œé”®å”¯ä¸€ï¼Œä½¿ç”¨é”®è®¡ç®—hashcodeã€‚</p><p>HashSetåªå­˜å‚¨å¯¹è±¡ï¼Œé€šè¿‡æˆå‘˜å¯¹è±¡è®¡ç®—hashcodeï¼Œä½†hashcodeå¯èƒ½ç›¸åŒï¼Œä¸€èˆ¬ä½¿ç”¨equals()åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸åŒã€‚</p><h2 id="ConcurrentHashMapä¸HashTableåŒºåˆ«"><a href="#ConcurrentHashMapä¸HashTableåŒºåˆ«" class="headerlink" title="ConcurrentHashMapä¸HashTableåŒºåˆ«"></a>ConcurrentHashMapä¸HashTableåŒºåˆ«</h2><p>ä¸»è¦ä½“ç°åœ¨å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ä¸åŒã€‚</p><p>HashTableä½¿ç”¨å…¨è¡¨é”ï¼Œæ‰€æœ‰æ•°æ®äº‰å¤ºä¸€æŠŠé”ï¼Œæ•ˆç‡åŠå…¶ä½ä¸‹ã€‚</p><p><strong>ConcurrentHashMapï¼ˆjdk1.7ï¼‰</strong>ä½¿ç”¨åˆ†æ®µé”ï¼Œå¯¹æ¡¶æ•°ç»„è¿›è¡Œåˆ†æ®µï¼Œæ‹†åˆ†æˆ<strong>Segment</strong>æ•°ç»„ï¼Œä¸€ä¸ªSegmentåŒ…å«å¤šä¸ªHashEntryï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªæ•°ç»„ç»“ç‚¹ï¼Œè¿™æ ·æ¯æŠŠé”å°±å¯¹åº”éƒ¨åˆ†æ•°æ®ï¼Œå‡å°‘é”ç«äº‰é—®é¢˜ï¼Œæé«˜å¹¶å‘è®¿é—®æ•ˆç‡ã€‚</p><p><strong>ConcurrentHashMapï¼ˆjdk1.8ï¼‰</strong>å–æ¶ˆäº†Segmentåˆ†æ®µé”ï¼Œ<strong>é‡‡ç”¨CAS å’Œ synchronized</strong>æ¥ä¿è¯å¹¶å‘å®‰å…¨ï¼Œæ•°æ®ç»“æ„å’ŒHashMap1.8ä¸€æ ·ã€‚è€Œæ“ä½œå¯¹è±¡ç”±åŸæœ¬çš„Segmentå˜ä¸ºHashEntryï¼Œç›´æ¥æ“ä½œæ•°ç»„ç»“ç‚¹</p><p>CASå¯¹åº”ä¹è§‚é”ï¼Œsynchronizedå¯¹åº”æ‚²è§‚é”ï¼Œä½¿ç”¨ä¹è§‚é”è¿›ä¸€æ­¥æé«˜æ•ˆç‡ï¼Œå½“ä¹è§‚é”å¤±æ•ˆæ—¶åœ¨é‡‡ç”¨æ‚²è§‚é”ã€‚ä¹Ÿå°±æ˜¯æ£€æµ‹åˆ°å¹¶å‘å†²çªå†åŠ é”ã€‚</p><h1 id="ArrayListåº•å±‚å®ç°"><a href="#ArrayListåº•å±‚å®ç°" class="headerlink" title="ArrayListåº•å±‚å®ç°"></a>ArrayListåº•å±‚å®ç°</h1><h2 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h2><ul><li>æ— å‚åˆå§‹åŒ–ï¼šåˆå§‹åŒ–ä¸ºä¸€ä¸ªç©ºæ•°ç»„ï¼Œç„¶ååœ¨æ‰§è¡Œç¬¬ä¸€ä¸ªæ·»åŠ æ“ä½œæ—¶è¿›è¡Œæ‰©å®¹ï¼Œå®¹é‡å˜ä¸º10ï¼Œæ‰©å®¹æˆ‘ä»¬åé¢ä¼šç»†è¯´ã€‚</li><li>æœ‰å‚åˆå§‹åŒ–ï¼šåˆå§‹åŒ–ä¸€ä¸ªæŒ‡å®šå¤§å°çš„æ•°ç»„ã€‚</li><li>å‚æ•°ä¸ºCollectionçš„åˆå§‹åŒ–ï¼šå¤åˆ¶è¯¥é›†åˆçš„å…ƒç´ ï¼Œä¸å¸¸ç”¨ã€‚</li></ul><h2 id="æ‰©å®¹æœºåˆ¶ï¼ˆä¸€èˆ¬æ‰©å®¹1-5å€ï¼‰"><a href="#æ‰©å®¹æœºåˆ¶ï¼ˆä¸€èˆ¬æ‰©å®¹1-5å€ï¼‰" class="headerlink" title="æ‰©å®¹æœºåˆ¶ï¼ˆä¸€èˆ¬æ‰©å®¹1.5å€ï¼‰"></a>æ‰©å®¹æœºåˆ¶ï¼ˆä¸€èˆ¬æ‰©å®¹1.5å€ï¼‰</h2><h3 id="add"><a href="#add" class="headerlink" title="add"></a>add</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    ensureCapacityInternal(size + <span class="number">1</span>);</span><br><span class="line">    elementData[size++] = e;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°addå°±æ˜¯æ•°ç»„èµ‹å€¼å¹¶ç´¢å¼•é€’å¢ï¼Œä½†å‰ææ˜¯æ‰§è¡ŒensureCapacityInternalæ–¹æ³•ã€‚æˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•æ˜¯å¹²ä»€ä¹ˆçš„ã€‚</p><h3 id="ensureCapacityInternal"><a href="#ensureCapacityInternal" class="headerlink" title="ensureCapacityInternal"></a>ensureCapacityInternal</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacityInternal</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureExplicitCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>)</span><br><span class="line">        grow(minCapacity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">calculateCapacity</span><span class="params">(Object[] elementData, <span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">        <span class="keyword">return</span> Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> minCapacity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥è§£é‡Šç©ºæ•°ç»„çš„åˆå§‹æ‰©å®¹ä¸ºä»€ä¹ˆæ˜¯10ï¼ŒArrayListå®šä¹‰äº†é»˜è®¤å®¹é‡10ä»¥åŠsizeå˜é‡ï¼Œsizeæ˜¯é»˜è®¤å€¼0ï¼Œè¿™é‡Œæˆ‘ä»¬åˆå§‹åŒ–æ— å‚æ•°ç»„åï¼Œé¦–æ¬¡æ‰§è¡Œaddæ–¹æ³•ï¼Œå®ƒä¼šè°ƒç”¨ ensureCapacityInternal(size + 1) å…¶ä¸­å‚æ•°æ˜¯1ï¼Œä¹Ÿå°±æ˜¯è¯´ ensureCapacityInternal æ–¹æ³•çš„æœ€å°å®¹é‡å‚æ•°é¦–æ¬¡æ·»åŠ æ—¶ä¸º1ã€‚</p><p>ç„¶åæŒ‰å±‚æ¬¡å…ˆæ‰§è¡Œ calculateCapacityæ–¹æ³•ï¼Œå½“å½“å‰æ•°ç»„ä¸ºç©ºæ—¶ï¼Œå®ƒä¼šæ¯”è¾ƒæ•°ç»„çš„æœ€å°å®¹é‡ä¸é»˜è®¤å®¹é‡ï¼Œå–è¾ƒå¤§å€¼è¿”å›ï¼Œä¸æ˜¯ç©ºæ•°ç»„åˆ™è¿”å›æœ€å°å®¹é‡ã€‚è¿™é‡Œç©ºæ•°ç»„ä¼šè¿”å›é»˜è®¤å®¹é‡10ã€‚</p><p>æ¥ç€æ‰§è¡Œ ensureExplicitCapacityæ–¹æ³• ï¼Œè‹¥æœ€å°å®¹é‡å¤§äºæ•°ç»„é•¿åº¦åˆ™æ‰§è¡Œ growæ–¹æ³•è¿›è¡Œæ‰©å®¹ã€‚è¿™é‡Œé¦–æ¬¡æ— å‚åˆå§‹åŒ–çš„ç©ºæ•°ç»„ï¼Œå…¶ä¼ å…¥çš„æœ€å°å®¹é‡å‚æ•°å¤§äºç©ºæ•°ç»„é•¿åº¦0ç›¸ç­‰ï¼Œä¼šè¿›è¡Œç¬¬ä¸€æ¬¡æ‰©å®¹ã€‚</p><p>å…¶ä¸­modCountç”¨äºè®°å½•ä¿®æ”¹æ¬¡æ•°ï¼Œä¸ºå¤šçº¿ç¨‹æœåŠ¡ï¼Œè¿™é‡Œå•çº¿ç¨‹å°±ä¸ç”¨å…³å¿ƒäº†ã€‚</p><h3 id="grow"><a href="#grow" class="headerlink" title="grow"></a>grow</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">int</span> oldCapacity = elementData.length;</span><br><span class="line">    <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = minCapacity;</span><br><span class="line">    <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">    <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">    elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œgrowæ–¹æ³•å…ˆæ˜¯è·å–å½“å‰æ•°ç»„é•¿åº¦ï¼Œå°†åŸé•¿åº¦&gt;&gt;1å³é™¤2ï¼Œæ‰€ä»¥æ•°ç»„æ‰©å®¹ä¸ºåŸæ¥çš„1.5å€å·¦å³ï¼ˆå¥‡æ•°æœ‰æŸï¼‰ï¼Œç„¶åæ¯”è¾ƒæ‰©å®¹åé•¿åº¦ä¸å½“å‰ä¼ å…¥çš„æœ€å°å®¹é‡å‚æ•°ï¼Œè¿”å›è¾ƒå¤§å€¼ã€‚æ¥ç€å°±å¯¹æœ€å¤§ç•Œé™è¿›è¡Œäº†é™åˆ¶ã€‚æœ€åæ‰§è¡ŒArrays.copyOfï¼Œåˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ï¼Œå…¶é•¿åº¦è®¾ç½®ä¸ºæ‰©å®¹å®¹é‡ï¼Œå¹¶æŠŠç°åœ¨çš„å…ƒç´ å¤åˆ¶è¿‡å»ã€‚</p><h2 id="å¤åˆ¶æ“ä½œ"><a href="#å¤åˆ¶æ“ä½œ" class="headerlink" title="å¤åˆ¶æ“ä½œ"></a>å¤åˆ¶æ“ä½œ</h2><p>æˆ‘ä»¬åœ¨æ‰©å®¹æ—¶å¾€å¾€æ˜¯æ–°å»ºä¸€ä¸ªæ•°ç»„ï¼ŒæŠŠåŸæœ¬æ•°ç»„å†…å®¹copyè¿‡å»ï¼Œä¼šç»å¸¸ä½¿ç”¨ Arrays.copyOf å’Œ System.arraycopy è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œæ¥åˆ†æä¸€ä¸‹ã€‚</p><h3 id="Arrays-copyOf"><a href="#Arrays-copyOf" class="headerlink" title="Arrays.copyOf"></a>Arrays.copyOf</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] copyOf(<span class="keyword">int</span>[] original, <span class="keyword">int</span> newLength) &#123;</span><br><span class="line">    <span class="keyword">int</span>[] copy = <span class="keyword">new</span> <span class="keyword">int</span>[newLength];</span><br><span class="line">    System.arraycopy(original, <span class="number">0</span>, copy, <span class="number">0</span>,</span><br><span class="line">                     Math.min(original.length, newLength));</span><br><span class="line">    <span class="keyword">return</span> copy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä»–æ•°ç»„ç±»ä¼¼ï¼Œè¿™é‡Œé€‰æ‹©äº†æ•´æ•°å‹æ•°ç»„ï¼Œcopyæ“ä½œå°±æ˜¯åˆ›å»ºä¸€ä¸ªæ‰©å®¹å®¹é‡çš„æ–°æ•°ç»„ï¼Œç„¶åè°ƒç”¨ System.arraycopy è¿›è¡Œå¤åˆ¶æœ€åè¿”å›æ–°çš„æ•°ç»„ã€‚æ³¨æ„æœ€åä¸€ä¸ªå‚æ•°å–è¦å¤åˆ¶çš„æ•°ç»„é•¿åº¦ï¼Œå› ä¸ºæ˜¯è¦å¤åˆ¶çš„æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯å¾…æ‰©å®¹çš„ï¼Œè‚¯å®šé•¿åº¦è¾ƒå°ï¼Œæ‰€ä»¥å–minã€‚</p><h3 id="System-arraycopy"><a href="#System-arraycopy" class="headerlink" title="System.arraycopy"></a>System.arraycopy</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆ‘ä»¬å‘ç° arraycopy æ˜¯ä¸€ä¸ª native æ–¹æ³•,æ¥ä¸‹æ¥æˆ‘ä»¬è§£é‡Šä¸€ä¸‹å„ä¸ªå‚æ•°çš„å…·ä½“æ„ä¹‰</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤åˆ¶æ•°ç»„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> src æºæ•°ç»„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> srcPos æºæ•°ç»„ä¸­çš„èµ·å§‹ä½ç½®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dest ç›®æ ‡æ•°ç»„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> destPos ç›®æ ‡æ•°ç»„ä¸­çš„èµ·å§‹ä½ç½®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> length è¦å¤åˆ¶çš„æ•°ç»„å…ƒç´ çš„æ•°é‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">arraycopy</span><span class="params">(Object src,  <span class="keyword">int</span>  srcPos,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     Object dest, <span class="keyword">int</span> destPos,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     <span class="keyword">int</span> length)</span></span>;</span><br></pre></td></tr></table></figure><p>é€‰æ‹©æºæ•°ç»„çš„æŒ‡å®šç´¢å¼•åçš„å†…å®¹ï¼Œç„¶åä»ç›®æ ‡æ•°ç»„çš„æŒ‡å®šç´¢å¼•å¤„å¼€å§‹å¤åˆ¶è¿‡æ¥ï¼Œé•¿åº¦ä»£è¡¨è¦å¤åˆ¶çš„æ•°é‡ã€‚</p><h2 id="ensureCapacity"><a href="#ensureCapacity" class="headerlink" title="ensureCapacity"></a>ensureCapacity</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> minExpand = (elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA)</span><br><span class="line">        ? <span class="number">0</span></span><br><span class="line">        : DEFAULT_CAPACITY;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (minCapacity &gt; minExpand) &#123;</span><br><span class="line">        ensureExplicitCapacity(minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•æ˜¯ç”±ç”¨æˆ·è‡ªè¡Œè°ƒç”¨çš„ï¼ŒArrayListä¸­å¹¶æ²¡æœ‰è°ƒç”¨è¿‡ã€‚æˆ‘ä»¬åœ¨è¿›è¡Œå¤§é‡addæ“ä½œæ—¶å¯ä»¥å…ˆè°ƒç”¨è¯¥æ–¹æ³•ï¼Œæ­¤æ—¶ä¼ å…¥çš„æ˜¯ addçš„æ“ä½œæ¬¡æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ‰§è¡Œ100000æ¬¡addï¼Œå…ˆè°ƒç”¨è¯¥æ–¹æ³•ï¼Œä¼šåœ¨addæ“ä½œæ‰§è¡Œå‰å°±ç”¨æ‰§è¡Œçš„æ€»æ¬¡æ•°è°ƒç”¨ ensureExplicitCapacityæ–¹æ³•ï¼Œå…ˆå¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹ï¼Œæˆ‘ä»¬ä¼ å…¥çš„æœ€å°å®¹é‡å°±æ˜¯æ‰§è¡Œæ¬¡æ•°ï¼Œè¿™æ ·å°±ä¸ç”¨åœ¨æ‰§è¡Œaddæ—¶é¢‘ç¹æ‰©å®¹ï¼Œå‡å°‘äº†æ—¶é—´çš„æ¶ˆè€—ã€‚</p><h1 id="HashMapåº•å±‚å®ç°"><a href="#HashMapåº•å±‚å®ç°" class="headerlink" title="HashMapåº•å±‚å®ç°"></a>HashMapåº•å±‚å®ç°</h1><h2 id="HashMapä¸ºä»€ä¹ˆé•¿åº¦æ˜¯2çš„å¹‚"><a href="#HashMapä¸ºä»€ä¹ˆé•¿åº¦æ˜¯2çš„å¹‚" class="headerlink" title="HashMapä¸ºä»€ä¹ˆé•¿åº¦æ˜¯2çš„å¹‚"></a>HashMapä¸ºä»€ä¹ˆé•¿åº¦æ˜¯2çš„å¹‚</h2><p>è¿™ä¸ªå±äºHashMapçš„ç»å…¸é—®é¢˜äº†ï¼Œä¸å¾—ä¸è¯´ä¼¼æ‡‚éæ‡‚çš„äººå¤ªå¤šäº†ï¼Œè®¸å¤šåšå®¢éƒ½åœ¨çè®²ï¼Œè¿™é‡Œæˆ‘å°±è®²è®²è‡ªå·±å¯¹è¿™ä¸ªé—®é¢˜çš„ç†è§£ã€‚ï¼ˆæ¨èçœ‹guideå“¥çš„å®¹å™¨è®²è§£ï¼Œè¿™ä¸ªç‚¹è®²çš„å¾ˆå¯¹ï¼‰</p><h3 id="ä¸-amp"><a href="#ä¸-amp" class="headerlink" title="% ä¸ &amp;"></a>% ä¸ &amp;</h3><p>ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“ï¼Œè®¡ç®—æœºåœ¨å¤„ç†% å’Œ &amp;è¿™ä¸¤ä¸ªè¿ç®—ç¬¦æ—¶ï¼Œ&amp;çš„æ•ˆç‡æ˜¯é«˜äº%çš„ï¼Œå› ä¸º&amp;æ˜¯äºŒè¿›åˆ¶è®¡ç®—ï¼Œè®¡ç®—æœºå¤„ç†æ•ˆç‡æ›´é«˜ã€‚</p><h3 id="HashMapçš„ç®—æ³•"><a href="#HashMapçš„ç®—æ³•" class="headerlink" title="HashMapçš„ç®—æ³•"></a>HashMapçš„ç®—æ³•</h3><p>æˆ‘ä»¬ä¸€èˆ¬ç”¨ç®—æ³•å¤„ç†æ•£åˆ—å€¼çš„åˆ†é…é—®é¢˜ï¼Œå¥½çš„ç®—æ³•å°±å¯ä»¥æœ‰æ•ˆé™ä½hashå†²çªçš„å‘ç”Ÿã€‚åœ¨HashMapä¸­å°±æ˜¯<strong>å…ˆç”¨å“ˆå¸Œå€¼ä¸æ•°ç»„é•¿åº¦å–ä½™ï¼Œå†å­˜æ”¾åˆ°å¯¹åº”æ•°ç»„ä¸‹æ ‡</strong>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HashCode % length</span><br></pre></td></tr></table></figure><p>è€Œå–ä½™è¿ç®—æ˜¯å¯ä»¥è½¬åŒ–ä¸ºæŒ‰ä½ä¸çš„ï¼ˆ<strong>å‰æä¸ºlengthæ˜¯äºŒè¿›åˆ¶æ•°</strong>ï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HashCode &amp; (length - 1)</span><br></pre></td></tr></table></figure><p>è¿™ä¹ˆçœ‹æ¥åªæœ‰å½“æ•°ç»„é•¿åº¦æ˜¯2çš„å¹‚æ—¶ï¼Œæ‰èƒ½å°†å–ä½™è¿ç®—è½¬æ¢ä¸ºæŒ‰ä½ä¸ï¼Œç„¶åæˆ‘ä»¬ä¾¿å¯å¤§å¤§æå‡è¿ç®—æ•ˆç‡ï¼Œ<strong>æ‰€ä»¥HashMapé•¿åº¦è¦æ˜¯2çš„å¹‚ï¼Œæ¯æ¬¡æ‰©å®¹*2</strong>ã€‚</p><h3 id="2çš„å¹‚"><a href="#2çš„å¹‚" class="headerlink" title="2çš„å¹‚"></a>2çš„å¹‚</h3><p>ç”±å‰ä¸¤ä¸ªåˆ†ææ¥çœ‹ï¼Œå¦‚æœå½“æ•°ç»„é•¿åº¦æ˜¯2çš„å¹‚æ—¶ï¼Œæˆ‘ä»¬å‘ç°lenth-1çš„å€¼ä¼šå˜æˆä½ä½å…¨ä¸º1çš„äºŒè¿›åˆ¶æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">length:  10000</span><br><span class="line">length-1: 01111</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬å†ç”¨æ•£åˆ—å€¼ä¸è¿™ä¸ªä½ä½å…¨ä¸º1çš„äºŒè¿›åˆ¶æ•°è¿›è¡Œä¸è¿ç®—ï¼Œå¹¶ä¸å…¶ä»–æƒ…å†µå¯¹æ¯”ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">01111011110100101001</span><br><span class="line">10101100111010110011</span><br><span class="line">--------------------</span><br><span class="line">00101000110000100001</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°åŒæ ·çš„æ•°æ®ï¼Œå…¨ä¸º1æŒ‰ä½ä¸åçš„å€¼å†²çªæ›´ä¸æ˜“å‘ç”Ÿã€‚</p><p>è¿™ä¹Ÿæ˜¯å› ä¸º&amp;çš„ç‰¹æ€§å¯¼è‡´çš„ï¼Œ&amp;è®¡ç®—çš„4ç§æƒ…å†µï¼š00ã€01ã€10ã€11ï¼Œç»“æœæ˜¯3ä¸ª0ï¼Œ1ä¸ª1ï¼Œæ‰€ä»¥ä¸ºäº†å‡å°‘å†²çªæˆ‘ä»¬å°½é‡è®©å€¼æˆä¸º1ï¼Œæ‰€ä»¥æ•°ç»„çš„é•¿åº¦è¦å°½é‡å…¨ä¸º1ã€‚</p><p>é€šè¿‡ä¸Šè¿°åˆ†ææˆ‘ä»¬ä¹Ÿå¯ä»¥ç†è§£ä¸ºä»€ä¹ˆè¦è®©æ•°ç»„é•¿åº¦ä¸º2çš„å¹‚ï¼Œå…¶length-1åæ˜¯ä½ä½å…¨1çš„äºŒè¿›åˆ¶æ•°ï¼Œä¸ä»…åŠ å¿«äº†è¿ç®—æ•ˆç‡ï¼Œè€Œä¸”ä¸æ˜“äº§ç”Ÿhashå†²çªã€‚ </p><h2 id="HashMapåº•å±‚ä¸çº¢é»‘æ ‘"><a href="#HashMapåº•å±‚ä¸çº¢é»‘æ ‘" class="headerlink" title="HashMapåº•å±‚ä¸çº¢é»‘æ ‘"></a>HashMapåº•å±‚ä¸çº¢é»‘æ ‘</h2><p>å…¶å®æˆ‘ä¸€å¼€å§‹çœ‹Javaå¹¶æ²¡æœ‰çœ‹é›†åˆç±»ï¼Œæ¯•ç«Ÿå­¦è¿‡æ•°æ®ç»“æ„ï¼Œçº¿æ€§è¡¨ã€æ ˆã€é˜Ÿåˆ—ã€æ ‘ã€å›¾ã€æ•£åˆ—ç­‰åº•å±‚æˆ‘è¿˜æ˜¯äº†è§£çš„ï¼Œä½†åœ¨çœ‹é¢ç»çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘çªç„¶å‘ç°äº†HashMapã€çº¢é»‘æ ‘è¿™å‡ ä¸ªé™Œç”Ÿçš„è¯æ±‡ç»å¸¸è¢«è€ƒå¯Ÿï¼Œæ‰€ä»¥æˆ‘å°±å»äº†è§£äº†ä¸€ä¸‹ã€‚</p><p>äº†è§£åï¼Œæˆ‘å‘ç°çº¢é»‘æ ‘å…¶å®å°±æ˜¯ç®€æ˜“ç‰ˆçš„AVLæ ‘ï¼Œä¹Ÿå°±æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Œè¯´ç®€æ˜“ç‰ˆå¯èƒ½æœ‰ç‚¹è¿‡äº†ï¼Œçº¢é»‘æ ‘åªæ˜¯æ²¡æœ‰AVLé‚£ä¹ˆä¸¥æ ¼ï¼Œä½†å®ƒä¹Ÿæ˜¯é€šè¿‡ç»“ç‚¹çš„å·¦æ—‹ã€å³æ—‹æ¥è¾¾åˆ°å¹³è¡¡çŠ¶æ€çš„ã€‚äºŒè€…ç›¸æ¯”ä¸‹ï¼ŒAVLæ˜¯æ ‘çš„é«˜åº¦å¹³è¡¡ï¼ŒæŸ¥æ‰¾æ•ˆç‡é«˜ï¼›è€Œçº¢é»‘æ ‘æ˜¯é«˜åº¦å¹³è¡¡ç›¸å·®ä¸€å±‚ï¼Œä½†å…¶æ’å…¥åˆ é™¤æ“ä½œçš„æ•ˆç‡æ›´é«˜ã€‚</p><h3 id="jdk1-7"><a href="#jdk1-7" class="headerlink" title="jdk1.7"></a>jdk1.7</h3><p>æ•°ç»„+é“¾è¡¨ï¼Œå‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œå°†å†²çªå…ƒç´ å­˜æ”¾åˆ°å¯¹æ•°ç»„çš„é“¾è¡¨ï¼Œä½¿ç”¨å¤´æ’æ³•æ’å…¥ï¼Œä½†åœ¨å¤šçº¿ç¨‹è¿›è¡Œæ‰©å®¹æ“ä½œæ—¶ï¼Œä½¿ç”¨å¤´æ’æ³•ä¼šå½¢æˆç¯ã€‚</p><p><strong>å¤šçº¿ç¨‹å¤´æ’æ³•ä¸ºä»€ä¹ˆå½¢æˆç¯</strong>ï¼Œæ¯”æ–¹ä¸€ä¸ªæ•°ç»„ç´¢å¼•æœ‰ä¸‰ä¸ªå†²çªå…ƒç´ 123ï¼Œåˆ™ä¾æ¬¡å¤´æ’æ³•æ’å…¥é“¾è¡¨ï¼Œå˜æˆ321ï¼Œè€Œæ‰©å®¹åå½¢æˆçš„æ–°æ•°ç»„æˆ‘ä»¬è¦æŠŠç°åœ¨çš„å…ƒç´ ç§»è¿‡å»ï¼Œå†æ¬¡ä½¿ç”¨å¤´æ’å°±å˜æˆäº†123ï¼Œè¿™æ˜¯å•çº¿ç¨‹ä¸‹çš„æ‰©å®¹ã€‚è€Œå¤šçº¿ç¨‹ä¸‹æ‰©å®¹æ—¶ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œåè½®åˆ°ç¬¬äºŒä¸ªçº¿ç¨‹ï¼Œä½†å› ä¸ºå¤´æ’æ³•çš„å½±å“å¯¼è‡´æ‰©å®¹åçš„é“¾è¡¨é¡ºåºå‘ç”Ÿäº†æ”¹å˜ï¼Œä¹‹åå†æŒ‰åŸå…ˆçš„é¡ºåºæ“ä½œå°±ä¼šå‡ºç°ç¯ï¼Œå¯¼è‡´æ­»é”çš„å‘ç”Ÿã€‚</p><p>æ€»ç»“å°±æ˜¯å¤´æ’æ³•å®¹æ˜“é€†åº+ç¯å½¢é“¾è¡¨æ­»å¾ªç¯ï¼Œæ”¾ä¸€ä¸ªè§†é¢‘è®²è§£ï¼š</p><p><a href="https://www.bilibili.com/video/BV1n541177Ea?from=search&amp;seid=4027342742461950529">https://www.bilibili.com/video/BV1n541177Ea?from=search&amp;seid=4027342742461950529</a></p><h3 id="jdk1-8"><a href="#jdk1-8" class="headerlink" title="jdk1.8"></a>jdk1.8</h3><p>æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼Œå‘ç”Ÿå“ˆå¸Œå†²çªä¹Ÿä¼šæ”¾å…¥é“¾è¡¨ï¼Œä½¿ç”¨çš„å°¾æ’æ³•ï¼Œä½†å½“é“¾è¡¨é•¿åº¦è¶…è¿‡8æ—¶ï¼Œä¼šå°†å…¶æ•°æ®ç»“æ„è½¬æ¢ä¸ºçº¢é»‘æ ‘ä»¥æé«˜æ•ˆç‡ã€‚å½“é“¾è¡¨é•¿åº¦å°äº6æ—¶ï¼Œç”±çº¢é»‘æ ‘è½¬å›é“¾è¡¨ã€‚</p><p><strong>ä¸ºä»€ä¹ˆå½“é“¾è¡¨é•¿åº¦è¶…è¿‡8è½¬æ¢ä¸ºçº¢é»‘æ ‘</strong>ï¼Œå› ä¸ºå½“æˆ‘ä»¬çš„ç®—æ³•è¶³å¤Ÿå¥½ï¼Œé“¾è¡¨è¾¾åˆ°8ä¸ªç»“ç‚¹çš„æ¦‚ç‡æ˜¯éå¸¸ä½çš„ï¼Œå†²çªèƒ½è¾¾åˆ°8è¯´æ˜å½“å‰ç®—æ³•ä¸å¤Ÿå¥½ï¼Œå¯¼è‡´æ•£åˆ—ä¸å‡åŒ€ï¼Œæ­¤æ—¶ç›¸å¯¹äºç‰¹æ®Šæƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦è½¬åŒ–æˆçº¢é»‘æ ‘æé«˜æ•ˆç‡ã€‚</p><p><strong>ä¸ºä»€ä¹ˆçº¢é»‘æ ‘è½¬å˜æˆé“¾è¡¨çš„é˜™å€¼æ˜¯6</strong>ï¼Œå¦‚æœé˜™å€¼è®¾ä¸º8ï¼Œä¸€ä¸ªåˆ é™¤å’Œæ·»åŠ æ“ä½œå°±ä¼šé¢‘ç¹çš„è¿›è¡Œé“¾è¡¨å’Œçº¢é»‘æ ‘çš„è½¬æ¢ï¼Œæ‰€ä»¥è®¾ç½®é€€åŒ–çš„é˜™å€¼ä¸º6ï¼Œé˜™å€¼ä¸å¯å¤ªä¸´ç•Œã€‚ </p><h2 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h2><p>åˆšåˆšè¯´è¿‡jdk1.7ä½¿ç”¨å¤´æ’ä¼šå¯¼è‡´åœ¨å¤šçº¿ç¨‹æ“ä½œæ—¶æ­»é”ï¼Œå°±ç®—jdk1.8ä½¿ç”¨äº†å°¾æ’ï¼ŒHashMapè¿˜æ˜¯å¤šç”¨äºå•çº¿ç¨‹ï¼Œåœ¨å¹¶å‘æƒ…å†µä¸‹å»ºè®®ä½¿ç”¨ConcurrentHashMapã€‚</p><h2 id="è´Ÿè½½å› å­"><a href="#è´Ÿè½½å› å­" class="headerlink" title="è´Ÿè½½å› å­"></a>è´Ÿè½½å› å­</h2><p>ä¼—æ‰€å‘¨çŸ¥HashMapè´Ÿè½½å› å­æ˜¯0.75ï¼Œä½†è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“è´Ÿè½½å› å­æ˜¯ç”¨æ¥è¡¡é‡HashMapä½•æ—¶è¯¥æ‰©å®¹çš„ï¼Œå½“HashMapä¸­å…ƒç´ è¶…è¿‡ æ•°ç»„é•¿åº¦ * è´Ÿè½½å› å­ å°±è¦è¿›è¡Œ2å€æ‰©å®¹ã€‚è´Ÿè½½å› å­ç›¸å½“äºä¸€ä¸ªå®¹é‡ç•Œé™ã€‚</p><p>å¦‚æœè´Ÿè½½å› å­æ˜¯1ï¼Œç›¸å¯¹äºæ•°ç»„å æ»¡æ—¶æ‰©å®¹ï¼Œå…¶æ—¶é—´åˆ©ç”¨ç‡ä½ç©ºé—´åˆ©ç”¨ç‡é«˜ï¼Œå±äºæ—¶é—´æ¢ç©ºé—´ï¼Œè€Œè´Ÿè½½å› å­ä¸º0.5æ—¶ï¼Œæ•°ç»„å ä¸€åŠå°±è¦æ‰©å®¹ï¼Œè¿™æ—¶æ‰©å®¹ä¼šé€ æˆç©ºé—´çš„æµªè´¹ï¼Œå±äºç©ºé—´æ¢æ—¶é—´ã€‚æ‰€ä»¥æˆ‘ä»¬ç»¼åˆå¹¶æ ¹æ®ç®—æ³•é€‰æ‹©è´Ÿè½½å› å­æ˜¯0.75ï¼Œæ­¤æ—¶æ—¶é—´ã€ç©ºé—´åˆ©ç”¨ç‡æ¯”è¾ƒå‡è¡¡ã€‚</p><h1 id="çº¢é»‘æ ‘"><a href="#çº¢é»‘æ ‘" class="headerlink" title="çº¢é»‘æ ‘"></a>çº¢é»‘æ ‘</h1><p>çº¢é»‘æ ‘å¯ä»¥ç†è§£æˆæ²¡æœ‰é‚£ä¹ˆä¸¥æ ¼çš„å¹³è¡¡äºŒå‰æ ‘ï¼ˆAVLï¼‰ï¼Œå®ƒå¹¶ä¸æ˜¯å®Œå…¨å¹³è¡¡çš„ï¼Œå› æ­¤æ—‹è½¬æ¬¡æ•°ä¹Ÿç›¸åº”å‡å°‘ã€‚ä½†ä½¿ç”¨çº¢é»‘æ ‘è¿›è¡Œå¢åˆ æ“ä½œï¼Œæ•ˆç‡æ˜¯é«˜äºAVLçš„ã€‚</p><h2 id="è§„åˆ™"><a href="#è§„åˆ™" class="headerlink" title="è§„åˆ™"></a>è§„åˆ™</h2><ul><li>ç»“ç‚¹ä¸ºçº¢/é»‘</li><li>æ ¹ç»“ç‚¹ä¸ºé»‘</li><li>å¶å­ç»“ç‚¹æ˜¯é»‘è‰²ç©ºç»“ç‚¹null</li><li>æ¯ä¸ªçº¢è‰²ç»“ç‚¹çš„ä¸¤ä¸ªå­ç»“ç‚¹å‡ä¸ºé»‘è‰²ï¼Œä¸å­˜åœ¨ä¸¤ä¸ªç›¸è¿çš„çº¢è‰²ç»“ç‚¹</li><li>ä»ä»»æ„ç»“ç‚¹åˆ°æ¯ä¸ªå¶å­ç»“ç‚¹çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²ç»“ç‚¹</li></ul><h2 id="è‡ªå¹³è¡¡ï¼ˆæ—‹è½¬-å˜è‰²ï¼‰"><a href="#è‡ªå¹³è¡¡ï¼ˆæ—‹è½¬-å˜è‰²ï¼‰" class="headerlink" title="è‡ªå¹³è¡¡ï¼ˆæ—‹è½¬ + å˜è‰²ï¼‰"></a>è‡ªå¹³è¡¡ï¼ˆæ—‹è½¬ + å˜è‰²ï¼‰</h2><p><strong>æ³¨æ„æ’å…¥çš„ç»“ç‚¹ä¸€å®šæ˜¯çº¢è‰²çš„ã€‚</strong></p><p>çº¢é»‘æ ‘åœ¨æ‰§è¡Œæ·»åŠ ä¸åˆ é™¤æ“ä½œæ—¶ï¼Œå¦‚æœç ´åäº†çº¢é»‘æ ‘çš„è§„åˆ™ï¼Œé‚£ä¹ˆçº¢é»‘æ ‘ä¼šå’ŒAVLä¸€æ ·ï¼Œé€šè¿‡æ—‹è½¬è¿›è¡Œè‡ªå¹³è¡¡ï¼Œå¹¶ä¸”è¿˜è¦è¿›è¡Œå˜è‰²æ“ä½œã€‚è¿™é‡Œå°±ä½“ç°äº†çº¢é»‘æ ‘ä¸AVLçš„åŒºåˆ«ï¼ŒAVLæ˜¯æ˜ç¡®è§„å®šæ ‘çš„æ·±åº¦å·®ä¸è¶…è¿‡1ä½œä¸ºå¹³è¡¡æ¡ä»¶ï¼Œè€Œçº¢é»‘æ ‘å·§å¦™çš„å°†è§„åˆ™è®¾å®šä¸ºå¹³è¡¡æ¡ä»¶ï¼Œçœå»äº†è®¸å¤šç¹ççš„æ“ä½œæ­¥éª¤ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å®¹å™¨å¯¹æ¯”&quot;&gt;&lt;a href=&quot;#å®¹å™¨å¯¹æ¯”&quot; class=&quot;headerlink&quot; title=&quot;å®¹å™¨å¯¹æ¯”&quot;&gt;&lt;/a&gt;å®¹å™¨å¯¹æ¯”&lt;/h1&gt;&lt;h2 id=&quot;é›†åˆæ¡†æ¶ç®€è¿°&quot;&gt;&lt;a href=&quot;#é›†åˆæ¡†æ¶ç®€è¿°&quot; class=&quot;headerlink&quot; title=&quot;é›†åˆæ¡†æ¶ç®€</summary>
      
    
    
    
    <category term="å…«è‚¡" scheme="http://aidianfirst.com/categories/%E5%85%AB%E8%82%A1/"/>
    
    
  </entry>
  
  <entry>
    <title>RabbitMQç®€å•å­¦ä¹ </title>
    <link href="http://aidianfirst.com/2021/09/21/%E4%B8%AD%E9%97%B4%E4%BB%B6/RabbitMQ%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/"/>
    <id>http://aidianfirst.com/2021/09/21/%E4%B8%AD%E9%97%B4%E4%BB%B6/RabbitMQ%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/</id>
    <published>2021-09-21T08:45:27.000Z</published>
    <updated>2023-07-30T11:20:17.727Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>RabbitMQåŸºäºerlangï¼Œæˆ‘ä»¬éœ€è¦å…ˆå®‰è£…erlangã€‚</p><p>erlangï¼š<a href="https://packagecloud.io/rabbitmq/erlang/packages/el/7/erlang-21.3.8.21-1.el7.x86_64.rpm">https://packagecloud.io/rabbitmq/erlang/packages/el/7/erlang-21.3.8.21-1.el7.x86_64.rpm</a></p><p>RabbitMQï¼š<a href="https://packagecloud.io/rabbitmq/rabbitmq-server/packages/el/7/rabbitmq-server-3.8.8-1.el7.noarch.rpm">https://packagecloud.io/rabbitmq/rabbitmq-server/packages/el/7/rabbitmq-server-3.8.8-1.el7.noarch.rpm</a></p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨è´¹å…¶ä»–ç‰ˆæœ¬ï¼Œcentos8å°±è¦ä½¿ç”¨el8ï¼ŒæŒ‰è‡ªå·±æƒ…å†µæ¥ï¼Œç„¶åè¿›å…¥ç•Œé¢å³ä¸Šè§’ç‚¹å‡»ä¸‹è½½ï¼ˆæœ€å¼€å§‹æ‰¾åŠå¤©ï¼Œæ²¡çœ‹åˆ°ä¸‹è½½æŒ‰é’®ğŸ˜‚ï¼‰ï¼Œç„¶åå¯ä»¥ä½¿ç”¨xftpä¼ åˆ°linuxçš„æ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘æ”¾åœ¨/usr/local/softwareã€‚</p><ul><li><p><strong>å®‰è£…å‘½ä»¤ï¼ŒæŒ‰åºæ‰§è¡Œ</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh erlang-21.3.8.21-1.el7.x86_64.rpm</span><br><span class="line">yum install socat -y</span><br><span class="line">rpm -ivh rabbitmq-server-3.8.8-1.el7.noarch.rpm</span><br></pre></td></tr></table></figure></li><li><p><strong>åŸºæœ¬æŒ‡ä»¤</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chkconfig rabbitmq-server on# å¼€æœºå¯åŠ¨æœåŠ¡è®¾ç½®</span><br><span class="line">/sbin/service rabbitmq-server start# è‡ªè¡Œå¯åŠ¨æœåŠ¡</span><br><span class="line">/sbin/service rabbitmq-server status# æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span><br><span class="line">/sbin/service rabbitmq-server stop# åœæ­¢è¿è¡Œ</span><br></pre></td></tr></table></figure></li><li><p><strong>å¯åŠ¨webç®¡ç†æ’ä»¶</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¦åœ¨mqæœåŠ¡åœæ­¢æ—¶å¯åŠ¨ï¼Œç„¶åå†å¼€å¯mqåˆ™æ’ä»¶ç”Ÿæ•ˆ</span></span><br><span class="line">rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—®æœ¬æœºåœ°å€çš„15672ç«¯å£ï¼Œ<a href="http://192.168.158.134:15672/%EF%BC%8C%E6%B3%A8%E6%84%8F%E9%9C%80%E8%A6%81%E5%85%88%E5%BC%80%E6%94%BE%E7%AB%AF%E5%8F%A3%EF%BC%8C%E6%88%96%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99%E3%80%82">http://192.168.158.134:15672/ï¼Œæ³¨æ„éœ€è¦å…ˆå¼€æ”¾ç«¯å£ï¼Œæˆ–å…³é—­é˜²ç«å¢™ã€‚</a></p></li><li><p><strong>ç”¨æˆ·ç®¡ç†</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®è´¦å·å¯†ç </span></span><br><span class="line">rabbitmqctl add_user admin 111</span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®è´¦å·çš„è§’è‰²</span></span><br><span class="line">rabbitmqctl set_user_tags admin administrator</span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®è§’è‰²çš„æƒé™ï¼Œæ ¹ç›®å½•ä¸‹å…¨éƒ¨å¯è¯»å¯å†™å¯æ‰§è¡Œ</span></span><br><span class="line">rabbitmqctl set_permissions -p &quot;/&quot; admin &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æ‰€æœ‰è´¦å·</span></span><br><span class="line">rabbitmqctl list_users</span><br></pre></td></tr></table></figure></li><li><p><strong>ä»£ç å®ç°</strong></p><p>æˆ‘ä»¬é€šè¿‡Javaæ¥å…·ä½“å®ç°MQçš„æ“ä½œæµç¨‹ï¼Œå…ˆå¯¼å…¥ç›¸å…³ä¾èµ–ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-nop --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-nop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="ç”Ÿäº§æ¶ˆè´¹è€…ç®€å•æ¨¡å¼ï¼ˆHello-Worldï¼‰"><a href="#ç”Ÿäº§æ¶ˆè´¹è€…ç®€å•æ¨¡å¼ï¼ˆHello-Worldï¼‰" class="headerlink" title="ç”Ÿäº§æ¶ˆè´¹è€…ç®€å•æ¨¡å¼ï¼ˆHello Worldï¼‰"></a>ç”Ÿäº§æ¶ˆè´¹è€…ç®€å•æ¨¡å¼ï¼ˆHello Worldï¼‰</h1><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/27.png" alt="27.png"></p><p>ä¸€ä¸ªç”Ÿäº§è€…Pé€šè¿‡é˜Ÿåˆ—queueå‘é€ä¿¡æ¯ï¼Œæ¶ˆè´¹è€…Cæ¥æ”¶ä¿¡æ¯</p><p><strong>å…·ä½“æµç¨‹ï¼š</strong></p><ul><li>åˆ›å»ºè¿æ¥å·¥å‚å¯¹è±¡</li><li>åˆ›å»ºè¿æ¥è·å–ä¿¡é“</li><li>é€šè¿‡ä¿¡é“åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—</li><li>è¿›è¡Œæ¶ˆæ¯çš„å‘é€ä¸æ¥æ”¶æ“ä½œ</li></ul><h2 id="ç”Ÿäº§è€…ä»£ç "><a href="#ç”Ÿäº§è€…ä»£ç " class="headerlink" title="ç”Ÿäº§è€…ä»£ç "></a>ç”Ÿäº§è€…ä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Producer</span> </span>&#123;</span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—name</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºè¿æ¥å·¥å‚</span></span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        factory.setHost(<span class="string">&quot;192.168.158.135&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;111&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºè¿æ¥</span></span><br><span class="line">        Connection connection = factory.newConnection();</span><br><span class="line">        <span class="comment">//è·å–è¿æ¥çš„ä¿¡é“</span></span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * é€šè¿‡ä¿¡é“åˆ›å»ºé˜Ÿåˆ—å£°æ˜queueDeclare</span></span><br><span class="line"><span class="comment">         * 1ã€é˜Ÿåˆ—åç§°</span></span><br><span class="line"><span class="comment">         * 2ã€durableï¼šé˜Ÿåˆ—æ˜¯å¦æŒä¹…åŒ–</span></span><br><span class="line"><span class="comment">         * 3ã€exclusiveï¼šé˜Ÿåˆ—æ˜¯å¦æ’ä»–</span></span><br><span class="line"><span class="comment">         * 4ã€autoDeleteï¼šé˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         * 5ã€argurnentsï¼šå…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        String message = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         *  å‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         *  1ã€äº¤æ¢æœºåï¼Œä¸ä½¿ç”¨äº¤æ¢æœºåˆ™ä¸º&quot;&quot;</span></span><br><span class="line"><span class="comment">         *  2ã€å‘é€ä¿¡æ¯çš„é˜Ÿåˆ—ï¼ˆRoutingKeyï¼‰</span></span><br><span class="line"><span class="comment">         *  3ã€å…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         *  4ã€å‘é€çš„æ¶ˆæ¯ä½“ï¼Œå¿…é¡»æ˜¯byteæ•°ç»„</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicPublish(<span class="string">&quot;&quot;</span>, QUEUE_NAME, <span class="keyword">null</span>, message.getBytes());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¶ˆè´¹è€…ä»£ç "><a href="#æ¶ˆè´¹è€…ä»£ç " class="headerlink" title="æ¶ˆè´¹è€…ä»£ç "></a>æ¶ˆè´¹è€…ä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        factory.setHost(<span class="string">&quot;192.168.158.135&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;111&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Connection connection = factory.newConnection();</span><br><span class="line"></span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä½¿ç”¨Lambdaè¡¨è¾¾å¼ç®€å•ç¼–å†™å›è°ƒæ¥å£</span></span><br><span class="line">        <span class="comment">//åªéœ€è¦è¿”å›æ¶ˆæ¯ä½“ï¼Œè‹¥è¿”å›messageåˆ™æ˜¯ä¸€ä¸ªåœ°å€</span></span><br><span class="line">        DeliverCallback deliverCallback = (String consumerTag, Delivery message) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="keyword">new</span> String(message.getBody()));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        CancelCallback cancelCallback = (String consumerTag) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆæ¯è¢«ä¸­æ–­&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         * 1ã€é˜Ÿåˆ—åç§°</span></span><br><span class="line"><span class="comment">         * 2ã€autoAckï¼šæ˜¯å¦è‡ªåŠ¨æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         * 3ã€deliverCallbackï¼šæ¶ˆæ¯çš„å›è°ƒæ¥å£</span></span><br><span class="line"><span class="comment">         * 4ã€cancelCallbackï¼šæ¶ˆè´¹è€…å–æ¶ˆè®¢é˜…æ—¶çš„å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="keyword">true</span>, deliverCallback, cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ï¼ˆWork-Queuesï¼‰"><a href="#å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ï¼ˆWork-Queuesï¼‰" class="headerlink" title="å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ï¼ˆWork Queuesï¼‰"></a>å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ï¼ˆWork Queuesï¼‰</h1><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/28.png" alt="28.png"></p><p>ä¸€ä¸ªç”Ÿäº§è€…é€šè¿‡é˜Ÿåˆ—å‘é€å¤§é‡æ¶ˆæ¯ï¼Œæœ‰å¤šä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆæ¯æ¥æ”¶ï¼Œå…¶ä¸­é˜Ÿåˆ—å”¯ä¸€ï¼Œè€Œæ¶ˆè´¹è€…ä¸ä¼šé‡å¤å¤„ç†æ¶ˆæ¯ï¼Œé€šè¿‡è½®è¯¢çš„æ–¹å¼å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨ideaé‡Œé€‰æ‹©å¤šæ¬¡è¿è¡Œæ¶ˆè´¹è€…ï¼Œç„¶ååœ¨ç”Ÿäº§è€…ä¸­æ‰‹åŠ¨å‘é€ä¿¡æ¯ï¼Œä¼šå‘ç°å¤šä¸ªæ¶ˆè´¹è€…è½®è¯¢è·å–ä¿¡æ¯ã€‚</p><h2 id="é€šç”¨ä¿¡é“å·¥å…·ç±»"><a href="#é€šç”¨ä¿¡é“å·¥å…·ç±»" class="headerlink" title="é€šç”¨ä¿¡é“å·¥å…·ç±»"></a>é€šç”¨ä¿¡é“å·¥å…·ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChannelUtils</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Channel <span class="title">getChannel</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        factory.setHost(<span class="string">&quot;192.168.158.135&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;111&quot;</span>);</span><br><span class="line">        Connection connection = factory.newConnection();</span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line">        <span class="keyword">return</span> channel;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">workProducer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">&quot;WorkQueues&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line">        Channel channel = ChannelUtils.getChannel();</span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        <span class="keyword">while</span>(scanner.hasNext())&#123;</span><br><span class="line">            String message = scanner.next();</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, QUEUE_NAME, <span class="keyword">null</span>, message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;å‘é€æ¶ˆæ¯æˆåŠŸ:&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">workConsumer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">&quot;WorkQueues&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line">        Channel channel = ChannelUtils.getChannel();</span><br><span class="line">        DeliverCallback deliverCallback = (String consumerTag, Delivery message) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥æ”¶çš„æ¶ˆæ¯:&quot;</span> + <span class="keyword">new</span> String(message.getBody()));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        CancelCallback cancelCallback = (String consumerTag) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆæ¯è¢«ä¸­æ–­&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;------------C2ç­‰å¾…æ¥æ”¶ä¿¡æ¯------------&quot;</span>);</span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="keyword">true</span>, deliverCallback, cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¶ˆæ¯åº”ç­”"><a href="#æ¶ˆæ¯åº”ç­”" class="headerlink" title="æ¶ˆæ¯åº”ç­”"></a>æ¶ˆæ¯åº”ç­”</h2><p>ä¸ºäº†ä¿è¯MQçš„æ¶ˆæ¯åœ¨å‘é€è¿‡ç¨‹ä¸­ä¸ä¸¢å¤±ï¼Œéœ€è¦è¿›è¡Œæ¶ˆæ¯åº”ç­”ï¼Œå³æ¶ˆè´¹è€…åœ¨æ¥æ”¶æ¶ˆæ¯å¹¶å¤„ç†æ¶ˆæ¯åï¼Œä¼šå‘Šè¯‰MQä¸€å¤„ç†æ¶ˆæ¯ï¼Œæ­¤æ—¶MQæ‰å¯ä»¥å°†æ¶ˆæ¯è¿›è¡Œåˆ é™¤ã€‚</p><p>ä¸€èˆ¬åˆ†ä¸ºè‡ªåŠ¨åº”ç­”ä¸æ‰‹åŠ¨åº”ç­”ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨æ‰‹åŠ¨åº”ç­”ã€‚</p><ul><li><p>åº”ç­”çš„æ–¹å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¡®è®¤</span></span><br><span class="line">channel.basicAck(Â·Â·Â·);</span><br><span class="line"><span class="comment">//ä¸ç¡®è®¤</span></span><br><span class="line">channel.basicNack(Â·Â·Â·);</span><br><span class="line"><span class="comment">//ä¸ç¡®è®¤ï¼Œç›¸æ¯”Nackï¼ŒRejectå°‘äº†ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">channel.basicReject(Â·Â·Â·);</span><br></pre></td></tr></table></figure></li></ul><h2 id="æ¶ˆæ¯æ‰‹åŠ¨åº”ç­”ï¼ˆæ¨èï¼‰"><a href="#æ¶ˆæ¯æ‰‹åŠ¨åº”ç­”ï¼ˆæ¨èï¼‰" class="headerlink" title="æ¶ˆæ¯æ‰‹åŠ¨åº”ç­”ï¼ˆæ¨èï¼‰"></a>æ¶ˆæ¯æ‰‹åŠ¨åº”ç­”ï¼ˆæ¨èï¼‰</h2><p>å¯ä»¥å‘ç°æ¶ˆè´¹è€…1ã€2å’Œæœ€å¼€å§‹çš„å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ä¸€æ ·æ˜¯è½®è¯¢è·å–ä¿¡æ¯ï¼Œä½†ä¸€ä¸ªå¤„ç†å¿«ï¼Œä¸€ä¸ªå¤„ç†æ…¢ï¼Œå¦‚æœæˆ‘ä»¬æŠŠå¤„ç†æ…¢çš„æ¶ˆè´¹è€…å®•æœºï¼Œç”±äºæ‰“å¼€äº†æ¶ˆæ¯æ‰‹åŠ¨åº”ç­”ï¼Œæœ¬åº”ç”±æ¶ˆè´¹è€…2å¤„ç†çš„æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼Œè€Œæ˜¯ç”±æ¶ˆè´¹è€…1è¿›è¡Œå¤„ç†ã€‚ç”Ÿäº§è€…å’Œä¸€å¼€å§‹ä½¿ç”¨çš„å·¥ä½œé˜Ÿåˆ—æ¨¡å¼çš„ä¸€è‡´ï¼Œåªéœ€è¦æ”¹å˜æ¶ˆè´¹è€…ã€‚</p><ul><li><p>æ¶ˆè´¹è€…1ï¼Œå¤„ç†æ—¶é—´çŸ­ï¼Œä½¿ç”¨æ‰‹åŠ¨åº”ç­”ä¸çº¿ç¨‹ä¼‘çœ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ackConsumer1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">&quot;WorkQueues&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line">        Channel channel = ChannelUtils.getChannel();</span><br><span class="line">        System.out.println(<span class="string">&quot;C1ç­‰å¾…å¤„ç†ï¼Œå¤„ç†æ—¶é—´çŸ­&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> autoAck = <span class="keyword">false</span>;</span><br><span class="line">        DeliverCallback deliverCallback = (String consumerTag, Delivery message) -&gt; &#123;</span><br><span class="line">            <span class="comment">//ä¼‘çœ 1s</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥æ”¶çš„æ¶ˆæ¯:&quot;</span> + <span class="keyword">new</span> String(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * æ‰‹åŠ¨åº”ç­”ï¼ŒbasicAckè‚¯å®š</span></span><br><span class="line"><span class="comment">             * 1ã€æ¶ˆæ¯çš„æ ‡è®°ï¼Œç±»ä¼¼æ•°ç»„ç´¢å¼•</span></span><br><span class="line"><span class="comment">             * 2ã€æ˜¯å¦æ‰¹é‡åº”ç­”</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.basicAck(message.getEnvelope().getDeliveryTag(), <span class="keyword">false</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        CancelCallback cancelCallback = (String consumerTag) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆæ¯è¢«ä¸­æ–­&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(QUEUE_NAME, autoAck, deliverCallback, cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ¶ˆè´¹è€…2ï¼Œå¤„ç†æ—¶é—´é•¿</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ackConsumer2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">&quot;WorkQueues&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line">        Channel channel = ChannelUtils.getChannel();</span><br><span class="line">        System.out.println(<span class="string">&quot;C2ç­‰å¾…å¤„ç†ï¼Œå¤„ç†æ—¶é—´é•¿&quot;</span>);</span><br><span class="line"><span class="comment">//æ”¹ä¸ºä¼‘çœ 20sï¼Œå…¶ä½™ä¸æ¶ˆè´¹è€…1ä¸€è‡´</span></span><br><span class="line">Â·Â·Â·</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="ä¸å…¬å¹³åˆ†å‘ï¼ˆå¼€å¯é¢„å–å€¼ï¼‰"><a href="#ä¸å…¬å¹³åˆ†å‘ï¼ˆå¼€å¯é¢„å–å€¼ï¼‰" class="headerlink" title="ä¸å…¬å¹³åˆ†å‘ï¼ˆå¼€å¯é¢„å–å€¼ï¼‰"></a>ä¸å…¬å¹³åˆ†å‘ï¼ˆå¼€å¯é¢„å–å€¼ï¼‰</h2><p>é»˜è®¤prefetchCount = 0ï¼Œæ­¤æ—¶æ¶ˆè´¹è€…å¯¹ä¿¡æ¯è¿›è¡Œè½®è¯¢å¤„ç†ï¼Œè‡ªå®šä¹‰prefetchCount&gt;0æ—¶ï¼Œå¹¶é€šè¿‡ä¿¡é“çš„basicQosè¿›è¡Œè®¾ç½®ï¼Œåˆ™è§„å®šäº†æ¯ä¸€ä¸ªé˜Ÿåˆ—çš„å½“å‰çœ‹å¤„ç†ä¿¡æ¯çš„æœ€å¤§æ•°ã€‚ä¹Ÿå°±è¯´è¿˜æ˜¯æ‰§è¡Œè½®è¯¢æ“ä½œï¼Œä½†æŸä¸ªæ¶ˆè´¹è€…ä¿¡æ¯å¤„ç†æ—¶ä¸åº”ç­”é€ æˆä¿¡æ¯é˜»å¡ï¼Œè¿™ä¸ªé˜»å¡é˜Ÿåˆ—çš„æœ€å¤§å€¼å³prefetchCountï¼Œå½“é˜»å¡æ•°æ®è¶…è¿‡æœ€å¤§å€¼ï¼Œåˆ™è¯¥æ¶ˆè´¹è€…ä¸å†æ¥æ”¶æ–°æ¶ˆæ¯ã€‚è€Œåç»­æ¶ˆæ¯å…¨ç”±æœ‰ç©ºé—²çš„æ¶ˆè´¹è€…å¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸å…¬å¹³åˆ†å‘</span></span><br><span class="line"><span class="keyword">int</span> prefetchCount = <span class="number">1</span>;</span><br><span class="line">channel.basicQos(prefetchCount);</span><br></pre></td></tr></table></figure><h2 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="headerlink" title="æŒä¹…åŒ–"></a>æŒä¹…åŒ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºé˜Ÿåˆ—æ—¶ï¼Œç¬¬äºŒä¸ªå‚æ•°durableè®¾ä¸ºtrueå¼€å¯æŒä¹…åŒ–</span></span><br><span class="line">channel.queueDeclare(queueName, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line"><span class="comment">//å‘å¸ƒæ¶ˆæ¯æ—¶ï¼Œç¬¬äºŒä¸ªå‚æ•°è¿›è¡Œå“åº”çš„è®¾ç½®ï¼Œå®ç°æ¶ˆæ¯æŒä¹…åŒ–</span></span><br><span class="line">channel.basicPublish(<span class="string">&quot;&quot;</span>, QUEUE_NAME, MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes());</span><br></pre></td></tr></table></figure><h2 id="å‘å¸ƒä¸ç¡®è®¤"><a href="#å‘å¸ƒä¸ç¡®è®¤" class="headerlink" title="å‘å¸ƒä¸ç¡®è®¤"></a>å‘å¸ƒä¸ç¡®è®¤</h2><p>å½“æˆ‘ä»¬å°†é˜Ÿåˆ—ä»¥åŠæ¶ˆæ¯è¿›è¡ŒæŒä¹…åŒ–æ“ä½œåï¼Œä¿¡æ¯éœ€è¦å­˜å‚¨åˆ°ç£ç›˜ä¸Šæ‰å¯å®ŒæˆæŒä¹…åŒ–æ“ä½œï¼Œè‹¥å­˜å‚¨åˆ°ç£ç›˜çš„è¿‡ç¨‹å‘ç”Ÿäº†å®•æœºï¼Œé‚£ä¹ˆæŒä¹…åŒ–ä¹Ÿæ˜¯å¤±è´¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å¯¹ä¿¡æ¯è¿›è¡Œå‘å¸ƒä¸ç¡®è®¤ï¼Œä¿è¯ä¿¡æ¯æŒä¹…åŒ–æˆåŠŸã€‚</p><p>ä¸€èˆ¬åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§æ¨¡å¼ï¼š</p><ul><li><p>å•ä¸€ç¡®è®¤ï¼šæ¯å‘é€ä¸€æ¡æ¶ˆæ¯å°±è¿›è¡Œä¸€æ¬¡ç¡®è®¤ï¼Œæ•ˆç‡ä½</p></li><li><p>æ‰¹é‡ç¡®è®¤ï¼šå‘é€å¤šæ¡æ¶ˆæ¯åï¼Œå†è¿›è¡Œä¸€æ¬¡ç¡®è®¤</p></li><li><p>å¼‚æ­¥ç¡®è®¤ï¼šå…ˆå°†æ¶ˆæ¯å…¨éƒ¨å‘é€ï¼Œéšåç”±brokerè¿›è¡Œç¡®è®¤å¹¶è¿”å›ä¿¡æ¯ï¼Œç›¸å½“äºä¸€ä¸ªæ¶ˆæ¯çš„ç›‘å¬å™¨ï¼Œç”Ÿäº§è€…å†å°†æœªç¡®è®¤çš„æ¶ˆæ¯è¿›è¡Œé‡æ–°å‘é€</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">confirmMessage</span> </span>&#123;</span><br><span class="line">    <span class="comment">//æ¶ˆæ¯çš„æ•°æ®é‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MESSAGE_COUNT = <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        confirmMessage.singlePublish();             <span class="comment">//å•ä¸€</span></span><br><span class="line">        confirmMessage.batchPublish();              <span class="comment">//æ‰¹é‡</span></span><br><span class="line">        confirmMessage.asynchronousAllPublish();    <span class="comment">//å¼‚æ­¥æ‰¹é‡</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å•ä¸€ç¡®è®¤</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">singlePublish</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Channel channel = ChannelUtils.getChannel();</span><br><span class="line">        String queueName = UUID.randomUUID().toString();</span><br><span class="line">        channel.queueDeclare(queueName, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">//å¼€å¯å‘å¸ƒä¸ç¡®è®¤</span></span><br><span class="line">        channel.confirmSelect();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¼€å§‹æ—¶é—´</span></span><br><span class="line">        <span class="keyword">long</span> begin = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MESSAGE_COUNT; i++)&#123;</span><br><span class="line">            String message = i + <span class="string">&quot;&quot;</span>;</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, queueName, <span class="keyword">null</span>, message.getBytes());</span><br><span class="line">            channel.waitForConfirms();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘å¸ƒ&quot;</span> + MESSAGE_COUNT + <span class="string">&quot;æ¡æ•°æ®ï¼Œå•ä¸€å¤„ç†éœ€è¦è€—æ—¶&quot;</span> + (end - begin) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‰¹é‡ç¡®è®¤</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">batchPublish</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Â·Â·Â·</span><br><span class="line">        <span class="comment">//æ‰¹é‡ç¡®è®¤çš„æ¶ˆæ¯æ•°é‡é™åˆ¶</span></span><br><span class="line">        <span class="keyword">int</span> batchSize = <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MESSAGE_COUNT; i++)&#123;</span><br><span class="line">            String message = i + <span class="string">&quot;&quot;</span>;</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, queueName, <span class="keyword">null</span>, message.getBytes());</span><br><span class="line">            <span class="comment">//æ¶ˆæ¯å‘é€è¾¾åˆ°é™åˆ¶æ—¶ï¼Œéœ€è¿›è¡Œä¸€æ¬¡ç¡®è®¤</span></span><br><span class="line">            <span class="keyword">if</span>((i + <span class="number">1</span>) % batchSize == <span class="number">0</span>)&#123;</span><br><span class="line">                channel.waitForConfirms();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘å¸ƒ&quot;</span> + MESSAGE_COUNT + <span class="string">&quot;æ¡æ•°æ®ï¼Œæ‰¹é‡å¤„ç†éœ€è¦è€—æ—¶&quot;</span> + (end - begin) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¼‚æ­¥ç¡®è®¤</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">asynchronousAllPublish</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Â·Â·Â·</span><br><span class="line">        ConcurrentSkipListMap&lt;Long, String&gt; map = <span class="keyword">new</span> ConcurrentSkipListMap&lt;&gt;();</span><br><span class="line">        <span class="comment">//è®¾ç½®æˆåŠŸçš„æ¶ˆæ¯ç›‘å¬å™¨</span></span><br><span class="line">        ConfirmCallback ackCallback = (<span class="keyword">long</span> deliveryTag, <span class="keyword">boolean</span> mutiple) -&gt; &#123;</span><br><span class="line">            <span class="comment">//è¿‡æ»¤ç¡®è®¤æ¶ˆæ¯ï¼Œç•™ä¸‹æœªç¡®è®¤çš„</span></span><br><span class="line">            <span class="keyword">if</span>(mutiple)&#123;</span><br><span class="line">                ConcurrentNavigableMap&lt;Long, String&gt; confirm = map.headMap(deliveryTag);</span><br><span class="line">                confirm.clear();</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                map.remove(deliveryTag);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¡®è®¤çš„æ¶ˆæ¯&quot;</span> + deliveryTag);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//è®¾ç½®å¤±è´¥çš„æ¶ˆæ¯ç›‘å¬å™¨</span></span><br><span class="line">        ConfirmCallback nackCallback = (<span class="keyword">long</span> deliveryTag, <span class="keyword">boolean</span> mutiple) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æœªç¡®è®¤çš„æ¶ˆæ¯&quot;</span> + deliveryTag);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//å¼‚æ­¥é€šçŸ¥</span></span><br><span class="line">        channel.addConfirmListener(ackCallback, nackCallback);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MESSAGE_COUNT; i++)&#123;</span><br><span class="line">            String message = <span class="string">&quot;æ¶ˆæ¯&quot;</span> + i;</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, queueName, <span class="keyword">null</span>, message.getBytes());</span><br><span class="line">            <span class="comment">//è®°å½•æ‰€æœ‰è¦å‘é€çš„æ¶ˆæ¯ï¼Œéšååœ¨ç›‘å¬å™¨ä¸­åˆ é™¤ä¸€ç¡®è®¤çš„æ¶ˆæ¯ï¼Œç•™ä¸‹æœªç¡®è®¤çš„</span></span><br><span class="line">            map.put(channel.getNextPublishSeqNo(), message);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘å¸ƒ&quot;</span> + MESSAGE_COUNT + <span class="string">&quot;æ¡æ•°æ®ï¼Œå¼‚æ­¥å¤„ç†éœ€è¦è€—æ—¶&quot;</span> + (end - begin) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Exchangesäº¤æ¢æœº"><a href="#Exchangesäº¤æ¢æœº" class="headerlink" title="Exchangesäº¤æ¢æœº"></a>Exchangesäº¤æ¢æœº</h1><ul><li>é»˜è®¤äº¤æ¢æœºï¼šä»£ç ä¸­å°±æ˜¯ä½¿ç”¨â€â€ç©ºå­—ç¬¦ä¸²ï¼Œå³ä¸ä½¿ç”¨</li><li>ç›´è¿äº¤æ¢æœºdirectï¼šå¯¹åº”è·¯ç”±æ¨¡å¼ï¼Œä½¿ç”¨RoutingKeyåŒ¹é…é˜Ÿåˆ—</li><li>ä¸»é¢˜äº¤æ¢æœºtopicï¼šå¯¹åº”ä¸»é¢˜æ¨¡å¼</li><li>é¦–éƒ¨äº¤æ¢æœºheaders</li><li>æ‰‡å‡ºäº¤æ¢æœºfanout ï¼šå¯¹åº”å‘å¸ƒä¸è®¢é˜…æ¨¡å¼ï¼Œç›¸å½“äºå¹¿æ’­</li></ul><h2 id="ä¸´æ—¶é˜Ÿåˆ—"><a href="#ä¸´æ—¶é˜Ÿåˆ—" class="headerlink" title="ä¸´æ—¶é˜Ÿåˆ—"></a>ä¸´æ—¶é˜Ÿåˆ—</h2><p>ä¹Ÿå°±æ˜¯æ²¡æœ‰å®ç°æŒä¹…åŒ–çš„é˜Ÿåˆ—ï¼Œå…¶åå­—éšæœºï¼Œæ–­å¼€æ¶ˆè´¹è€…è¿æ¥åï¼Œé˜Ÿåˆ—ä¼šè‡ªåŠ¨åˆ é™¤ã€‚ç”¨å®Œå³åˆ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String queueName = channel.queueDeclare().getQueue();</span><br></pre></td></tr></table></figure><h1 id="è®¢é˜…ä¸å‘å¸ƒæ¨¡å¼ï¼ˆPublish-Subscribeï¼‰"><a href="#è®¢é˜…ä¸å‘å¸ƒæ¨¡å¼ï¼ˆPublish-Subscribeï¼‰" class="headerlink" title="è®¢é˜…ä¸å‘å¸ƒæ¨¡å¼ï¼ˆPublish/Subscribeï¼‰"></a>è®¢é˜…ä¸å‘å¸ƒæ¨¡å¼ï¼ˆPublish/Subscribeï¼‰</h1><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/29.png" alt="29.png"></p><p>ä¸€ä¸ªç”Ÿäº§è€…ï¼Œä¸€ä¸ªäº¤æ¢æœºï¼Œå¤šä¸ªé˜Ÿåˆ—ä»¥åŠå¤šä¸ªæ¶ˆè´¹è€…ã€‚ç”Ÿäº§è€…çš„æ¶ˆæ¯ä¸ä¼šç›´æ¥å‘é€ç»™é˜Ÿåˆ—ï¼Œè€Œæ˜¯é€šè¿‡äº¤æ¢æœºå¯¹æ¶ˆæ¯å®Œæˆåˆ†é…ã€‚å°†æ¥æ”¶çš„æ¶ˆæ¯é€šè¿‡å¹¿æ’­çš„å½¢å¼å‘é€ç»™æ‰€æœ‰é˜Ÿåˆ—ã€‚ä¹Ÿå°±æ˜¯ä¸è€ƒè™‘RoutingKeyçš„å½±å“ã€‚æ²¡æœ‰è®¾ç½®RoutingKeyã€‚ä¹Ÿå°±æ˜¯äº¤æ¢æœºçš„fanoutæ‰‡å‡ºç±»å‹çš„å®ç°ã€‚</p><h2 id="ç”Ÿäº§è€…-1"><a href="#ç”Ÿäº§è€…-1" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">fanoutProducer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXCHANGE_NAME = <span class="string">&quot;fanout&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Channel channel = ChannelUtils.getChannel();</span><br><span class="line">        Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        <span class="keyword">while</span>(scanner.hasNext())&#123;</span><br><span class="line">            String message = scanner.next();</span><br><span class="line">            channel.basicPublish(EXCHANGE_NAME, <span class="string">&quot;&quot;</span>, <span class="keyword">null</span>, message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯:&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¶ˆè´¹è€…-1"><a href="#æ¶ˆè´¹è€…-1" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h2><p>å¤šä¸ªç›¸åŒçš„æ¶ˆè´¹è€…ï¼Œä¼šé€šè¿‡äº¤æ¢æœºåŒæ—¶æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯fanoutäº¤æ¢æœºå®ç°äº†å¹¿æ’­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">fanoutConsumer1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXCHANGE_NAME = <span class="string">&quot;fanout&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Channel channel = ChannelUtils.getChannel();</span><br><span class="line">        <span class="comment">//å£°æ˜äº¤æ¢æœºï¼Œ1ã€äº¤æ¢æœºåï¼Œ2ã€äº¤æ¢æœºç±»å‹</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.FANOUT);</span><br><span class="line">        <span class="comment">//ä¸´æ—¶é˜Ÿåˆ—</span></span><br><span class="line">        String queueName = channel.queueDeclare().getQueue();</span><br><span class="line">        <span class="comment">//ç»‘å®šäº¤æ¢æœºä¸é˜Ÿåˆ—ï¼Œ1ã€é˜Ÿåˆ—åï¼Œ2ã€äº¤æ¢æœºåï¼Œ3ã€RoutingKey</span></span><br><span class="line">        channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¶ˆæ¯è¿›è¡Œæ¥æ”¶Â·Â·Â·&quot;</span>);</span><br><span class="line"></span><br><span class="line">        DeliverCallback deliverCallback = (String consumerTag, Delivery message) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;1å·æµ‹è¯•æ¥æ”¶çš„æ¶ˆæ¯ï¼š&quot;</span> + <span class="keyword">new</span> String(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        CancelCallback cancelCallback = (String consumerTag) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆæ¯è¢«ä¸­æ–­&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(queueName, <span class="keyword">true</span>, deliverCallback, cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è·¯ç”±æ¨¡å¼ï¼ˆRoutingï¼‰"><a href="#è·¯ç”±æ¨¡å¼ï¼ˆRoutingï¼‰" class="headerlink" title="è·¯ç”±æ¨¡å¼ï¼ˆRoutingï¼‰"></a>è·¯ç”±æ¨¡å¼ï¼ˆRoutingï¼‰</h1><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/30.png" alt="30.png"></p><p>åŸºäºå‘å¸ƒä¸è®¢é˜…æ¨¡å¼ï¼Œåªæ˜¯äº¤æ¢æœºç±»å‹æ”¹ä¸ºä½¿ç”¨directtï¼Œäº¤æ¢æœºå‘é€æ¶ˆæ¯æ ¹æ®ç»‘å®šçš„RoutingKeyæ¥åˆ†é…é˜Ÿåˆ—ã€‚ä¸»è¦RoutingKeyåŒ¹é…çš„é˜Ÿåˆ—éƒ½ä¼šæ¥æ”¶æ¶ˆæ¯ï¼Œæ‰€ä»¥è‹¥å…¨éƒ¨é˜Ÿåˆ—çš„RoutingKeyä¸€è‡´ï¼Œå°±ç›¸å½“äºfanoutç±»å‹è¿›è¡Œå¹¿æ’­ã€‚</p><h2 id="ç”Ÿäº§è€…-2"><a href="#ç”Ÿäº§è€…-2" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h2><p>æˆ‘ä»¬å‘é€ä¿¡æ¯æ—¶ï¼Œç»™äº¤æ¢æœºåˆ†é…ä¸åŒçš„RoutingKeyï¼Œå°±ä¼šå‘é€ç»™ç›¸å¯¹åº”çš„é˜Ÿåˆ—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">directProducer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXCHANGE_NAME = <span class="string">&quot;direct&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Channel channel = ChannelUtils.getChannel();</span><br><span class="line">        Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        <span class="keyword">while</span>(scanner.hasNext())&#123;</span><br><span class="line">            String message = scanner.next();</span><br><span class="line">            channel.basicPublish(EXCHANGE_NAME, <span class="string">&quot;222&quot;</span>, <span class="keyword">null</span>, message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯:&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¶ˆè´¹è€…-2"><a href="#æ¶ˆè´¹è€…-2" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">directConsumer1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXCHANGE_NAME = <span class="string">&quot;direct&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Channel channel = ChannelUtils.getChannel();</span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class="line">        String queueName = channel.queueDeclare().getQueue();</span><br><span class="line">        channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;111&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¶ˆæ¯è¿›è¡Œæ¥æ”¶Â·Â·Â·&quot;</span>);</span><br><span class="line">        DeliverCallback deliverCallback = (String consumerTag, Delivery message) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;1å·æµ‹è¯•æ¥æ”¶çš„æ¶ˆæ¯ï¼š&quot;</span> + <span class="keyword">new</span> String(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line">        CancelCallback cancelCallback = (String consumerTag) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆæ¯è¢«ä¸­æ–­&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(queueName, <span class="keyword">true</span>, deliverCallback, cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä¸»é¢˜æ¨¡å¼ï¼ˆTopicsï¼‰"><a href="#ä¸»é¢˜æ¨¡å¼ï¼ˆTopicsï¼‰" class="headerlink" title="ä¸»é¢˜æ¨¡å¼ï¼ˆTopicsï¼‰"></a>ä¸»é¢˜æ¨¡å¼ï¼ˆTopicsï¼‰</h1><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/31.png" alt="31.png"></p><p>ç”±äºè·¯ç”±æ¨¡å¼ä½¿ç”¨directï¼Œå…¶æ¶ˆæ¯æ˜¯ä¸€ä¸€å¯¹åº”å‘é€çš„ï¼Œæœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œå› ä¸ºRoutingKeyç»Ÿä¸€ï¼Œæˆ‘ä»¬é˜Ÿåˆ—ä¸èƒ½åŒæ—¶æ¥æ”¶å¤šä¸ªä¸åŒçš„RoutingKeyã€‚ä¾‹å¦‚æˆ‘ä»¬é˜Ÿåˆ—æƒ³æ¥æ”¶ tc.name ä¸ tc.age è¿™ä¸¤ä¸ªæ¶ˆæ¯ï¼Œä½†ä½¿ç”¨directåªèƒ½æ˜ç¡®æŒ‡æ˜å…¶ä¸­ä¸€ç§ï¼Œæ­¤æ—¶å°±è¦ä½¿ç”¨topicä¸»é¢˜æ¨¡å¼ï¼Œç›¸å½“äºå¯¹RoutingKeyè¿›è¡Œæ¨¡ç³ŠåŒ–å¤„ç†ï¼ŒåŒ¹é…å…¨éƒ¨ç›¸å…³è”çš„RoutingKeyè¿›è¡Œå‘é€ã€‚</p><p>å³ä½¿ä¸€ä¸ªé˜Ÿåˆ—å¯ä»¥åŒ¹é…å¤šä¸ªRoutingKeyï¼Œä½†åŒä¸€ä¸ªé˜Ÿåˆ—æ¯æ¬¡åªèƒ½æ¥æ”¶ä¸€æ¬¡æ¶ˆæ¯ã€‚</p><h2 id="å®šä¹‰ä»¥åŠæ¨¡ç³ŠåŒ¹é…"><a href="#å®šä¹‰ä»¥åŠæ¨¡ç³ŠåŒ¹é…" class="headerlink" title="å®šä¹‰ä»¥åŠæ¨¡ç³ŠåŒ¹é…"></a>å®šä¹‰ä»¥åŠæ¨¡ç³ŠåŒ¹é…</h2><p>ä¸»é¢˜æ¨¡å¼çš„RoutingKeyå¿…é¡»æ˜¯ä¸€ä¸ªå•è¯åˆ—è¡¨ï¼Œé€šè¿‡ . è¿›è¡Œåˆ†å‰²ï¼Œæœ€å¤š255å­—èŠ‚ã€‚ä¾‹å¦‚ tc.nameã€tc.ageè¿™æ ·å®šä¹‰ï¼Œä¸€èˆ¬å¸¦æœ‰ä¸€å®šçš„æŒ‡å‘æ€§ã€‚ç„¶åtopicä¸­å°±å¯ä»¥ä½¿ç”¨ç±»ä¼¼sqlçš„é€šé…ç¬¦è¿›è¡Œæ¨¡ç³ŠåŒ¹é…ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* ä»£è¡¨ä»»æ„ä¸€ä¸ªè¯</span><br><span class="line"># å¯ä»£è¡¨0æˆ–å¤šä¸ªå•è¯</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´RoutingKeyå®šä¹‰ä¸º tc.* ï¼Œå¯ä»¥åŒæ—¶åŒ¹é…tc.name å’Œ tc.ageã€‚ </p><p>*<em>æ³¨æ„è‹¥åªç»‘å®š#ï¼Œå°±ç›¸å½“äºfanoutç±»å‹ï¼Œå› ä¸ºéƒ½å¯ä»¥åŒ¹é…ã€‚è€Œç»‘å®šçš„RoutingKeyæ²¡æœ‰å‡ºç° <em>æˆ–#ï¼Œè¯´æ˜æ²¡æœ‰åšæ¨¡ç³ŠåŒ¹é…å¤„ç†ï¼Œå°±ç›¸å½“äºdirectç±»å‹ã€‚å¯ä»¥è¯´topicåŒ…æ‹¬äº†fanoutä¸directã€‚</em></em></p><h2 id="ç”Ÿäº§è€…-3"><a href="#ç”Ÿäº§è€…-3" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">topicProducer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXCHANGE_NAME = <span class="string">&quot;topic&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Channel channel = ChannelUtils.getChannel();</span><br><span class="line">        HashMap&lt;String, String&gt; bindMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        bindMap.put(<span class="string">&quot;quick.orange.rabbit&quot;</span>, <span class="string">&quot;Q1ã€Q2&quot;</span>);</span><br><span class="line">        bindMap.put(<span class="string">&quot;lazy.orange.elephant&quot;</span>, <span class="string">&quot;Q1ã€Q2&quot;</span>);</span><br><span class="line">        bindMap.put(<span class="string">&quot;quick.orange.fox&quot;</span>, <span class="string">&quot;Q1&quot;</span>);</span><br><span class="line">        bindMap.put(<span class="string">&quot;lazy.brown.fox&quot;</span>, <span class="string">&quot;Q2&quot;</span>);</span><br><span class="line">        bindMap.put(<span class="string">&quot;lazy.pink.rabbit&quot;</span>, <span class="string">&quot;Q2&quot;</span>);</span><br><span class="line">        bindMap.put(<span class="string">&quot;quick.brown.fox&quot;</span>, <span class="string">&quot;null&quot;</span>);</span><br><span class="line">        bindMap.put(<span class="string">&quot;quick.orange.male.rabit&quot;</span>, <span class="string">&quot;null&quot;</span>);</span><br><span class="line">        bindMap.put(<span class="string">&quot;lazy.orange.male.rabbit&quot;</span>, <span class="string">&quot;Q2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;String, String&gt; entry : bindMap.entrySet())&#123;</span><br><span class="line">            String RoutingKey = entry.getKey();</span><br><span class="line">            String info = entry.getValue();</span><br><span class="line">            channel.basicPublish(EXCHANGE_NAME, RoutingKey, <span class="keyword">null</span>, info.getBytes() );</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯:&quot;</span> + info);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¶ˆè´¹è€…-3"><a href="#æ¶ˆè´¹è€…-3" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h2><p>æµ‹è¯•åå¯ä»¥å‘ç°äº¤æ¢æœºæŒ‰ç…§æ¨¡ç³ŠåŒ¹ï¼Œå‘é˜Ÿåˆ—å‘é€æ¶ˆæ¯ã€‚</p><p>ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥ç»‘å®šå¤šä¸ªRoutingKeyã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">topicConsumer1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXCHANGE_NAME = <span class="string">&quot;topic&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Channel channel = ChannelUtils.getChannel();</span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, <span class="string">&quot;topic&quot;</span>);</span><br><span class="line">        String queueName = <span class="string">&quot;Q1&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line">        channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;*.orange.*&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯Â·Â·Â·Â·Â·Â·&quot;</span>);</span><br><span class="line">        DeliverCallback deliverCallback = (String consumerTag, Delivery message) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Q1é˜Ÿåˆ—æ¥æ”¶çš„æ¶ˆæ¯ï¼š&quot;</span> + <span class="keyword">new</span> String(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥æ”¶çš„é˜Ÿåˆ—æ˜¯&quot;</span> + queueName + <span class="string">&quot;ï¼Œç»‘å®šçš„Keyæ˜¯&quot;</span> + message.getEnvelope().getRoutingKey());</span><br><span class="line">        &#125;;</span><br><span class="line">        CancelCallback cancelCallback = (String consumerTag) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆæ¯è¢«ä¸­æ–­&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(queueName, <span class="keyword">true</span>, deliverCallback, cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="RPCæ¨¡å¼"><a href="#RPCæ¨¡å¼" class="headerlink" title="RPCæ¨¡å¼"></a>RPCæ¨¡å¼</h1><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/32.png" alt="32.png"></p><h1 id="æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLXï¼‰"><a href="#æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLXï¼‰" class="headerlink" title="æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLXï¼‰"></a>æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLXï¼‰</h1><p>æ­»ä¿¡ï¼ˆdead-letter-exchangeï¼‰å³æ— æ³•è¢«æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œä¾‹å¦‚æˆ‘ä»¬å¾®ä¿¡ä»˜æ¬¾ï¼Œæœ‰ä¸€ä¸ªä»˜æ¬¾æ—¶é—´ï¼Œè¶…è¿‡æ—¶é—´çš„ä»˜æ¬¾åº”å½’ä¸ºæ­»ä¿¡ï¼Œéœ€è¦ç”±åŸé˜Ÿåˆ—æ¨ç»™æ­»ä¿¡é˜Ÿåˆ—è¿›è¡Œå¤„ç†ã€‚ä¸€èˆ¬æˆä¸ºæ­»ä¿¡æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ul><li>æ¶ˆæ¯è¢«æ‹’ç»ï¼šè¢«æ­£å¸¸é˜Ÿåˆ—æ‹’ç»ï¼Œåˆ™å½’ä¸ºæ­»ä¿¡</li><li>æ¶ˆæ¯TTLè¿‡æœŸï¼šç›´åˆ°æ—¶é—´è¿‡æœŸï¼Œä»æœªæ¥æ”¶åˆ°æ¶ˆæ¯åˆ™å½’ä¸ºæ­»ä¿¡</li><li>é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦ï¼šå½“æ¶ˆæ¯è¶…è¿‡é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦æ—¶ï¼Œå½’ä¸ºæ­»ä¿¡</li></ul><p>æµ‹è¯•æ—¶ï¼Œå…ˆå°†æ­£å¸¸æ¶ˆè´¹è€…å¯åŠ¨åˆ›å»ºéœ€è¦çš„é˜Ÿåˆ—ï¼Œç„¶ååœæ‰æ¶ˆè´¹è€…ï¼Œå¯åŠ¨ç”Ÿäº§è€…ï¼Œæœ€åå¯åŠ¨æ­»ä¿¡é˜Ÿåˆ—æ¶ˆè´¹è€…æŸ¥çœ‹æ­»ä¿¡é˜Ÿåˆ—çš„æƒ…å†µã€‚</p><h2 id="ç”Ÿäº§è€…-4"><a href="#ç”Ÿäº§è€…-4" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DLXProducer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NORMAL_EXCHANGE = <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Channel channel = ChannelUtils.getChannel();</span><br><span class="line">        <span class="comment">// æ­»ä¿¡æ¶ˆæ¯ï¼Œè®¾ç½®TTLæ—¶é—´ï¼Œè‹¥æµ‹è¯•æœ€å¤§é•¿åº¦åˆ™è¦æ³¨é‡Šæ‰TTL</span></span><br><span class="line">        AMQP.BasicProperties properties = <span class="keyword">new</span> AMQP.BasicProperties().builder().expiration(<span class="string">&quot;10000&quot;</span>).build();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">11</span>; i++)&#123;</span><br><span class="line">            String message = <span class="string">&quot;info&quot;</span> + i;</span><br><span class="line">            channel.basicPublish(NORMAL_EXCHANGE, <span class="string">&quot;normal&quot;</span>, properties, message.getBytes());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¶ˆè´¹è€…-4"><a href="#æ¶ˆè´¹è€…-4" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ­£å¸¸é˜Ÿåˆ—æ¶ˆè´¹è€…ï¼Œéœ€è¦å…³è”æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">// è¿™é‡Œæ¨¡æ‹Ÿäº†TTLå’Œæœ€å¤§é•¿åº¦</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DLXConsumer1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NORMAL_EXCHANGE = <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEAD_EXCHANGE = <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NORMAL_QUEUE = <span class="string">&quot;normal_queue&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEAD_QUEUE = <span class="string">&quot;dead_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Channel channel = ChannelUtils.getChannel();</span><br><span class="line">        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        channel.exchangeDeclare(DEAD_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç°åœ¨è¦å°†æ™®é€šé˜Ÿåˆ—ä¸æ­»ä¿¡é˜Ÿåˆ—å…³è”èµ·æ¥ï¼Œæ–¹ä¾¿æ­»ä¿¡æ¶ˆæ¯çš„å¤„ç†</span></span><br><span class="line">        <span class="comment">// éœ€è¦å¯¹æœ€åä¸€ä¸ªå‚æ•°è¿›è¡Œè®¾ç½®</span></span><br><span class="line">        Map&lt;String, Object&gt; arguments = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">// ä¸ºæ™®é€šé˜Ÿåˆ—è®¾ç½®å¯¹åº”çš„æ­»ä¿¡äº¤æ¢æœºä»¥åŠæ­»ä¿¡çš„RoutingKey</span></span><br><span class="line">        <span class="comment">// æ³¨æ„è¿™é‡Œé”®æ˜¯è§„å®šå¥½çš„</span></span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, DEAD_EXCHANGE);</span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="string">&quot;dead&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¯è®¾ç½®æœ€å¤§é•¿åº¦ï¼Œè¶…è¿‡é•¿åº¦çš„æ¶ˆæ¯å½’ä¸ºæ­»ä¿¡</span></span><br><span class="line">        <span class="comment">// arguments.put(&quot;x-max-length&quot;, 6);</span></span><br><span class="line">        </span><br><span class="line">        channel.queueDeclare(NORMAL_QUEUE, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, arguments);</span><br><span class="line">        channel.queueDeclare(DEAD_QUEUE, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line">        channel.queueBind(NORMAL_QUEUE, NORMAL_EXCHANGE, <span class="string">&quot;normal&quot;</span>);</span><br><span class="line">        channel.queueBind(DEAD_QUEUE, DEAD_EXCHANGE, <span class="string">&quot;dead&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯&quot;</span>);</span><br><span class="line"></span><br><span class="line">        DeliverCallback deliverCallback = (String consumerTag, Delivery message) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Consumer1æ¥æ”¶çš„æ¶ˆæ¯æ˜¯ï¼š&quot;</span> + <span class="keyword">new</span> String(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line">        CancelCallback cancelCallback = (String consumerTag) -&gt; &#123;&#125;;</span><br><span class="line">        channel.basicConsume(NORMAL_QUEUE, <span class="keyword">true</span>, deliverCallback, cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ­»ä¿¡é˜Ÿåˆ—æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DLXConsumer2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEAD_QUEUE = <span class="string">&quot;dead_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Channel channel = ChannelUtils.getChannel();</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯&quot;</span>);</span><br><span class="line">        DeliverCallback deliverCallback = (String consumerTag, Delivery message) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Consumer2æ¥æ”¶çš„æ¶ˆæ¯æ˜¯ï¼š&quot;</span> + <span class="keyword">new</span> String(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line">        CancelCallback cancelCallback = (String consumerTag) -&gt; &#123;&#125;;</span><br><span class="line">        channel.basicConsume(DEAD_QUEUE, <span class="keyword">true</span>, deliverCallback, cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰‹åŠ¨æ‹’ç»æ¶ˆæ¯ï¼Œæ¨¡æ‹Ÿæ¶ˆæ¯æ‹’ç»çš„æƒ…å†µï¼Œæ›¿æ¢æ­£å¸¸æ¶ˆè´¹è€…çš„DeliverCallbackæ¥å£å®ç°å³å¯</span></span><br><span class="line">DeliverCallback deliverCallback = (String consumerTag, Delivery message) -&gt; &#123;</span><br><span class="line">            String msg = <span class="keyword">new</span> String(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(msg.equals(<span class="string">&quot;info5&quot;</span>) || msg.equals(<span class="string">&quot;info8&quot;</span>) || msg.equals(<span class="string">&quot;info9&quot;</span>))&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Consumer1æ‹’ç»çš„æ¶ˆæ¯æ˜¯ï¼š&quot;</span> + msg);</span><br><span class="line">                <span class="comment">// æ‹’ç»æ¶ˆæ¯ï¼Œfalseä»£è¡¨ä¸è¿”å›é˜Ÿåˆ—</span></span><br><span class="line">                channel.basicReject(message.getEnvelope().getDeliveryTag(), <span class="keyword">false</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Consumer1æ¥æ”¶çš„æ¶ˆæ¯æ˜¯ï¼š&quot;</span> + msg);</span><br><span class="line">                channel.basicAck(message.getEnvelope().getDeliveryTag(), <span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"><span class="comment">// æ³¨æ„æ­¤æ—¶éœ€è¦ä½¿ç”¨æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line">channel.basicConsume(NORMAL_QUEUE, <span class="keyword">false</span>, deliverCallback, cancelCallback);</span><br></pre></td></tr></table></figure><h1 id="å»¶è¿Ÿé˜Ÿåˆ—"><a href="#å»¶è¿Ÿé˜Ÿåˆ—" class="headerlink" title="å»¶è¿Ÿé˜Ÿåˆ—"></a>å»¶è¿Ÿé˜Ÿåˆ—</h1><p><strong>å»¶è¿Ÿé˜Ÿåˆ—å¯ç†è§£ä¸ºæ­»ä¿¡é˜Ÿåˆ—ä¸­çš„TTLè¿‡æœŸæƒ…å†µ</strong>ã€‚å…·ä½“åœºæ™¯å¦‚æˆ‘ä»¬ç½‘ä¸Šè´­ç¥¨ï¼Œå…ˆç¡®å®šè®¢å•ï¼Œæ­¤æ—¶æˆ‘ä»¬å ç”¨äº†ä¸€å¼ ç¥¨ï¼Œè‹¥è§„å®šæ—¶é—´å†…æˆ‘ä»¬æ²¡æœ‰ä»˜æ¬¾ï¼Œé‚£ä¹ˆè¶…æ—¶åå°±æ— æ³•å¯¹è®¢å•ä»˜æ¬¾ï¼Œè¿™ä¸ªç¥¨ä¹Ÿé‡æ–°å›åˆ°ä»£å”®çš„çŠ¶æ€ã€‚é™æ—¶çš„çŸ­ä¿¡éªŒè¯ä¹Ÿæ˜¯å»¶è¿Ÿé˜Ÿåˆ—çš„è¿ç”¨ã€‚</p><p>è€Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼å®ç°å»¶è¿Ÿé˜Ÿåˆ—ï¼š</p><ul><li>åŸºäºæ­»ä¿¡é˜Ÿåˆ—çš„TTLå®ç°</li><li>åŸºäºå®˜æ–¹æ’ä»¶çš„äº¤æ¢æœºå»¶è¿Ÿå®ç°</li></ul><h2 id="æ•´åˆSpring-Bootä¾èµ–ä»¥åŠé…ç½®"><a href="#æ•´åˆSpring-Bootä¾èµ–ä»¥åŠé…ç½®" class="headerlink" title="æ•´åˆSpring Bootä¾èµ–ä»¥åŠé…ç½®"></a>æ•´åˆSpring Bootä¾èµ–ä»¥åŠé…ç½®</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.50<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.amqp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-rabbit-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.158</span><span class="number">.136</span></span><br><span class="line">    <span class="comment"># æ³¨æ„ç«¯å£ä¸æ˜¯15672</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">111</span></span><br></pre></td></tr></table></figure><h2 id="åŸºäºæ­»ä¿¡å®ç°çš„å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆé˜Ÿåˆ—å»¶è¿Ÿï¼‰"><a href="#åŸºäºæ­»ä¿¡å®ç°çš„å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆé˜Ÿåˆ—å»¶è¿Ÿï¼‰" class="headerlink" title="åŸºäºæ­»ä¿¡å®ç°çš„å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆé˜Ÿåˆ—å»¶è¿Ÿï¼‰"></a>åŸºäºæ­»ä¿¡å®ç°çš„å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆé˜Ÿåˆ—å»¶è¿Ÿï¼‰</h2><p>æ•´ä½“æµç¨‹å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image@main/33.png" alt="33.png"></p><p>æˆ‘ä»¬é€šè¿‡è®¾ç½®é˜Ÿåˆ—çš„TTLå¤±æ•ˆæ—¶é—´æ¥æ¨¡æ‹Ÿå»¶è¿Ÿé˜Ÿåˆ—ï¼Œä½†æœ‰ä¸€ä¸ªç¼ºé™·ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸å¯èƒ½æ¯æ¬¡éƒ½è§„å®šå¥½TTLï¼Œé‚£ä¹ˆæ¯æœ‰ä¸€ä¸ªæ–°TTLå°±è¦æ–°å¢ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰å»¶æ—¶ä¹Ÿå°±æ˜¯queueCè§£å†³ï¼Œä½†åˆæœ‰æ–°é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªè‡ªå®šä¹‰å»¶è¿Ÿæ˜¯èµ°åŒä¸€ä¸ªé˜Ÿåˆ—çš„ï¼Œä¼šæœ‰é˜Ÿåˆ—é˜»å¡çš„æƒ…å†µå‘ç”Ÿï¼Œä¹Ÿå°±æ˜¯å½“æˆ‘ä»¬å…ˆå‘é€ä¸€ä¸ªå»¶æ—¶æ—¶é•¿è¾ƒé•¿çš„æ¶ˆæ¯ï¼Œåå‘é€ä¸€ä¸ªå»¶æ—¶æ—¶é•¿è¾ƒçŸ­çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆè¾ƒçŸ­çš„æ¶ˆæ¯éœ€è¦ç­‰å¾…è¾ƒé•¿æ¶ˆæ¯å¤„ç†å®Œåå†å¤„ç†ï¼Œä¸¥æ ¼éµå®ˆé˜Ÿåˆ—çš„å…ˆè¿›å…ˆå‡ºã€‚</p><ul><li>æ‰€æœ‰çš„é˜Ÿåˆ—ä»¥åŠäº¤æ¢æœºçš„è®¾ç½®</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TTLQueueConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ™®é€šäº¤æ¢æœºä¸æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NORMAL_EXCHANGE = <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEAD_EXCHANGE = <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">// å¤šä¸ªæ™®é€šé˜Ÿåˆ—ï¼Œå»¶æ—¶ä¸ä¸€æ ·</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_A = <span class="string">&quot;queueA&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_B = <span class="string">&quot;queueB&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_C = <span class="string">&quot;queueC&quot;</span>; <span class="comment">//è‡ªå®šä¹‰å»¶æ—¶</span></span><br><span class="line">    <span class="comment">// æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEAD_QUEUE = <span class="string">&quot;deadQueue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†ä¸¤ä¸ªäº¤æ¢æœºã€3ä¸ªé˜Ÿåˆ—å…¨éƒ¨è¿›è¡Œç»„ä»¶å£°æ˜</span></span><br><span class="line">    <span class="meta">@Bean(&quot;nExchange&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DirectExchange <span class="title">nExchange</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DirectExchange(NORMAL_EXCHANGE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean(&quot;dExchange&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DirectExchange <span class="title">dExchange</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DirectExchange(DEAD_EXCHANGE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean(&quot;queueA&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">queueA</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; arguments = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, DEAD_EXCHANGE);</span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="string">&quot;dead&quot;</span>);</span><br><span class="line">        arguments.put(<span class="string">&quot;x-message-ttl&quot;</span>, <span class="number">10000</span>);</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(QUEUE_A).withArguments(arguments).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean(&quot;queueB&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">queueB</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; arguments = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, DEAD_EXCHANGE);</span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="string">&quot;dead&quot;</span>);</span><br><span class="line">        arguments.put(<span class="string">&quot;x-message-ttl&quot;</span>, <span class="number">30000</span>);</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(QUEUE_B).withArguments(arguments).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰é˜Ÿåˆ—ï¼Œå¯æ»¡è¶³ä¸åŒçš„TTL</span></span><br><span class="line">    <span class="meta">@Bean(&quot;queueC&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">queueC</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; arguments = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, DEAD_EXCHANGE);</span><br><span class="line">        arguments.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="string">&quot;dead&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(QUEUE_C).withArguments(arguments).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean(&quot;deadQueue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">deadQueue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(DEAD_QUEUE).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ™®é€šé˜Ÿåˆ—ä¸æ­»ä¿¡é˜Ÿåˆ—è¿›è¡Œç»‘å®š</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">queueABindNormal</span><span class="params">(<span class="meta">@Qualifier(&quot;queueA&quot;)</span> Queue queueA,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    <span class="meta">@Qualifier(&quot;nExchange&quot;)</span> DirectExchange nExchange)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueA).to(nExchange).with(<span class="string">&quot;normalA&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">queueBBindNormal</span><span class="params">(<span class="meta">@Qualifier(&quot;queueB&quot;)</span> Queue queueB,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    <span class="meta">@Qualifier(&quot;nExchange&quot;)</span> DirectExchange nExchange)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueB).to(nExchange).with(<span class="string">&quot;normalB&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">queueCBindNormal</span><span class="params">(<span class="meta">@Qualifier(&quot;queueC&quot;)</span> Queue queueC,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    <span class="meta">@Qualifier(&quot;nExchange&quot;)</span> DirectExchange nExchange)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueC).to(nExchange).with(<span class="string">&quot;normalC&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">deadQueueBindDead</span><span class="params">(<span class="meta">@Qualifier(&quot;deadQueue&quot;)</span> Queue deadQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     <span class="meta">@Qualifier(&quot;dExchange&quot;)</span> DirectExchange dExchange)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(deadQueue).to(dExchange).with(<span class="string">&quot;dead&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç”Ÿäº§è€…P</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/ttl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">sendMsgController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendMsg/&#123;message&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMsg</span><span class="params">(<span class="meta">@PathVariable</span> String message)</span></span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¼€å§‹æ—¶é—´:&#123;&#125;ï¼Œå‘é€æ¶ˆæ¯ç»™ä¸¤ä¸ªTTLé˜Ÿåˆ—:&#123;&#125;&quot;</span>, <span class="keyword">new</span> Date().toString(), message);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;normal_exchange&quot;</span>, <span class="string">&quot;normalA&quot;</span>, <span class="string">&quot;10sçš„TTLé˜Ÿåˆ—ï¼š&quot;</span> + message);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;normal_exchange&quot;</span>, <span class="string">&quot;normalB&quot;</span>, <span class="string">&quot;40sçš„TTLé˜Ÿåˆ—ï¼š&quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendTTLMsg/&#123;message&#125;/&#123;TTL&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMsg</span><span class="params">(<span class="meta">@PathVariable</span> String message, <span class="meta">@PathVariable</span> String TTL)</span></span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¼€å§‹æ—¶é—´:&#123;&#125;ï¼Œå‘é€è‡ªå®šä¹‰TTLä¸º&#123;&#125;msçš„æ¶ˆæ¯ç»™é˜Ÿåˆ—:&#123;&#125;&quot;</span>, <span class="keyword">new</span> Date().toString(), TTL, message);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;normal_exchange&quot;</span>, <span class="string">&quot;normalC&quot;</span>, message, msg -&gt;&#123;</span><br><span class="line">            <span class="comment">// è‡ªå®šä¹‰å»¶è¿Ÿæ—¶é•¿</span></span><br><span class="line">            msg.getMessageProperties().setExpiration(TTL);</span><br><span class="line">            <span class="keyword">return</span> msg;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ¶ˆè´¹è€…C</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">deadQueueConsumer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;deadQueue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(Message message)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        String msg = <span class="keyword">new</span> String(message.getBody());</span><br><span class="line">        log.info(<span class="string">&quot;æ¥æ”¶æ—¶é—´:&#123;&#125;ï¼Œæ”¶åˆ°æ­»ä¿¡é˜Ÿåˆ—çš„æ¶ˆæ¯:&#123;&#125;&quot;</span>, <span class="keyword">new</span> Date().toString(), msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="RabbitMQæ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆäº¤æ¢æœºå»¶è¿Ÿï¼Œæ¨èï¼‰"><a href="#RabbitMQæ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆäº¤æ¢æœºå»¶è¿Ÿï¼Œæ¨èï¼‰" class="headerlink" title="RabbitMQæ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆäº¤æ¢æœºå»¶è¿Ÿï¼Œæ¨èï¼‰"></a>RabbitMQæ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆäº¤æ¢æœºå»¶è¿Ÿï¼Œæ¨èï¼‰</h2><p>githubï¼š<a href="https://github.com/rabbitmq/rabbitmq-delayed-message-exchange/releases/tag/v3.8.0">https://github.com/rabbitmq/rabbitmq-delayed-message-exchange/releases/tag/v3.8.0</a></p><p>ä¸‹è½½å®˜æ–¹æ’ä»¶ï¼Œå°†å‹ç¼©åŒ…æ”¾åˆ°MQçš„æ’ä»¶ç›®å½• /usr/lib/rabbitmq/lib/rabbitmq_server-3.8.8/plugins ï¼Œç„¶åé‡å¯MQï¼Œéšåæˆ‘ä»¬åœ¨Webç®¡ç†ç•Œé¢çš„äº¤æ¢æœºç±»å‹ä¸­çœ‹è§ x-delayed-message ï¼Œä¹Ÿå°±æ˜¯å®˜æ–¹æ’ä»¶çš„å»¶è¿Ÿé˜Ÿåˆ—å®ç°ã€‚</p><p>æ’ä»¶å®ç°å»¶è¿Ÿï¼Œæ•´ä½“æµç¨‹æ›´ç®€å•ï¼Œä»…ä»…åªéœ€è¦ä¸€ä¸ªé˜Ÿåˆ—å’Œä¸€ä¸ªäº¤æ¢æœºã€‚ç”±äº¤æ¢æœºå†…éƒ¨è¿›è¡Œå»¶æ—¶çš„è®¾å®šï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å¯¹äº¤æ¢æœºè¿›è¡Œå‚æ•°é…ç½®ã€‚</p><p>å®Œæˆæ’ä»¶å»¶è¿Ÿé˜Ÿåˆ—åï¼Œä¸ä¼šå‡ºç°TTLé‚£ç§åŒä¸€ä¸ªé˜Ÿåˆ—æ‹¥å¡çš„æƒ…å†µã€‚æ‰€ä»¥æ¨èä½¿ç”¨æ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—ã€‚</p><ul><li>æ’ä»¶å£°æ˜é˜Ÿåˆ—ä¸å»¶è¿Ÿäº¤æ¢æœº</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelayedQueueConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DELAYED_QUEUE = <span class="string">&quot;delayed_queue&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DELAYED_EXCHANGE = <span class="string">&quot;delayed_exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DELAYED_ROUTING_KEY = <span class="string">&quot;delayed_routing_key&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">delayedQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(DELAYED_QUEUE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å£°æ˜è‡ªå®šä¹‰äº¤æ¢æœº</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CustomExchange <span class="title">delayedExchange</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œå…¶ä»–å‚æ•°ä»£è¡¨ç›´è¿çš„å»¶è¿Ÿç±»å‹ï¼Œä¸‹é¢æŒ‡è¿™ä¸ªæ˜¯å»¶è¿Ÿæ¶ˆæ¯</span></span><br><span class="line">        Map&lt;String, Object&gt; arguments = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        arguments.put(<span class="string">&quot;x-delayed-type&quot;</span>, <span class="string">&quot;direct&quot;</span>);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 1ã€äº¤æ¢æœºåç§°</span></span><br><span class="line"><span class="comment">         * 2ã€äº¤æ¢æœºç±»å‹</span></span><br><span class="line"><span class="comment">         * 3ã€æ˜¯å¦æŒä¹…åŒ–</span></span><br><span class="line"><span class="comment">         * 4ã€æ˜¯å¦è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         * 5ã€å…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CustomExchange(DELAYED_EXCHANGE, <span class="string">&quot;x-delayed-message&quot;</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, arguments);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å®Œæˆç»‘å®š</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">delayedBind</span><span class="params">(<span class="meta">@Qualifier(&quot;delayedQueue&quot;)</span> Queue delayedQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                               <span class="meta">@Qualifier(&quot;delayedExchange&quot;)</span> CustomExchange delayedExchange)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(delayedQueue).to(delayedExchange).with(DELAYED_ROUTING_KEY).noargs();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç”Ÿäº§è€…</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/sendDelayMsg/&#123;message&#125;/&#123;delayTime&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMsg</span><span class="params">(<span class="meta">@PathVariable</span> String message, <span class="meta">@PathVariable</span> Integer delayTime)</span></span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;å¼€å§‹æ—¶é—´:&#123;&#125;ï¼Œå‘é€æ’ä»¶å»¶æ—¶ä¸º&#123;&#125;msçš„æ¶ˆæ¯ç»™é˜Ÿåˆ—:&#123;&#125;&quot;</span>, <span class="keyword">new</span> Date().toString(), delayTime, message);</span><br><span class="line">    rabbitTemplate.convertAndSend(DelayedQueueConfig.DELAYED_EXCHANGE, DelayedQueueConfig.DELAYED_ROUTING_KEY, message, msg -&gt;&#123;</span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰å»¶è¿Ÿæ—¶é•¿ms</span></span><br><span class="line">        msg.getMessageProperties().setDelay(delayTime);</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ’ä»¶å»¶è¿Ÿæ¶ˆè´¹è€…</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">delayQueueConsumer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = DelayedQueueConfig.DELAYED_QUEUE)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(Message message)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        String msg = <span class="keyword">new</span> String(message.getBody());</span><br><span class="line">        log.info(<span class="string">&quot;æ¥æ”¶æ—¶é—´:&#123;&#125;ï¼Œæ”¶åˆ°æ­»ä¿¡é˜Ÿåˆ—çš„æ¶ˆæ¯:&#123;&#125;&quot;</span>, <span class="keyword">new</span> Date().toString(), msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‘å¸ƒä¸ç¡®è®¤è¿›é˜¶"><a href="#å‘å¸ƒä¸ç¡®è®¤è¿›é˜¶" class="headerlink" title="å‘å¸ƒä¸ç¡®è®¤è¿›é˜¶"></a>å‘å¸ƒä¸ç¡®è®¤è¿›é˜¶</h1><p>è‹¥RabbitMQæœåŠ¡å™¨å‘ç”Ÿå®•æœºï¼Œå…¶é‡å¯æœŸé—´ç”Ÿäº§è€…æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ¢å¤æ¶ˆæ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶ï¼Œäº¤æ¢æœºæˆ–é˜Ÿåˆ—æ”¶ä¸åˆ°æ¶ˆæ¯è¯¥å¦‚ä½•å¤„ç†ã€‚</p><p><strong>å°±æ˜¯å½“äº¤æ¢æœºä¸RoutingKeyæœ‰é”™è¯¯æ—¶ï¼Œå¯è‡ªå®šä¹‰é”™è¯¯çš„è¾“å‡ºï¼Œæ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹å“ªä¸€æ­¥å‡ºé”™ï¼Œè¿›è€Œæ‰§è¡Œæ¶ˆæ¯é‡å‘æ“ä½œã€‚</strong></p><h2 id="äº¤æ¢æœºç¡®è®¤æ¶ˆæ¯ï¼ˆäº¤æ¢æœºåŒ¹é…é”™è¯¯è¿”å›å¤±è´¥æƒ…å†µï¼‰"><a href="#äº¤æ¢æœºç¡®è®¤æ¶ˆæ¯ï¼ˆäº¤æ¢æœºåŒ¹é…é”™è¯¯è¿”å›å¤±è´¥æƒ…å†µï¼‰" class="headerlink" title="äº¤æ¢æœºç¡®è®¤æ¶ˆæ¯ï¼ˆäº¤æ¢æœºåŒ¹é…é”™è¯¯è¿”å›å¤±è´¥æƒ…å†µï¼‰"></a>äº¤æ¢æœºç¡®è®¤æ¶ˆæ¯ï¼ˆäº¤æ¢æœºåŒ¹é…é”™è¯¯è¿”å›å¤±è´¥æƒ…å†µï¼‰</h2><p>äº¤æ¢æœºåˆ¤æ–­æ¶ˆæ¯çš„æ¥æ”¶æƒ…å†µï¼Œæ‰§è¡Œå›è°ƒæ–¹æ³•çš„ç¡®è®¤æ¶ˆæ¯</p><ul><li>ymlé…ç½®æ–‡ä»¶å¼€å¯å‘å¸ƒç¡®è®¤æ¨¡å¼</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">publisher-confirm-type:</span> <span class="string">correlated</span></span><br></pre></td></tr></table></figure><ul><li>é…ç½®äº¤æ¢æœºä¸é˜Ÿåˆ—</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdvancedConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CONFIRM_EXCHANGE = <span class="string">&quot;confirm_exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CONFIRM_QUEUE = <span class="string">&quot;confirm_queue&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ROUTING_KEY = <span class="string">&quot;routing1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DirectExchange <span class="title">confirmExchange</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DirectExchange(CONFIRM_EXCHANGE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">confirmQueue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(CONFIRM_QUEUE).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">bind</span><span class="params">(Queue confirmQueue,DirectExchange confirmExchange)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(confirmQueue).to(confirmExchange).with(ROUTING_KEY);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å›è°ƒæ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¶ˆæ¯çš„å›è°ƒæ¥å£ï¼Œåˆ¤æ–­æ¶ˆæ¯çš„æ¥æ”¶æƒ…å†µ</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">myCallBack</span> <span class="keyword">implements</span> <span class="title">RabbitTemplate</span>.<span class="title">ConfirmCallback</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœ¬æ–¹æ³•æ˜¯RabbitTemplateçš„ä¸€ä¸ªå®ç°ç±»ï¼Œæˆ‘ä»¬åªæ˜¯å®ç°äº†æ¥å£</span></span><br><span class="line">    <span class="comment">// ä½†æ˜¯RabbitTemplateå¹¶æ²¡æœ‰æ³¨å…¥è¿™ä¸ªå®ç°ç±»</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨@PostConstructæ³¨è§£åœ¨è¿›è¡Œæ³¨å…¥</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        rabbitTemplate.setConfirmCallback(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤æ¢æœºçš„ç¡®è®¤å›è°ƒæ–¹æ³•</span></span><br><span class="line"><span class="comment">     * 1ã€ä¿å­˜å›è°ƒæ¶ˆæ¯çš„IDåŠç›¸å…³ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * 2ã€æ˜¯å¦æ¥æ”¶åˆ°æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     * 3ã€å¤±è´¥çš„åŸå› </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">confirm</span><span class="params">(CorrelationData correlationData, <span class="keyword">boolean</span> ack, String cause)</span> </span>&#123;</span><br><span class="line">        String ID = correlationData != <span class="keyword">null</span> ? correlationData.getId() : <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(ack)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;äº¤æ¢æœºå·²æ”¶åˆ°IDä¸º&#123;&#125;çš„æ¶ˆæ¯&quot;</span>, ID);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;äº¤æ¢æœºæ²¡æœ‰æ”¶åˆ°IDä¸º&#123;&#125;çš„æ¶ˆæ¯ï¼Œå…¶åŸå› æ˜¯&#123;&#125;&quot;</span>, ID, cause);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç”Ÿäº§è€…</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/confirm&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdvancedController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendConfirmMsg/&#123;message&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMsg</span><span class="params">(<span class="meta">@PathVariable</span> String message)</span></span>&#123;</span><br><span class="line">        CorrelationData correlationData = <span class="keyword">new</span> CorrelationData(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;å‘é€æ¶ˆæ¯ä¸ºï¼š&#123;&#125;&quot;</span>, message);</span><br><span class="line">        rabbitTemplate.convertAndSend(AdvancedConfig.CONFIRM_EXCHANGE, AdvancedConfig.ROUTING_KEY, message, correlationData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ¶ˆè´¹è€…</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">confirmConsumer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = AdvancedConfig.CONFIRM_QUEUE)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">recive</span> <span class="params">(Message message)</span></span>&#123;</span><br><span class="line">        String msg = <span class="keyword">new</span> String(message.getBody());</span><br><span class="line">        log.info(<span class="string">&quot;æ¥æ”¶å‘å¸ƒé˜Ÿåˆ—çš„æ¶ˆæ¯ï¼š&#123;&#125;&quot;</span>, msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å›é€€æ¶ˆæ¯ï¼ˆè¿”å›keyå¤±è´¥æ¶ˆæ¯çš„ä¿¡æ¯ï¼‰"><a href="#å›é€€æ¶ˆæ¯ï¼ˆè¿”å›keyå¤±è´¥æ¶ˆæ¯çš„ä¿¡æ¯ï¼‰" class="headerlink" title="å›é€€æ¶ˆæ¯ï¼ˆè¿”å›keyå¤±è´¥æ¶ˆæ¯çš„ä¿¡æ¯ï¼‰"></a>å›é€€æ¶ˆæ¯ï¼ˆè¿”å›keyå¤±è´¥æ¶ˆæ¯çš„ä¿¡æ¯ï¼‰</h2><ul><li>ymlé…ç½®æ–‡ä»¶å¼€å¯å›é€€</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">publisher-returns:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><ul><li>å›é€€æ¥å£ï¼Œåœ¨myCallBackä¸­å¢åŠ æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    rabbitTemplate.setConfirmCallback(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">// æ³¨å…¥ä¸€ä¸‹</span></span><br><span class="line">    rabbitTemplate.setReturnsCallback(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">returnedMessage</span><span class="params">(ReturnedMessage message)</span> </span>&#123;</span><br><span class="line">        log.error(<span class="string">&quot;æ¶ˆæ¯ï¼š&#123;&#125;ï¼Œè¢«äº¤æ¢æœº&#123;&#125;å›é€€ï¼Œå›é€€åŸå› ï¼š&#123;&#125;ï¼Œè·¯ç”±keyï¼š&#123;&#125;&quot;</span>, <span class="keyword">new</span> String(message.getMessage().getBody()), message.getExchange(), message.getReplyText(), message.getRoutingKey());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li>ç”Ÿäº§è€…</li></ul><p>æ­¤æ—¶routingKeyæœ‰é”™è¯¯ï¼Œä¼šè¿›è¡Œå›é€€æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¿”å›å¤±è´¥æ¶ˆæ¯çš„ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/sendConfirmMsg/&#123;message&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMsg</span><span class="params">(<span class="meta">@PathVariable</span> String message)</span></span>&#123;</span><br><span class="line">    CorrelationData correlationData = <span class="keyword">new</span> CorrelationData(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    log.info(<span class="string">&quot;å‘é€æ¶ˆæ¯ä¸ºï¼š&#123;&#125;&quot;</span>, message);</span><br><span class="line">    rabbitTemplate.convertAndSend(AdvancedConfig.CONFIRM_EXCHANGE, AdvancedConfig.ROUTING_KEY + <span class="string">&quot;1&quot;</span>, message, correlationData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¤‡ä»½äº¤æ¢æœº"><a href="#å¤‡ä»½äº¤æ¢æœº" class="headerlink" title="å¤‡ä»½äº¤æ¢æœº"></a>å¤‡ä»½äº¤æ¢æœº</h2><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/34.png" alt="34.png"></p><p><strong>å¤‡ä»½äº¤æ¢æœºä¼˜å…ˆçº§é«˜äºå›é€€ï¼Œä¼˜å…ˆå¤‡ä»½ï¼Œå¤±è´¥åˆ™è¿›è¡Œå›é€€ã€‚</strong></p><ul><li>é˜Ÿåˆ—ä¸äº¤æ¢æœºé…ç½®</li></ul><p>åœ¨ä¹‹å‰çš„é…ç½®ä¸­è¡¥ä¸Šå³å¯ï¼Œæ³¨æ„å¤‡ä»½æ¨¡å¼æ˜¯fanoutï¼Œå¹¿æ’­ç»™å¤‡ä»½é˜Ÿåˆ—å’Œè­¦å‘Šé˜Ÿåˆ—ï¼Œæ— éœ€RoutingKeyã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdvancedConfig</span> </span>&#123;</span><br><span class="line">    Â·Â·Â·Â·Â·</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String BACK_UP_EXCHANGE = <span class="string">&quot;back_up_exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String BACK_UP_QUEUE = <span class="string">&quot;back_up_queue&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String WARNING_QUEUE = <span class="string">&quot;warning_queue&quot;</span>;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FanoutExchange <span class="title">backupExchange</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FanoutExchange(BACK_UP_EXCHANGE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">backupQueue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(BACK_UP_EXCHANGE).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">warningQueue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(WARNING_QUEUE).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">backupBind</span><span class="params">(Queue backupQueue,FanoutExchange backupExchange)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(backupQueue).to(backupExchange);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">warningBind</span><span class="params">(Queue warningQueue,FanoutExchange backupExchange)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(warningQueue).to(backupExchange);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ¶ˆè´¹è€…</li></ul><p>å¤‡ä»½é˜Ÿåˆ—æ¶ˆè´¹è€…å°±æ˜¯ä¹‹å‰çš„å‘å¸ƒç¡®è®¤çš„æ¶ˆè´¹è€…ï¼Œè¿™é‡Œè­¦å‘Šé˜Ÿåˆ—éœ€è¦ä¸€ä¸ªæ–°çš„è­¦å‘Šæ¶ˆè´¹è€…ã€‚</p><p>ç„¶åé€šè¿‡é”™è¯¯çš„è·¯ç”±keyæŸ¥çœ‹è­¦å‘Šå¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">warningConsumer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = AdvancedConfig.WARNING_QUEUE)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">recive</span> <span class="params">(Message message)</span></span>&#123;</span><br><span class="line">        String msg = <span class="keyword">new</span> String(message.getBody());</span><br><span class="line">        log.error(<span class="string">&quot;è­¦å‘Šï¼šå‘ç°æ¶ˆæ¯&#123;&#125;ï¼Œå­˜åœ¨è·¯ç”±é—®é¢˜&quot;</span>, msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å®‰è£…&quot;&gt;&lt;a href=&quot;#å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…&quot;&gt;&lt;/a&gt;å®‰è£…&lt;/h1&gt;&lt;p&gt;RabbitMQåŸºäºerlangï¼Œæˆ‘ä»¬éœ€è¦å…ˆå®‰è£…erlangã€‚&lt;/p&gt;
&lt;p&gt;erlangï¼š&lt;a href=&quot;https://package</summary>
      
    
    
    
    <category term="ä¸­é—´ä»¶" scheme="http://aidianfirst.com/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
    
    <category term="å­¦ä¹ " scheme="http://aidianfirst.com/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="MQ" scheme="http://aidianfirst.com/tags/MQ/"/>
    
  </entry>
  
  <entry>
    <title>Dockerç®€å•å­¦ä¹ </title>
    <link href="http://aidianfirst.com/2021/09/12/%E4%B8%AD%E9%97%B4%E4%BB%B6/Docker%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/"/>
    <id>http://aidianfirst.com/2021/09/12/%E4%B8%AD%E9%97%B4%E4%BB%B6/Docker%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/</id>
    <published>2021-09-12T14:15:40.000Z</published>
    <updated>2023-07-30T11:20:17.727Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p><a href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p><ul><li><p><strong>å¸è½½æ—§ç‰ˆæœ¬</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure></li><li><p><strong>å®‰è£…åŒ…ä¸é•œåƒ</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…åŒ…</span></span><br><span class="line">sudo yum install -y yum-utils</span><br><span class="line"><span class="meta">#</span><span class="bash"> é•œåƒä»“åº“ï¼Œå¯ä½¿ç”¨å®˜æ–¹æ–‡æ¡£æˆ–é˜¿é‡Œäº‘çš„é•œåƒ</span></span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">--add-repo \</span><br><span class="line">http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure></li><li><p><strong>å®‰è£…</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¯ä»¥å…ˆæ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•</span></span><br><span class="line">yum makecache fast</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…</span></span><br><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure></li><li><p><strong>å¯åŠ¨åŠåŸºæœ¬æ“ä½œ</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> startå¯åŠ¨</span></span><br><span class="line">sudo systemctl start docker</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿è¡Œhello-worldï¼Œè‹¥æ²¡æœ‰å¯¹åº”é•œåƒä¼šå…ˆæ‹‰å–é•œåƒ</span></span><br><span class="line">sudo docker run hello-world</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹é•œåƒ</span></span><br><span class="line">docker images</span><br></pre></td></tr></table></figure></li><li><p><strong>å¸è½½</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¸è½½</span></span><br><span class="line">sudo yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰‹åŠ¨åˆ é™¤èµ„æºï¼Œ/var/lib/dockeré»˜è®¤è·¯å¾„</span></span><br><span class="line">sudo rm -rf /var/lib/docker</span><br><span class="line">sudo rm -rf /var/lib/containerd</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨é˜¿é‡Œäº‘ç»™å®¹å™¨é•œåƒåŠ é€Ÿ</p><p><a href="https://cr.console.aliyun.com/cn-chengdu/instances/mirrors">https://cr.console.aliyun.com/cn-chengdu/instances/mirrors</a></p><p>ä½¿ç”¨å¯¹åº”çš„å‘½ä»¤é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://wl2q99bq.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure></li><li><p>é•œåƒå¯åŠ¨æµç¨‹</p><ul><li>dockerç°åœ¨æœ¬åœ°æŸ¥æ‰¾é•œåƒï¼Œæœ‰å°±ç›´æ¥ä½¿ç”¨</li><li>æœ¬åœ°é•œåƒæŸ¥æ‰¾ä¸åˆ°ï¼Œå°±å»Docker Hubä¸Šä¸‹è½½é•œåƒ</li><li>æŸ¥æ‰¾åˆ°äº†å°±ä¸‹è½½å¹¶ä½¿ç”¨ï¼Œå®˜æ–¹æŸ¥æ‰¾ä¸åˆ°åˆ™æŠ¥é”™</li></ul></li></ul><h1 id="åŸºæœ¬å‘½ä»¤"><a href="#åŸºæœ¬å‘½ä»¤" class="headerlink" title="åŸºæœ¬å‘½ä»¤"></a>åŸºæœ¬å‘½ä»¤</h1><p>å®˜ç½‘å‘½ä»¤ï¼š<a href="https://docs.docker.com/engine/reference/commandline/docker/">https://docs.docker.com/engine/reference/commandline/docker/</a></p><h2 id="é•œåƒå‘½ä»¤"><a href="#é•œåƒå‘½ä»¤" class="headerlink" title="é•œåƒå‘½ä»¤"></a>é•œåƒå‘½ä»¤</h2><ul><li><p><strong>docker images æŸ¥çœ‹é•œåƒ</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">hello-world   latest    d1165f221234   6 months ago   13.3kB</span><br><span class="line"><span class="meta">#</span><span class="bash"> å­—æ®µè§£é‡Š</span></span><br><span class="line">REPOSITORY é•œåƒä»“åº“æº</span><br><span class="line">TAGé•œåƒæ ‡ç­¾</span><br><span class="line">IMAGE IDé•œåƒid</span><br><span class="line">CREATEDåˆ›å»ºæ—¶é—´</span><br><span class="line">SIZEé•œåƒå¤§å°</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç›¸å…³å‘½ä»¤</span></span><br><span class="line">Options:</span><br><span class="line">  -a, --all# æ˜¾ç¤ºå…¨éƒ¨é•œåƒ</span><br><span class="line">  -f, --filter # æ ¹æ®æ¡ä»¶è¿‡æ»¤è¾“å‡º</span><br><span class="line">  -q, --quiet# åªæ˜¾ç¤ºé•œåƒID</span><br></pre></td></tr></table></figure></li><li><p><strong>docker search æœç´¢é•œåƒ</strong></p><p>å’Œç›´æ¥å»Docker Hubå®˜ç½‘æœç´¢ä¸€è‡´ã€‚</p></li><li><p><strong>docker pull ä¸‹è½½é•œåƒ</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker pull é•œåƒå:tag å¯ä¸‹è½½å¯¹åº”ç‰ˆæœ¬</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é»˜è®¤æœ€æ–°ç‰ˆæœ¬ä¸‹è½½</span></span><br><span class="line">[root@localhost /]# docker pull mysql</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">a330b6cecb98: Pull complete # åˆ†å±‚ä¸‹è½½</span><br><span class="line">9c8f656c32b8: Pull complete </span><br><span class="line">88e473c3f553: Pull complete </span><br><span class="line">062463ea5d2f: Pull complete </span><br><span class="line">daf7e3bdf4b6: Pull complete </span><br><span class="line">1839c0b7aac9: Pull complete </span><br><span class="line">cf0a0cfee6d0: Pull complete </span><br><span class="line">1b42041bb11e: Pull complete </span><br><span class="line">10459d86c7e6: Pull complete </span><br><span class="line">b7199599d5f9: Pull complete </span><br><span class="line">1d6f51e17d45: Pull complete </span><br><span class="line">50e0789bacad: Pull complete </span><br><span class="line">Digest: sha256:99e0989e7e3797cfbdb8d51a19d32c8d286dd8862794d01a547651a896bcf00c</span><br><span class="line">Status: Downloaded newer image for mysql:latest</span><br><span class="line">docker.io/library/mysql:latest # çœŸå®åœ°å€</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŒ‡å®šç‰ˆæœ¬ä¸‹è½½</span></span><br><span class="line">[root@localhost /]# docker pull mysql:5.7</span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ†å±‚ä¸‹è½½ï¼Œä»¥å‰ä¸‹è¿‡çš„ç»„ä»¶å°±ä¸ç”¨äºŒæ¬¡ä¸‹è½½äº†ï¼ŒèŠ‚çœç©ºé—´</span></span><br><span class="line">a330b6cecb98: Already exists</span><br><span class="line">9c8f656c32b8: Already exists </span><br><span class="line">88e473c3f553: Already exists </span><br><span class="line">062463ea5d2f: Already exists </span><br><span class="line">daf7e3bdf4b6: Already exists </span><br><span class="line">1839c0b7aac9: Already exists </span><br><span class="line">cf0a0cfee6d0: Already exists </span><br><span class="line">fae7a809788c: Pull complete </span><br><span class="line">dae5a82a61f0: Pull complete </span><br><span class="line">7063da9569eb: Pull complete </span><br><span class="line">51a9a9b4ef36: Pull complete </span><br><span class="line">Digest: sha256:d9b934cdf6826629f8d02ea01f28b2c4ddb1ae27c32664b14867324b3e5e1291</span><br><span class="line">Status: Downloaded newer image for mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br></pre></td></tr></table></figure></li><li><p><strong>docker rmi åˆ é™¤é•œåƒï¼ˆremove imagesï¼‰</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŒ‡å®šidåˆ é™¤é•œåƒ</span></span><br><span class="line">[root@localhost /]# docker rmi -f &lt;é•œåƒå¯¹åº”ID&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥å‡ºæ‰€æœ‰çš„idï¼Œç„¶ååˆ é™¤æ‰€æœ‰é•œåƒ</span></span><br><span class="line">[root@localhost /]# docker rmi -f $(docker images -aq)</span><br></pre></td></tr></table></figure></li></ul><h2 id="å®¹å™¨å‘½ä»¤"><a href="#å®¹å™¨å‘½ä»¤" class="headerlink" title="å®¹å™¨å‘½ä»¤"></a>å®¹å™¨å‘½ä»¤</h2><p>æ‹¥æœ‰é•œåƒåæ‰èƒ½åˆ›å»ºå®¹å™¨ï¼Œä½¿ç”¨centosé•œåƒæ¥è¿›è¡Œå®éªŒ</p><ul><li><p><strong>ä¸‹è½½é•œåƒï¼šdocker pull centos</strong></p></li><li><p><strong>docker run æ–°å»ºå®¹å™¨å¹¶å¯åŠ¨</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker run &lt;å‚æ•°&gt; &lt;é•œåƒ&gt;</span><br><span class="line"><span class="meta"> #</span><span class="bash"> å‚æ•°</span></span><br><span class="line"> --name = &quot;name&quot;# å®¹å™¨åå­—è‡ªå®šä¹‰</span><br><span class="line"> -d# åœ¨åå°è¿è¡Œ</span><br><span class="line"> -it # ä½¿ç”¨äº¤äº’æ–¹å¼è¿è¡Œï¼Œè¿›å…¥å®¹å™¨æŸ¥çœ‹å†…å®¹</span><br><span class="line"> -p# æŒ‡å®šå®¹å™¨ç«¯å£ -p 8080ç«¯å£</span><br><span class="line"> -p ip:ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£</span><br><span class="line"> -p ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£</span><br><span class="line"> -p å®¹å™¨ç«¯å£</span><br><span class="line"> å®¹å™¨ç«¯å£</span><br><span class="line"> -P# å¤§å†™Pï¼ŒéšæœºæŒ‡å®šç«¯å£</span><br><span class="line"> </span><br><span class="line">[root@localhost /]# docker run -it centos /bin/bash</span><br><span class="line">[root@a0e3c05e1120 /]#</span><br></pre></td></tr></table></figure></li><li><p><strong>docker ps æŸ¥çœ‹æ‰€æœ‰è¿è¡Œçš„å®¹å™¨</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker ps &lt;å‚æ•°&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é»˜è®¤å±•ç¤ºæ­£åœ¨è¿è¡Œçš„å®¹å™¨</span></span><br><span class="line">-a# å¯æŸ¥çœ‹æ‰€æœ‰è¿è¡Œè¿‡çš„å®¹å™¨</span><br><span class="line">-n=x# åˆ—å‡ºæœ€è¿‘åˆ›å»ºçš„xä¸ªå®¹å™¨ã€</span><br><span class="line">-q# åªæ˜¾ç¤ºID</span><br></pre></td></tr></table></figure></li><li><p><strong>é€€å‡ºå®¹å™¨</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exit# å®¹å™¨åœæ­¢å¹¶é€€å‡º</span><br><span class="line">ctrl + P + Q# å®¹å™¨ä¸åœæ­¢é€€å‡º</span><br></pre></td></tr></table></figure></li><li><p><strong>docker rm åˆ é™¤å®¹å™¨</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker rm &lt;å®¹å™¨ID&gt;# åˆ é™¤æŒ‡å®šIDï¼Œè¿è¡Œä¸­çš„ä¸èƒ½åˆ é™¤ï¼Œå¯ä½¿ç”¨rm -f</span><br><span class="line">docker rm -f $(docker ps -aq)# å…¨éƒ¨åˆ é™¤</span><br></pre></td></tr></table></figure></li><li><p><strong>å¯åŠ¨ä¸åœæ­¢å®¹å™¨çš„æ“ä½œ</strong></p><p>ç±»ä¼¼linuxå‘½ä»¤ï¼Œè¿™é‡Œå¯åŠ¨å¯ä»¥å¯åŠ¨ä»¥å‰è¿è¡Œè¿‡çš„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start ID</span><br><span class="line">docker restart ID</span><br><span class="line">docker stop ID</span><br><span class="line">docker kill ID</span><br></pre></td></tr></table></figure></li></ul><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><ul><li><p><strong>docker run åå°å¯åŠ¨å®¹å™¨</strong></p><p>æ³¨æ„åå°å¯åŠ¨å®¹å™¨æ—¶ï¼Œå¿…é¡»è¦æœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹ï¼Œè‹¥dockerå‘ç°æ²¡æœ‰åº”ç”¨ï¼Œåˆ™è‡ªåŠ¨åœæ­¢</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -d &lt;é•œåƒå&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯ä»¥å†™ä¸€ä¸ªè„šæœ¬ï¼Œç„¶ååå°è¿è¡Œ</span></span><br><span class="line">docker run -d centos /bin/sh -c &quot;while true;do echo tang;sleep 1;done&quot;</span><br></pre></td></tr></table></figure></li><li><p><strong>docker logs æŸ¥çœ‹æ—¥å¿—</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker logs &lt;å‚æ•°&gt; &lt;å®¹å™¨&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> å‚æ•°</span></span><br><span class="line">-f# è·Ÿè¸ªæ—¥å¿—è¾“å‡º</span><br><span class="line">-t# æ˜¾ç¤ºæ—¥å¿—çš„æ—¶é—´æˆ³</span><br><span class="line">--since# è‡ªæŸä¸ªæ—¶é—´å¼€å§‹çš„æ‰€æœ‰æ—¥å¿—</span><br><span class="line">--tail # åªåˆ—å‡ºæœ€æ–°çš„næ¡æ—¥å¿—</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯ä»¥ç”¨ä¸Šé¢çš„å¾ªç¯è„šæœ¬è¿›è¡Œæ—¥å¿—æµ‹è¯•</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å‘ç°-fåæ—¥å¿—ä¼šæŒç»­è¾“å‡ºå†…å®¹ä½†æ˜¯æ²¡æœ‰æ—¶é—´</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -tä¼šè¾“å‡ºå½“å‰çš„å…¨éƒ¨å†…å®¹æœ‰æ—¶é—´ä½†ä¸è·Ÿè¸ª</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --sinceå’Œ--tailåé¢å¿…é¡»åŠ ç›¸å…³æ¡ä»¶è¿›è¡Œä¿¡æ¯ç­›é€‰</span></span><br></pre></td></tr></table></figure></li><li><p><strong>docker top æŸ¥çœ‹å®¹å™¨ä¸­è¿›ç¨‹ä¿¡æ¯</strong></p><p>å¯ä»¥æ ¹æ®æŸ¥è¯¢çš„è¿›ç¨‹å·æ€æ­»è¿›ç¨‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker top &lt;å®¹å™¨ID&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> UIDç”¨æˆ·ID</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PID è¿›ç¨‹ID</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PPIDçˆ¶è¿›ç¨‹ID</span></span><br></pre></td></tr></table></figure></li><li><p><strong>docker inspect æŸ¥çœ‹å®¹å™¨æºæ•°æ®</strong></p><p>å¯ä»¥æŸ¥çœ‹å®¹å™¨çš„ç›¸å…³ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect &lt;å®¹å™¨ID&gt;</span><br></pre></td></tr></table></figure></li><li><p><strong>docker exec / attach è¿›å…¥å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¿›å…¥å®¹å™¨ï¼Œç„¶åå¼€å¯ä¸€ä¸ªæ–°çš„ç»ˆç«¯</span></span><br><span class="line">docker exec -it &lt;å®¹å™¨ID&gt; /bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿›å…¥å®¹å™¨æ­£åœ¨æ‰§è¡Œçš„ç»ˆç«¯</span></span><br><span class="line">docker attach &lt;å®¹å™¨ID&gt;</span><br></pre></td></tr></table></figure></li><li><p><strong>docker cp å®¹å™¨æ‹·è´æ–‡ä»¶åˆ°ä¸»æœº</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åœ¨å®¹å™¨ä¸­åˆ›å»ºæ–‡ä»¶ï¼Œç„¶ååœ¨ä¸»æœºä¸­ä½¿ç”¨cpå‘½ä»¤</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°†å®¹å™¨å¯¹åº”çš„æ–‡ä»¶æ‹·è´åˆ°ä¸»æœºçš„æŒ‡å®šç›®å½•</span></span><br><span class="line">docker cp &lt;å®¹å™¨ID&gt;:&lt;æ–‡ä»¶è·¯å¾„&gt; &lt;ä¸»æœºè·¯å¾„&gt;</span><br></pre></td></tr></table></figure></li></ul><h2 id="ä½¿ç”¨ç»ƒä¹ "><a href="#ä½¿ç”¨ç»ƒä¹ " class="headerlink" title="ä½¿ç”¨ç»ƒä¹ "></a>ä½¿ç”¨ç»ƒä¹ </h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker search nginx</span><br><span class="line">docker pull nginx</span><br><span class="line">docker run -d -p 8888:80 nginx# ä½¿ç”¨8888æ›¿æ¢é»˜è®¤80ç«¯å£</span><br><span class="line">curl lcoalhost:8888 # æµ‹è¯•è®¿é—®å¯¹åº”åœ°å€ç«¯å£</span><br><span class="line">docker exec -it &lt;ID&gt; /bin/bash   # å¯ä»¥è¿›å…¥å®¹å™¨ </span><br></pre></td></tr></table></figure><p>æœ¬æœºè®¿é—®å¯¹åº”ipå’Œç«¯å£ä¹Ÿå¯ä»¥è®¿é—®nginxå®¹å™¨ï¼Œéœ€è¦æå‰å…³é—­é˜²ç«å¢™å¼€æ”¾ç«¯å£ã€‚</p><h2 id="å¯è§†åŒ–é¢æ¿"><a href="#å¯è§†åŒ–é¢æ¿" class="headerlink" title="å¯è§†åŒ–é¢æ¿"></a>å¯è§†åŒ–é¢æ¿</h2><p>å®‰è£…å¯è§†åŒ–å·¥å…·ï¼športainer</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8088:9000 --restart=always -v var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br></pre></td></tr></table></figure><p>è¿è¡Œæµ‹è¯•ï¼Œä¸»æœºè®¿é—®8088ç«¯å£ï¼š<a href="http://192.168.158.131:8088/">http://192.168.158.131:8088/</a></p><h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><h2 id="é•œåƒï¼ˆåˆ†å±‚å¤ç”¨ï¼‰"><a href="#é•œåƒï¼ˆåˆ†å±‚å¤ç”¨ï¼‰" class="headerlink" title="é•œåƒï¼ˆåˆ†å±‚å¤ç”¨ï¼‰"></a>é•œåƒï¼ˆåˆ†å±‚å¤ç”¨ï¼‰</h2><p>Dockeré•œåƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿï¼Œé™¤äº†æä¾›å®¹å™¨è¿è¡Œæ—¶æ‰€éœ€çš„ç¨‹åºã€åº“ã€èµ„æºã€é…ç½®ç­‰æ–‡ä»¶å¤–ï¼Œ<strong>è¿˜åŒ…å«äº†ä¸€äº›ä¸ºè¿è¡Œæ—¶å‡†å¤‡çš„é…ç½®å‚æ•°</strong>ï¼Œå¦‚åŒ¿åå·ã€ç¯å¢ƒå˜é‡ã€ç”¨æˆ·ç­‰ï¼Œ<strong>é•œåƒä¸åŒ…å«åŠ¨æ€æ•°æ®ï¼Œæ„å»ºåå†…å®¹ä¸ä¼šè¢«æ”¹å˜ã€‚</strong></p><p>Dockerè®¾è®¡æ—¶ï¼Œä½¿ç”¨Union FSæŠ€æœ¯ï¼Œä½¿å…¶æˆä¸ºä¸€ä¸ªåˆ†å±‚å­˜å‚¨æ¶æ„ã€‚é•œåƒç”±å¤šå±‚æ–‡ä»¶ç³»ç»Ÿè”åˆç»„æˆã€‚<strong>Dockeré•œåƒå¯æ‹†åˆ†æˆå¤šä¸ªå±‚æ¬¡ï¼Œä¸¤ä¸ªä¸åŒé•œåƒå…¶ä¸­ç›¸åŒå±‚æ¬¡çš„æ–‡ä»¶æ˜¯å¯ä»¥å¤ç”¨çš„ã€‚ä¸€å±‚å±‚æ„å»ºé•œåƒæ—¶ï¼Œåä¸€å±‚æ˜¯åœ¨å‰ä¸€å±‚çš„åŸºç¡€ä¸Šå®Œæˆçš„ï¼Œæ¯ä¸€å±‚æ„å»ºå®Œåä¸åœ¨å‘ç”Ÿæ”¹å˜ï¼Œåä¸€å±‚çš„ä»»ä½•æ”¹å˜åªä¼šå‘ç”Ÿåœ¨è‡ªå·±è¿™ä¸€å±‚ã€‚</strong>ä¹Ÿå°±è¯´è‹¥åä¸€å±‚åˆ é™¤å‰ä¸€å±‚çš„æ–‡ä»¶ï¼Œåªæ˜¯åœ¨å½“å‰å±‚æ ‡è®°æ–‡ä»¶åˆ é™¤ï¼Œä½¿å¾—æ–‡ä»¶ä¸æ˜¾ç¤ºï¼Œå…¶å®åœ¨å‰ä¸€å±‚ä¸Šæ•°æ®å¹¶æ²¡æœ‰æ”¹å˜ã€‚</p><h2 id="å®¹å™¨"><a href="#å®¹å™¨" class="headerlink" title="å®¹å™¨"></a>å®¹å™¨</h2><p><strong>å¯ä»¥è¯´å®¹å™¨æ˜¯é•œåƒè¿è¡Œæ—¶çš„å®ä½“ï¼Œé•œåƒä¸å®¹å™¨å¯ä»¥ç±»æ¯”é¢å‘å¯¹è±¡é‡Œçš„ç±»ä¸å®ä¾‹ã€‚å®¹å™¨æ˜¯å¯ä»¥è¿›è¡Œåˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤ç­‰æ“ä½œçš„ã€‚</strong></p><p>é•œåƒä¸€èˆ¬æ˜¯åªè¯»çš„ï¼Œå¯åŠ¨ä¸€ä¸ªå®¹å™¨å°±æ˜¯åœ¨é•œåƒçš„æœ€å¤–å±‚åŠ ä¸Šä¸€ä¸ªå¯è¯»å†™å±‚ï¼Œé•œåƒå°±åƒä¸€ä¸ªå®‰è£…åŒ…ï¼Œå¯åŠ¨å®¹å™¨åæ‰èƒ½å¯¹å†…éƒ¨è¿›è¡Œæ“ä½œã€‚</p><h2 id="ä»“åº“"><a href="#ä»“åº“" class="headerlink" title="ä»“åº“"></a>ä»“åº“</h2><p>ä»“åº“å°±æ˜¯é›†ä¸­å­˜å‚¨é•œåƒæ–‡ä»¶çš„åœ°æ–¹ï¼Œå¾ˆå®¹æ˜“è”æƒ³åˆ°Mavenä»“åº“ã€‚</p><p>å®˜æ–¹é•œåƒä»“åº“æœç´¢åœ°å€ï¼š<a href="https://hub.docker.com/">https://hub.docker.com/</a></p><h2 id="æäº¤é•œåƒ"><a href="#æäº¤é•œåƒ" class="headerlink" title="æäº¤é•œåƒ"></a>æäº¤é•œåƒ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å®˜æ–¹çš„tomcatè¿›è¡Œè¿‡ç®€åŒ–ï¼Œwebappsæ–‡ä»¶å¤¹æ˜¯ç©ºçš„</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆ‘ä»¬å¯ä»¥å°†åŸºæœ¬ä¿¡æ¯æ‹·è´è¿›å»ï¼Œç„¶åæäº¤è¿™ä¸ªä¿®æ”¹è¿‡çš„é•œåƒ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æäº¤åç›¸å½“äºæ–°ç”Ÿæˆäº†ä¸€ä¸ªé•œåƒ</span></span><br><span class="line">docker commit -a=&quot;ä½œè€…&quot; -m=&quot;æè¿°ä¿¡æ¯&quot; &lt;å®¹å™¨ID&gt; è‡ªå®šä¹‰é•œåƒå</span><br></pre></td></tr></table></figure><h1 id="å®¹å™¨æ•°æ®å·ï¼ˆæŒä¹…åŒ–ä¸åŒæ­¥ï¼‰"><a href="#å®¹å™¨æ•°æ®å·ï¼ˆæŒä¹…åŒ–ä¸åŒæ­¥ï¼‰" class="headerlink" title="å®¹å™¨æ•°æ®å·ï¼ˆæŒä¹…åŒ–ä¸åŒæ­¥ï¼‰"></a>å®¹å™¨æ•°æ®å·ï¼ˆæŒä¹…åŒ–ä¸åŒæ­¥ï¼‰</h1><p>æˆ‘ä»¬å¸Œæœ›Dockerçš„æ•°æ®æ˜¯å¯ä»¥æŒä¹…åŒ–çš„ï¼Œä½†æˆ‘ä»¬ä¿®æ”¹äº†å®¹å™¨å†…çš„æ•°æ®ï¼Œå¦‚æœä¸ç”Ÿæˆä¸€ä¸ªæ–°å®¹å™¨ï¼Œåˆ é™¤å®¹å™¨åä¿®æ”¹çš„æ•°æ®å°±æ¶ˆå¤±äº†ï¼Œä¸ºäº†å°†æ•°æ®æŒä¹…åŒ–ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨å®¹å™¨æ•°æ®å·ã€‚å·å°±æ˜¯ç›®å½•æˆ–æ–‡ä»¶ï¼Œå­˜åœ¨äºä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä¸­ï¼Œä½†ä¸å±äºUnion FSï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œä¸æ˜¯åˆ†å±‚æ¶æ„çš„ï¼Œå¯ä»¥è¿›è¡Œ<strong>æ•°æ®çš„æŒä¹…åŒ–æˆ–æ•°æ®å…±äº«</strong>ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¿è¡Œå®¹å™¨ï¼Œä½¿ç”¨-vå‘½ä»¤è¿›è¡Œç›®å½•æŒ‚è½½</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -v &lt;ä¸»æœºç›®å½•&gt;:&lt;å®¹å™¨ç›®å½•&gt;</span></span><br><span class="line">docker run -it -v /home/ceshi:/home centos /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡inspectå‘½ä»¤æŸ¥çœ‹å®¹å™¨ä¿¡æ¯ï¼ŒMountså°±æ˜¯å·æŒ‚è½½çš„ä¿¡æ¯</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Sourceï¼šä¸»æœºç›®å½•ï¼ŒDestinationï¼šå®¹å™¨ç›®å½•</span></span><br><span class="line">docker inspect &lt;å®¹å™¨ID&gt;</span><br><span class="line">Â·Â·Â·</span><br><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Type&quot;: &quot;bind&quot;,</span><br><span class="line">        &quot;Source&quot;: &quot;/home/ceshi&quot;,</span><br><span class="line">        &quot;Destination&quot;: &quot;/home&quot;,</span><br><span class="line">        &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">        &quot;RW&quot;: true,</span><br><span class="line">        &quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class="line">    &#125;</span><br><span class="line">],</span><br><span class="line">Â·Â·Â·</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸Šæ“ä½œï¼Œä¸¤ä¸ªç›®å½•å°±å®Œæˆäº†åŒæ­¥æ“ä½œï¼Œå…¶å†…å®¹å®Œå…¨ä¸€è‡´ã€‚</p><p>åŒç†æˆ‘ä»¬æ“ä½œä¸€ä¸‹mysqlï¼Œä¸”ä½¿ç”¨æœ¬åœ°æ•°æ®åº“æ“ä½œå·¥å…·å¯ä»¥å¯¹è¯¥æ•°æ®åº“è¿æ¥ã€‚</p><p><strong>è€Œä¸”å°†æ•°æ®åº“åˆ é™¤åï¼Œæˆ‘ä»¬dataä¸­çš„æ•°æ®ä¾æ—§å­˜åœ¨ã€‚</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br></pre></td></tr></table></figure><h1 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h1><h2 id="åˆ›å»ºé•œåƒ"><a href="#åˆ›å»ºé•œåƒ" class="headerlink" title="åˆ›å»ºé•œåƒ"></a>åˆ›å»ºé•œåƒ</h2><p>Dockerfileæ˜¯ä¸€ä¸ªç”¨æ¥æ„å»ºé•œåƒçš„æ–‡æœ¬æ–‡ä»¶ã€‚å…¶åŒ…å«æ„å»ºé•œåƒæ‰€éœ€çš„æŒ‡ä»¤ä¸è¯´æ˜ã€‚ç›¸å½“äºä¸€ä¸ªå‘½ä»¤è„šæœ¬ï¼Œä½¿ç”¨è„šæœ¬ç”Ÿæˆé•œåƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åœ¨æŒ‡å®šç›®å½•ä¸‹ï¼Œå†™ä¸€æ®µç®€å•è„šæœ¬</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆ‘çš„è·¯å¾„/home/dockerfile-test/dockerfile01</span></span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]</span><br><span class="line"></span><br><span class="line">CMD echo &quot;--------END--------&quot;</span><br><span class="line"></span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure><p>æœ‰äº†è„šæœ¬åï¼Œå°±å¯ä»¥ä½¿ç”¨docker buildå‘½ä»¤åˆ›å»ºé•œåƒ,<strong>æœ«å°¾æœ‰ä¸ª . ä¸è¦å¿˜äº†</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker buildå‘½ä»¤åˆ›å»ºé•œåƒ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -f è„šæœ¬è·¯å¾„</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -t é•œåƒå:ç‰ˆæœ¬å·</span></span><br><span class="line">docker build -f /home/dockerfile-test/dockerfile01 -t tang/centos:1.0 .</span><br></pre></td></tr></table></figure><p>è¿è¡Œè‡ªå·±åˆ›å»ºçš„é•œåƒï¼Œåœ¨æ ¹ç›®å½•ä¸‹å¯ä»¥å‘ç°è„šæœ¬ä¸­å†™å¥½çš„å·ï¼švolume01ã€volume02ï¼Œä½†è¿™é‡Œæ˜¯åŒ¿åæŒ‚è½½ï¼Œéœ€è¦é€šè¿‡inspectæŸ¥çœ‹ä¸»æœºå¯¹åº”ç”Ÿæˆçš„éšæœºæ–‡ä»¶å¤¹åç§°ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it tang/centos:1.0 /bin/bash</span><br></pre></td></tr></table></figure><h2 id="å·æ•°æ®åŒæ­¥ï¼ˆâ€“volumes-fromï¼‰"><a href="#å·æ•°æ®åŒæ­¥ï¼ˆâ€“volumes-fromï¼‰" class="headerlink" title="å·æ•°æ®åŒæ­¥ï¼ˆâ€“volumes-fromï¼‰"></a>å·æ•°æ®åŒæ­¥ï¼ˆâ€“volumes-fromï¼‰</h2><p>å°†ä¸åŒå®¹å™¨çš„æŒ‚è½½å·çš„æ•°æ®åŒæ­¥ï¼Œå¦‚ä¸¤ä¸ªä¸åŒå®¹å™¨çš„mysqlä½¿ç”¨åŒä¸€ä¸ªæ•°æ®åº“ã€‚å½“ç„¶åˆ é™¤å…¶ä¸­ä¸€ä¸ªå®¹å™¨ï¼Œå…¶ä»–å®¹å™¨å†…çš„å·æ•°æ®ä¸ä¼šæ¶ˆå¤±ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æˆ‘ä»¬è¿™é‡Œåªæ˜¯è¦ä½¿ç”¨åŒä¸€ä¸ªæ•°æ®åº“ï¼Œå¯ä½¿ç”¨åŒ¿åæŒ‚è½½</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç¬¬äºŒä¸ªmysqlä½¿ç”¨--volumes-fromå’Œç¬¬ä¸€ä¸ªmysqlè¿›è¡Œå·æ•°æ®åŒæ­¥</span></span><br><span class="line">docker run -d -p 3310:3306 -v /etc/mysql/conf.d -v /var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line"></span><br><span class="line">docker run -d -p 3310:3306 --name mysql02 --volumes-from mysql:5.7</span><br></pre></td></tr></table></figure><h2 id="DockerfileæŒ‡ä»¤"><a href="#DockerfileæŒ‡ä»¤" class="headerlink" title="DockerfileæŒ‡ä»¤"></a>DockerfileæŒ‡ä»¤</h2><p>æˆ‘ä»¬å†™dockerfileè„šæœ¬æ—¶å¸¸ç”¨çš„æŒ‡ä»¤ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FROM# åŸºç¡€é•œåƒ</span><br><span class="line">MAINTAINER# é•œåƒä½œè€…</span><br><span class="line">RUN# é•œåƒæ„å»ºæ—¶è¦æ‰§è¡Œçš„å‘½ä»¤</span><br><span class="line">ADD# å°†æ–‡ä»¶æ·»åŠ åˆ°é•œåƒä¸­</span><br><span class="line">WORKDIR# é•œåƒçš„å·¥ä½œç›®å½•</span><br><span class="line">VOLUME# æŒ‚è½½çš„ç›®å½•</span><br><span class="line">EXPOSE# é…ç½®ç«¯å£</span><br><span class="line">CMD# å®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ï¼Œå¯è¢«æ›¿ä»£</span><br><span class="line">ENTRYPOINT# å®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ï¼Œå¯è¿½åŠ å‘½ä»¤</span><br><span class="line">ONBUILD # è¯¥å‘½ä»¤ä¸‹çš„å†…å®¹åªå¯¹å½“å‰é•œåƒçš„å­é•œåƒç”Ÿæ•ˆ</span><br><span class="line">COPY# ç±»ä¼¼ADDï¼Œå°†æ–‡ä»¶æ‹·è´åˆ°é•œåƒ</span><br><span class="line">ENV# æ„å»ºæ—¶é…ç½®ç¯å¢ƒå˜é‡</span><br><span class="line">LABEL# ä¸ºé•œåƒæŒ‡å®šæ ‡ç­¾</span><br></pre></td></tr></table></figure><h2 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h2><ul><li><p>ç¼–å†™dockerfileè„šæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">MAINTAINER aidianfirst&lt;AVG--lover&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®é»˜è®¤çš„å·¥ä½œç›®å½•</span></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è‡ªè¡Œæ·»åŠ å‘½ä»¤ï¼ŒåŸç”Ÿcentoså‘½ä»¤å¾ˆå°‘</span></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo ----------END----------- </span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure></li><li><p>docker buildå‘½ä»¤æ„å»ºé•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -f myDockerfile -t mycentos:1.0 .</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨å®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„é•œåƒåï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è‡ªè¡Œæ·»åŠ çš„å‘½ä»¤äº†</span></span><br><span class="line">docker run -it mycentos:1.0</span><br></pre></td></tr></table></figure></li></ul><h2 id="CMD-ä¸-ENTRYPOINTåŒºåˆ«"><a href="#CMD-ä¸-ENTRYPOINTåŒºåˆ«" class="headerlink" title="CMD ä¸ ENTRYPOINTåŒºåˆ«"></a>CMD ä¸ ENTRYPOINTåŒºåˆ«</h2><p>cmdï¼šå‘½ä»¤åªèƒ½è¢«æ›¿æ¢ï¼Œä¸èƒ½æ‹¼æ¥ã€‚</p><p>entrypointï¼šå‘½ä»¤å¯ä»¥è¢«æ‹¼æ¥ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨CMDï¼Œå¯åŠ¨å®¹å™¨åå°±ä¼šæ‰§è¡Œls -aå‘½ä»¤</span></span><br><span class="line">FROM centos</span><br><span class="line">CMD [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è‹¥æˆ‘ä»¬å¯åŠ¨æ—¶åœ¨ç»“å°¾æ·»åŠ æ–°æŒ‡ä»¤</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¸Œæœ›å®¹å™¨å¯åŠ¨åæ‰§è¡Œls -alï¼Œä½†CMDåªèƒ½å‘½ä»¤æ›¿æ¢</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¹Ÿå°±æ˜¯å°†åŸæœ¬çš„ls -aæ›¿æ¢ä¸º -lï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªå‘½ä»¤ä¼šæŠ¥é”™</span></span><br><span class="line">docker run e457b67ad5eb -l</span><br><span class="line"><span class="meta">#</span><span class="bash"> éœ€è¦å†™æˆä¸€ä¸ªå®Œæ•´å‘½ä»¤å¯¹CMDçš„å‘½ä»¤è¿›è¡Œæ›¿æ¢ï¼Œè€Œä¸æ˜¯æ‹¼æ¥</span></span><br><span class="line">docker run e457b67ad5eb ls -al</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨ENTRYPOINT</span></span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨å‘½ä»¤è¡Œå¯åŠ¨ï¼Œå‘ç°å¯ä»¥è¿›è¡Œå‘½ä»¤æ‹¼æ¥</span></span><br><span class="line">docker run -it fe4bf4cb9f12 -l</span><br></pre></td></tr></table></figure><h1 id="Dockeræµç¨‹ä¸€å›¾çœ‹æ‡‚"><a href="#Dockeræµç¨‹ä¸€å›¾çœ‹æ‡‚" class="headerlink" title="Dockeræµç¨‹ä¸€å›¾çœ‹æ‡‚"></a>Dockeræµç¨‹ä¸€å›¾çœ‹æ‡‚</h1><p>pullä¸‹è½½é•œåƒã€runå¯åŠ¨å®¹å™¨ã€Dockerfileç¼–å†™é•œåƒè„šæœ¬ï¼Œbuildä¸€ä¸ªè„šæœ¬ç”Ÿæˆé•œåƒï¼Œsave/loadæ‰“åŒ…ä¼ è¾“ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/26.png" alt="26.png"></p><h1 id="Dockerç½‘ç»œ"><a href="#Dockerç½‘ç»œ" class="headerlink" title="Dockerç½‘ç»œ"></a>Dockerç½‘ç»œ</h1><h2 id="dockeræ˜¯å¦‚ä½•å¤„ç†å®¹å™¨ç½‘ç»œè®¿é—®çš„ï¼Ÿï¼ˆipï¼‰"><a href="#dockeræ˜¯å¦‚ä½•å¤„ç†å®¹å™¨ç½‘ç»œè®¿é—®çš„ï¼Ÿï¼ˆipï¼‰" class="headerlink" title="dockeræ˜¯å¦‚ä½•å¤„ç†å®¹å™¨ç½‘ç»œè®¿é—®çš„ï¼Ÿï¼ˆipï¼‰"></a>dockeræ˜¯å¦‚ä½•å¤„ç†å®¹å™¨ç½‘ç»œè®¿é—®çš„ï¼Ÿï¼ˆipï¼‰</h2><p>ä½¿ç”¨ ip addr å‘½ä»¤å¯ä»¥æŸ¥çœ‹è™šæ‹Ÿæœºçš„ç½‘ç»œï¼Œç„¶åæˆ‘ä»¬å¯ä»¥å‘ç°æœ‰ä¸€ä¸ªå«docker0çš„ç½‘ç»œã€‚æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œè¿›å…¥é…ç½®æ–‡ä»¶æŸ¥çœ‹ipï¼Œç„¶åç”¨æœ¬æœºpingè¿™ä¸ªipï¼Œå‘ç°ç½‘ç»œæ˜¯é€šçš„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -P --name tomcat01 tomcat</span><br><span class="line">docker exec -it tomcat01 /bin/bash</span><br><span class="line">cat /etc/hosts</span><br><span class="line"><span class="meta">#</span><span class="bash"> 172.17.0.278c064e8db0a</span></span><br><span class="line">ping 172.17.0.2 # ç½‘ç»œæ˜¯é€šçš„</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨dockerå®¹å™¨ï¼Œdockerä¼šä¸ºå®¹å™¨åˆ†é…ä¸€ä¸ªipï¼Œä¸”å®‰è£…dockeråä¼šç”Ÿæˆä¸€ä¸ªç½‘å¡docker0ï¼Œä½¿ç”¨çš„æ˜¯æ¡¥æ¥æ¨¡å¼ï¼ŒæŠ€æœ¯æ˜¯veth-pairã€‚</li><li>æ¯æ¬¡å¯åŠ¨å®¹å™¨éƒ½ä¼šæ–°å»ºä¸€ä¸ªç½‘å¡ï¼Œæˆå¯¹å‡ºç°çš„ã€‚ä½¿ç”¨veth-pairå……å½“æ¡¥æ¢è¿æ¥è™šæ‹Ÿç½‘ç»œè®¾å¤‡ã€‚å…¶ä¸­å®¹å™¨ä¹‹é—´ä¹Ÿå¯ä»¥ç›¸äº’pingã€‚</li><li>æˆ‘ä»¬ä¸åŒå®¹å™¨å¯ä»¥ä½¿ç”¨ipè¿›è¡Œè¿æ¥ã€‚</li></ul><h2 id="â€“linkï¼ˆrunå¯åŠ¨æ—¶ï¼‰"><a href="#â€“linkï¼ˆrunå¯åŠ¨æ—¶ï¼‰" class="headerlink" title="â€“linkï¼ˆrunå¯åŠ¨æ—¶ï¼‰"></a>â€“linkï¼ˆrunå¯åŠ¨æ—¶ï¼‰</h2><p>å…¶å®å°±æ˜¯åœ¨/etc/hostsé…ç½®æ–‡ä»¶ä¸­å£°æ˜äº†ï¼Œåç§°å¯¹åº”çš„ipï¼Œæ‰€ä»¥æˆ‘ä»¬åç»­å¯ç›´æ¥ä½¿ç”¨åå­—è¿æ¥ï¼Œä¸ä½¿ç”¨ipã€‚ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨ä¸€ä¸ªtest2çš„tomcatï¼Œä½¿ç”¨--linkæŒ‡ä»¤å°†å…¶ä¸test1è¿é€š</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯ç›´æ¥ä½¿ç”¨ping test1ï¼Œ2ä¸1ä¸é€‚ç”¨ipä¹å¹´è¿é€šï¼Œä½†linkæ˜¯å•å‘çš„</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æƒ³è¦1ä¸2è¿é€šï¼Œæˆ‘ä»¬éœ€è¦å¯¹test1ä¹Ÿè¿›è¡Œå£°æ˜</span></span><br><span class="line">docker run --name test2 --link test1 tomcat</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å®‰è£…&quot;&gt;&lt;a href=&quot;#å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…&quot;&gt;&lt;/a&gt;å®‰è£…&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/engine/install/centos/&quot;&gt;https://docs.</summary>
      
    
    
    
    <category term="ä¸­é—´ä»¶" scheme="http://aidianfirst.com/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
    
  </entry>
  
  <entry>
    <title>MySQLå…«è‚¡æ–‡</title>
    <link href="http://aidianfirst.com/2021/09/09/%E5%85%AB%E8%82%A1/MySQL%E5%85%AB%E8%82%A1%E6%96%87/"/>
    <id>http://aidianfirst.com/2021/09/09/%E5%85%AB%E8%82%A1/MySQL%E5%85%AB%E8%82%A1%E6%96%87/</id>
    <published>2021-09-09T05:21:25.000Z</published>
    <updated>2023-07-30T11:20:17.727Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åŸºç¡€è¯­æ³•"><a href="#åŸºç¡€è¯­æ³•" class="headerlink" title="åŸºç¡€è¯­æ³•"></a>åŸºç¡€è¯­æ³•</h1><h2 id="å¢åˆ æ”¹æŸ¥"><a href="#å¢åˆ æ”¹æŸ¥" class="headerlink" title="å¢åˆ æ”¹æŸ¥"></a>å¢åˆ æ”¹æŸ¥</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># æ·»åŠ </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `è¡¨`(`å­—æ®µ`) <span class="keyword">values</span> (<span class="string">&#x27;å€¼&#x27;</span>)</span><br><span class="line"># åˆ é™¤ï¼Œ<span class="keyword">truncate</span>æ¸…å…¨è¡¨</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> `è¡¨` <span class="keyword">where</span> <span class="operator">&lt;</span>æ¡ä»¶<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> `è¡¨`</span><br><span class="line"># ä¿®æ”¹</span><br><span class="line">update `è¡¨` <span class="keyword">set</span> `å­—æ®µ` <span class="operator">=</span> <span class="string">&#x27;å€¼&#x27;</span> <span class="keyword">where</span> <span class="operator">&lt;</span>æ¡ä»¶<span class="operator">&gt;</span></span><br><span class="line"># æŸ¥è¯¢ åé¢å¯ä»¥ä½¿ç”¨å¾ˆå¤šçš„å…³é”®å­—è¾…åŠ©æŸ¥è¯¢</span><br><span class="line"># <span class="keyword">select</span> <span class="operator">-</span> <span class="keyword">from</span> <span class="operator">-</span> <span class="keyword">where</span> <span class="operator">-</span> <span class="keyword">group</span> <span class="keyword">by</span> <span class="operator">-</span> <span class="keyword">having</span> <span class="operator">-</span> <span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line"><span class="keyword">select</span> `å­—æ®µ` <span class="keyword">from</span> `è¡¨` <span class="keyword">where</span>Â·Â·Â· </span><br></pre></td></tr></table></figure><h2 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h2><p>å»é‡æŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> `å­—æ®µ`, `å­—æ®µ` <span class="keyword">from</span> `è¡¨`</span><br></pre></td></tr></table></figure><h2 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h2><p>è¿æ¥å­—æ®µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> concat(<span class="string">&#x27;æˆ‘çš„åå­—æ˜¯:&#x27;</span>,`name`) <span class="keyword">as</span> å­¦ç”Ÿå§“å <span class="keyword">from</span> `users`</span><br></pre></td></tr></table></figure><h2 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h2><p>limitä¸€èˆ¬æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªè¡¨ç¤ºè¿”å›æ•°æ®çš„èµ·å§‹ä½ï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºè¦è¿”å›çš„è¡Œæ•°ã€‚è‹¥åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå³çœå»äº†ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä½¿ç”¨é»˜è®¤å€¼0ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># è¿”å›å‰<span class="number">5</span>è¡Œæ•°æ®ï¼ˆé»˜è®¤ä»ç¬¬<span class="number">0</span>è¡Œå¼€å§‹ï¼Œè¿”å›å<span class="number">5</span>è¡Œæ•°æ®ï¼‰</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> `è¡¨` limit <span class="number">5</span></span><br><span class="line"># ä»ç¬¬<span class="number">3</span>è¡Œå¼€å§‹ï¼Œè¿”å›å<span class="number">3</span>è¡Œæ•°æ®ï¼Œä¹Ÿå°±æ˜¯<span class="number">4</span>ã€<span class="number">5</span>ã€<span class="number">6</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> `è¡¨` limit <span class="number">3</span>ï¼Œ<span class="number">3</span></span><br></pre></td></tr></table></figure><h2 id="order-by"><a href="#order-by" class="headerlink" title="order by"></a>order by</h2><p>æ’åºï¼Œ<strong>ASCå‡åºï¼ˆé»˜è®¤ï¼‰ï¼ŒDESCé™åº</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> `è¡¨`</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> `å­—æ®µ` <span class="keyword">ASC</span> <span class="operator">/</span> <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure><h2 id="where"><a href="#where" class="headerlink" title="where"></a>where</h2><p>å¯ä½¿ç”¨çš„åˆ¤æ–­è¯­å¥ </p><table><thead><tr><th align="center">æ“ä½œç¬¦</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">=</td><td align="center">ç­‰äº</td></tr><tr><td align="center">&lt;</td><td align="center">å°äº</td></tr><tr><td align="center">&gt;</td><td align="center">å¤§äº</td></tr><tr><td align="center">!=</td><td align="center">ä¸ç­‰äº</td></tr><tr><td align="center">&lt;=</td><td align="center">å°äºç­‰äº</td></tr><tr><td align="center">&gt;=</td><td align="center">å¤§äºç­‰äº</td></tr><tr><td align="center">BETWEEN</td><td align="center">åœ¨ä¸¤ä¸ªå€¼ä¹‹é—´</td></tr><tr><td align="center">IS NULL</td><td align="center">ä¸º NULL å€¼</td></tr></tbody></table><ul><li><p><strong>andã€or</strong>å¯ç”¨äºæ¥è¿æ¥å¤šä¸ªæ¡ä»¶åˆ¤æ–­ã€‚ä¼˜å…ˆå¤„ç†andã€‚</p></li><li><p><strong>in</strong>å¸¸ç”¨äºåŒ¹é…ä¸€ç»„å€¼ï¼Œä¹Ÿå¯ä»¥è·Ÿä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼ŒåŒ¹é…å­æŸ¥è¯¢å¾—åˆ°çš„ä¸€ç»„å€¼</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> `è¡¨` <span class="keyword">where</span> `å­—æ®µ` <span class="keyword">in</span> (<span class="string">&#x27;å€¼&#x27;</span>Â·Â·Â·)</span><br></pre></td></tr></table></figure></li><li><p><strong>not</strong>ç›¸å½“äºå¦å®šï¼Œå¯åŠ åœ¨ä¸€èˆ¬çš„åˆ¤æ–­è¯­å¥å‰é¢è¡¨å¦å®š</p></li></ul><h2 id="é€šé…ç¬¦ï¼ˆæ¨¡ç³ŠæŸ¥è¯¢ï¼‰"><a href="#é€šé…ç¬¦ï¼ˆæ¨¡ç³ŠæŸ¥è¯¢ï¼‰" class="headerlink" title="é€šé…ç¬¦ï¼ˆæ¨¡ç³ŠæŸ¥è¯¢ï¼‰"></a>é€šé…ç¬¦ï¼ˆæ¨¡ç³ŠæŸ¥è¯¢ï¼‰</h2><p>é€šé…ç¬¦ç”¨äºè¿‡æ»¤ï¼Œä½†åªèƒ½ç”¨äºæ–‡æœ¬å­—æ®µã€‚</p><p>è¦ä½¿ç”¨<strong>like</strong>è¿›è¡Œé€šé…ç¬¦åŒ¹é…ã€‚å°±æ˜¯ä½¿ç”¨ä¸¤ä¸ªé€šé…ç¬¦è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œç„¶åè¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ã€‚</p><ul><li><strong>%</strong> å¯æ›¿æ¢0æˆ–å¤šä¸ªä»»æ„å­—ç¬¦</li><li><strong>_</strong>  åªå¯æ›¿æ¢1ä¸ªä»»æ„å­—ç¬¦</li></ul><h2 id="è®¡ç®—å‡½æ•°"><a href="#è®¡ç®—å‡½æ•°" class="headerlink" title="è®¡ç®—å‡½æ•°"></a>è®¡ç®—å‡½æ•°</h2><p>å‡½æ•°å¯¹selectåçš„æŸ¥è¯¢å­—æ®µæ“ä½œå³å¯ã€‚</p><table><thead><tr><th align="center">å‡½ æ•°</th><th align="center">è¯´ æ˜</th></tr></thead><tbody><tr><td align="center">AVG()</td><td align="center">è¿”å›æŸåˆ—çš„å¹³å‡å€¼</td></tr><tr><td align="center">COUNT()</td><td align="center">è¿”å›æŸåˆ—çš„è¡Œæ•°</td></tr><tr><td align="center">MAX()</td><td align="center">è¿”å›æŸåˆ—çš„æœ€å¤§å€¼</td></tr><tr><td align="center">MIN()</td><td align="center">è¿”å›æŸåˆ—çš„æœ€å°å€¼</td></tr><tr><td align="center">SUM()</td><td align="center">è¿”å›æŸåˆ—å€¼ä¹‹å’Œ</td></tr></tbody></table><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(money) <span class="keyword">AS</span> `sum` <span class="keyword">FROM</span> `account`</span><br></pre></td></tr></table></figure><h2 id="group-byï¼Œhaving"><a href="#group-byï¼Œhaving" class="headerlink" title="group byï¼Œhaving"></a>group byï¼Œhaving</h2><p>é€šè¿‡æŸ¥è¯¢è¯­å¥æŸ¥æ‰¾è¡¨çš„æŸä¸ªå­—æ®µï¼Œç„¶åæŒ‰ç…§å­—æ®µè¿›è¡Œåˆ†ç»„å±•ç¤ºã€‚</p><p>é¦–å…ˆå¯ä»¥é€šè¿‡whereå¯¹åŸè¡¨æ•°æ®è¿›è¡Œç­›é€‰æ“ä½œï¼Œç„¶åä½¿ç”¨group byå¯¹æŸ¥è¯¢æ•°æ®è¿›è¡Œåˆ†ç»„æ“ä½œï¼Œåˆ†ç»„åçš„æ•°æ®è‹¥è¿˜éœ€è¦ç­›é€‰ï¼Œåˆ™ä½¿ç”¨havingæ“ä½œã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> `å­—æ®µ`, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> åˆ«å <span class="keyword">FROM</span> `è¡¨`</span><br><span class="line"><span class="keyword">WHERE</span> <span class="operator">&lt;</span>å¯¹åŸè¡¨æ•°æ®æ“ä½œ<span class="operator">&gt;</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> `å­—æ®µ` </span><br><span class="line"><span class="keyword">HAVING</span> <span class="operator">&lt;</span>å¯¹åˆ†ç»„æ•°æ®æ“ä½œ<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure><h2 id="å­æŸ¥è¯¢"><a href="#å­æŸ¥è¯¢" class="headerlink" title="å­æŸ¥è¯¢"></a>å­æŸ¥è¯¢</h2><p>å°±æ˜¯æŸ¥è¯¢è¯­å¥å¥—æŸ¥è¯¢ï¼Œä½¿ç”¨å­æŸ¥è¯¢çš„ç»“æœæ¥è¿›è¡Œæ“ä½œã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users</span><br><span class="line"><span class="keyword">WHERE</span> `name` <span class="keyword">IN</span> (<span class="keyword">SELECT</span> `password` <span class="keyword">FROM</span> users)</span><br></pre></td></tr></table></figure><p>å­æŸ¥è¯¢å¯†ç å­—æ®µçš„ç»“æœï¼ŒæŸ¥è¯¢å§“åï¼Œå…¶ä¸­å§“åå’Œå­æŸ¥è¯¢çš„å¯†ç å­—æ®µæœ‰ç›¸åŒå€¼åˆ™ç­›é€‰å‡ºæ¥ã€‚</p><h2 id="è¿æ¥ï¼ˆjoin-onï¼‰"><a href="#è¿æ¥ï¼ˆjoin-onï¼‰" class="headerlink" title="è¿æ¥ï¼ˆjoin onï¼‰"></a>è¿æ¥ï¼ˆjoin onï¼‰</h2><h3 id="å†…è¿æ¥ï¼ˆinner-joinï¼‰"><a href="#å†…è¿æ¥ï¼ˆinner-joinï¼‰" class="headerlink" title="å†…è¿æ¥ï¼ˆinner joinï¼‰"></a>å†…è¿æ¥ï¼ˆinner joinï¼‰</h3><p>æŸ¥è¯¢ç”¨æˆ·çš„é‚®ç®±ä¸è´¦æˆ·çš„é‡‘é¢ï¼Œæ‰¾åˆ°ä¸¤ä¸ªè¡¨idç›¸åŒçš„æ•°æ®è¿›è¡Œè¿”å›ã€‚inner joinæ¥è¿æ¥æŸ¥è¯¢åï¼Œä½¿ç”¨onè¿›è¡Œæ¡ä»¶ç­›é€‰ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.money, u.email</span><br><span class="line"><span class="keyword">FROM</span> account <span class="keyword">AS</span> a <span class="keyword">INNER</span> <span class="keyword">JOIN</span> users <span class="keyword">AS</span> u</span><br><span class="line"><span class="keyword">ON</span> a.id <span class="operator">=</span> u.id</span><br></pre></td></tr></table></figure><h3 id="è‡ªè¿æ¥"><a href="#è‡ªè¿æ¥" class="headerlink" title="è‡ªè¿æ¥"></a>è‡ªè¿æ¥</h3><p>è¡¨ä¸è¡¨è‡ªèº«è¿›è¡Œè¿æ¥æŸ¥è¯¢ï¼Œç›¸å½“äºå¤åˆ¶ä¸€ä¸ªè¡¨ï¼Œä¸¤ä¸ªç›¸åŒçš„è¡¨è¿›è¡Œè¿æ¥æŸ¥è¯¢ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> u1.email, u1.id</span><br><span class="line"><span class="keyword">FROM</span> users <span class="keyword">AS</span> u1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> users <span class="keyword">AS</span> u2</span><br><span class="line"><span class="keyword">ON</span> u1.id <span class="operator">=</span> u2.id</span><br></pre></td></tr></table></figure><h3 id="å¤–è¿æ¥ï¼ˆå·¦å¤–è¿ã€å³å¤–è¿ã€å…¨å¤–è¿ï¼‰"><a href="#å¤–è¿æ¥ï¼ˆå·¦å¤–è¿ã€å³å¤–è¿ã€å…¨å¤–è¿ï¼‰" class="headerlink" title="å¤–è¿æ¥ï¼ˆå·¦å¤–è¿ã€å³å¤–è¿ã€å…¨å¤–è¿ï¼‰"></a>å¤–è¿æ¥ï¼ˆå·¦å¤–è¿ã€å³å¤–è¿ã€å…¨å¤–è¿ï¼‰</h3><p>å·¦è¿æ¥ç”¨æˆ·è¡¨ä¸è´¦æˆ·è¡¨ï¼Œè¿”å›éœ€è¦çš„å­—æ®µï¼Œä½¿ç”¨å·¦å³è¿æ¥æ—¶ï¼Œå‡ºæ¥æŸ¥è¯¢ä¸¤ä¸ªè¡¨ç¬¦åˆçš„å­—æ®µï¼Œè¿˜è¦å±•ç¤ºå·¦è¡¨æˆ–å³è¡¨çš„å‰©ä½™å…¨éƒ¨å†…å®¹ã€‚æ²¡æœ‰å­—æ®µåˆ™è®°ä¸ºnullï¼Œä½†ä¸€å®šè¦æœ‰ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> u.id, u.name, u.password</span><br><span class="line"><span class="keyword">FROM</span> users <span class="keyword">AS</span> u <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> account <span class="keyword">AS</span> a</span><br><span class="line"><span class="keyword">ON</span> a.id <span class="operator">=</span> u.id</span><br></pre></td></tr></table></figure><h2 id="ç»„åˆæŸ¥è¯¢"><a href="#ç»„åˆæŸ¥è¯¢" class="headerlink" title="ç»„åˆæŸ¥è¯¢"></a>ç»„åˆæŸ¥è¯¢</h2><p>ç»„åˆå¤šä¸ªæŸ¥è¯¢è¯­å¥ï¼Œä½†æ¯ä¸ªæŸ¥è¯¢çš„è¿”å›æ ¼å¼å¿…é¡»ä¸€æ ·ï¼Œå¦‚åˆ—ç›¸åŒç­‰ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> `name` <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> `name`<span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> `name` <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">3</span></span><br></pre></td></tr></table></figure><h2 id="ä¸‰å¤§èŒƒå¼"><a href="#ä¸‰å¤§èŒƒå¼" class="headerlink" title="ä¸‰å¤§èŒƒå¼"></a>ä¸‰å¤§èŒƒå¼</h2><p><a href="https://zhuanlan.zhihu.com/p/194270249">https://zhuanlan.zhihu.com/p/194270249</a></p><ul><li><p>1NF</p><p>æ•°æ®åº“æ¯ä¸€åˆ—ï¼ˆæ¯ä¸ªå±æ€§å­—æ®µï¼‰ï¼Œéƒ½æ˜¯ä¸å¯åˆ†å‰²çš„åŸå­æ•°æ®é¡¹ã€‚ä¹Ÿå°±è¯´å­—æ®µå†…å®¹å¯ä»¥äºŒæ¬¡æ‹†åˆ†ï¼Œé‚£ä¹ˆå°±ä¸æ»¡è¶³1NFã€‚</p><p>æ¯”å¦‚å­¦ç”Ÿè¯¾ç¨‹å…³ç³»è¡¨ï¼Œä¸å¯ä»¥ä¸€ä¸ªå­¦ç”Ÿç›´æ¥å¯¹åº”ä¸€ä¸ªè¯¾ç¨‹çš„ä¿¡æ¯é›†åˆï¼Œè€Œæ˜¯åˆ†å¤šä¸ªæ¡ç›®è¿›è¡Œè®°å½•ã€‚</p></li><li><p>2NF</p><p>è¡¨ä¸­éä¸»é”®å­—æ®µåº”è¯¥å’Œä¸»é”®å®Œå…¨ä¾èµ–ï¼Œè€Œä¸æ˜¯éƒ¨åˆ†ä¾èµ–ã€‚</p><p><strong>å½“è¡¨ä¸­ä¸»é”®ç”±å¤šä¸ªå­—æ®µç»„æˆæ—¶ä¼šå‡ºç°è¯¥é—®é¢˜</strong>ï¼Œéƒ¨åˆ†å­—æ®µåªå’Œå…¶ä¸­ä¸€ä¸ªä¸»é”®æœ‰å…³è”ï¼Œæ¯”æ–¹è¯´è®¢å•è¡¨ä¸»é”®ç”±è®¢å•å· + äº§å“ç»„æˆï¼Œä¸€äº›è®¢å•å…·ä½“æ•°æ®ä¿¡æ¯åº”è¯¥å•ç‹¬ä¸è®¢å•å·è®°å½•ï¼Œè€Œä¸æ˜¯æ··åˆåœ¨è®¢å•äº§å“è¡¨ä¸­ã€‚</p></li><li><p>3NF</p><p>éä¸»é”®å­—æ®µä¸èƒ½ä¼ é€’ä¾èµ–äºä¸»é”®ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½äº§ç”Ÿä¾èµ–ä¼ é€’å…³ç³»ã€‚ä¸»é”®å¤–çš„æ‰€æœ‰å­—æ®µäº’ä¸ä¾èµ–ã€‚</p><p>æ¯”å¦‚æœ‰ABCä¸‰ä¸ªå­—æ®µï¼ŒAæ˜¯ä¸»é”®ï¼ŒCæ˜¯é€šè¿‡Bä¸Aä¸»é”®è¿›è¡Œå…³è”ï¼Œæ­¤æ—¶å°±è¿åäº†3NFã€‚éœ€è¦æ‹†åˆ†æˆABï¼ŒBCä¸¤å¼ è¡¨ï¼Œæ¶ˆé™¤ä¼ é€’ä¾èµ–ã€‚</p></li></ul><h1 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h1><h2 id="ç´¢å¼•åº•å±‚æ•°æ®ç»“æ„"><a href="#ç´¢å¼•åº•å±‚æ•°æ®ç»“æ„" class="headerlink" title="ç´¢å¼•åº•å±‚æ•°æ®ç»“æ„"></a>ç´¢å¼•åº•å±‚æ•°æ®ç»“æ„</h2><h3 id="ä½¿ç”¨Bæ ‘ä¸B-æ ‘å¼•æ“çš„åŒºåˆ«"><a href="#ä½¿ç”¨Bæ ‘ä¸B-æ ‘å¼•æ“çš„åŒºåˆ«" class="headerlink" title="ä½¿ç”¨Bæ ‘ä¸B+æ ‘å¼•æ“çš„åŒºåˆ«"></a>ä½¿ç”¨Bæ ‘ä¸B+æ ‘å¼•æ“çš„åŒºåˆ«</h3><ul><li>Bæ ‘å…¶æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šå­˜æ”¾ key å’Œ data ï¼Œä½†B+æ ‘åªæœ‰å¶å­èŠ‚ç‚¹ä¼šå­˜æ”¾ key å’Œ data ï¼Œå…¶ä½™å†…éƒ¨èŠ‚ç‚¹å­˜æ”¾keyã€‚ä¹Ÿå°±æ˜¯è¯´Bæ ‘æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯ä»¥ä¿å­˜æ•°æ®ï¼Œç´¢å¼•å¾ˆå¤§ï¼Œä½†B+æ ‘åªæœ‰å¶å­èŠ‚ç‚¹ä¿å­˜æ•°æ®ï¼Œå…¶å†…éƒ¨èŠ‚ç‚¹ç›¸å½“äºä¸€ä¸ªæŸ¥æ‰¾çš„ç´¢å¼•ã€‚</li><li>B+æ ‘çš„å¶å­èŠ‚ç‚¹é€šè¿‡é“¾è¡¨ç›¸è¿ï¼Œè€ŒBæ ‘å¶å­èŠ‚ç‚¹æ˜¯å•ç‹¬çš„ã€‚</li><li>B+æ ‘ç›¸å½“äºBæ ‘æ£€ç´¢æ›´åŠ ç¨³å®šï¼ŒBæ ‘å¯èƒ½æ²¡æœ‰èµ°åˆ°å¶å­èŠ‚ç‚¹å°±æŸ¥åˆ°æ•°æ®äº†ï¼Œè€ŒB+æ ‘æ•°æ®éƒ½æ˜¯å­˜åœ¨ä¸å¶å­èŠ‚ç‚¹ä¸Šçš„ï¼Œä¸”å¶å­èŠ‚ç‚¹è¿˜å¯è¿›è¡Œé¡ºåºæŸ¥æ‰¾ï¼Œä¸ç”¨è¿”å›ä¸Šä¸€èŠ‚ç‚¹ã€‚B+æ ‘æ›´ä¾¿äºåŒºé—´æŸ¥æ‰¾å’Œéå†ã€‚</li><li>ä¸ºä»€ä¹ˆä¸ç”¨çº¢é»‘æ ‘ï¼Œå› ä¸ºBã€B+æ ‘éƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹åŒ…å«å¤šä¸ªkeyçš„æ•°æ®ç»“æ„ï¼Œå®ƒä»¬çš„æ ‘é«˜ç›¸æ¯”çº¢é»‘æ ‘æ›´ä½ï¼Œè€Œæ•°æ®åº“ç£ç›˜IOæ¬¡æ•°å°±æ˜¯ç”±æ ‘é«˜å†³å®šçš„ï¼Œä½¿ç”¨B+æ ‘ç»“æ„IOæ•ˆç‡æ›´é«˜ã€‚</li></ul><h2 id="ç´¢å¼•ç±»å‹"><a href="#ç´¢å¼•ç±»å‹" class="headerlink" title="ç´¢å¼•ç±»å‹"></a>ç´¢å¼•ç±»å‹</h2><ul><li><p><strong>ä¸»é”®ç´¢å¼•ï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰</strong></p><p>æ•°æ®è¡¨çš„ä¸»é”®å°±æ˜¯ä¸»é”®ç´¢å¼•ã€‚ä¸»é”®å’Œä¸»é”®ç´¢å¼•ä¸€è‡´ï¼Œåªèƒ½æœ‰ä¸€ä¸ªï¼Œä¸”ä¸»é”®ä¸ä¸ºç©ºï¼Œä¸èƒ½é‡å¤ã€‚èšç°‡ç´¢å¼•ã€‚</p></li><li><p><strong>äºŒçº§ç´¢å¼•ï¼ˆè¾…åŠ©ç´¢å¼•ï¼‰</strong></p><p>InnoDBä¸­éä¸»é”®ç´¢å¼•çš„å°±æ˜¯äºŒçº§ç´¢å¼•ï¼ŒäºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®æ˜¯ä¸»é”®å€¼ï¼Œå¯é€šè¿‡äºŒçº§ç´¢å¼•ç¡®å®šä¸»é”®çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯å›è¡¨æŸ¥è¯¢ã€‚</p></li><li><p><strong>å”¯ä¸€ç´¢å¼•</strong></p><p>å”¯ä¸€ç´¢å¼•çš„å±æ€§åˆ—ä¸å¯å‡ºç°é‡å¤æ•°æ®ï¼Œä½†å…è®¸æ•°æ®ä¸ºnullï¼Œä¸€å¼ è¡¨å…è®¸å¤šä¸ªå”¯ä¸€ç´¢å¼•ã€‚ä¸€èˆ¬æ˜¯ä¸ºäº†ä¿è¯æ•°æ®åˆ—çš„å”¯ä¸€æ€§ï¼Œä¸æ˜¯ä¸ºäº†æŸ¥æ‰¾æ€§èƒ½è€ƒè™‘ã€‚</p></li><li><p><strong>æ™®é€šç´¢å¼•</strong></p><p>æ™®é€šç´¢å¼•å”¯ä¸€çš„ä½œç”¨å°±æ˜¯ä¸ºäº†å¿«é€ŸæŸ¥è¯¢æ•°æ®ï¼Œä¸€å¼ è¡¨å…è®¸å¤šä¸ªæ™®é€šç´¢å¼•ï¼Œä¸”å…è®¸æ•°æ®é‡å¤å’Œnullã€‚</p></li><li><p><strong>å‰ç¼€ç´¢å¼•</strong></p><p>ç´¢å¼•å¾ˆé•¿çš„å­—ç¬¦åˆ—ï¼Œå¯¼è‡´ç´¢å¼•å¾ˆå¤§ä¸”æ…¢ã€‚å‰ç¼€ç´¢å¼•åªé€‚åˆå­—ç¬¦ä¸²ç±»å‹æ•°æ®ã€‚å‰ç¼€ç´¢å¼•å¯¹æ–‡æœ¬çš„å‰å‡ ä¸ªå­—ç¬¦åˆ›å»ºç´¢å¼•ï¼ŒèŠ‚çœç´¢å¼•ç©ºé—´ï¼Œæé«˜ç´¢å¼•æ•ˆç‡ã€‚</p></li><li><p><strong>å“ˆå¸Œç´¢å¼•</strong></p><p>åŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œä¸ºäº†ç²¾ç¡®åŒ¹é…ç´¢å¼•æ‰€æœ‰åˆ—çš„æŸ¥è¯¢æ‰æœ‰æ•ˆã€‚æ— æ³•ç”¨äºæ’åºï¼Œä¸æ”¯æŒéƒ¨åˆ†ç´¢å¼•åˆ—çš„åŒ¹é…æŸ¥è¯¢ï¼Œå“ˆå¸Œç´¢å¼•å§‹ç»ˆä½¿ç”¨ç´¢å¼•åˆ—çš„å…¨éƒ¨å†…å®¹è®¡ç®—å“ˆå¸Œå€¼ã€‚</p></li><li><p><strong>å…¨æ–‡ç´¢å¼•</strong></p><p>å…¨æ–‡ç´¢å¼•ä¸»è¦ä¸ºäº†æ£€ç´¢å¤§æ–‡æœ¬æ•°æ®çš„å…³é”®å­—ä¿¡æ¯ã€‚</p></li><li><p><strong>å¤šåˆ—ç´¢å¼•</strong></p><p>å¤šä¸ªåˆ—ç»„æˆçš„ç´¢å¼•å³è”åˆç´¢å¼•ã€‚éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™ã€‚</p></li></ul><h2 id="èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•ï¼ˆInnoDBï¼‰"><a href="#èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•ï¼ˆInnoDBï¼‰" class="headerlink" title="èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•ï¼ˆInnoDBï¼‰"></a>èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•ï¼ˆInnoDBï¼‰</h2><h3 id="èšç°‡ç´¢å¼•"><a href="#èšç°‡ç´¢å¼•" class="headerlink" title="èšç°‡ç´¢å¼•"></a>èšç°‡ç´¢å¼•</h3><p>ä¸€ä¸ªè¡¨åªæœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ã€‚èšé›†ç´¢å¼•å°±æ˜¯ç´¢å¼•ç»“æ„ä¸æ•°æ®ä¸€èµ·å­˜æ”¾çš„ç´¢å¼•ã€‚ä¸»é”®ç´¢å¼•æ˜¯èšé›†ç´¢å¼•ã€‚B+æ ‘ç»“æ„ï¼Œå¶å­èŠ‚ç‚¹dataå­˜å‚¨æ•°æ®ã€‚</p><ul><li>ä¼˜ç‚¹ï¼šèšé›†ç´¢å¼•æŸ¥è¯¢é€Ÿåº¦å¾ˆå¿«ï¼Œä½¿ç”¨çš„æ˜¯B+æ ‘çš„å­˜å‚¨ç»“æ„ã€‚</li><li>ç¼ºç‚¹ï¼š<strong>ä¾èµ–æœ‰åºæ•°æ®</strong>ï¼Œå› ä¸ºB+æ ‘æ•°æ®æœ‰åºï¼Œé‡åˆ°æ— åºæ•°æ®æˆ‘ä»¬è¿˜è¦å…ˆè¿›è¡Œæ’åºå¤„ç†ï¼Œè€ŒåƒUUIDè¿™ç§æ‚ä¹±æ•°æ®å¤„ç†æ•ˆç‡å°±æ›´ä½äº†ã€‚</li></ul><p>InnoDBé»˜è®¤å°†é€æ¸è®¾ç½®ä¸ºèšç°‡ç´¢å¼•ï¼Œè‹¥æ²¡æœ‰å®šä¹‰ä¸»é”®ï¼ŒInnoDBä¼šé€‰æ‹©ä¸€ä¸ªå”¯ä¸€çš„éç©ºç´¢å¼•ä»£æ›¿ã€‚è‹¥æ²¡æœ‰è¿™ç§ç´¢å¼•ï¼ŒInnoDBä¼šéšå¼å®šä¹‰ä¸€ä¸ªä¸»é”®ä½œä¸ºèšç°‡ç´¢å¼•ã€‚</p><h3 id="éèšç°‡ç´¢å¼•"><a href="#éèšç°‡ç´¢å¼•" class="headerlink" title="éèšç°‡ç´¢å¼•"></a>éèšç°‡ç´¢å¼•</h3><p>äºŒçº§ç´¢å¼•æ˜¯éèšé›†ç´¢å¼•ã€‚å¶å­èŠ‚ç‚¹å­˜æ”¾ä¸»é”®å€¼ï¼Œä¸€èˆ¬æ˜¯æŸ¥è¯¢åˆ°ä¸»é”®å€¼åå¯¹ä¸»é”®ç´¢å¼•è¿›è¡Œå›è¡¨æŸ¥è¯¢ã€‚å¶å­èŠ‚ç‚¹dataå­˜å‚¨æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆã€‚</p><ul><li>ç¼ºç‚¹ï¼šä¹Ÿä¾èµ–æœ‰åºæ•°æ®ã€‚ä¸”éèšé›†ç´¢å¼•å¯èƒ½å‘ç”Ÿå›è¡¨æŸ¥è¯¢ã€‚</li></ul><h2 id="InnoDBä¸MyISAM"><a href="#InnoDBä¸MyISAM" class="headerlink" title="InnoDBä¸MyISAM"></a>InnoDBä¸MyISAM</h2><ul><li>äº‹åŠ¡ï¼šInnoDBæ”¯æŒäº‹åŠ¡æ“ä½œï¼ŒMyISAMä¸æ”¯æŒ</li><li>é”ï¼šInnoDBä½¿ç”¨è¡Œçº§é”ï¼ŒMyISAMä½¿ç”¨è¡¨çº§é”</li><li>ç´¢å¼•ï¼šInnoDBæ˜¯èšé›†è¡¨ï¼ŒMyISAMæ˜¯éèšé›†è¡¨</li><li>å¤–é”®ï¼šInnoDBæ”¯æŒå¤–é”®ï¼ŒMyISAMä¸æ”¯æŒ</li></ul><h2 id="æœ€å·¦åŒ¹é…ä¸è¦†ç›–ç´¢å¼•"><a href="#æœ€å·¦åŒ¹é…ä¸è¦†ç›–ç´¢å¼•" class="headerlink" title="æœ€å·¦åŒ¹é…ä¸è¦†ç›–ç´¢å¼•"></a>æœ€å·¦åŒ¹é…ä¸è¦†ç›–ç´¢å¼•</h2><p>é¦–å…ˆè¯´è¯´å¤šåˆ—ç´¢å¼•çš„<strong>æœ€å·¦åŒ¹é…åŸåˆ™</strong>ï¼Œä¸€ä¸ªå¤šåˆ—ç´¢å¼•ï¼ˆ a | b | c ï¼‰ï¼Œå¯ä»¥åŒ¹é…ä¸‰ç§æŸ¥è¯¢æ¡ä»¶ï¼Œaã€abã€abcï¼Œä¸”whereæŸ¥è¯¢æ¡ä»¶çš„å…ˆåä¸å½±å“ç´¢å¼•ï¼Œåªè¦æœ‰ç¬¦åˆçš„å­—æ®µå°±å¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œå› ä¸ºMySQLçš„ä¼˜åŒ–å™¨ä¼šä¼˜åŒ–å­—æ®µé¡ºåºèµ°å¤šåˆ—ç´¢å¼•ã€‚è€Œbcçš„æŸ¥è¯¢æ¡ä»¶æ˜¯æ— æ³•ä½¿ç”¨è¯¥å¤šåˆ—ç´¢å¼•çš„ã€‚</p><p><strong>æœ€å·¦åŒ¹é…åŸåˆ™ä¼šå‘å³åŒ¹é…ç›´è‡³é‡åˆ°èŒƒå›´æŸ¥è¯¢ï¼ˆ&gt;ã€&lt;ã€betweenã€likeï¼‰ã€‚</strong></p><p>ç„¶åè¯´è¯´<strong>è¦†ç›–ç´¢å¼•</strong>ï¼Œå¦‚æœæˆ‘ä»¬è¦<strong>æŸ¥è¯¢çš„å­—æ®µå…¨éƒ¨è¢«ä¸€ä¸ªç´¢å¼•æ‰€åŒ…å«ï¼Œé‚£ä¹ˆè¯¥æŸ¥è¯¢åªéœ€è¦å»æ‰«æç´¢å¼•æ ‘è€Œæ— éœ€å›è¡¨</strong>ã€‚ï¼ˆå›è¡¨æŸ¥è¯¢å°±æ˜¯æŸ¥äºŒçº§ç´¢å¼•æ‹¿ä¸»é”®å€¼ï¼Œå†å»æŸ¥ä¸»é”®ç´¢å¼•æ‹¿æ•°æ®ï¼‰è¿™é‡Œè¦†ç›–ç´¢å¼•åªæœ‰éƒ¨åˆ†è¦†ç›–ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><p>æ‰€ä»¥æœ‰æ—¶ä¼šå‡ºç°ç‰¹æ®Šæƒ…å†µï¼Œå¯¼è‡´æˆ‘ä»¬è¯¯ä»¥ä¸ºæœ€å·¦åŒ¹é…å¤±æ•ˆï¼Œä¾‹å¦‚æˆ‘ä»¬ç»™è¡¨ä¸­æ‰€æœ‰å­—æ®µè®¾ç½®ä¸ºå¤šåˆ—ç´¢å¼•ï¼Œé‚£ä¹ˆå¯¹è¯¥è¡¨çš„æŸ¥è¯¢ä¸€å®šä¼šèµ°è¦†ç›–ç´¢å¼•çš„æ“ä½œï¼Œæ­¤æ—¶æˆ‘ä»¬æ— è®ºæ€ä¹ˆå†™whereæ¡ä»¶è¯­å¥ï¼Œéƒ½ä¸ä¼šå…¨è¡¨æŸ¥è¯¢ï¼Œå¯¼è‡´æœ€å·¦åŒ¹é…çœ‹ä¼¼å¤±æ•ˆäº†ã€‚</p><h2 id="ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯"><a href="#ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯" class="headerlink" title="ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯"></a>ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯</h2><ul><li><p>ç´¢å¼•åˆ—å­—æ®µä½¿ç”¨å‡½æ•°</p></li><li><p>ç´¢å¼•åˆ—æ¶‰åŠè¡¨è¾¾å¼è®¡ç®—</p></li><li><p>æ¨¡ç³ŠæŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ¡ä»¶%åœ¨å³ä¾§å¯ä»¥èµ°ç´¢å¼•ï¼Œ%åœ¨å·¦ä¾§ç´¢å¼•å¤±æ•ˆã€‚**%åœ¨å³ä¾§çš„æƒ…å†µä¸‹ï¼Œmysqlæ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¼˜åŒ–ï¼Œåˆ¤æ–­æ˜¯å…¨è¡¨æ‰«æè¿˜æ˜¯èµ°ç´¢å¼•ï¼Œæ‰€ä»¥åœ¨æ¨¡ç³ŠæŸ¥è¯¢çš„æ—¶å€™æœ€å¥½ä¸è¦ç”¨å·¦%ï¼Œä¸”å†…å®¹è¦å†™è¯¦ç»†ç‚¹ã€‚**</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1: å¾®ä¿¡%</span><br><span class="line">2: å¾®ä¿¡å°ç¨‹åº%</span><br><span class="line">3: å¾®ä¿¡å…¬ä¼—å·%</span><br><span class="line">ä¸Šé¢ä¸‰ç§æ¨¡ç³ŠæŸ¥è¯¢æ¡ä»¶ï¼Œå¯èƒ½æƒ…å†µ1ä¼šè¢«MySQLè¿›è¡Œä¼˜åŒ–èµ°å…¨è¡¨æ‰«æï¼Œè¿™ä¸ªæ¶‰åŠåˆ°ä¼˜åŒ–ç®—æ³•ã€‚è€Œè¯¦ç»†ä¸€ç‚¹çš„æŸ¥è¯¢æ¡ä»¶2ã€3å°±ä¼šèµ°ç´¢å¼•ã€‚</span><br><span class="line">æˆ‘å®è·µåçš„çŒœæµ‹æ˜¯æ¡ä»¶ç›®æ ‡æ•°æ®å æ¯”æƒé‡è¿‡é«˜ï¼Œå¦‚æœå½“å‰æ¨¡ç³ŠæŸ¥è¯¢æ¡ä»¶ç›®æ ‡æ•°æ®åœ¨æ•´ä¸ªè¡¨ä¸­å æ¯”è¿‡é«˜ï¼Œè¿™ä¸ªæ¡ä»¶çš„ç´¢å¼•åº”è¯¥ä¼šä½äºB+æ ‘æœ€ä¸Šé¢çš„å‡ å±‚ï¼Œé‚£ä¹ˆéå†èµ°åˆ°çš„å¶å­èŠ‚ç‚¹ä¼šæ¯”è¾ƒå¤šï¼Œç´¢æ€§è¿›è¡Œå…¨è¡¨æ‰«æä¸èµ°ç´¢å¼•</span><br></pre></td></tr></table></figure></li><li><p>ç´¢å¼•åˆ—å±æ€§æ˜¯å­—ç¬¦ä¸²ï¼ŒæŸ¥è¯¢æ¡ä»¶ä½¿ç”¨æ•°å­—ï¼Œä¸èµ°ç´¢å¼•ã€‚åº•å±‚ä¼šè¿›è¡Œä¼˜åŒ–è¿›è¡Œæ ¼å¼è½¬æ¢ï¼Œè€Œæ•°å­—æ•´å‹æ ¼å¼æ¡ä»¶ä½¿ç”¨å­—ç¬¦ä¸²ç¡®å¯ä»¥ã€‚å»ºè®®æŸ¥è¯¢æ¡ä»¶éƒ½ç”¨å¼•å· <code>&#39;æ¡ä»¶&#39;</code>è¿›è¡Œä¿®é¥°ã€‚</p></li><li><p>æŸ¥è¯¢æ¡ä»¶ä¸­æœ‰orï¼Œä¸ä¸€å®šèµ°ç´¢å¼•ï¼Œæ­¤æ—¶è¦çœ‹MySQLä¼˜åŒ–å™¨</p></li><li><p>inçš„èŒƒå›´æŸ¥è¯¢ï¼Œæ¡ä»¶ç›®æ ‡è¿‡å¤šæ—¶ä¼šè¢«ä¼˜åŒ–æˆå…¨è¡¨æ‰«æï¼Œå…·ä½“é—®é¢˜å…·ä½“åˆ†æ</p></li><li><p>æ­£åˆ™è¡¨è¾¾å¼</p></li><li><p>MySQLä¼˜åŒ–å™¨ï¼Œå½“å…¨è¡¨æ‰«ææ•ˆç‡æ›´é«˜æ—¶ï¼Œä¸èµ°ç´¢å¼•ã€‚ä¸€èˆ¬é€šè¿‡EXPLAINç›¸å…³å‚æ•°è¿›è¡Œåˆ†è¾¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">prossible_keys: æ­¤å¤„ä¸ºå¯èƒ½è¿ç”¨åˆ°çš„ç´¢å¼•ï¼Œä¼˜åŒ–å™¨å¤„ç†å‰</span><br><span class="line">key: å®é™…ç”¨åˆ°çš„ç´¢å¼•ï¼Œä¼˜åŒ–å™¨å¤„ç†å</span><br></pre></td></tr></table></figure></li></ul><p>ç‰¹æ®Šæƒ…å†µï¼šè¦†ç›–ç´¢å¼•ï¼Œå³ä½¿æ˜¯å¤±æ•ˆåœºæ™¯ä»å¯ä»¥å‘½ä¸­ï¼Œå…¶å®åœºæ™¯å¾ˆå¤šï¼Œç´¢å¼•è¿˜è·Ÿæ•°æ®é‡æœ‰å…³ï¼Œå®é™…ä¸­æˆ‘ä»¬éœ€è¦ä½¿ç”¨ EXPLAIN å¯¹è‡ªå·±çš„SQLæ€§èƒ½è¿›è¡Œè¯„ä¼°ã€‚</p><p>EXPLAIN ç›¸å…³å‚æ•°ï¼š<a href="https://www.jianshu.com/p/8fab76bbf448">https://www.jianshu.com/p/8fab76bbf448</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show index from &#96;è¡¨å&#96;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä»¥ä¸Šè¯­å¥æ¥æŸ¥çœ‹æ¯å¼ è¡¨ç´¢å¼•çš„æŒ‡æ ‡ï¼Œå…¶ä¸­ cardinality ä»£è¡¨ â€œç´¢å¼•åŸºæ•°â€ ï¼Œè¯¥å‚æ•°æ¶‰åŠåˆ°ä¼˜åŒ–å™¨çš„ç´¢å¼•é€‰æ‹©ï¼ŒåŸºæ•°è¶Šå¤§çš„ç´¢å¼•æ€§èƒ½è¶Šå¥½ã€‚</p><h1 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h1><h2 id="æ•°æ®åº“äº‹åŠ¡"><a href="#æ•°æ®åº“äº‹åŠ¡" class="headerlink" title="æ•°æ®åº“äº‹åŠ¡"></a>æ•°æ®åº“äº‹åŠ¡</h2><p>å¤šä¸ªå¯¹æ•°æ®åº“æ“ä½œæ„æˆçš„ä¸€ä¸ªé€»è¾‘æ•´ä½“ï¼Œè¿™å°±æ˜¯æ•°æ®åº“äº‹åŠ¡ï¼Œè¿™ä¸ªé€»è¾‘æ•´ä½“çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æˆåŠŸã€‚</p><h2 id="ACID"><a href="#ACID" class="headerlink" title="ACID"></a>ACID</h2><ul><li><strong>åŸå­æ€§ï¼š</strong>åŸå­æ€§è¡¨ç¤ºäº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œè¿™ä¸ªæ•´ä½“åªèƒ½åŒæ—¶å®Œæˆæ“ä½œï¼Œä¸èƒ½åªå®Œæˆéƒ¨åˆ†æ“ä½œã€‚</li><li><strong>ä¸€è‡´æ€§ï¼š</strong>æ‰§è¡Œäº‹åŠ¡å‰åï¼Œæ•°æ®æ•´ä½“è¦ä¿æŒä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯æŠŠäº‹åŠ¡å½“ä½œä¸€ä¸ªæ•´ä½“ï¼Œæ¯”å¦‚è¿›è¡Œè½¬è´¦æ“ä½œï¼Œæ— è®ºæ“ä½œæ˜¯å¦æˆåŠŸï¼Œè´¦æˆ·ä¹‹é—´çš„æ“ä½œçš„é‡‘é¢æ•´ä½“æ˜¯ä¸å˜çš„ã€‚</li><li><strong>éš”ç¦»æ€§ï¼š</strong>å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸å—å…¶ä»–äº‹åŠ¡å¹²æ‰°ï¼Œäº‹åŠ¡ä¹‹é—´æ—¶ç›¸äº’éš”ç¦»çš„ã€‚</li><li><strong>æŒä¹…æ€§ï¼š</strong>ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œæäº¤åï¼Œå®ƒåœ¨æ•°æ®åº“ä¸­çš„æ”¹å˜æ˜¯æ°¸ä¹…çš„ï¼Œæ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸ä¼šå½±å“æ•°æ®ã€‚</li></ul><h2 id="å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜"><a href="#å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜" class="headerlink" title="å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜"></a>å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜</h2><p>å¤šä¸ªäº‹åŠ¡å¹¶å‘è¿è¡Œï¼Œç»å¸¸ä¼šæœ‰å¤šä¸ªç”¨æˆ·æ“ä½œåŒä¸€æ•°æ®ï¼Œå¹¶å‘æ˜¯ä¸å¯é¿çš„ï¼Œä½†ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ï¼Œä¸€èˆ¬æ˜¯å› ä¸ºå¹¶å‘ç ´åäº†äº‹åŠ¡çš„éš”ç¦»æ€§æ‰å¯¼è‡´ä»¥ä¸‹é—®é¢˜çš„å‘ç”Ÿã€‚</p><ul><li><p><strong>è„è¯»ï¼š</strong>ä¸€ä¸ªäº‹åŠ¡Aæ­£åœ¨è®¿é—®æ•°æ®å¹¶è¿›è¡Œä¿®æ”¹ï¼Œä½†ä¿®æ”¹è¿˜æœªæäº¤åˆ°æ•°æ®åº“ä¸­ï¼Œæ­¤æ—¶å¦ä¸€ä¸ªäº‹åŠ¡Bè®¿é—®è¯¥æ•°æ®å¹¶ä½¿ç”¨ï¼Œç”±äºè¿™ä¸ªæ•°æ®è¿˜æœªæäº¤ï¼Œäº‹åŠ¡Aåç»­å¯èƒ½å¯¹äº‹åŠ¡è¿›è¡Œå›æ»šæ“ä½œï¼Œé‚£ä¹ˆæ•°æ®å°±æ²¡æœ‰è¿›è¡Œä¿®æ”¹ï¼Œäº‹åŠ¡Bè¯»å–åˆ°çš„æ•°æ®å°±æ˜¯è„æ•°æ®ã€‚</p></li><li><p><strong>ä¸¢å¤±ä¿®æ”¹ï¼š</strong>äº‹åŠ¡Aè¯»å–æ•°æ®æ—¶ï¼ŒåŒæ—¶å¦ä¸€ä¸ªäº‹åŠ¡Bä¹Ÿè®¿é—®è¯¥æ•°æ®ï¼Œæ­¤æ—¶äº‹åŠ¡Aå…ˆä¿®æ”¹æ•°æ®ï¼Œç„¶åäº‹åŠ¡Bä¹Ÿä¿®æ”¹æ•°æ®ï¼Œæœ€åäº‹åŠ¡Bçš„ä¿®æ”¹æ“ä½œä¼šè¦†ç›–äº‹åŠ¡Açš„ä¿®æ”¹æ“ä½œã€‚</p></li><li><p><strong>ä¸å¯é‡å¤è¯»ï¼š</strong>äº‹åŠ¡Aå¯¹åŒä¸€æ•°æ®è¿›è¡Œå¤šæ¬¡è¯»å–æ“ä½œï¼Œåœ¨Aè¿›è¡Œå¤šæ¬¡è¯»å–ä¹‹é—´ï¼Œæœ‰äº‹åŠ¡Bå¯¹è¯¥æ•°æ®è¿›è¡Œäº†ä¿®æ”¹æ“ä½œï¼Œå¯¼è‡´äº‹åŠ¡AåŒä¸€æ•°æ®çš„å¤šæ¬¡è¯»å–ç»“æœä¸ä¸€è‡´ã€‚</p></li><li><p><strong>å¹»è¯»ï¼š</strong>äº‹åŠ¡Aå¯¹å¤šæ¡æ•°æ®è¿›è¡Œè¯»å–æ“ä½œï¼Œä½†ä¸­é€”äº‹åŠ¡Bæ‰§è¡Œäº†æ’å…¥æˆ–åˆ é™¤æ“ä½œï¼Œéšåäº‹åŠ¡Aå†æ¬¡å¯¹å¤šæ¡æ•°æ®è¿›è¡Œè¯»å–ï¼Œå‘ç°å’Œå‰ä¸€æ¬¡è¯»å–ç»“æœä¸ä¸€è‡´ã€‚</p></li></ul><h2 id="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"><a href="#äº‹åŠ¡çš„éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"></a>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</h2><p>éš”ç¦»çº§åˆ«ä¾æ¬¡é€’å¢</p><ul><li><strong>è¯»å–æœªæäº¤ï¼š</strong>å…è®¸è¯»å–æœªæäº¤çš„æ•°æ®ï¼Œæ‰€æœ‰å¹¶å‘é—®é¢˜éƒ½ä¼šå‡ºç°ã€‚</li><li><strong>è¯»å–å·²æäº¤ï¼š</strong>å…è®¸äº‹åŠ¡è¯»å–å·²æäº¤çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æäº¤å‰å¯¹å…¶ä»–äº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚å¯ä»¥é˜»æ­¢è„è¯»çš„å‘ç”Ÿã€‚</li><li><strong>å¯é‡å¤è¯»ï¼š</strong>ä¿è¯åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¤šæ¬¡è¯»å–åŒä¸€æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œé™¤éäº‹åŠ¡æœ¬èº«è¿›è¡Œä¿®æ”¹æ“ä½œã€‚å¯é˜»æ­¢è„è¯»ä¸ä¸å¯é‡å¤è¯»ã€‚</li><li><strong>å¯ä¸²è¡ŒåŒ–ï¼š</strong>å®Œå…¨æœä»ACIDçš„éš”ç¦»çº§åˆ«ã€‚å¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œå¤šä¸ªäº‹åŠ¡é—´äº’ä¸å¹²æ‰°ï¼Œä¸ä¼šå‡ºç°å¹¶å‘ç›¸å…³é—®é¢˜ã€‚è¯¥éš”ç¦»çº§åˆ«éœ€è¦è¿›è¡ŒåŠ é”æ“ä½œï¼Œä»¥ç¡®ä¿åŒæ—¶é—´åªæœ‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ä¸²è¡Œæ‰§è¡Œã€‚</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;åŸºç¡€è¯­æ³•&quot;&gt;&lt;a href=&quot;#åŸºç¡€è¯­æ³•&quot; class=&quot;headerlink&quot; title=&quot;åŸºç¡€è¯­æ³•&quot;&gt;&lt;/a&gt;åŸºç¡€è¯­æ³•&lt;/h1&gt;&lt;h2 id=&quot;å¢åˆ æ”¹æŸ¥&quot;&gt;&lt;a href=&quot;#å¢åˆ æ”¹æŸ¥&quot; class=&quot;headerlink&quot; title=&quot;å¢åˆ æ”¹æŸ¥&quot;&gt;&lt;/a</summary>
      
    
    
    
    <category term="å…«è‚¡" scheme="http://aidianfirst.com/categories/%E5%85%AB%E8%82%A1/"/>
    
    
  </entry>
  
  <entry>
    <title>è®¡ç½‘å…«è‚¡æ–‡</title>
    <link href="http://aidianfirst.com/2021/09/06/%E5%85%AB%E8%82%A1/%E8%AE%A1%E7%BD%91%E5%85%AB%E8%82%A1%E6%96%87/"/>
    <id>http://aidianfirst.com/2021/09/06/%E5%85%AB%E8%82%A1/%E8%AE%A1%E7%BD%91%E5%85%AB%E8%82%A1%E6%96%87/</id>
    <published>2021-09-06T15:15:14.000Z</published>
    <updated>2023-07-30T11:20:17.727Z</updated>
    
    <content type="html"><![CDATA[<h1 id="è®¡ç½‘æ¨¡å‹"><a href="#è®¡ç½‘æ¨¡å‹" class="headerlink" title="è®¡ç½‘æ¨¡å‹"></a>è®¡ç½‘æ¨¡å‹</h1><ul><li><p>OSIä¸ƒå±‚</p><p>ç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚ã€ä¼šè¯å±‚ã€è¡¨ç¤ºå±‚ã€ç½‘ç»œå±‚</p></li><li><p>TCP/IPå››å±‚</p><p>ç½‘ç»œæ¥å£å±‚ã€ç½‘ç»œå±‚ï¼ˆIPï¼‰ã€ä¼ è¾“å±‚ï¼ˆTCPã€UDPï¼‰ã€åº”ç”¨å±‚</p></li><li><p>äº”å±‚åè®®</p><p>ç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚ã€åº”ç”¨å±‚</p></li></ul><h1 id="TCPä¸‰æ¬¡æ¡æ‰‹"><a href="#TCPä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="TCPä¸‰æ¬¡æ¡æ‰‹"></a>TCPä¸‰æ¬¡æ¡æ‰‹</h1><h2 id="æ¡æ‰‹æµç¨‹"><a href="#æ¡æ‰‹æµç¨‹" class="headerlink" title="æ¡æ‰‹æµç¨‹"></a>æ¡æ‰‹æµç¨‹</h2><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/24.png" alt="24.png"></p><p>Aä½œä¸ºå®¢æˆ·ç«¯ï¼ŒBä½œä¸ºæœåŠ¡ç«¯ã€‚SYNæ˜¯åŒæ­¥åºåˆ—ç¼–å·ï¼ŒACKæ˜¯ç¡®è®¤æ ‡å¿—ä½ã€‚</p><ul><li>Bå¤„äºLISTENï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œ<strong>Aå‘Bå‘é€è¯·æ±‚æŠ¥æ–‡ï¼ŒSYN=1ã€ACK=0</strong>ï¼Œå¹¶é€‰æ‹©ä¸€ä¸ªåˆå§‹åºå·xï¼Œä»£è¡¨è¿™æ˜¯ä¸€ä¸ªåŒæ­¥è¯·æ±‚ã€‚</li><li>Bæ”¶åˆ°è¯·æ±‚æŠ¥æ–‡ï¼Œè‹¥åŒæ„å»ºç«‹è¿æ¥ï¼Œ<strong>åˆ™Bå‘Aå‘é€è¿æ¥ç¡®è®¤æŠ¥æ–‡ï¼ŒSYN=1ã€ACK=1</strong>ï¼Œä¸”ç¡®è®¤å·æ˜¯x+1ï¼Œå¹¶é€‰æ‹©ä¸€ä¸ªåˆå§‹åºå·yï¼Œè¿™ä¸€æ­¥æ˜¯å¯¹ç¬¬ä¸€æ¬¡æ¡æ‰‹çš„SYNåŒæ­¥è¿›è¡Œç¡®è®¤ã€‚</li><li>Aæ”¶åˆ°Bçš„æ¥è¿æ¥ç¡®è®¤æŠ¥æ–‡åï¼Œè¿˜éœ€<strong>Aå‘Bå‘å‡ºç¡®è®¤æŠ¥æ–‡ï¼ŒACK=1</strong>ï¼Œç¡®è®¤å·æ˜¯y+1ï¼Œåºå·æ˜¯x+1ï¼Œç„¶åBæ”¶åˆ°Açš„ç¡®è®¤æŠ¥æ–‡åï¼Œè¿æ¥æˆåŠŸå»ºç«‹ã€‚</li></ul><h2 id="ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹"><a href="#ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹"></a>ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹</h2><p>ä¸‰æ¬¡æ¡æ‰‹æ˜¯ä¸ºäº†é˜²æ­¢å¤±æ•ˆçš„è¿æ¥è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨ï¼Œè®©æœåŠ¡å™¨é”™è¯¯æ‰“å¼€è¿æ¥ã€‚</p><p>å®¢æˆ·ç«¯å‘é€çš„è¿æ¥è¯·æ±‚è‹¥åœ¨ç½‘ç»œä¸­é•¿æ—¶é—´æ»ç•™ï¼Œé‚£ä¹ˆé—´éš”å¾ˆé•¿çš„æ—¶é—´æ‰æ”¶åˆ°æœåŠ¡ç«¯çš„è¿æ¥ç¡®è®¤ã€‚ä½†å®¢æˆ·ç«¯åœ¨ç­‰å¾…ä¸€ä¸ªè¶…æ—¶é‡ä¼ æ—¶é—´åï¼Œä¼šé‡æ–°è¯·æ±‚è¿æ¥ã€‚æœ€åè¿™ä¸ªæ»ç•™çš„è¯·æ±‚è¿˜æ˜¯ä¼šåˆ°è¾¾æœåŠ¡å™¨ã€‚è‹¥ä¸è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ä¼šæ‰“å¼€ä¸¤ä¸ªè¿æ¥ï¼Œ<strong>è‹¥è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯ä¼šå¿½ç•¥æœåŠ¡å™¨åç»­å‘æ¥å¯¹æ»ç•™è¿æ¥è¯·æ±‚çš„ç¡®è®¤æŠ¥æ–‡ï¼Œäºæ˜¯ä¸è¿›è¡Œå¯¹è¯¥è¯·æ±‚çš„ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œå› æ­¤ä¸ä¼šæ‰“å¼€å¤šä¸ªè¿æ¥ã€‚</strong></p><h2 id="ä¸ºä»€ä¹ˆç¬¬äºŒæ¬¡æ¡æ‰‹é™¤äº†å›ä¼ ACKï¼Œè¿˜è¦å›ä¼ SYNï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆç¬¬äºŒæ¬¡æ¡æ‰‹é™¤äº†å›ä¼ ACKï¼Œè¿˜è¦å›ä¼ SYNï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆç¬¬äºŒæ¬¡æ¡æ‰‹é™¤äº†å›ä¼ ACKï¼Œè¿˜è¦å›ä¼ SYNï¼Ÿ"></a>ä¸ºä»€ä¹ˆç¬¬äºŒæ¬¡æ¡æ‰‹é™¤äº†å›ä¼ ACKï¼Œè¿˜è¦å›ä¼ SYNï¼Ÿ</h2><p>å›ä¼ SYNä»£è¡¨æœåŠ¡ç«¯æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œè¯æ˜å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„é€šä¿¡æ˜¯æ­£å¸¸çš„ï¼Œç°åœ¨è¿”å›ä¸€ä¸ªSYNæ¥å»ºç«‹å¹¶ç¡®è®¤æœåŠ¡ç«¯åˆ°å®¢æˆ·ç«¯çš„é€šä¿¡æ˜¯å¦æ­£å¸¸ã€‚</p><p>å›ä¼ ACKä»£è¡¨æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯æ”¶åˆ°äº†å®ƒçš„è¯·æ±‚ã€‚</p><p>å®¢æˆ·ç«¯å‘å‡ºSYNè¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä½¿ç”¨SYNâ€“ACKè¿›è¡Œåº”ç­”è¿™ä¸ªè¯·æ±‚ï¼Œæœ€åå®¢æˆ·ç«¯å†ä»¥ACKè¿›è¡Œè¿æ¥çš„æœ€åç¡®è®¤ï¼Œäºæ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é—´å»ºç«‹äº†å¯é çš„TCPè¿æ¥ã€‚</p><h1 id="TCPå››æ¬¡æŒ¥æ‰‹"><a href="#TCPå››æ¬¡æŒ¥æ‰‹" class="headerlink" title="TCPå››æ¬¡æŒ¥æ‰‹"></a>TCPå››æ¬¡æŒ¥æ‰‹</h1><h2 id="æŒ¥æ‰‹æµç¨‹"><a href="#æŒ¥æ‰‹æµç¨‹" class="headerlink" title="æŒ¥æ‰‹æµç¨‹"></a>æŒ¥æ‰‹æµç¨‹</h2><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/25.png" alt="25.png"></p><p>Aä½œä¸ºå®¢æˆ·ç«¯ï¼ŒBä½œä¸ºæœåŠ¡ç«¯ã€‚FINä»£è¡¨ç»“æŸã€‚</p><ul><li><strong>Aå‘Bå‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN=1ã€‚</strong></li><li>Bæ”¶åˆ°Açš„é‡Šæ”¾è¯·æ±‚ï¼Œéšå<strong>Bå‘Aå‘å‡ºç¡®è®¤è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒACK=1</strong>ï¼Œæ­¤æ—¶TCPå¤„äºåŠå…³é—­çŠ¶æ€ï¼ŒBå¯ä»¥å‘Aå‘é€æ•°æ®ï¼Œä½†Aä¸å¯ä»¥å‘Bå‘é€æ•°æ®ã€‚</li><li>æ­¤æ—¶Aåˆ°Bçš„è¿æ¥å…³é—­ï¼Œç„¶åæˆ‘ä»¬è¦å…³é—­Båˆ°Açš„è¿æ¥ï¼Œ<strong>Bå‘Aå‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN=1ï¼Œç”±äºç°åœ¨æ˜¯åŠå…³é—­çŠ¶æ€ï¼ŒæœåŠ¡å™¨å¯èƒ½åˆå‘é€äº†ä¸€äº›æ•°æ®ï¼Œæ­¤æ—¶Bè¿›å…¥LASTâ€“ACKï¼ˆæœ€åç¡®è®¤çŠ¶æ€ï¼‰ï¼Œç„¶åBå‘Aå‘é€ç¡®è®¤ï¼ŒACK=1</strong>ï¼Œç­‰å¾…å…³é—­ã€‚</li><li>Aæ”¶åˆ°Bçš„è¿æ¥å…³é—­è¯·æ±‚å’Œæœ€åç¡®è®¤è¯·æ±‚åï¼Œ<strong>Aè¿›å…¥TIMEâ€“WAITçŠ¶æ€ï¼ŒAå‘Bå‘é€ç¡®è®¤æŠ¥æ–‡ï¼ŒACK=1ï¼Œå†ç­‰å¾…2MSLåé‡Šæ”¾è¿æ¥ã€‚</strong></li><li>Bæ”¶åˆ°Açš„ç¡®è®¤è¿æ¥ï¼Œé‡Šæ”¾è¿æ¥ã€‚</li></ul><h2 id="ä¸ºä»€ä¹ˆå››æ¬¡æŒ¥æ‰‹"><a href="#ä¸ºä»€ä¹ˆå››æ¬¡æŒ¥æ‰‹" class="headerlink" title="ä¸ºä»€ä¹ˆå››æ¬¡æŒ¥æ‰‹"></a>ä¸ºä»€ä¹ˆå››æ¬¡æŒ¥æ‰‹</h2><p>å®¢æˆ·ç«¯å…ˆå‘é€FINè¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°æŠ¥æ–‡åå°±è¿›å…¥CLOSEâ€“WAITçŠ¶æ€ã€‚è¯¥çŠ¶æ€æ˜¯ä¸ºäº†è®©æœåŠ¡ç«¯å‘é€è¿˜æœªä¼ è¾“å®Œæ¯•çš„æ•°æ®ï¼Œå¾…æ•°æ®ä¼ è¾“å®Œæ¯•åï¼ŒæœåŠ¡å™¨ä¼šå‘é€FINè¿æ¥é‡Šæ”¾æŠ¥æ–‡ã€‚</p><p>è€Œå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„è¿æ¥é‡Šæ”¾è¯·æ±‚åï¼Œè¿›å…¥TIMEâ€“WAITçŠ¶æ€ï¼Œç„¶åç­‰å¾…2MSLçš„æ—¶é—´åï¼Œè¿›å…¥CLOSEDçŠ¶æ€ã€‚ç­‰å¾…çš„åŸå› æœ‰ä¸¤ç‚¹ï¼š</p><ul><li><p>ç¡®ä¿å®¢æˆ·ç«¯çš„æœ€åä¸€ä¸ªç¡®è®¤æŠ¥æ–‡å¯ä»¥åˆ°è¾¾æœåŠ¡ç«¯ã€‚è‹¥Bæ²¡æœ‰æ”¶åˆ°Açš„ç¡®è®¤æŠ¥æ–‡ï¼Œé‚£ä¹ˆAä¼šé‡æ–°å‘é€ç¡®è®¤è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒAç­‰å¾…ä¸€æ®µæ—¶é—´å°±æ˜¯ä¸ºäº†å¤„ç†è¿™ç§æƒ…å†µã€‚</p></li><li><p>ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œæ˜¯ä¸ºäº†ç­‰å¾…æœ¬è¿æ¥æŒç»­æ—¶é—´å†…äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡ä»ç½‘ç»œä¸­æ¶ˆå¤±ï¼Œä½¿ä¸‹ä¸€æ¬¡æ–°è¿æ¥ä¸ä¼šå‡ºç°æ—§è¿æ¥çš„è¯·æ±‚æŠ¥æ–‡ã€‚</p></li></ul><h1 id="TCPä¸UDPçš„åŒºåˆ«"><a href="#TCPä¸UDPçš„åŒºåˆ«" class="headerlink" title="TCPä¸UDPçš„åŒºåˆ«"></a>TCPä¸UDPçš„åŒºåˆ«</h1><ul><li>UDP<ul><li>æ— è¿æ¥</li><li>ä¼ è¾“ä¸å¯é </li><li>ä¼ è¾“å½¢å¼ï¼šæ•°æ®æŠ¥æ–‡ç«¯</li><li>ä¼ è¾“æ•ˆç‡å¿«</li><li>è€—èµ„æºå°‘</li><li>é¦–éƒ¨å­—èŠ‚ï¼š8å­—èŠ‚</li><li>ä¸€èˆ¬ç”¨äºé€šä¿¡é€Ÿåº¦è¦æ±‚é«˜çš„åœºæ™¯ï¼Œå³æ—¶é€šä¿¡ï¼Œå¦‚QQè¯­éŸ³ã€è§†é¢‘ç›´æ’­ç­‰</li></ul></li><li>TCP<ul><li>é¢å‘è¿æ¥</li><li>å¯é ä¼ è¾“</li><li>ä¼ è¾“å½¢å¼ï¼šå­—èŠ‚æµ</li><li>ä¼ è¾“æ•ˆç‡æ…¢</li><li>è€—èµ„æºå¤š</li><li>é¦–éƒ¨å­—èŠ‚ï¼š20-60</li><li>å¤šç”¨äºè¦æ±‚é€šä¿¡å¯é çš„åœºæ™¯ï¼Œå¦‚æ–‡ä»¶ä¼ è¾“ã€å‘é€æ¥æ”¶é‚®ä»¶ã€è¿œç¨‹ç™»å½•ç­‰åœºæ™¯</li></ul></li></ul><h1 id="TCPåè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“"><a href="#TCPåè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“" class="headerlink" title="TCPåè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“"></a>TCPåè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“</h1><ul><li><strong>æ ¡éªŒå’Œï¼š</strong>TCPæ ¡éªŒå’Œè¦†ç›–TCPé¦–éƒ¨ä¸TCPæ•°æ®ï¼Œè¿™æ˜¯ä¸€ä¸ªå‘é€ç«¯åˆ°æ¥æ”¶ç«¯çš„æ ¡éªŒå’Œã€‚ç›®çš„æ˜¯æ£€æµ‹æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„ä»»ä½•å˜åŒ–ï¼Œè‹¥æ”¶åˆ°çš„æ ¡éªŒå’Œæœ‰å·®é”™ï¼ŒTCPä¼šä¸¢å¼ƒå’Œä¸ç¡®è®¤æ¥æ”¶è¿™ä¸ªæŠ¥æ–‡æ®µã€‚</li><li><strong>æµé‡æ§åˆ¶ï¼š</strong>æµé‡æ§åˆ¶æ˜¯ä¸ºäº†æ§åˆ¶å‘é€æ–¹å‘é€é€Ÿç‡ï¼Œä¿è¯æ¥æ”¶æ–¹æ¥å¾—åŠæ¥æ”¶ã€‚å½“æ¥æ”¶æ–¹æ¥ä¸åŠå¤„ç†å‘é€æ–¹æ•°æ®æ—¶ï¼Œæ¥æ”¶æ–¹å‘é€çš„ç¡®è®¤æŠ¥æ–‡ä¸­çš„çª—å£å­—æ®µå¯ç”¨æ¥æ§åˆ¶å‘é€æ–¹çª—å£å¤§å°ï¼Œè¿›è€Œå½±å“å‘é€æ–¹çš„å‘é€é€Ÿç‡ã€‚<strong>ï¼ˆTCPåˆ©ç”¨æ»‘åŠ¨çª—å£å®ç°æµé‡æ§åˆ¶ï¼‰</strong></li><li><strong>æ‹¥å¡æ§åˆ¶ï¼š</strong>ç½‘ç»œæ‹¥å¡æ—¶ï¼Œå‡å°‘æ•°æ®çš„å‘é€ï¼Œé™ä½ç½‘ç»œæ‹¥å¡ç¨‹åº¦ã€‚<strong>ï¼ˆç»´æŠ¤æ‹¥å¡çª—å£ï¼Œå…¶å¤§å°å–å†³äºç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦ï¼‰</strong></li><li><strong>ARQåè®®ï¼š</strong>å®ç°å¯é ä¼ è¾“ï¼ŒåŸºæœ¬åŸç†æ˜¯æ¯æ¬¡å‘é€å®Œä¸€ä¸ªåˆ†ç»„å°±åœæ­¢å‘é€ï¼Œç­‰å¾…å¯¹æ–¹è¿›è¡Œç¡®è®¤åï¼Œå†è¿›è¡Œä¸‹ä¸€ä¸ªåˆ†ç»„çš„å‘é€ã€‚</li><li><strong>è¶…æ—¶é‡ä¼ ï¼š</strong>TCPå‘é€æŠ¥æ–‡åä¼šå¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œç­‰å¾…æ¥æ”¶ç«¯ç¡®è®¤è¿™ä¸ªæŠ¥æ–‡ã€‚è‹¥åœ¨é™åˆ¶æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ¥æ”¶ç«¯çš„ç¡®è®¤è¿”å›ï¼ŒTCPä¼šé‡æ–°å‘é€è¿™ä¸ªæŠ¥æ–‡æ®µã€‚</li></ul><h1 id="æµè§ˆå™¨ä»è¾“å…¥urlåˆ°å±•ç¤ºç½‘é¡µå‘ç”Ÿäº†ä»€ä¹ˆ"><a href="#æµè§ˆå™¨ä»è¾“å…¥urlåˆ°å±•ç¤ºç½‘é¡µå‘ç”Ÿäº†ä»€ä¹ˆ" class="headerlink" title="æµè§ˆå™¨ä»è¾“å…¥urlåˆ°å±•ç¤ºç½‘é¡µå‘ç”Ÿäº†ä»€ä¹ˆ"></a>æµè§ˆå™¨ä»è¾“å…¥urlåˆ°å±•ç¤ºç½‘é¡µå‘ç”Ÿäº†ä»€ä¹ˆ</h1><ul><li><p><strong>è§£æURlï¼š</strong>ä¹Ÿå°±æ˜¯åˆ†ææˆ‘ä»¬ç½‘å€çš„è¯·æ±‚è·¯å¾„</p></li><li><p><strong>æµè§ˆå™¨å°è£…HTTPè¯·æ±‚æŠ¥æ–‡ï¼š</strong>å¯¹URLè¿›è¡Œåˆ†æåï¼Œæµè§ˆå™¨ç¡®å®šäº†ç›®æ ‡æœåŠ¡å™¨ä»¥åŠè¯·æ±‚è·¯å¾„å¯¹åº”çš„æ–‡ä»¶ã€‚éšåæµè§ˆå™¨å°±å°†è¿™äº›ä¿¡æ¯å°è£…æˆä¸€ä¸ªHTTPè¯·æ±‚æŠ¥æ–‡å‘é€å‡ºå»ã€‚</p></li><li><p><strong>DNSåŸŸåè§£æè·å–IPåœ°å€ï¼š</strong>åŸŸåå¹¶ä¸æ˜¯ç›®æ ‡æœåŠ¡å™¨çš„è¯¦ç»†åœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜è¦è§£æè·å–å…¶è¯¦ç»†çš„IPåœ°å€ã€‚è€ŒDNSè·å–åœ°å€æ˜¯å…ˆå»ç¼“å­˜æŸ¥æ‰¾ï¼Œæ²¡æœ‰åˆ™å»æŸ¥è¯¢ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼Œ<strong>æ³¨æ„DNSä½¿ç”¨UDPåè®®ï¼Œä»¥ä¸‹è¯·æ±‚çš„è½¬å‘éƒ½æ˜¯åŸºäºUDPã€‚</strong></p><ul><li><strong>æœç´¢æµè§ˆå™¨DNSç¼“å­˜</strong></li><li><strong>æœç´¢æ“ä½œç³»ç»ŸDNSç¼“å­˜</strong></li><li>ç¼“å­˜ä¸­éƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†åŸŸåå‘é€åˆ°<strong>æœ¬åœ°åŸŸåæœåŠ¡å™¨</strong>ï¼Œé€šè¿‡æœ¬åœ°åŸŸåæœåŠ¡å™¨æŸ¥è¯¢DNSç¼“å­˜ï¼Œæ‰¾åˆ°åˆ™è¿”å›<strong>ï¼ˆä¸»æœºä¸æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¹‹é—´æŸ¥è¯¢æ–¹å¼æ˜¯é€’å½’æŸ¥è¯¢ï¼‰</strong></li><li>è‹¥æœ¬åœ°åŸŸåæœåŠ¡å™¨DNSç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œåˆ™æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘ä¸Šçº§åŸŸåæœåŠ¡å™¨è¿›è¡Œ<strong>è¿­ä»£æŸ¥è¯¢</strong>ã€‚<strong>ï¼ˆæœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸å…¶ä»–åŸŸåæœåŠ¡å™¨ä¹‹é—´è¿­ä»£æŸ¥è¯¢ï¼Œé˜²æ­¢æ ¹åŸŸåæœåŠ¡å™¨å‹åŠ›è¿‡å¤§ï¼‰</strong><ul><li>æœ¬åœ°åŸŸåæœåŠ¡å™¨<strong>å‘æ ¹åŸŸåæœåŠ¡å™¨å‘èµ·è¯·æ±‚</strong>ï¼Œæ ¹åŸŸåæ˜¯æœ€é«˜å±‚æ¬¡çš„ï¼Œå®ƒä¸ä¼šç›´æ¥æŒ‡æ˜ä¸€ä¸ªIPåœ°å€ï¼Œè€Œæ˜¯è¿”å›é¡¶çº§åŸŸåæœåŠ¡å™¨åœ°å€ï¼Œé€å±‚æŸ¥è¯¢</li><li>æœ¬åœ°åŸŸåæœåŠ¡å™¨<strong>å‘é¡¶çº§åŸŸåæœåŠ¡å™¨å‘èµ·è¯·æ±‚</strong>ï¼Œè·å–æƒé™åŸŸåæœåŠ¡å™¨åœ°å€</li><li><strong>æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘æƒé™åŸŸåæœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œå¾—åˆ°åŸŸåçš„IPåœ°å€</strong></li></ul></li><li>æœ¬åœ°åŸŸåæœåŠ¡å™¨è·å–IPåè¿”å›ç»™æ“ä½œç³»ç»Ÿï¼ŒåŒæ—¶è‡ªå·±ä¹Ÿä¼šç¼“å­˜IPåœ°å€ï¼Œæ–¹ä¾¿åç»­æŸ¥æ‰¾</li><li>æ“ä½œç³»ç»Ÿå°†IPåœ°å€è¿”å›ç»™æµè§ˆå™¨ï¼ŒåŒæ—¶è‡ªå·±ä¹Ÿä¼šå°†IPåœ°å€ç¼“å­˜èµ·æ¥</li><li>æµè§ˆå™¨å¾—åˆ°åŸŸåå¯¹åº”IPåœ°å€ï¼ŒåŒæ—¶æŠŠIPåœ°å€ç¼“å­˜èµ·æ¥</li></ul></li><li><p><strong>å»ºç«‹TCPè¿æ¥ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰ï¼š</strong>è·å–IPåœ°å€åï¼Œæµè§ˆå™¨çŸ¥é“è¦è½¬å‘çš„å¯¹è±¡äº†ï¼Œæ­¤æ—¶éœ€è¦å‘é€HTTPè¯·æ±‚æŠ¥æ–‡ï¼Œè¿™æ—¶è¦<strong>å…ˆé€šè¿‡TCPçš„ä¸‰æ¬¡æ¡æ‰‹</strong>å»ºç«‹æµè§ˆå™¨ä¸æœåŠ¡å™¨é—´çš„å¯é è¿æ¥ï¼Œ<strong>ä¿è¯åŒæ–¹éƒ½å…·æœ‰å¯é çš„å‘é€ä¸æ¥æ”¶èƒ½åŠ›</strong></p></li><li><p><strong>æµè§ˆå™¨å‘é€HTTPè¯·æ±‚ï¼š</strong>TCPä¸‰æ¬¡æ¡æ‰‹åï¼Œæµè§ˆå™¨ä¸æœåŠ¡å™¨é—´å»ºç«‹å¯é è¿æ¥ï¼Œæµè§ˆå™¨å¯ä»¥å‘é€HTTPè¯·æ±‚æŠ¥æ–‡ï¼Œç”±äºè¿™äº›æŠ¥æ–‡è¾ƒå¤§ï¼Œ<strong>TCPä¼šå°†HTTPæŠ¥æ–‡æŒ‰åºå·åˆ†å‰²æˆè‹¥å¹²æŠ¥æ–‡æ®µå¹¶åŠ ä¸ŠTCPé¦–éƒ¨ï¼Œåˆ†åˆ«è¿›è¡Œä¼ è¾“ã€‚æ¥æ”¶æ–¹åœ¨æ”¶åˆ°æŠ¥æ–‡æ®µåï¼ŒæŒ‰åºå·ä»¥åŸæ¥é¡ºåºé‡ç»„HTTPæŠ¥æ–‡</strong></p><ul><li><strong>è´Ÿè´£ä¼ è¾“çš„IPåè®®ï¼š</strong>TCPä¼ è¾“æŠ¥æ–‡æ®µæ—¶ï¼Œé€šè¿‡IPåè®®è¿›è¡Œä¼ è¾“ï¼ŒIPåè®®åœ¨ä¼ è¾“æ—¶ï¼Œä¼šç»™æŠ¥æ–‡æ®µæ·»åŠ IPé¦–éƒ¨å°è£…æˆIPæ•°æ®æŠ¥ç„¶åå†ä¼ è¾“ã€‚IPé¦–éƒ¨åŒ…å«æºIPåœ°å€ä¸ç›®æ ‡IPåœ°å€ã€‚</li></ul></li><li><p><strong>æœåŠ¡å™¨å“åº”è¯·æ±‚ï¼š</strong>æœåŠ¡å™¨æ”¶åˆ°æŠ¥æ–‡æ®µåï¼ŒæŒ‰åºå·é‡ç»„ä¸€ä¸ªHTTPè¯·æ±‚æŠ¥æ–‡ï¼Œç„¶åå¤„ç†å¹¶è¿”å›ä¸€ä¸ªHTTPå“åº”ï¼ŒHTTPå“åº”çš„è¿”å›è¿‡ç¨‹å’ŒHTTPè¯·æ±‚ä¸€è‡´ã€‚</p></li><li><p><strong>æ–­å¼€TCPè¿æ¥ï¼š</strong>æµè§ˆå™¨ä¸æœåŠ¡å™¨ä¸éœ€è¦å‘é€æ•°æ®ï¼ŒTCPå››æ¬¡æŒ¥æ‰‹æ–­å¼€è¿æ¥ã€‚</p></li><li><p><strong>æµè§ˆå™¨æ¸²æŸ“ç•Œé¢ï¼š</strong>æµè§ˆå™¨æ¥æ”¶æœåŠ¡å™¨è¿”å›çš„æ•°æ®åŒ…ï¼Œæ ¹æ®æµè§ˆå™¨çš„æ¸²æŸ“æœºåˆ¶å¯¹æ•°æ®æ¸²æŸ“ã€‚</p></li></ul><h1 id="Cookieä¸Session"><a href="#Cookieä¸Session" class="headerlink" title="Cookieä¸Session"></a>Cookieä¸Session</h1><p>Cookieå°†æ•°æ®ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ï¼ŒSessionå°†æ•°æ®ä¿å­˜åœ¨æœåŠ¡å™¨ã€‚</p><p>Sessionç›¸å¯¹æ¥è¯´å®‰å…¨æ€§æ›´é«˜ã€‚Cookieå¸¸ç”¨äºæˆ‘ä»¬ç½‘ç«™ä¿å­˜è´¦å·å¯†ç æˆ–ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼ŒSessionå¸¸ç”¨äºè´­ç‰©è½¦ï¼Œåœ¨ä¸åŒé¡µé¢é—´è·Ÿè¸ªä¿¡æ¯ã€‚</p><h1 id="HTTPSï¼ˆåº”ç”¨å±‚ï¼‰"><a href="#HTTPSï¼ˆåº”ç”¨å±‚ï¼‰" class="headerlink" title="HTTPSï¼ˆåº”ç”¨å±‚ï¼‰"></a>HTTPSï¼ˆåº”ç”¨å±‚ï¼‰</h1><h2 id="HTTP1-0ä¸HTTP1-1åŒºåˆ«"><a href="#HTTP1-0ä¸HTTP1-1åŒºåˆ«" class="headerlink" title="HTTP1.0ä¸HTTP1.1åŒºåˆ«"></a>HTTP1.0ä¸HTTP1.1åŒºåˆ«</h2><p><strong>é•¿è¿æ¥ä¸çŸ­è¿æ¥</strong>ã€‚<strong>HTTP1.0é»˜è®¤ä½¿ç”¨çŸ­è¿æ¥ï¼ŒHTTP1.1é»˜è®¤ä½¿ç”¨é•¿è¿æ¥</strong>ã€‚çŸ­é“¾æ¥å³æ¯æ¬¡å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¿›è¡ŒHTTPæ“ä½œéƒ½è¦å»ºç«‹è¿æ¥ï¼Œä»»åŠ¡ç»“æŸå°±å…³é—­ï¼Œå¼€é”€å¤§ã€‚é•¿è¿æ¥åˆ™æ˜¯åœ¨å“åº”å¤´ä¸­åŠ å…¥Connection:keep-aliveçš„æ ‡è¯†ï¼Œåœ¨è§„å®šæ—¶é—´å†…å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„è¿æ¥éƒ½ä¸ä¼šå…³é—­ã€‚</p><p><strong>ç¼“å­˜å¤„ç†</strong>ã€‚HTTP1.0ä¸»è¦ä½¿ç”¨headeré‡Œçš„ If-Modified-Sinceï¼ŒExpires æ¥åšç¼“å­˜åˆ¤æ–­çš„æ ‡å‡†ï¼Œ<strong>HTTP1.1å¼•å…¥æ›´å¤šçš„ç¼“å­˜æ§åˆ¶ç­–ç•¥</strong>å¦‚ Entity tagï¼ŒIf-Unmodified-Sinceï¼ŒIf-Matchï¼ŒIf-None-Match ç­‰æ›´å¤šå¯é€‰æ‹©çš„ç¼“å­˜å¤´æ¥æ§åˆ¶ç¼“å­˜ç­–ç•¥ã€‚</p><p><strong>å¸¦å®½ä¼˜åŒ–åŠç½‘ç»œè¿æ¥ä½¿ç”¨</strong>ã€‚<strong>HTTP1.0å­˜åœ¨å¸¦å®½æµªè´¹ç°è±¡</strong>ï¼Œå¦‚å®¢æˆ·ç«¯åªéœ€è¦æŸå¯¹è±¡çš„éƒ¨åˆ†å†…å®¹ï¼Œä½†æœåŠ¡å™¨å´é€æ¥äº†æ•´ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”ä¸æ”¯æŒç«¯ç‚¹ç»­ä¼ åŠŸèƒ½ã€‚<strong>HTTP1.1åœ¨è¯·æ±‚å¤´åŠ å…¥äº†rangeå¤´åŸŸï¼Œå®ƒå…è®¸åªè¯·æ±‚æŸä¸ªèµ„æºçš„éƒ¨åˆ†å†…å®¹</strong>ï¼Œå¯¹åº”è¿”å›ç 206ï¼Œè¿™æ ·å°±æ–¹ä¾¿äº†å¼€å‘è€…è¿›è¡Œé€‰æ‹©ï¼Œå¹¶å……åˆ†åˆ©ç”¨å¸¦å®½å’Œè¿æ¥ã€‚</p><h2 id="HTTPä¸HTTPSçš„åŒºåˆ«"><a href="#HTTPä¸HTTPSçš„åŒºåˆ«" class="headerlink" title="HTTPä¸HTTPSçš„åŒºåˆ«"></a>HTTPä¸HTTPSçš„åŒºåˆ«</h2><ul><li><p><strong>ç«¯å£ï¼š</strong>HTTPçš„URLç”± â€œhttp://â€œ èµ·å§‹ï¼Œå…¶é»˜è®¤ç«¯å£æ˜¯80ï¼ŒHTTPSçš„URLç”± â€œhttps://â€œ èµ·å§‹ï¼Œå…¶é»˜è®¤ç«¯å£æ˜¯443ã€‚</p></li><li><p><strong>å®‰å…¨æ€§ä¸èµ„æºæ¶ˆè€—ï¼š</strong>HTTPåè®®è¿è¡Œåœ¨TCPä¸Šï¼Œ<strong>æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ— æ³•éªŒè¯å¯¹æ–¹èº«ä»½</strong>ã€‚HTTPSæ˜¯è¿è¡Œåœ¨<strong>SSL/TLSä¸Šçš„HTTPåè®®</strong>ï¼ŒSSL/TLSè¿è¡Œåœ¨TCPä¸Šï¼Œæ‰€æœ‰<strong>ä¼ è¾“å†…å®¹æ˜¯åŠ å¯†è¿‡çš„ï¼Œé‡‡ç”¨çš„æ˜¯å¯¹ç§°åŠ å¯†</strong>ï¼Œä½†å¯¹ç§°åŠ å¯†çš„å¯†é’¥å¯¹æœåŠ¡å™¨æ–¹çš„è¯ä¹¦ä»Šæ¬¡è¡Œäº†éå¯¹ç§°åŠ å¯†ã€‚</p><p>æ€»ç»“å°±æ˜¯HTTPçš„å®‰å…¨æ€§æ²¡æœ‰HTTPSé«˜ï¼Œä½†HTTPSä¼šæ¯”HTTPæ¶ˆè€—æ›´å¤šçš„æœåŠ¡å™¨èµ„æºã€‚</p></li></ul><h2 id="å¯¹ç§°åŠ å¯†"><a href="#å¯¹ç§°åŠ å¯†" class="headerlink" title="å¯¹ç§°åŠ å¯†"></a>å¯¹ç§°åŠ å¯†</h2><p>é‡‡ç”¨å•é’¥è¿›è¡ŒåŠ å¯†çš„æ–¹æ³•ï¼ŒåŒä¸€ä¸ªå¯†é’¥å¯ä»¥è¿›è¡ŒåŠ å¯†ä¸è§£å¯†ã€‚</p><p>ä¼˜ç‚¹ï¼šç®—æ³•å…¬å¼€ï¼ŒåŠ å¯†é€Ÿåº¦å¿«ã€æ•ˆç‡é«˜ï¼Œé€‚åˆé•¿æ•°æ®ä½¿ç”¨ã€‚</p><p>ç¼ºç‚¹ï¼šå¯†é’¥ä¼ è¾“ä¸å®‰å…¨ï¼Œæ˜“ç ´è§£ï¼Œä¸”å¯†é’¥ç®¡ç†éº»çƒ¦ã€‚</p><h2 id="éå¯¹ç§°åŠ å¯†"><a href="#éå¯¹ç§°åŠ å¯†" class="headerlink" title="éå¯¹ç§°åŠ å¯†"></a>éå¯¹ç§°åŠ å¯†</h2><p>åŠ å¯†ä¸è§£å¯†æ—¶åˆ†åˆ«ä½¿ç”¨ä¸¤ä¸ªå¯†é’¥ï¼Œå³åŠ å¯†ä½¿ç”¨å…¬é’¥ï¼Œè§£å¯†ä½¿ç”¨ç§é’¥ã€‚</p><p>ä¼˜ç‚¹ï¼šå¯†é’¥åˆ†é…ç®€å•ï¼Œå¯†é’¥ä¿å­˜é‡å°‘ï¼Œå®‰å…¨ï¼Œå³ä½¿ä¼ è¾“å¯†æ–‡è¢«æ‹¦æˆªï¼Œè‹¥åªè·å–å…¬é’¥ï¼Œæ²¡æœ‰ç§é’¥æ—¶æ— æ³•ç ´è§£å¯†æ–‡çš„ã€‚</p><p>ç¼ºç‚¹ï¼šç®—æ³•å¤æ‚ï¼ŒåŠ å¯†æ•ˆç‡ä½ï¼Œé€Ÿåº¦æ…¢ã€‚</p><p>éå¯¹ç§°åŠ å¯†å¯ä»¥ä¿è¯æ•°æ®ä¼ è¾“è¿‡ç¨‹çš„å®‰å…¨ï¼Œå› ä¸ºæ‹¦æˆªåªèƒ½è·å–éƒ¨åˆ†å¯†é’¥ï¼Œæ— æ³•è§£å¯†ï¼Œé™¤éè·å–ä¸€æ¥ä¸€å›çš„ä¸¤ä¸ªåŠ å¯†å¯†é’¥ã€‚</p><h2 id="å¸¸ç”¨HTTPè¯·æ±‚æ–¹æ³•"><a href="#å¸¸ç”¨HTTPè¯·æ±‚æ–¹æ³•" class="headerlink" title="å¸¸ç”¨HTTPè¯·æ±‚æ–¹æ³•"></a>å¸¸ç”¨HTTPè¯·æ±‚æ–¹æ³•</h2><ul><li>GETï¼šä»æœåŠ¡å™¨è·å–è¯·æ±‚</li><li>HEADï¼šä»æœåŠ¡å™¨è·å–è¯·æ±‚é¦–éƒ¨ä¿¡æ¯</li><li>POSTï¼šå‘æœåŠ¡å™¨å‘é€éœ€è¦å¤„ç†çš„æ•°æ®</li><li>PUTï¼šå°†è¯·æ±‚çš„ä¸»ä½“å­˜å‚¨åˆ°æœåŠ¡å™¨ä¸Š</li><li>DELETEï¼šä»æœåŠ¡å™¨ä¸Šåˆ é™¤æ•°æ®</li><li>TRACEï¼šå¯¹å¯èƒ½ç»è¿‡ä»£ç†æœåŠ¡å™¨ä¼ é€åˆ°æœåŠ¡å™¨çš„æŠ¥æ–‡è¿›è¡Œè¿½è¸ª</li><li>OPTIONSï¼šå†³å®šåœ¨æœåŠ¡å™¨ä¸Šå¯æ‰§è¡Œå“ªäº›æ–¹æ³•</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;è®¡ç½‘æ¨¡å‹&quot;&gt;&lt;a href=&quot;#è®¡ç½‘æ¨¡å‹&quot; class=&quot;headerlink&quot; title=&quot;è®¡ç½‘æ¨¡å‹&quot;&gt;&lt;/a&gt;è®¡ç½‘æ¨¡å‹&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;OSIä¸ƒå±‚&lt;/p&gt;
&lt;p&gt;ç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚ã€ä¼šè¯å±‚ã€è¡¨ç¤ºå±‚ã€ç½‘ç»œå±‚&lt;/p&gt;
&lt;/li&gt;
</summary>
      
    
    
    
    <category term="å…«è‚¡" scheme="http://aidianfirst.com/categories/%E5%85%AB%E8%82%A1/"/>
    
    
  </entry>
  
  <entry>
    <title>Javaå…«è‚¡æ–‡--å¹¶å‘</title>
    <link href="http://aidianfirst.com/2021/09/02/%E5%85%AB%E8%82%A1/Java%E5%85%AB%E8%82%A1%E6%96%87-%E5%B9%B6%E5%8F%91/"/>
    <id>http://aidianfirst.com/2021/09/02/%E5%85%AB%E8%82%A1/Java%E5%85%AB%E8%82%A1%E6%96%87-%E5%B9%B6%E5%8F%91/</id>
    <published>2021-09-02T08:28:38.000Z</published>
    <updated>2023-07-30T11:20:17.727Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å¹¶å‘åŸºç¡€"><a href="#å¹¶å‘åŸºç¡€" class="headerlink" title="å¹¶å‘åŸºç¡€"></a>å¹¶å‘åŸºç¡€</h1><h2 id="è¿›ç¨‹ä¸çº¿ç¨‹"><a href="#è¿›ç¨‹ä¸çº¿ç¨‹" class="headerlink" title="è¿›ç¨‹ä¸çº¿ç¨‹"></a>è¿›ç¨‹ä¸çº¿ç¨‹</h2><ul><li><p><strong>è¿›ç¨‹ï¼ˆèµ„æºç®¡ç†æœ€å°å•ä½ï¼‰ï¼š</strong></p><p>ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œè¿è¡Œç¨‹åºçš„åŸºæœ¬å•ä½ï¼Œè¿›ç¨‹æ˜¯åŠ¨æ€çš„ã€‚ç³»ç»Ÿæ‰§è¡Œä¸€ä¸ªç¨‹åºå³è¿›ç¨‹ä»åˆ›å»ºï¼Œè¿è¡Œåˆ°æ­»äº¡çš„è¿‡ç¨‹ã€‚</p><p>åœ¨Javaä¸­ï¼Œå¯åŠ¨mainå‡½æ•°å³å¯åŠ¨äº†ä¸€ä¸ªJVMçš„è¿›ç¨‹ï¼Œmainæ‰€åœ¨çš„çº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ã€‚</p></li><li><p><strong>çº¿ç¨‹ï¼ˆä»»åŠ¡è°ƒåº¦æœ€å°å•ä½ï¼‰ï¼š</strong></p><p>çº¿ç¨‹æ˜¯æ¯”è¿›ç¨‹æ›´å°çš„æ‰§è¡Œå•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥äº§ç”Ÿå¤šä¸ªçº¿ç¨‹ï¼ŒåŒç±»çº¿ç¨‹ä¹‹é—´å…±äº«è¿›ç¨‹çš„<strong>å †å’Œæ–¹æ³•åŒºèµ„æº</strong>ï¼Œä½†æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„<strong>ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆ</strong>ã€‚</p><p>ç³»ç»Ÿåœ¨äº§ç”Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ–åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´åˆ‡æ¢å·¥ä½œæ—¶ï¼Œå…¶è´Ÿæ‹…æ¯”æ“ä½œè¿›ç¨‹å°å¾—å¤šï¼Œå› æ­¤çº¿ç¨‹ä¹Ÿç§°ä¸ºè½»é‡çº§è¿›ç¨‹ã€‚</p></li></ul><h2 id="çº¿ç¨‹çŠ¶æ€"><a href="#çº¿ç¨‹çŠ¶æ€" class="headerlink" title="çº¿ç¨‹çŠ¶æ€"></a>çº¿ç¨‹çŠ¶æ€</h2><ul><li><strong>æ–°å»ºï¼ˆNEWï¼‰</strong>ï¼šçº¿ç¨‹åˆ›å»ºæœªå¯åŠ¨ï¼Œæ­¤æ—¶è¿˜æœªè°ƒç”¨startã€‚</li><li><strong>å¯è¿è¡Œï¼ˆRUNABLEï¼‰</strong>ï¼šçº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€æˆ–ç­‰å¾…èµ„æºè°ƒåº¦è¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚</li><li><strong>é˜»å¡ï¼ˆBLOCKEDï¼‰</strong>ï¼šçº¿ç¨‹ç­‰å¾…è·å–é”ã€‚</li><li><strong>æ— é™æœŸç­‰å¾…ï¼ˆWAITINGï¼‰</strong>ï¼šæ‰§è¡ŒObject.wait()æˆ–Thread.join()è¿›å…¥ï¼Œæ²¡æœ‰ä¸»åŠ¨å”¤é†’åˆ™ä¸€ç›´ç­‰å¾…ã€‚</li><li><strong>é™æœŸç­‰å¾…ï¼ˆTIMED_WAITINGï¼‰</strong>ï¼šè‡ªåŠ¨å”¤é†’ï¼Œå³ç­‰å¾…æ—¶è®¾ç½®äº†æ—¶é—´ï¼Œsleep() æˆ– wait() æˆ– join()è®¾ç½®æ—¶é—´ã€‚</li><li><strong>æ­»äº¡ï¼ˆTERMINATEDï¼‰</strong>ï¼šçº¿ç¨‹ç»“æŸæˆ–å¼‚å¸¸ç»“æŸã€‚</li></ul><h2 id="å¹¶å‘ä¸å¹¶è¡Œ"><a href="#å¹¶å‘ä¸å¹¶è¡Œ" class="headerlink" title="å¹¶å‘ä¸å¹¶è¡Œ"></a>å¹¶å‘ä¸å¹¶è¡Œ</h2><ul><li><strong>å¹¶å‘ï¼š</strong>åŒä¸€æ—¶é—´æ®µï¼Œå¯ä»¥å¤šä¸ªä»»åŠ¡æ‰§è¡Œï¼Œä½†å•ä½æ—¶é—´ä¸ä¸€å®šåŒæ—¶æ‰§è¡Œã€‚</li><li><strong>å¹¶è¡Œï¼š</strong>å•ä½æ—¶é—´å†…ï¼Œå¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œã€‚</li></ul><h2 id="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’ŒçŠ¶æ€"><a href="#çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’ŒçŠ¶æ€" class="headerlink" title="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’ŒçŠ¶æ€"></a>çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’ŒçŠ¶æ€</h2><ul><li><strong>NEWï¼šæ–°å»º</strong>ï¼Œçº¿ç¨‹è¢«æ„å»ºï¼Œä½†è¿˜æ²¡æœ‰è°ƒç”¨start()æ–¹æ³•</li><li><strong>RUNNABLEï¼šå¯è¿è¡Œ</strong>ï¼Œä¸€èˆ¬æ“ä½œç³»ç»Ÿç»†åˆ†ä¸ºREADYï¼ˆå°±ç»ªï¼‰å’ŒRUNNINGï¼ˆè¿è¡Œï¼‰ï¼ŒJavaä¸­3ç»Ÿç§°ä½è¿è¡Œä¸­</li><li><strong>BLOCKEDï¼šé˜»å¡</strong>ï¼Œçº¿ç¨‹å› ä¸ºé”è¢«é˜»å¡</li><li><strong>WAITINGï¼šç­‰å¾…</strong>ï¼Œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œè¿›å…¥è¯¥çŠ¶æ€çš„çº¿ç¨‹éœ€è¦ä¾é å…¶ä»–çº¿ç¨‹çš„é€šçŸ¥æ‰å¯è¿”å›è¿è¡ŒçŠ¶æ€</li><li><strong>TIME_WAITINGï¼šè¶…æ—¶ç­‰å¾…</strong>ï¼Œè¯¥çŠ¶æ€åœ¨ç­‰å¾…åŸºç¡€ä¸Šå¢åŠ äº†è¶…æ—¶é™åˆ¶ï¼Œè¶…æ—¶åçº¿ç¨‹è‡ªè¡Œè¿”å›è¿è¡ŒçŠ¶æ€</li><li><strong>TERMINATEDï¼šç»ˆæ­¢</strong>ï¼Œè¡¨ç¤ºçº¿ç¨‹å·²æ‰§è¡Œå®Œæ¯•</li></ul><h2 id="å®ˆæŠ¤çº¿ç¨‹Daemon"><a href="#å®ˆæŠ¤çº¿ç¨‹Daemon" class="headerlink" title="å®ˆæŠ¤çº¿ç¨‹Daemon"></a>å®ˆæŠ¤çº¿ç¨‹Daemon</h2><p>å®ˆæŠ¤çº¿ç¨‹æ˜¯ç¨‹åºè¿è¡Œæ—¶åœ¨åå°æä¾›æœåŠ¡çš„çº¿ç¨‹ï¼Œä¸å±äºç¨‹åºä¸­ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ã€‚</p><p><strong>å½“æ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹ç»“æŸæ—¶ï¼Œç¨‹åºä¹Ÿå°±ç»ˆæ­¢ï¼ŒåŒæ—¶ä¼šæ€æ­»æ‰€æœ‰å®ˆæŠ¤çº¿ç¨‹ã€‚</strong></p><p>main() å±äºéå®ˆæŠ¤çº¿ç¨‹ã€‚</p><p>åœ¨çº¿ç¨‹å¯åŠ¨ä¹‹å‰ä½¿ç”¨ setDaemon() æ–¹æ³•å¯ä»¥å°†ä¸€ä¸ªçº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚</p><h2 id="ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="ä¸Šä¸‹æ–‡åˆ‡æ¢"></a>ä¸Šä¸‹æ–‡åˆ‡æ¢</h2><p>çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šæœ‰è‡ªå·±çš„<strong>è¿è¡Œæ¡ä»¶å’ŒçŠ¶æ€ï¼ˆä¸Šä¸‹æ–‡ï¼‰</strong>ï¼Œä¸€èˆ¬å‡ºç°ä»¥ä¸‹æƒ…å†µï¼Œçº¿ç¨‹ä¼šä»å ç”¨CPUçŠ¶æ€ä¸­é€€å‡ºï¼š</p><ul><li>ä¸»åŠ¨è®©å‡ºCPUï¼Œä¾‹å¦‚è°ƒç”¨sleep()ã€wait()è¿›å…¥ç¡çœ ã€ç­‰å¾…çŠ¶æ€</li><li>æ—¶é—´ç‰‡ç”¨å®Œï¼Œæ“ä½œç³»ç»Ÿé˜²æ­¢ä¸€ä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹é•¿æ—¶é—´å ç”¨CPUï¼Œä½¿å…¶ä»–è¿›ç¨‹åçº¿ç¨‹æ— ç”¨ã€‚</li><li>è°ƒç”¨é˜»å¡ç±»å‹çš„ç³»ç»Ÿä¸­æ–­ï¼Œä¾‹å¦‚è¯·æ±‚IOï¼Œçº¿ç¨‹è¢«é˜»å¡</li><li>çº¿ç¨‹ç»ˆæ­¢/ç»“æŸè¿è¡Œ</li></ul><p>å‰ä¸‰ç§éƒ½ä¼šå‘ç”Ÿçº¿ç¨‹åˆ‡æ¢ï¼Œ<strong>çº¿ç¨‹åˆ‡æ¢æ—¶è¦ä¿å­˜å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ã€‚å½“ä¸‹æ¬¡çº¿ç¨‹å ç”¨CPUæ—¶æ¢å¤ç°åœºï¼Œå¹¶åŠ è½½ä¸‹ä¸€ä¸ªå°†å ç”¨CPUçš„çº¿ç¨‹ä¸Šä¸‹æ–‡ã€‚è¿™å°±æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ã€‚</p><h2 id="çº¿ç¨‹è°ƒåº¦çš„æ–¹æ³•"><a href="#çº¿ç¨‹è°ƒåº¦çš„æ–¹æ³•" class="headerlink" title="çº¿ç¨‹è°ƒåº¦çš„æ–¹æ³•"></a>çº¿ç¨‹è°ƒåº¦çš„æ–¹æ³•</h2><ul><li>sleep()ï¼šçº¿ç¨‹å®šæ—¶ä¼‘çœ ï¼Œè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä¸ä¼šé‡Šæ”¾é”ã€‚</li><li>wait()ï¼šçº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œé‡Šæ”¾æŒæœ‰çš„å¯¹è±¡çš„é”ã€‚</li><li>join()ï¼šåœ¨Açº¿ç¨‹ä¸­è°ƒç”¨Bçº¿ç¨‹çš„join()ï¼ŒAçº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°Bçº¿ç¨‹ç»“æŸã€‚</li><li>yield()ï¼šçº¿ç¨‹è®©æ­¥ï¼Œå½“å‰çº¿ç¨‹ç”±è¿è¡ŒçŠ¶æ€è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œè®©å‡ºèµ„æºï¼Œæ‰€æœ‰çº¿ç¨‹é‡æ–°äº‰å–èµ„æºã€‚</li></ul><h2 id="sleepä¸waitåŒºåˆ«"><a href="#sleepä¸waitåŒºåˆ«" class="headerlink" title="sleepä¸waitåŒºåˆ«"></a>sleepä¸waitåŒºåˆ«</h2><ul><li>wait()æ˜¯Objectæ–¹æ³•ï¼Œsleep()æ˜¯Threadæ–¹æ³•</li><li>sleepä¸é‡Šæ”¾é”ï¼Œwaité‡Šæ”¾é”</li><li>waitæ²¡æœ‰è®¾ç½®æ—¶é—´ï¼Œåªèƒ½è¢«notify()ã€notifyAll()ä¸»åŠ¨å”¤é†’ã€‚</li></ul><h1 id="æ­»é”"><a href="#æ­»é”" class="headerlink" title="æ­»é”"></a>æ­»é”</h1><h2 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h2><p>å¤šä¸ªçº¿ç¨‹å¾ªç¯é˜»å¡ï¼Œå¾ªç¯ç­‰å¾…å…¶ä»–çº¿ç¨‹é‡Šæ”¾èµ„æºï¼Œè€Œäº§ç”Ÿæ­»é”å¿…é¡»å…·å¤‡å››ä¸ªæ¡ä»¶ï¼š</p><ul><li><strong>äº’æ–¥æ¡ä»¶ï¼š</strong>èµ„æºä»»ä½•æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å ç”¨ï¼Œä¸èƒ½å¤šä¸ªçº¿ç¨‹å…±ç”¨</li><li><strong>è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼š</strong>ä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºé˜»å¡æ—¶ï¼Œå¯¹å·²è·å–èµ„æºä¿æŒä¸æ”¾</li><li><strong>ä¸å¯å‰¥å¤ºæ¡ä»¶ï¼š</strong>è¿›ç¨‹å·²è·å–çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œä¹‹å‰ï¼Œæ˜¯ä¸èƒ½è¢«å…¶ä»–è¿›ç¨‹å¼ºè¡Œå‰¥å¤ºçš„ï¼Œåªå¯ä½¿ç”¨å®Œåè‡ªè¡Œé‡Šæ”¾</li><li><strong>å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼š</strong>è‹¥å¹²è¿›ç¨‹ä¹‹é—´çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»å½¢æˆç¯</li></ul><h2 id="é¢„é˜²ä¸é¿å…çº¿ç¨‹æ­»é”"><a href="#é¢„é˜²ä¸é¿å…çº¿ç¨‹æ­»é”" class="headerlink" title="é¢„é˜²ä¸é¿å…çº¿ç¨‹æ­»é”"></a>é¢„é˜²ä¸é¿å…çº¿ç¨‹æ­»é”</h2><p><strong>åªéœ€ç ´åä»»æ„ä¸€ä¸ªæ­»é”çš„å¿…è¦æ¡ä»¶å³å¯é¢„é˜²æ­»é”ã€‚</strong></p><ul><li><strong>ç ´åäº’æ–¥ï¼š</strong>ç¡¬ä»¶èµ„æºå®ç°åŒæ—¶è®¿é—®å¯ç ´åï¼Œè½¯ä»¶èµ„æºä¸€èˆ¬æ— æ³•æ‰“ç ´</li><li><strong>ç ´åè¯·æ±‚ä¸ä¿æŒï¼š</strong>ä¸€æ¬¡æ€§ç”³è¯·å…¨éƒ¨çš„èµ„æº</li><li><strong>ç ´åä¸å¯å‰¥å¤ºï¼š</strong>å ç”¨éƒ¨åˆ†èµ„æºçš„è¿›ç¨‹è¿›ä¸€æ­¥ç”³è¯·å…¶ä»–èµ„æºæ—¶ï¼Œè‹¥ç”³è¯·ä¸åˆ°ï¼Œå¯ä¸»åŠ¨é‡Šæ”¾è‡ªå·±å ç”¨çš„èµ„æº</li><li><strong>ç ´åå¾ªç¯ç­‰å¾…ï¼š</strong>é€šè¿‡æŒ‰åºç”³è¯·èµ„æºæ¥é¢„é˜²ã€‚æŒ‰è§„å®šé¡ºåºç”³è¯·èµ„æºï¼Œé‡Šæ”¾æ—¶åˆ™ååºæ‰§è¡Œã€‚</li></ul><p><strong>é¿å…æ­»é”ï¼š</strong>ä¸€èˆ¬å¯åœ¨èµ„æºåˆ†é…æ—¶ï¼Œé€šè¿‡ç®—æ³•ï¼ˆé“¶è¡Œå®¶ç®—æ³•ç­‰ï¼‰å¯¹èµ„æºè¿›è¡Œåˆç†åˆ†é…æ¥é¿å…æ­»é”ã€‚</p><h1 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h1><h2 id="å†…å­˜æ¨¡å‹JMM"><a href="#å†…å­˜æ¨¡å‹JMM" class="headerlink" title="å†…å­˜æ¨¡å‹JMM"></a>å†…å­˜æ¨¡å‹JMM</h2><p>Javaå†…å­˜æ¨¡å‹è§„å®šæ‰€æœ‰å˜é‡éƒ½å­˜å‚¨åœ¨<strong>ä¸»å†…å­˜ï¼ˆå…±äº«å˜é‡ï¼‰</strong>ï¼Œæ¯æ¡çº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„<strong>å·¥ä½œå†…å­˜</strong>ï¼Œçº¿ç¨‹åœ¨å·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¢«è¯¥çº¿ç¨‹ä½¿ç”¨çš„å˜é‡çš„<strong>ä¸»å†…å­˜å‰¯æœ¬</strong>ã€‚</p><h2 id="å¹¶å‘ç‰¹æ€§"><a href="#å¹¶å‘ç‰¹æ€§" class="headerlink" title="å¹¶å‘ç‰¹æ€§"></a>å¹¶å‘ç‰¹æ€§</h2><ul><li><p><strong>åŸå­æ€§ï¼ˆsynchronizedã€åŸå­ç±»ï¼‰</strong></p><p>ä¸€æ¬¡æˆ–å¤šæ¬¡æ“ä½œï¼Œè¦ä¹ˆæ‰€æœ‰çš„æ“ä½œå…¨éƒ¨éƒ½å¾—åˆ°æ‰§è¡Œå¹¶ä¸”ä¸ä¼šæ”¶åˆ°ä»»ä½•å› ç´ çš„å¹²æ‰°è€Œä¸­æ–­ï¼Œè¦ä¹ˆæ‰€æœ‰çš„æ“ä½œéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚</p></li><li><p><strong>å¯è§æ€§ï¼ˆvolatileã€synchronizedã€finalï¼‰</strong></p><p>å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡çš„å€¼æ—¶ï¼Œå…¶ä»–çº¿ç¨‹èƒ½ç«‹å³å¾—çŸ¥è¿™ä¸ªä¿®æ”¹ã€‚</p></li><li><p><strong>æœ‰åºæ€§ï¼ˆvolatileã€synchronizedï¼‰</strong></p><p>æœ¬çº¿ç¨‹å†…è§‚å¯Ÿï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æœ‰åºçš„ï¼›å¦‚æœåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è§‚å¯Ÿå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æ— åºçš„ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ä»£ç ç¼–å†™é¡ºåºå’Œå…¶æ‰§è¡Œé¡ºåºå¯èƒ½ä¸åŒã€‚å¯èƒ½ä¼šé€šè¿‡æŒ‡ä»¤é‡æ’è¿›è¡Œä¼˜åŒ–å¯¼è‡´ä¹±åºæ‰§è¡Œã€‚</p></li></ul><h2 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h2><p><strong>synchroizedè§£å†³å¤šçº¿ç¨‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ï¼Œå®ƒå¯ä»¥ä¿è¯è¢«ä¿®é¥°çš„æ–¹æ³•æˆ–ä»£ç å—åœ¨ä»»æ„æ—¶åˆ»éƒ½åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚</strong></p><p>Javaæ—©æœŸç‰ˆæœ¬ï¼Œsynå±äºé‡é‡çº§é”ï¼Œæ•ˆç‡ä½ã€‚JDK6åå¯¹synè¿›è¡Œäº†å¤§é‡ä¼˜åŒ–ã€‚</p><ul><li><p>synä¿®é¥°<strong>ç±»</strong>ï¼Œä½œç”¨å¯¹è±¡æ˜¯è¿™ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡</p></li><li><p>synä¿®é¥°<strong>å®ä¾‹æ–¹æ³•</strong>ï¼Œä½œç”¨äºå½“å‰å¯¹è±¡å®ä¾‹åŠ é”ï¼Œè¿›å…¥åŒæ­¥æ–¹æ³•å‰éœ€è¦<strong>è·å–å½“å‰å¯¹è±¡å®ä¾‹çš„é”</strong>ã€‚</p></li><li><p>synä¿®é¥°<strong>é™æ€æ–¹æ³•</strong>ï¼Œç»™å½“å‰ç±»åŠ é”ï¼Œä½œç”¨äºå½“å‰ç±»çš„ç§æ‰€æœ‰å¯¹è±¡å®ä¾‹ï¼Œè¿›å…¥åŒæ­¥æ–¹æ³•å‰éœ€è¦<strong>è·å–å½“å‰classçš„é”</strong>ã€‚</p></li><li><p>synä¿®é¥°<strong>ä»£ç å—</strong>ï¼ŒæŒ‡å®šåŠ é”çš„å¯¹è±¡ï¼Œå¯¹æŒ‡å®šçš„ å¯¹è±¡/ç±» åŠ é”ï¼Œè¿›å…¥åŒæ­¥æ–¹æ³•å‰<strong>è·å–å¯¹åº”æŒ‡å®šå¯¹è±¡/classçš„é”</strong>ã€‚</p></li></ul><p>æ„é€ æ–¹æ³•ä¸èƒ½è¢«synä¿®é¥°ï¼Œæ„é€ æ–¹æ³•æœ¬èº«å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><h2 id="é”å‡çº§æµç¨‹"><a href="#é”å‡çº§æµç¨‹" class="headerlink" title="é”å‡çº§æµç¨‹"></a>é”å‡çº§æµç¨‹</h2><p>é”ä¸»è¦å­˜åœ¨<strong>æ— é”çŠ¶æ€ã€åå‘é”çŠ¶æ€ã€è½»é‡çº§é”çŠ¶æ€ã€é‡é‡çº§é”çŠ¶æ€</strong>è¿™å››ä¸ªçŠ¶æ€ã€‚å®ƒä»¬éšç€ç«äº‰é€æ¸å‡çº§ã€‚é”å¯ä»¥å‡çº§ä½†ä¸å¯ä»¥é™çº§ï¼Œè¿™ç§ç­–ç•¥æ˜¯ä¸ºäº†æé«˜è·å¾—é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡ã€‚</p><p>é”å‡çº§å…¶å®å°±æ˜¯ä¼˜åŒ–ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰é”æ¶ˆé™¤å’Œé”ç²—åŒ–ã€‚</p><ul><li><p><strong>åå‘é”ï¼ˆç¬¬ä¸€ä¸ªè·å–é”çš„çº¿ç¨‹ï¼‰</strong></p><p>æ— ç«äº‰æƒ…å†µä¸‹æŠŠæ•´ä¸ªåŒæ­¥æ¶ˆé™¤æ‰ï¼ŒCASæ“ä½œéƒ½ä¸æ‰§è¡Œã€‚ä¸€æ—¦å‡ºç°å¦å¤–çš„ä¸€ä¸ªçº¿ç¨‹å»å°è¯•è·å–è¿™ä¸ªé”çš„æƒ…å†µï¼Œåå‘é”é©¬ä¸Šå¤±æ•ˆã€‚</p><p>åå‘é”æ˜¯åªé’ˆå¯¹ä¸€ä¸ªçº¿ç¨‹çš„ï¼Œçº¿ç¨‹è·å–é”åä¸ä¼šæœ‰è§£é”çš„æ“ä½œï¼Œå› ä¸ºæ˜¯å•ä¸€çº¿ç¨‹ã€‚è¿™æ ·å¯ä»¥å‡å°‘å¼€é”€ï¼Œä½†å¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹æ¥ç«äº‰é”ï¼Œåå‘é”å°±ä¼šå¤±æ•ˆï¼Œå¹¶å‡çº§ä¸ºè½»é‡çº§é”ã€‚</p></li><li><p><strong>è½»é‡çº§é”ï¼ˆCASï¼‰</strong></p><p>æ— ç«äº‰æƒ…å†µä¸‹ä½¿ç”¨CASæ“ä½œå»æ¶ˆé™¤åŒæ­¥ä½¿ç”¨çš„äº’æ–¥é‡ã€‚</p><p>è½»é‡çº§é”ä½¿ç”¨CASè¿›è¡Œæ“ä½œï¼Œå®ç°é”çš„è·å–ã€‚å½“é”ç«äº‰ååˆ†ä¸¥é‡çš„æƒ…å†µä¸‹ï¼Œå°†è½»é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é”ã€‚</p></li><li><p><strong>è‡ªæ—‹é”</strong></p><p>ç”±äºè½»é‡çº§é”æ˜¯CASå®ç°ï¼ŒCASä¹Ÿå°±æ¶‰åŠåˆ°äº†è‡ªæ—‹é”ï¼Œè‡ªæ—‹å°±æ˜¯å¾ªç¯ç­‰å¾…é”é‡Šæ”¾ã€‚</p><p>è½»é‡çº§é”ç«äº‰å¤±è´¥æ—¶ï¼Œä¼šè¿›è¡Œè‡ªæ—‹ï¼Œè‡ªæ—‹æˆåŠŸè·å–é”ï¼Œä¾æ—§æ˜¯è½»é‡çº§é”ï¼Œè‡ªæ—‹è·å–å¤±è´¥ï¼Œåˆ™è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚</p></li><li><p><strong>é‡é‡çº§é”ï¼ˆäº’æ–¥é‡ mutexï¼‰</strong></p><p>é‡é‡çº§é”æ˜¯ç›´æ¥è®©çº¿ç¨‹è¿›å…¥å µå¡çŠ¶æ€ï¼Œå½“æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”åï¼Œå”¤é†’å µå¡çš„çº¿ç¨‹ï¼Œç„¶åçº¿ç¨‹å†æ¬¡ç«äº‰é”ã€‚</p></li></ul><h2 id="volatileä¸synchronizedåŒºåˆ«"><a href="#volatileä¸synchronizedåŒºåˆ«" class="headerlink" title="volatileä¸synchronizedåŒºåˆ«"></a>volatileä¸synchronizedåŒºåˆ«</h2><ul><li>volatileæ•ˆç‡æ¯”synchronizedæ•ˆç‡é«˜ï¼Œvolatileåªèƒ½ä¿®é¥°å˜é‡ï¼Œsynchronizedå¯ä¿®é¥°æ–¹æ³•å’Œä»£ç å—ã€‚</li><li>volatileä¿è¯æœ‰åºæ€§ã€å¯è§æ€§ï¼Œä½†ä¸ä¿è¯åŸå­æ€§ã€‚synchronizedæœ‰åºæ€§ã€å¯è§æ€§ã€åŸå­æ€§éƒ½å¯ä»¥ä¿è¯ã€‚</li><li>volatileç”¨äºè§£å†³å˜é‡åœ¨å¤šçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œsynchronizedå¯è§£å†³å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ã€‚</li><li>volatileé˜²æ­¢æŒ‡ä»¤é‡æ’ã€‚</li></ul><h2 id="ReentrantLockå¯é‡å…¥é”"><a href="#ReentrantLockå¯é‡å…¥é”" class="headerlink" title="ReentrantLockå¯é‡å…¥é”"></a>ReentrantLockå¯é‡å…¥é”</h2><p>æ‰‹åŠ¨è°ƒç”¨lock()ã€unlock()æ–¹æ³•ï¼Œæ¥è·å–é‡Šæ”¾é”ï¼Œä¸€èˆ¬é…åˆtry-finallyï¼Œæ“ä½œå†…å®¹å†™åœ¨tryä¸­ï¼Œåœ¨finallyä¸­ä¿è¯å¯ä»¥é‡Šæ”¾é”ã€‚åŸºäºAQSã€‚</p><h2 id="synå’ŒReenå¯¹æ¯”"><a href="#synå’ŒReenå¯¹æ¯”" class="headerlink" title="synå’ŒReenå¯¹æ¯”"></a>synå’ŒReenå¯¹æ¯”</h2><ul><li>synæ˜¯å…³é”®å­—ï¼Œå±äºJVMå±‚é¢ã€‚Reenæ˜¯å±äºJDKå±‚é¢ï¼Œå®ç°äº†Lockæ¥å£ã€‚</li><li>synæ— éœ€æ‰‹åŠ¨é‡Šæ”¾é”ã€‚Reenéœ€è¦è°ƒç”¨unlock()æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œä¸€èˆ¬é…åˆtry-finallyä¿è¯é”è¢«é‡Šæ”¾ã€‚</li><li>synå‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾é”ï¼Œä¸ä¼šå¯¼è‡´æ­»é”ã€‚Reenå¦‚æœæ²¡æœ‰ä¸»åŠ¨é…ç½®try-finallyå»é‡Šæ”¾é”ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ­»é”ã€‚</li><li>synä¸å¯ä¸­æ–­ï¼Œé™¤éæŠ›å‡ºå¼‚å¸¸æˆ–æ‰§è¡Œå®Œæ¯•ã€‚Reenå¯ä¸­æ–­ï¼Œä½¿ç”¨try Lock()ã€‚</li><li>synæ˜¯éå…¬å¹³é”ï¼ŒReené»˜è®¤æ˜¯éå…¬å¹³é”ï¼Œä½†å¯ä»¥è®¾ç½®æˆå…¬å¹³é”ã€‚Reenæ„é€ æ–¹æ³•ä¼ å…¥booleanå‚æ•°å¯æŒ‡å®šæ˜¯å¦åˆ›å»ºå…¬å¹³é”ã€‚</li><li>synåªèƒ½å”¤é†’ä¸€ä¸ªçº¿ç¨‹æˆ–å…¨éƒ¨å”¤é†’ã€‚Reenå¯ä»¥åˆ†ç»„å”¤é†’æˆ–ç²¾ç¡®å”¤é†’ï¼ŒReenå¯ä»¥ç»‘å®šå¤šä¸ªConditionå¯¹è±¡ã€‚</li><li>éƒ½æ˜¯å¯é‡å…¥é”ï¼Œè‡ªå·±å¯ä»¥é‡å¤è·å–è‡ªå·±çš„å†…éƒ¨é”ï¼Œå¯é¿å…æ­»é”å‘ç”Ÿã€‚</li></ul><h2 id="ReentrantReadWriteLockï¼ˆé”é™çº§ï¼‰"><a href="#ReentrantReadWriteLockï¼ˆé”é™çº§ï¼‰" class="headerlink" title="ReentrantReadWriteLockï¼ˆé”é™çº§ï¼‰"></a>ReentrantReadWriteLockï¼ˆé”é™çº§ï¼‰</h2><p>åŸºäºAQSå®ç°ã€‚è¯»å†™é”ç»´æŠ¤ä¸€å¯¹é”ï¼Œä¸€ä¸ª<strong>è¯»é”ï¼ˆå…±äº«é”ï¼‰</strong>å’Œä¸€ä¸ª<strong>å†™é”ï¼ˆç‹¬å é”ï¼‰</strong>ã€‚å®ç°äº†ReadWriteLockæ¥å£ã€‚</p><ul><li>å…è®¸å¤šä¸ªè¯»çº¿ç¨‹åŒæ—¶è®¿é—®</li><li>åœ¨å†™çº¿ç¨‹è®¿é—®æ—¶ï¼Œæ‰€æœ‰è¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡</li><li>å’ŒReentrantLockä¸€æ ·ï¼Œæ”¯æŒéå…¬å¹³é”å’Œå…¬å¹³é”ã€‚</li></ul><p><strong>é”é™çº§</strong></p><p><strong>é”é™çº§æ˜¯ä¸€ä¸ªä¸ºäº†ä¿è¯æ•°æ®å¯è§æ€§çš„æ“ä½œ</strong>ã€‚å¦‚æœçº¿ç¨‹è¿ç»­ä¸¤æ¬¡å¯¹åŒä¸€ä¸ªå˜é‡è¿›è¡Œå†™æ“ä½œï¼Œç„¶åæ‰§è¡Œå…¶ä»–é€»è¾‘æœ€åè¾“å‡ºå˜é‡ã€‚ä¼šå‘ç°ä¸¤æ¬¡å˜é‡è¾“å‡ºéƒ½æ˜¯ç¬¬äºŒæ¬¡ä¿®æ”¹çš„å˜é‡å€¼ï¼Œç¬¬ä¸€æ¬¡ä¿®æ”¹è¢«è¦†ç›–äº†ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨é”é™çº§ï¼Œåœ¨å†™é”ä¸­åŠ å…¥è¯»é”ç„¶åé‡Šæ”¾å†™é”ï¼Œå½“ç¬¬äºŒä¸ªçº¿ç¨‹è¿›æ¥æ—¶ç”±äºç¬¬ä¸€ä¸ªçº¿ç¨‹çš„è¯»é”æœªé‡Šæ”¾ä¼šç­‰å¾…ï¼Œç›´åˆ°ç¬¬ä¸€æ¬¡ä¿®æ”¹çš„é€»è¾‘å…¨éƒ¨æ‰§è¡Œå®Œåé‡Šæ”¾è¯»é”ã€‚æ­¤æ—¶å˜é‡å€¼å±•ç¤ºæ˜¯ç¬¬ä¸€æ¬¡ä¿®æ”¹ï¼Œç„¶åç¬¬äºŒæ¬¡ä¿®æ”¹æ‰ä¼šè¿›è¡Œï¼Œæœ€åå±•ç¤ºç¬¬äºŒæ¬¡ä¿®æ”¹çš„å˜é‡å€¼ã€‚</p><p>é”é™çº§ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œé˜²æ­¢å…¶ä»–çº¿ç¨‹ç¯¡æ”¹æ•°æ®ã€‚</p><h2 id="ä¹è§‚é”"><a href="#ä¹è§‚é”" class="headerlink" title="ä¹è§‚é”"></a>ä¹è§‚é”</h2><h3 id="CASï¼ˆCompare-And-Swapï¼‰"><a href="#CASï¼ˆCompare-And-Swapï¼‰" class="headerlink" title="CASï¼ˆCompare And Swapï¼‰"></a>CASï¼ˆCompare And Swapï¼‰</h3><ul><li>éœ€è¦è¯»å†™çš„å†…å­˜ä½ç½® V</li><li>å˜é‡è¿›è¡Œæ¯”è¾ƒçš„æ—§å€¼ A</li><li>å˜é‡æ‹Ÿå†™å…¥çš„æ–°å€¼ B</li></ul><p>å½“å†…å­˜ä½ç½®Vçš„å€¼ç­‰äºæ—§å€¼Aï¼Œè¯´æ˜æœªä¿®æ”¹è¿‡ï¼Œä½ç½®Vçš„å€¼æ›´æ–°ä¸ºBï¼Œå¦åˆ™ä¸è¿›è¡Œæ“ä½œã€‚CASä¸€èˆ¬æ˜¯è‡ªæ—‹çš„ï¼Œä¸æ–­çš„é‡è¯•ã€‚CASç”±CPUæ”¯æŒçš„åŸå­æ“ä½œï¼ŒåŸå­æ€§åœ¨ç¡¬ä»¶å±‚é¢å¾—åˆ°ä¿è¯ã€‚</p><p>è‹¥æ˜¯ç«äº‰å¤§çš„åœºæ™¯ï¼Œä¸å»ºè®®ä½¿ç”¨CASï¼Œä¼šå¯¼è‡´é¢‘ç¹è‡ªæ—‹ã€‚</p><h3 id="ç‰ˆæœ¬å·æ§åˆ¶"><a href="#ç‰ˆæœ¬å·æ§åˆ¶" class="headerlink" title="ç‰ˆæœ¬å·æ§åˆ¶"></a>ç‰ˆæœ¬å·æ§åˆ¶</h3><p>å…¨å±€å®šä¹‰ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯æ¬¡æ›´æ–°å‰å…ˆè¯»å–æ•°æ®ï¼Œå¹¶æŸ¥çœ‹ç‰ˆæœ¬å·ï¼Œè¿›è¡Œå†™å…¥æ“ä½œæ—¶ä¼šå†æ¬¡æŸ¥çœ‹ç‰ˆæœ¬å·ï¼Œä¸¤æ¬¡ç‰ˆæœ¬å·ä¸€è‡´ï¼Œåˆ™è¯´æ˜æ“ä½œæ‰§è¡Œè¿‡ç¨‹ä¸­æ²¡æœ‰å…¶ä»–çº¿ç¨‹å¹²æ‰°ï¼Œå®Œæˆæ›´æ–°æ“ä½œï¼Œå¹¶ä½¿ç‰ˆæœ¬å·+1ã€‚ä¸ä¸€è‡´åˆ™æ“ä½œå¤±è´¥ã€‚</p><p>ç‰ˆæœ¬å·ä¸€èˆ¬åŠ åœ¨æ•°æ®åº“è¡¨ä¸­ï¼Œè®©è¯»å†™æ“ä½œæ— å¹²æ‰°ã€‚</p><h3 id="ABAé—®é¢˜"><a href="#ABAé—®é¢˜" class="headerlink" title="ABAé—®é¢˜"></a>ABAé—®é¢˜</h3><p>å†…å­˜ä½ç½®Vçš„å€¼ï¼Œå‰åä¸¤æ¬¡è¯»å–å€¼éƒ½æ˜¯Aï¼Œä¸èƒ½å®ƒæ²¡æœ‰è¢«ä¿®æ”¹è¿‡ï¼Œå› ä¸ºå¯ä»¥è¿›è¡ŒäºŒæ¬¡ä¿®æ”¹å³ABAï¼Œæœ€åè¯»å–çš„è¿˜æ˜¯Aå€¼ã€‚</p><p>è§£å†³ï¼š</p><ul><li>ç‰ˆæœ¬å·</li><li>ä½¿ç”¨booleanå˜é‡ï¼Œè¡¨ç¤ºæ˜¯å¦ä¿®æ”¹è¿‡</li><li>åŸå­ç±»</li></ul><h1 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h1><p>ThreadLoacalè®©æ¯ä¸€ä¸ªçº¿ç¨‹ç»‘å®šè‡ªå·±çš„å€¼ï¼Œåœ¨é‡Œé¢å­˜å‚¨æ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰æ•°æ®ã€‚</p><p>æ¯ä¸€ä¸ªè®¿é—®ThreadLocalå˜é‡çš„çº¿ç¨‹éƒ½ä¼šæœ‰è¿™ä¸ªå˜é‡çš„æœ¬åœ°å‰¯æœ¬ï¼Œé€šè¿‡getã€setæ–¹æ³•å¯¹å˜é‡è¿›è¡Œæ“ä½œï¼Œä»è€Œé¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p>åœ¨æˆ‘çš„å•†åŸé¡¹ç›®ä¸­ï¼Œé€šè¿‡ThreadLocalè§£å†³äº†Serviceå±‚è·å–sessionå†…ä¿¡æ¯çš„é—®é¢˜ã€‚é¦–å…ˆMVCæ‹¦æˆªå™¨ä¼šæ£€æŸ¥è¯·æ±‚çš„sessionæ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨è¯·æ±‚é€šè¿‡å¹¶å°†ä¿¡æ¯setåˆ°ThreadLocalä¸­ï¼Œç„¶åæˆ‘ä»¬åœ¨Serviceå±‚å¤„ç†ä¸šåŠ¡é€»è¾‘æ—¶å°±å¯ä»¥é€šè¿‡getå¾—åˆ°ç›¸åº”çš„ä¿¡æ¯ã€‚</p><p>ThreadLocalç›¸å½“äºç»´æŠ¤äº†ä¸€ä¸ªMapï¼ŒKVå­˜å‚¨ã€‚Kæ˜¯å¼±å¼•ç”¨ï¼ŒVæ˜¯å¼ºå¼•ç”¨ï¼Œå¯èƒ½äº§ç”ŸK = nullçš„æƒ…å†µï¼Œåœ¨ThreadLocalè°ƒç”¨å®Œåæœ€å¥½æ‰§è¡Œ remove() é˜²æ­¢å†…å­˜æ³„éœ²ã€‚</p><p>ä½¿ç”¨getã€setä¸ä¼šå¯¼è‡´Vå†…å­˜æ³„éœ²ï¼Œåªæœ‰çº¿ç¨‹é•¿æ—¶é—´ä¸è¢«ä½¿ç”¨æ‰ä¼šå¯¼è‡´GCå°†Kæ¸…ç†ã€‚</p><h1 id="ä½¿ç”¨çº¿ç¨‹"><a href="#ä½¿ç”¨çº¿ç¨‹" class="headerlink" title="ä½¿ç”¨çº¿ç¨‹"></a>ä½¿ç”¨çº¿ç¨‹</h1><h2 id="Runnableæ¥å£ï¼ˆæ¨èï¼‰"><a href="#Runnableæ¥å£ï¼ˆæ¨èï¼‰" class="headerlink" title="Runnableæ¥å£ï¼ˆæ¨èï¼‰"></a>Runnableæ¥å£ï¼ˆæ¨èï¼‰</h2><p>å®ç°Runnableæ¥å£ï¼Œé‡å†™runæ–¹æ³•ï¼Œåœ¨æ‰§è¡Œç±»ä¸­å£°æ˜ä¸€ä¸ªThreadå¯¹è±¡ï¼Œå¹¶ä¼ å…¥è‡ªå®šä¹‰çš„Runnableå¯¹è±¡ï¼Œç„¶åThreadå¯¹è±¡æ‰§è¡Œstartæ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Thread thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> MyRunnable());</span><br><span class="line">    thread.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Callableæ¥å£ï¼ˆæœ‰è¿”å›å€¼ï¼Œä½¿ç”¨FutureTaskå°è£…ï¼‰"><a href="#Callableæ¥å£ï¼ˆæœ‰è¿”å›å€¼ï¼Œä½¿ç”¨FutureTaskå°è£…ï¼‰" class="headerlink" title="Callableæ¥å£ï¼ˆæœ‰è¿”å›å€¼ï¼Œä½¿ç”¨FutureTaskå°è£…ï¼‰"></a>Callableæ¥å£ï¼ˆæœ‰è¿”å›å€¼ï¼Œä½¿ç”¨FutureTaskå°è£…ï¼‰</h2><p>å®ç°Callableæ¥å£ï¼Œé‡å†™callæ–¹æ³•ï¼Œå’ŒRunnableä¸åŒï¼Œ<strong>å¯ä»¥æœ‰è¿”å›å€¼</strong>ï¼Œæ‰§è¡Œçº¿ç¨‹éœ€è¦å…ˆ<strong>é€šè¿‡FutureTaskå°è£…</strong>ï¼Œç„¶åå£°æ˜Threadå¯¹è±¡ä¼ å…¥FutureTaskå¯¹è±¡ï¼Œæ‰§è¡Œstartæ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚</p><p>æ³¨æ„Threadå¯¹è±¡å‚æ•°æ˜¯Runnableå‹ï¼Œè€ŒFutureTaskæ˜¯ç»§æ‰¿Runnableçš„ï¼Œæ‰€ä»¥é€šè¿‡Callableå®ç°çº¿ç¨‹ï¼Œéœ€è¦FutureTaskå°è£…ã€‚</p><p>FutureTaskçš„getæ–¹æ³•å¯ä»¥å–å‡ºCallableçš„å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCallable</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">250</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">    MyCallable mc = <span class="keyword">new</span> MyCallable();</span><br><span class="line">    FutureTask&lt;Integer&gt; ft = <span class="keyword">new</span> FutureTask&lt;&gt;(mc);</span><br><span class="line">    Thread thread = <span class="keyword">new</span> Thread(ft);</span><br><span class="line">    thread.start();</span><br><span class="line">    System.out.println(ft.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Threadç±»ï¼ˆå®ç°Runnableæ¥å£ï¼‰"><a href="#Threadç±»ï¼ˆå®ç°Runnableæ¥å£ï¼‰" class="headerlink" title="Threadç±»ï¼ˆå®ç°Runnableæ¥å£ï¼‰"></a>Threadç±»ï¼ˆå®ç°Runnableæ¥å£ï¼‰</h2><p>Threadç±»å®ç°äº†Runnableæ¥å£ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯é€šè¿‡é‡å†™runæ–¹æ³•ã€‚ç„¶åç›´æ¥å£°æ˜è‡ªå®šä¹‰çš„Threadå¯¹è±¡ï¼Œæ‰§è¡Œå®ƒçš„startæ–¹æ³•å°±å¯ä»¥å¯åŠ¨çº¿ç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    MyThread mt = <span class="keyword">new</span> MyThread();</span><br><span class="line">    mt.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®ç°ä¸ç»§æ‰¿åŒºåˆ«"><a href="#å®ç°ä¸ç»§æ‰¿åŒºåˆ«" class="headerlink" title="å®ç°ä¸ç»§æ‰¿åŒºåˆ«"></a>å®ç°ä¸ç»§æ‰¿åŒºåˆ«</h2><p>Javaç‰¹æ€§å¤šå®ç°ï¼Œå•ç»§æ‰¿ï¼Œè‚¯å®šæ˜¯å®ç°æ¥å£æ›´å¥½ï¼Œä¸”ç»§æ‰¿æ•´ä¸ªThreadç±»å¼€é”€è¿‡å¤§ã€‚</p><h2 id="runå’ŒstartåŒºåˆ«"><a href="#runå’ŒstartåŒºåˆ«" class="headerlink" title="runå’ŒstartåŒºåˆ«"></a>runå’ŒstartåŒºåˆ«</h2><p>runæ˜¯çº¿ç¨‹é»˜è®¤æ‰§è¡Œçš„æ–¹æ³•ï¼Œstartæ˜¯å¯åŠ¨çº¿ç¨‹ï¼Œçº¿ç¨‹è¿›è¡Œå¼‚æ­¥æ‰§è¡Œï¼Œå¦‚æœæ²¡æœ‰startï¼Œç›´æ¥æ‰§è¡Œrunå°±æ˜¯åœ¨å½“å‰çº¿ç¨‹è°ƒç”¨äº†ä¸€ä¸ªæ™®é€šæ–¹æ³•è€Œå·²ã€‚</p><h1 id="çº¿ç¨‹æ± ï¼ˆThreadPoolExecutorï¼‰"><a href="#çº¿ç¨‹æ± ï¼ˆThreadPoolExecutorï¼‰" class="headerlink" title="çº¿ç¨‹æ± ï¼ˆThreadPoolExecutorï¼‰"></a>çº¿ç¨‹æ± ï¼ˆThreadPoolExecutorï¼‰</h1><h2 id="å‚æ•°åˆ†æ"><a href="#å‚æ•°åˆ†æ" class="headerlink" title="å‚æ•°åˆ†æ"></a>å‚æ•°åˆ†æ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ThreadPoolExecutor(</span><br><span class="line">    <span class="keyword">int</span> corePoolSize,</span><br><span class="line">    <span class="keyword">int</span> maximumPoolSize,</span><br><span class="line">    <span class="keyword">long</span> keepAliveTime,</span><br><span class="line">    TimeUnit unit,</span><br><span class="line">    BlockingQueue&lt;Runnable&gt; workQueue,</span><br><span class="line">    ThreadFactory threadFactory,</span><br><span class="line">    RejectedExecutionHandler handler)</span><br></pre></td></tr></table></figure><ul><li><p><strong>corePoolSize</strong></p><p>æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œçº¿ç¨‹æ± ç»´æŠ¤çš„ä¸€ä¸ªæœ€å°çº¿ç¨‹æ•°é‡ï¼Œåªè¦çº¿ç¨‹æ± ä¸é”€æ¯å°±ä¸€ç›´å­˜åœ¨ï¼Œé™¤éè®¾ç½®allowCoreThreadTimeOut</p></li><li><p><strong>maximumPoolSize</strong></p><p>æœ€å¤§çº¿ç¨‹æ•°ï¼Œä¸ä¼šæ— é™åˆ›å»ºçº¿ç¨‹ï¼Œå¦‚æœé˜»å¡é˜Ÿåˆ—æ— é™å¤§ï¼Œè¿™ä¸ªå‚æ•°å°±æ²¡æ„ä¹‰äº†ã€‚</p></li><li><p><strong>keepAliveTime</strong></p><p>ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼Œå½“å‰çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œåœ¨keepAliveTimeæ—¶é—´åï¼Œè¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°çš„ç©ºé—²çº¿ç¨‹è¢«é”€æ¯</p></li><li><p><strong>unit</strong></p><p>keepAliveTimeçš„æ—¶é—´å•ä½</p></li><li><p><strong>workQueue</strong></p><p>é˜»å¡é˜Ÿåˆ—ç”¨æ¥å‚¨å­˜ç­‰å¾…æ‰§è¡Œä»»åŠ¡çš„é˜Ÿåˆ—ï¼Œæ–°ä»»åŠ¡åˆ°æ¥æ—¶ä¼šå…ˆåˆ¤æ–­çº¿ç¨‹æ•°æ˜¯å¦è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œè‹¥è¾¾åˆ°åˆ™å…ˆåœ¨é˜Ÿåˆ—ä¸­è¿›è¡Œç­‰å¾…ï¼Œé˜Ÿåˆ—æ»¡äº†åˆ™åˆ¤æ–­æœ€å¤§çº¿ç¨‹æ•°æ˜¯å¦é¥±å’Œï¼Œæœªé¥±å’Œåˆ™FIFOæ‰§è¡Œä»»åŠ¡ï¼Œé¥±å’Œæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</p></li><li><p><strong>threadFactory</strong></p><p>çº¿ç¨‹åˆ›å»ºå·¥å‚ï¼Œå¯è‡ªå®šä¹‰</p></li><li><p><strong>handler</strong></p><p>é¥±å’Œç­–ç•¥ï¼Œä»»åŠ¡è¾¾åˆ°ä¸Šé™ï¼Œå¯æ‹’ç»æ‰§è¡Œä»»åŠ¡ï¼Œæœ‰å¤šç§æ‹’ç»ç­–ç•¥</p><ul><li>AbortPolicyï¼šæŠ›å‡º <code>RejectedExecutionException</code>æ¥æ‹’ç»æ–°ä»»åŠ¡çš„å¤„ç†</li><li>CallerRunsPolicyï¼šç”±è°ƒç”¨çº¿ç¨‹æ± execute()æ–¹æ³•çš„çº¿ç¨‹ æ‰§è¡Œè¢«æ‹’ç»çš„ä»»åŠ¡ï¼Œå¼ºè¡Œä¿è¯ä¿¡æ¯ä¸ä¸¢å¤±ï¼Œä½†æ•ˆç‡ä½ã€‚</li><li>DiscardPolicyï¼šç›´æ¥ä¸¢å¼ƒæ–°ä»»åŠ¡</li><li>DiscardOldestPolicyï¼šä¸¢å¼ƒæœ€æ—©æœªè¢«å¤„ç†çš„ä»»åŠ¡</li></ul></li></ul><h2 id="çº¿ç¨‹æ± çš„ç§ç±»"><a href="#çº¿ç¨‹æ± çš„ç§ç±»" class="headerlink" title="çº¿ç¨‹æ± çš„ç§ç±»"></a>çº¿ç¨‹æ± çš„ç§ç±»</h2><ul><li><p><strong>FixedThreadPool</strong></p><p>å›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼Œcoreå’Œmaxéƒ½æ˜¯æˆ‘ä»¬ä¼ å…¥çš„æ•°å€¼ï¼Œä¹Ÿå°±æ˜¯æœ€å¤§çº¿ç¨‹æ•°å°±æ˜¯æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œæ²¡æœ‰éæ ¸å¿ƒçº¿ç¨‹ï¼Œçº¿ç¨‹ä¸å¯å›æ”¶ã€‚</p></li><li><p><strong>SingleThreadExecutor</strong></p><p>core=max=1ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œå•çº¿ç¨‹çº¿ç¨‹æ± é€ä¸ªæ‰§è¡Œä»»åŠ¡ï¼Œå¯ä¿è¯ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºï¼Œå…ˆè¿›å…ˆå‡ºã€‚</p></li><li><p><strong>CaheedThreadPool</strong></p><p>core = 0ï¼Œmax = intçš„æœ€å¤§å€¼ï¼Œæ²¡æœ‰æ ¸å¿ƒçº¿ç¨‹ï¼Œéæ ¸å¿ƒçº¿ç¨‹æ˜¯ int_maxå€¼ã€‚æ‰€æœ‰éƒ½æ˜¯ç©ºé—²çº¿ç¨‹éƒ½å¯å›æ”¶ã€‚</p></li><li><p><strong>ScheduledThreadPool</strong></p><p>æ‰§è¡Œå‘¨æœŸæ€§æˆ–å®šæ—¶ä»»åŠ¡çš„çº¿ç¨‹æ± ã€‚</p></li></ul><h2 id="çº¿ç¨‹æ± æ‰§è¡Œæµç¨‹"><a href="#çº¿ç¨‹æ± æ‰§è¡Œæµç¨‹" class="headerlink" title="çº¿ç¨‹æ± æ‰§è¡Œæµç¨‹"></a>çº¿ç¨‹æ± æ‰§è¡Œæµç¨‹</h2><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/45.png" alt="45.png"></p><ul><li>poolSize &lt; coreï¼Œç›´æ¥åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚</li><li>poolSize &gt; coreï¼Œå°†ä»»åŠ¡æ”¾åˆ°é˜»å¡é˜Ÿåˆ—FIFOã€‚</li><li>é˜»å¡é˜Ÿåˆ—æ»¡äº† &amp;&amp; poolSize  &lt; maxï¼Œåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚</li><li>poolSize &gt; maxï¼Œæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</li></ul><h2 id="ä¸ºä»€ä¹ˆæ¨èè‡ªå®šä¹‰çº¿ç¨‹æ± "><a href="#ä¸ºä»€ä¹ˆæ¨èè‡ªå®šä¹‰çº¿ç¨‹æ± " class="headerlink" title="ä¸ºä»€ä¹ˆæ¨èè‡ªå®šä¹‰çº¿ç¨‹æ± "></a>ä¸ºä»€ä¹ˆæ¨èè‡ªå®šä¹‰çº¿ç¨‹æ± </h2><ul><li><code>FixedThreadPool</code> å’Œ <code>SingleThreadExecutor</code>ï¼Œå®˜æ–¹è®¾ç½®å…¶é˜»å¡é˜Ÿåˆ—æ—¶ï¼Œç›´æ¥ä½¿ç”¨ LinkedBlockingQueue()ï¼Œä¼šèµ°æ— å‚æ„é€ å™¨ï¼Œæ— å‚æ„é€ å°†å®¹é‡è®¾ç½®ä¸º Integer.MAX_VALUEï¼Œä¼šå¯¼è‡´å¤§é‡è¯·æ±‚å †ç§¯ï¼Œæœ€ç»ˆå¯¼è‡´OOMå†…å­˜æº¢å‡ºã€‚</li><li><code>CaheedThreadPool</code> å’Œ <code>ScheduledThreadPool</code>ï¼Œå®˜æ–¹è®¾ç½®å®ƒä»¬çš„æœ€å¤§çº¿ç¨‹æ•°éƒ½æ˜¯ Integer.MAX_VALUEï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥å¤§é‡åˆ›å»ºçº¿ç¨‹ï¼Œå¯èƒ½å¯¼è‡´OOMå†…å­˜æº¢å‡ºã€‚</li></ul><h1 id="AQS"><a href="#AQS" class="headerlink" title="AQS"></a>AQS</h1><h2 id="AQSåŸç†"><a href="#AQSåŸç†" class="headerlink" title="AQSåŸç†"></a>AQSåŸç†</h2><p>AbstractQueuedSynchronizer æ˜¯ä¸€ä¸ªæ„å»ºé”å’ŒåŒæ­¥å™¨çš„æ¡†æ¶ï¼Œä¾‹å¦‚ReentrantLockã€Semaphoreéƒ½æ˜¯åŸºäºAQSå®ç°çš„ã€‚</p><ul><li>å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²ï¼Œåˆ™å°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆçš„å·¥ä½œçº¿ç¨‹ï¼Œå¹¶ä¸”å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ã€‚</li><li>å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºè¢«å ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€å¥—çº¿ç¨‹é˜»å¡ç­‰å¾…ä»¥åŠè¢«å”¤é†’æ—¶é”åˆ†é…çš„æœºåˆ¶ï¼Œè¿™ä¸ªæœºåˆ¶ AQS æ˜¯ç”¨ <strong>CLH é˜Ÿåˆ—é”</strong>å®ç°çš„ï¼Œå³ å°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚</li></ul><p>å…¶ä¸­CLHæ˜¯ä¸€ä¸ªFIFOåŒå‘é˜Ÿåˆ—ï¼ŒAQSå°†è¯·æ±‚å…±äº«èµ„æºçš„çº¿ç¨‹å°è£…æˆCLHçš„ä¸€ä¸ªNodeæ¥å®ç°é”çš„åˆ†é…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> state;<span class="comment">//å…±äº«å˜é‡ï¼Œä½¿ç”¨volatileä¿®é¥°ä¿è¯çº¿ç¨‹å¯è§æ€§</span></span><br></pre></td></tr></table></figure><p>AQSå®šä¹‰äº†ä¸€ä¸ªæˆå‘˜å˜é‡stateè¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼ŒAQS ä½¿ç”¨ CAS å¯¹è¯¥åŒæ­¥çŠ¶æ€è¿›è¡ŒåŸå­æ“ä½œå®ç°å¯¹å…¶å€¼çš„ä¿®æ”¹ã€‚æˆ‘ä»¬åç»­ä¸€äº›åŸºäºAQSå®ç°çš„ç±»ï¼Œå…¶æ“ä½œçš„é™åˆ¶æ•°å°±æ˜¯è¿™é‡Œçš„stateã€‚</p><h2 id="AQSå¯¹èµ„æºå…±äº«çš„æ–¹å¼"><a href="#AQSå¯¹èµ„æºå…±äº«çš„æ–¹å¼" class="headerlink" title="AQSå¯¹èµ„æºå…±äº«çš„æ–¹å¼"></a>AQSå¯¹èµ„æºå…±äº«çš„æ–¹å¼</h2><ul><li>ç‹¬å ï¼šåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼ŒReentrantLock</li><li>å…±äº«ï¼šå¤šçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼ŒCountDownLatchã€CyclicBarrierã€Semaphoreã€</li></ul><h2 id="CountDownLatchï¼ˆå€’è®¡æ—¶å™¨ï¼‰"><a href="#CountDownLatchï¼ˆå€’è®¡æ—¶å™¨ï¼‰" class="headerlink" title="CountDownLatchï¼ˆå€’è®¡æ—¶å™¨ï¼‰"></a>CountDownLatchï¼ˆå€’è®¡æ—¶å™¨ï¼‰</h2><p>åŸºäºAQSå®ç°ï¼ŒCountDownLatch å…è®¸æ•°ä¸ªçº¿ç¨‹é˜»å¡åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ã€‚</p><p>CountDownLatch ä¼šç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ cntï¼Œæ¯å½“ä¸€ä¸ªç­‰å¾…çº¿ç¨‹å®Œæˆä»»åŠ¡å°±æ˜¯æ‰§è¡Œ countDown() æ–¹æ³•ï¼Œä½¿è®¡æ•°å™¨å€¼-1ï¼Œåªæœ‰å½“ cnt å‡è‡³0æ—¶ï¼Œé‚£äº›è°ƒç”¨ await() è¿›å…¥ç­‰å¾…çš„çº¿ç¨‹ä¼šè¢«å”¤é†’ã€‚</p><p>ä¸€èˆ¬ await() é…åˆä»»åŠ¡è°ƒç”¨ä½¿ç”¨ï¼Œæ¯ä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡åå°± countDown()ï¼Œç„¶åæ‰§è¡Œ await() ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆä»»åŠ¡ã€‚</p><h2 id="CyclicBarrierï¼ˆå¾ªç¯æ …æ ï¼‰"><a href="#CyclicBarrierï¼ˆå¾ªç¯æ …æ ï¼‰" class="headerlink" title="CyclicBarrierï¼ˆå¾ªç¯æ …æ ï¼‰"></a>CyclicBarrierï¼ˆå¾ªç¯æ …æ ï¼‰</h2><p>åŸºäºReentrantLockå®ç°ï¼Œè€ŒReentrantLockæ˜¯åŸºäºAQSå®ç°çš„ã€‚ç”¨æ¥æ§åˆ¶å¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…ã€‚</p><p>CyclicBarrier è®©ä¸€ç»„çº¿ç¨‹åˆ°è¾¾ä¸€ä¸ªå±éšœï¼ˆåŒæ­¥ç‚¹ï¼‰æ—¶è¢«é˜»å¡ï¼Œç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœï¼Œå±éšœæ‰ä¼šè¢«æ‰“å¼€ï¼Œè¿™ä¸€ç»„çº¿ç¨‹æ‰å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚</p><p>CyclicBarrier å†…éƒ¨ä¹Ÿæ˜¯ä½¿ç”¨è®¡æ•°å™¨å®ç°ï¼Œçº¿ç¨‹æ‰§è¡Œ await() æ–¹æ³•ä¹‹åè®¡æ•°å™¨ä¼š-1ï¼Œå¹¶è¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°è®¡æ•°å™¨ä¸º 0ï¼Œæ‰€æœ‰è°ƒç”¨ await() æ–¹æ³•è€Œåœ¨ç­‰å¾…çš„çº¿ç¨‹æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</p><p>CyclicBarrier å’Œ CountDownLatch ç±»ä¼¼ï¼Œä½† CyclicBarrier å¯ä»¥è°ƒç”¨ reset() æ–¹æ³•è¿›è¡Œå¾ªç¯ä½¿ç”¨ã€‚è€Œ CountDownLatch  åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚</p><h2 id="Semaphoreï¼ˆä¿¡å·é‡ï¼‰"><a href="#Semaphoreï¼ˆä¿¡å·é‡ï¼‰" class="headerlink" title="Semaphoreï¼ˆä¿¡å·é‡ï¼‰"></a>Semaphoreï¼ˆä¿¡å·é‡ï¼‰</h2><p>åŸºäºAQSå®ç°ï¼ŒSemaphore ç±»ä¼¼äºæ“ä½œç³»ç»Ÿä¸­çš„ä¿¡å·é‡ï¼Œå¯ä»¥æ§åˆ¶å¯¹äº’æ–¥èµ„æºçš„è®¿é—®çº¿ç¨‹æ•°ã€‚</p><p>acquire() é˜»å¡çº¿ç¨‹ï¼Œä»ä¿¡å·é‡è·å–è®¸å¯</p><p>release() å¢åŠ è®¸å¯ï¼Œå¯é‡Šæ”¾ä¸€ä¸ªè¢«é˜»å¡çš„ acquire()ã€‚</p><p>Semaphoreç”¨æ¥ç»´æŠ¤è®¸å¯çš„æ•°é‡ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å¹¶å‘åŸºç¡€&quot;&gt;&lt;a href=&quot;#å¹¶å‘åŸºç¡€&quot; class=&quot;headerlink&quot; title=&quot;å¹¶å‘åŸºç¡€&quot;&gt;&lt;/a&gt;å¹¶å‘åŸºç¡€&lt;/h1&gt;&lt;h2 id=&quot;è¿›ç¨‹ä¸çº¿ç¨‹&quot;&gt;&lt;a href=&quot;#è¿›ç¨‹ä¸çº¿ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;è¿›ç¨‹ä¸çº¿ç¨‹&quot;&gt;</summary>
      
    
    
    
    <category term="å…«è‚¡" scheme="http://aidianfirst.com/categories/%E5%85%AB%E8%82%A1/"/>
    
    
  </entry>
  
  <entry>
    <title>Javaå…«è‚¡æ–‡</title>
    <link href="http://aidianfirst.com/2021/08/25/%E5%85%AB%E8%82%A1/Java%E5%85%AB%E8%82%A1%E6%96%87/"/>
    <id>http://aidianfirst.com/2021/08/25/%E5%85%AB%E8%82%A1/Java%E5%85%AB%E8%82%A1%E6%96%87/</id>
    <published>2021-08-25T02:01:10.000Z</published>
    <updated>2023-07-30T11:20:17.727Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åŸºæœ¬æ•°æ®ç±»å‹"><a href="#åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="åŸºæœ¬æ•°æ®ç±»å‹"></a>åŸºæœ¬æ•°æ®ç±»å‹</h1><h2 id="8ç§åŸºæœ¬æ•°æ®ç±»å‹åŠåŒ…è£…ç±»"><a href="#8ç§åŸºæœ¬æ•°æ®ç±»å‹åŠåŒ…è£…ç±»" class="headerlink" title="8ç§åŸºæœ¬æ•°æ®ç±»å‹åŠåŒ…è£…ç±»"></a>8ç§åŸºæœ¬æ•°æ®ç±»å‹åŠåŒ…è£…ç±»</h2><ul><li>byteï¼ˆ8ä½ã€1å­—èŠ‚ï¼‰Byte</li><li>char(16ä½ã€2å­—èŠ‚ï¼‰Character</li><li>shortï¼ˆ16ä½ã€2å­—èŠ‚ï¼‰Short</li><li>intï¼ˆ32ä½ã€4å­—èŠ‚ï¼‰Integer</li><li>longï¼ˆ64ä½ã€8å­—èŠ‚ï¼‰Long</li><li>floatï¼ˆ32ä½ã€4å­—èŠ‚ï¼‰Float</li><li>doubleï¼ˆ64ä½ã€8å­—èŠ‚ï¼‰Double</li><li>booleanï¼ˆtrueã€falseï¼‰Boolean</li></ul><h2 id="åŒ…è£…ç±»çš„è£…ç®±ä¸æ‹†ç®±"><a href="#åŒ…è£…ç±»çš„è£…ç®±ä¸æ‹†ç®±" class="headerlink" title="åŒ…è£…ç±»çš„è£…ç®±ä¸æ‹†ç®±"></a>åŒ…è£…ç±»çš„è£…ç®±ä¸æ‹†ç®±</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è£…ç®± Integer a = Integer.valueOf(10);</span></span><br><span class="line">Integer a = <span class="number">10</span>;</span><br><span class="line"><span class="comment">// æ‹†ç®± int b = a.intValue();</span></span><br><span class="line"><span class="keyword">int</span> b = a;</span><br></pre></td></tr></table></figure><h2 id="ç¼“å­˜æ± "><a href="#ç¼“å­˜æ± " class="headerlink" title="ç¼“å­˜æ± "></a>ç¼“å­˜æ± </h2><p>Integerè£…ç®±æºç ï¼Œå¦‚æœç¼“å­˜æ± å·²å­˜åœ¨æ•°å€¼ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›è¯¥å¯¹è±¡ï¼Œä¸ç”¨åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">valueOf</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)</span><br><span class="line">        <span class="keyword">return</span> IntegerCache.cache[i + (-IntegerCache.low)];</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Integer(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ä»¥ä¸‹ç»“æœæ˜¯trueï¼Œjæ˜¯ä»ç¼“å­˜æ± ä¸­å–çš„ç›¸åŒå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Integer i = <span class="number">1</span>;</span><br><span class="line">Integer j = <span class="number">1</span>;</span><br><span class="line">System.out.println(i.equals(j));</span><br></pre></td></tr></table></figure><p>ç¼“å­˜æ± æ˜¯æœ‰èŒƒå›´çš„ï¼Œå¦‚Integeræ˜¯-128~127ï¼ŒèŒƒå›´å¤–åˆ›å»ºå°±æ˜¯ä¸¤ä¸ªå¯¹è±¡ï¼Œä¸ä¼šä»å¸¸é‡æ± æ‹¿å–ã€‚<strong>æ³¨æ„floatå’Œdoubleå‹æ˜¯æ²¡æœ‰ç¼“å­˜æ± çš„</strong>ã€‚</p><h1 id="å¼•ç”¨æ•°æ®ç±»å‹çš„æµ…æ‹·è´ä¸æ·±æ‹·è´"><a href="#å¼•ç”¨æ•°æ®ç±»å‹çš„æµ…æ‹·è´ä¸æ·±æ‹·è´" class="headerlink" title="å¼•ç”¨æ•°æ®ç±»å‹çš„æµ…æ‹·è´ä¸æ·±æ‹·è´"></a>å¼•ç”¨æ•°æ®ç±»å‹çš„æµ…æ‹·è´ä¸æ·±æ‹·è´</h1><p>ä»Šå¤©åšå”¯å“ä¼šç¬”è¯•æ—¶ï¼Œå‘ç°setå¤åˆ¶å‡ºäº†é—®é¢˜ï¼Œå…œå…œè½¬è½¬æ‰¾åˆ°äº†é—®é¢˜çš„æ ¹æºï¼Œå¼•ç”¨æ•°æ®ç±»å‹ä»¥åŠæ·±æµ…æ‹·è´çš„é—®é¢˜ã€‚äºæ˜¯ä¾¿è¡¥ä¸Šäº†è¿™ä¸€å—çš„ç¬”è®°ã€‚</p><p>é¦–å…ˆJavaåˆ†ä¸ºåŸºç¡€æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹ï¼Œè¿™ä¸ªæˆ‘ä»¬éƒ½çŸ¥é“ã€‚å¯¹äºå…«å¤§åŸºç¡€æ•°æ®ç±»å‹ï¼Œæ²¡æœ‰æ·±æµ…æ‹·è´çš„è¯´æ³•ã€‚æˆ‘ä»¬ä¸»è¦æ˜¯è®¨è®ºå¼•ç”¨æ•°æ®ç±»å‹ã€‚</p><ul><li><p>æµ…æ‹·è´</p><p>ç®€å•æ¥è¯´ï¼Œæµ…æ‹·è´å°±æ˜¯å°†ä¸¤ä¸ªå¼•ç”¨æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯ä½¿ç”¨ â€œ=â€ è¿›è¡Œå¼•ç”¨ä¼ é€’ï¼Œå¼•ç”¨æ•°æ®ç±»å‹å­˜å‚¨çš„æ˜¯ä¸€æŒ‡å‘å¯¹è±¡çš„åœ°å€ã€‚</p><p>æˆ‘ä»¬è¿™é‡Œsetå’Œtempå°±æ˜¯ä½¿ç”¨ â€œ=â€ è¿›è¡Œæµ…æ‹·è´ï¼Œç”±tempå¯¹é›†åˆè¿›è¡Œæ¸…ç©ºæ“ä½œï¼Œsetå’ŒtempæŒ‡å‘çš„æ˜¯åŒä¸€å¯¹è±¡ï¼Œæ‰€ä»¥äºŒè€…éƒ½ä¸ºç©ºã€‚</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;Character&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">Set&lt;Character&gt; temp = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">temp = set;</span><br><span class="line">System.out.println(temp == set);<span class="comment">//true</span></span><br><span class="line">temp.clear();</span><br><span class="line">System.out.println(temp.isEmpty()); <span class="comment">//true</span></span><br><span class="line">System.out.println(set.isEmpty());<span class="comment">//true</span></span><br></pre></td></tr></table></figure></li><li><p>æ·±æ‹·è´</p><p>å’Œæµ…æ‹·è´ç›¸åï¼Œæ·±æ‹·è´å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå°†åŸå†…å®¹è¿›è¡Œå¤åˆ¶ï¼Œä»…ä»…æ˜¯å†…å®¹ç›¸åŒï¼Œä½†æ˜¯æ˜¯ä¸¤ä¸ªå¯¹è±¡ã€‚å¯¹äºå®¹å™¨æ¥è¯´å¯ä»¥ä½¿ç”¨ addAll() æˆ– putAll() æ¥è¿›è¡Œæ·±æ‹·è´ã€‚</p><p>è¿™é‡Œsetå’Œtempæ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œåªæ˜¯å†…å®¹ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸¤ä¸ªå¼•ç”¨æŒ‡å‘äº†ä¸¤ä¸ªä¸åŒçš„åœ°å€ï¼Œä½†åœ°å€çš„å†…å®¹ä¸€æ ·ã€‚æˆ‘ä»¬é€šå¸¸ä½¿ç”¨æ·±æ‹·è´å¯¹å®¹å™¨è¿›è¡Œå¤åˆ¶æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;Character&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">Set&lt;Character&gt; temp = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">set.add(<span class="string">&#x27;s&#x27;</span>);</span><br><span class="line">temp.addAll(set);</span><br><span class="line">System.out.println(temp == set);<span class="comment">//false</span></span><br><span class="line">temp.clear();</span><br><span class="line">System.out.println(temp.isEmpty()); <span class="comment">//true</span></span><br><span class="line">System.out.println(set.isEmpty());<span class="comment">//false</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="ä¸equalsçš„åŒºåˆ«"><a href="#ä¸equalsçš„åŒºåˆ«" class="headerlink" title="==ä¸equalsçš„åŒºåˆ«"></a>==ä¸equalsçš„åŒºåˆ«</h1><ul><li><p>==</p><ul><li>åŸºæœ¬æ•°æ®ç±»å‹ï¼šæ¯”è¾ƒå€¼æ˜¯å¦ç›¸ç­‰</li><li>å¼•ç”¨ç±»å‹ï¼šæ¯”è¾ƒå˜é‡æ˜¯å¦å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æ¯”è¾ƒå¼•ç”¨å˜é‡çš„å€¼ï¼Œå› ä¸ºå˜é‡å­˜å‚¨çš„æ˜¯å¯¹è±¡çš„åœ°å€</li></ul></li><li><p>equals()</p><ul><li>åŸºæœ¬æ•°æ®ç±»å‹ï¼šæ²¡æœ‰equals()æ–¹æ³•</li><li>å¼•ç”¨ç±»å‹ï¼šæ ¹æ®å½“å‰ç±»æ˜¯å¦é‡å†™equals()æ–¹æ³•<ul><li>ç±»æ²¡æœ‰é‡å†™equals()æ–¹æ³•ï¼šæ­¤æ—¶ä½¿ç”¨equals()ç›¸å½“äºä½¿ç”¨ == ï¼Œæ¯”è¾ƒä¸¤ä¸ªå˜é‡å¼•ç”¨çš„å¯¹è±¡åœ°å€ï¼Œæ­¤æ—¶ä½¿ç”¨çš„equals()æ˜¯Objectç±»çš„æ–¹æ³•</li><li>ç±»é‡å†™äº†equals()æ–¹æ³•ï¼šæ­¤æ—¶equasl()æŒ‰å…¶é‡å†™æ–¹æ³•çš„å…·ä½“å†…å®¹æ‰§è¡Œæ“ä½œï¼Œä¸€èˆ¬é‡å†™éƒ½æ˜¯ä¸ºäº†æ¯”è¾ƒå¼•ç”¨å¯¹è±¡çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼ŒIntegerã€Stringç­‰ç±»éƒ½å¯¹equals()è¿›è¡Œè¿‡é‡å†™ï¼Œæ‰€ä»¥å®ƒä»¬çš„equals()å¯æ¯”è¾ƒå€¼ç›¸ç­‰</li></ul></li></ul></li></ul><p>aã€bæ˜¯ç›´æ¥åˆ›å»ºä¸€ä¸ªabcçš„æ–°å¯¹è±¡ï¼Œ==ä¸ç­‰ã€equalsç›¸ç­‰ã€‚</p><p>aaåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä¸”æ”¾åˆ°äº†å­—ç¬¦ä¸²çš„å¸¸é‡æ± ï¼ˆç±»ä¼¼åŒ…è£…ç±»çš„ç¼“å­˜æ± ï¼‰ï¼Œæ‰€ä»¥bbåˆ›å»ºæ—¶ç›´æ¥ä»å¸¸é‡æ± æ‹¿å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯aaå’Œbbæ˜¯å®Œå…¨ç›¸åŒçš„å¯¹è±¡ï¼Œ==ã€equalséƒ½ç›¸ç­‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">String a = <span class="keyword">new</span> String(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">String b = <span class="keyword">new</span> String(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">String aa = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">String bb = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">System.out.println(a == b);<span class="comment">//flase</span></span><br><span class="line">System.out.println(a == aa);<span class="comment">//flase</span></span><br><span class="line">System.out.println(aa == bb);<span class="comment">//true</span></span><br><span class="line"></span><br><span class="line">System.out.println(a.equals(b));<span class="comment">//true</span></span><br><span class="line">System.out.println(a.equals(aa));<span class="comment">//true</span></span><br><span class="line">System.out.println(aa.equals(bb));<span class="comment">//true</span></span><br></pre></td></tr></table></figure><h1 id="hashCode-ä¸equals"><a href="#hashCode-ä¸equals" class="headerlink" title="hashCode()ä¸equals()"></a>hashCode()ä¸equals()</h1><p>hashCode()å³è·å¾—æ•£åˆ—å€¼ï¼Œå…¶å®šä¹‰åœ¨Objectç±»ä¸­ï¼Œè¿™ä»£è¡¨Javaä¸­æ‰€æœ‰ç±»éƒ½åŒ…å«hashCode()ã€‚ä¸¤ä¸ªå¯¹è±¡ç­‰ä»·ï¼Œå…¶hashcodeä¸€å®šç›¸ç­‰ï¼Œè€Œhashcodeç›¸ç­‰çš„ä¸¤ä¸ªå¯¹è±¡ä¸ä¸€å®šç­‰ä»·ï¼Œè¿™æ˜¯å› ä¸ºæ•£åˆ—å€¼ä¼šå‘ç”Ÿå“ˆå¸Œå†²çªï¼Œä½¿å¾—ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡æœ‰ç›¸åŒçš„æ•£åˆ—å€¼ã€‚</p><p>è€Œæˆ‘ä»¬é‡å†™equals()æ–¹æ³•ï¼Œå…¶hashCode()ä¹Ÿè¦é‡å†™ï¼Œå› ä¸ºä¸¤ä¸ªå¯¹è±¡ç­‰ä»·ï¼Œå…¶æ•£åˆ—å€¼ä¸€å®šç›¸ç­‰ã€‚ä¾‹å¦‚æˆ‘ä»¬ä½¿ç”¨HashSetå­˜å‚¨å¯¹è±¡æ—¶ï¼Œä¼šå…ˆé€šè¿‡æ•£åˆ—å€¼åˆ¤æ–­ï¼Œè‹¥æ²¡æœ‰ç›¸åŒçš„æ•£åˆ—å€¼åˆ™åŠ å…¥å¯¹è±¡ï¼Œæœ‰ç›¸ç­‰çš„å€¼åˆ™ç”¨equalså†æ¬¡åˆ¤æ–­ï¼Œç¡®å®šæ˜¯å¦æ˜¯ç›¸åŒçš„å¯¹è±¡ã€‚</p><p>æ‰€ä»¥<strong>HashSetæ˜¯å…ˆé€šè¿‡hashcodeåˆ¤æ–­å¯¹è±¡ï¼Œå†ç”¨equalsåˆ¤æ–­å¯¹è±¡</strong>ï¼Œå¦‚æœæˆ‘ä»¬<strong>é‡å†™equals()æ—¶ä¸é‡å†™hashCode()ï¼Œåˆ™å¯èƒ½å°†ä¸¤ä¸ªç›¸åŒçš„å¯¹è±¡å­˜æ”¾åˆ°HashSetä¸­</strong>ã€‚è€Œåœ¨HashSetå­˜å‚¨ä¸­ä½¿ç”¨hashCode()è¿˜å¯ä»¥å‡å°‘equalsçš„åˆ¤æ–­æ¬¡æ•°ï¼Œæé«˜äº†æ‰§è¡Œæ•ˆç‡ï¼Œä¸ºæ­¤æˆ‘ä»¬é‡å†™equals()æ—¶hashCode()ä¹Ÿè¦é‡å†™ï¼Œä¸ºäº†ä¿è¯ç›¸åŒçš„å¯¹è±¡æœ‰ç›¸åŒçš„æ•£åˆ—å€¼ã€‚</p><h1 id="æ³›å‹æ“¦é™¤"><a href="#æ³›å‹æ“¦é™¤" class="headerlink" title="æ³›å‹æ“¦é™¤"></a>æ³›å‹æ“¦é™¤</h1><p>Javaåªåœ¨ç¼–è¯‘é˜¶æ®µæ£€æµ‹éæ³•ç±»å‹ï¼Œå®é™…æ‰§è¡Œæ—¶ä¸æ£€æµ‹ï¼Œä¹Ÿå°±æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µå°±å°†æ³›å‹çš„ç±»å‹æ“¦é™¤äº†ã€‚å¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œlistæ˜¯å­˜å‚¨Integerå‹çš„ï¼Œtestè¢«listèµ‹å€¼ä¹Ÿåº”è¯¥å­˜å‚¨Integerçš„ï¼Œä½†testæ·»åŠ å­—ç¬¦ä¸²å´æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸ºä»–è™½ç„¶æ˜¯å­˜å‚¨Integerï¼Œä½†åœ¨è¿è¡Œæ—¶ï¼Œlistå’Œtestéƒ½ä¼šè¿›è¡Œæ³›å‹æ“¦é™¤ï¼Œè§†ä¸ºArrayListã€‚å¯ä»¥è¯´æ³›å‹åªæ˜¯è¡¨é¢è¿›è¡Œé™åˆ¶ï¼Œå®é™…æ‰§è¡Œçš„æ—¶å€™æ²¡æœ‰ç”¨ã€‚</p><p>listæ·»åŠ å­—ç¬¦ä¸²æ˜¯ä¸€å®šä¸è¡Œçš„ï¼Œå› ä¸ºè¡¨é¢ä¸Šå®ƒå°±æ˜¯ç”¨æ¥å­˜å‚¨Integerå‹çš„ï¼Œä½†testè™½ç„¶ç­‰äºlistï¼Œé€»è¾‘ä¸Šæ˜¯ç”¨æ¥å­˜å‚¨Integerçš„ï¼Œä½†çœ‹ä¸Šå»å®ƒæ²¡æœ‰å—æ³›å‹é™åˆ¶ï¼Œæ‰€ä»¥å®ƒå¯ä»¥æ·»åŠ å­—ç¬¦ä¸²ã€‚æ³›å‹åªæ˜¯åœ¨ç¼–è¯‘é˜¶æ®µè¿›è¡Œé™åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¡¨é¢é™åˆ¶ï¼Œåœ¨å®é™…æ‰§è¡Œé˜¶æ®µlistã€testéƒ½ä¼šè¢«è§†ä¸ºArrayListã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">List test = list;</span><br><span class="line">test.add(<span class="string">&quot;aaa&quot;</span>);</span><br></pre></td></tr></table></figure><h1 id="é‡è½½ä¸é‡å†™"><a href="#é‡è½½ä¸é‡å†™" class="headerlink" title="é‡è½½ä¸é‡å†™"></a>é‡è½½ä¸é‡å†™</h1><h2 id="é‡è½½"><a href="#é‡è½½" class="headerlink" title="é‡è½½"></a>é‡è½½</h2><p>é‡è½½å‘ç”Ÿåœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œå¤šä¸ªæ–¹æ³•åç›¸åŒçš„æ–¹æ³•ï¼Œä½†å‚æ•°æ•°é‡ã€å‚æ•°é¡ºåºã€å‚æ•°ç±»å‹è‡³å°‘æœ‰ä¸€ä¸ªä¸åŒã€‚å¤šç”¨äºæ„é€ å™¨é‡è½½ã€‚</p><p>æ³¨æ„æ–¹æ³•è¿”å›å€¼ç±»å‹å¯ä»¥ä¸åŒï¼Œä½†å®ƒä¸æ˜¯åˆ¤æ–­é‡è½½çš„æ ‡å‡†ï¼Œä¹Ÿå°±æ˜¯è¯´å‚æ•°æ²¡æœ‰æ”¹å˜æ—¶ï¼Œåªæœ‰è¿”å›å€¼ç±»å‹ä¸åŒåˆ™ä¸æ˜¯é‡è½½ã€‚</p><p>ç”±äºå­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œå…¶çˆ¶ç±»æ–¹æ³•åœ¨å­ç±»ä¸­å…¨éƒ¨å®ç°ï¼Œæ­¤æ—¶æˆ‘ä»¬åœ¨å¯¹æ–¹æ³•é‡è½½ç›¸å½“äºåœ¨å­ç±»ä¸­é‡è½½ã€‚ä¹Ÿå°±æ˜¯åŒä¸€ä¸ªç±»ï¼Œå¹¶æ²¡æœ‰å­ç±»å¯¹çˆ¶ç±»é‡è½½ã€‚</p><h2 id="é‡å†™"><a href="#é‡å†™" class="headerlink" title="é‡å†™"></a>é‡å†™</h2><p>é‡å†™æ˜¯å­ç±»å¯¹çˆ¶ç±»è¿›è¡Œæ“ä½œï¼Œæ–¹æ³•åã€å‚æ•°å¿…é¡»å®Œå…¨ç›¸åŒï¼Œè®¿é—®æƒé™&gt;=çˆ¶ç±»ï¼Œè¿”å›å€¼ç±»å‹å’ŒæŠ›å‡ºå¼‚å¸¸å¯ä»¥æ˜¯çˆ¶ç±»è¿”å›ç±»å‹æˆ–å…¶å­ç±»å‹ã€‚</p><p>çˆ¶ç±»æ˜¯private/final/staticä¿®é¥°ï¼Œå…¶å­ç±»ä¸èƒ½é‡å†™ã€‚å­ç±»åŒåæ–¹æ³•ç›¸å½“äºå®šä¹‰äº†ä¸€ä¸ªæ–°æ–¹æ³•ã€‚</p><p>æ„é€ æ–¹æ³•ä¹Ÿä¸èƒ½è¢«å­ç±»é‡å†™ã€‚</p><h1 id="String"><a href="#String" class="headerlink" title="String"></a>String</h1><h2 id="Stringçš„ç‰¹ç‚¹"><a href="#Stringçš„ç‰¹ç‚¹" class="headerlink" title="Stringçš„ç‰¹ç‚¹"></a>Stringçš„ç‰¹ç‚¹</h2><p>Stringè¢«å£°æ˜ä¸ºfinalï¼ŒStringå¯¹è±¡ä¸å¯å˜ã€ä¸å¯ç»§æ‰¿ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span> value[];</span><br></pre></td></tr></table></figure><p>Stringä¸å¯å˜æ€§ï¼Œä½¿å…¶å¤©ç”Ÿå…·æœ‰çº¿ç¨‹å®‰å…¨æ€§ã€‚</p><h2 id="Stringã€StringBufferã€StringBuilder"><a href="#Stringã€StringBufferã€StringBuilder" class="headerlink" title="Stringã€StringBufferã€StringBuilder"></a>Stringã€StringBufferã€StringBuilder</h2><ul><li>Stringä¸å¯å˜ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œæ¯æ¬¡å‘ç”Ÿæ”¹å˜éƒ½ä¼šæ–°ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ã€‚<strong>æ“ä½œå°‘é‡æ•°æ®å¯ç”¨ã€‚</strong></li><li>StringBufferå¯å˜ï¼Œå…¶å†…éƒ¨æ–¹æ³•åŠ äº†åŒæ­¥é”ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ”¹å˜å¯¹è±¡æ˜¯å¯¹è¯¥å¯¹è±¡æœ¬èº«æ“ä½œã€‚<strong>å¤šçº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²å¯ç”¨ã€‚</strong></li><li>StringBuilderå¯å˜ï¼Œä¸æ˜¯çº¿ç¨‹å®‰å…¨ã€‚<strong>å•çº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²å¯ç”¨ã€‚</strong></li></ul><h2 id="å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString-Poolï¼‰"><a href="#å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString-Poolï¼‰" class="headerlink" title="å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Poolï¼‰"></a>å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Poolï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//a != bï¼Œè¿™æ˜¯ä¸¤ä¸ªå¯¹è±¡</span></span><br><span class="line">String a = <span class="keyword">new</span> String(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">String b = <span class="keyword">new</span> String(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line"><span class="comment">//c == dï¼Œ</span></span><br><span class="line">String c = a.intern();</span><br><span class="line">String d = b.intern();</span><br><span class="line"><span class="comment">// c == d == e == f</span></span><br><span class="line">String e = <span class="string">&quot;aaa&quot;</span>;</span><br><span class="line">String f = <span class="string">&quot;aaa&quot;</span>;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œnew Stringæ˜¯ç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå³aã€bæ˜¯ä¸¤ä¸ªä¸åŒå¯¹è±¡ï¼Œä½†å€¼ç›¸ç­‰ã€‚</p><p>ä½¿ç”¨<strong>intern()æ–¹æ³•</strong>ä¼šå°†å¯¹åº”å­—ç¬¦ä¸²çš„å€¼å­˜å…¥å¸¸é‡æ± ï¼Œç„¶åå½“å¸¸é‡æ± å­˜åœ¨å€¼ç›¸ç­‰çš„å­—ç¬¦ä¸²æ—¶ï¼Œç›´æ¥è¿”å›å¸¸é‡æ± ä¸­çš„å¼•ç”¨ï¼Œæ‰€ä»¥cã€déƒ½æ˜¯aaaå­—ç¬¦ä¸²åœ¨å¸¸é‡æ± ä¸­çš„å¼•ç”¨ï¼Œæ‰€ä»¥æ˜¯ç›¸åŒå¯¹è±¡ã€‚</p><p>eã€få°±ä¸ç”¨è¯´äº†ï¼Œä¼šç›´æ¥å¼•ç”¨å¸¸é‡æ± ï¼Œæ²¡æœ‰åˆ™æ–°å»ºå¯¹è±¡ï¼Œå¹¶æ”¾å…¥å¸¸é‡æ± ã€‚</p><h1 id="å…³é”®å­—"><a href="#å…³é”®å­—" class="headerlink" title="å…³é”®å­—"></a>å…³é”®å­—</h1><h2 id="final"><a href="#final" class="headerlink" title="final"></a>final</h2><ul><li>finalä¿®é¥°çš„ç±»ä¸å¯ç»§æ‰¿ï¼Œfinalç±»ä¸­æ‰€æœ‰æˆå‘˜æ–¹æ³•è¢«éšå¼æŒ‡å®šä¸ºfinalæ–¹æ³•</li><li>finalä¿®é¥°æ–¹æ³•ä¸å¯é‡å†™</li><li>finalä¿®é¥°çš„å˜é‡æ˜¯å¸¸é‡<ul><li>åŸºç¡€æ•°æ®ç±»å‹ï¼Œæ•°å€¼åœ¨åˆå§‹åŒ–åä¸å¯æ›´æ”¹</li><li>å¼•ç”¨ç±»å‹ï¼Œåˆå§‹åŒ–åä¸å¯æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡</li></ul></li></ul><h2 id="static"><a href="#static" class="headerlink" title="static"></a>static</h2><ul><li><p>é™æ€å˜é‡ï¼ˆç±»å˜é‡ï¼‰ï¼Œé™æ€æ–¹æ³•</p><p>è¢«staticä¿®é¥°çš„æˆå‘˜å±äºç±»ï¼Œä¸å•å±äºç±»çš„æŸä¸ªå¯¹è±¡ï¼Œè¢«ç±»ä¸­æ‰€æœ‰å¯¹è±¡å…±äº«ã€‚å¯é€šè¿‡ç±»åç›´æ¥è°ƒç”¨ã€‚</p></li><li><p>é™æ€ä»£ç å—ï¼šåœ¨ç±»åˆå§‹åŒ–æ—¶è¿è¡Œä¸€æ¬¡ã€‚è¯¥ç±»æ— è®ºåˆ›å»ºå¤šå°‘æ¬¡ï¼Œé™æ€ä»£ç å—åªæ‰§è¡Œä¸€æ¬¡ã€‚</p></li><li><p>é™æ€å†…éƒ¨ç±»</p></li><li><p>é™æ€å¯¼åŒ…ï¼šimport staticï¼Œå¯å¯¼å…¥æŸä¸ªç±»çš„æŒ‡å®šé™æ€èµ„æºã€‚</p></li></ul><h2 id="this"><a href="#this" class="headerlink" title="this"></a>this</h2><p>ç”¨äºå¼•ç”¨ç±»çš„å½“å‰å®ä¾‹ï¼ŒæŒ‡å‘æœ¬ç±»å¯¹è±¡ã€‚</p><h2 id="super"><a href="#super" class="headerlink" title="super"></a>super</h2><p>å­ç±»è®¿é—®çˆ¶ç±»çš„å˜é‡å’Œæ–¹æ³•ï¼ŒæŒ‡å‘çˆ¶ç±»å¯¹è±¡ã€‚</p><h1 id="æ–¹æ³•åˆå§‹åŒ–é¡ºåº"><a href="#æ–¹æ³•åˆå§‹åŒ–é¡ºåº" class="headerlink" title="æ–¹æ³•åˆå§‹åŒ–é¡ºåº"></a>æ–¹æ³•åˆå§‹åŒ–é¡ºåº</h1><ul><li>çˆ¶ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰</li><li>å­ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰</li><li>mainæ–¹æ³•</li><li>çˆ¶ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰</li><li>çˆ¶ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰</li><li>å­ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰</li><li>å­ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰</li></ul><p>çˆ¶ &gt; å­ï¼Œé™æ€æœ€ä¼˜å…ˆ</p><p>è¿™é‡Œçœ‹ä¸€ä¸ªç‰¹æ®Šä¾‹å­ï¼Œæˆ‘ä»¬å£°æ˜ä¸€ä¸ªå…¨å±€é™æ€å¯¹è±¡ï¼Œå®ƒåœ¨è°ƒç”¨æ„é€ æ–¹æ³•æ—¶ä¼šå…ˆæ‰§è¡Œæ™®é€šæ–¹æ³•å—ï¼Œä½†é™æ€å˜é‡ä»¥åŠé™æ€æ–¹æ³•å—ç›¸äº’ä¸å½±å“ï¼Œåªæœ‰æŒ‰åºèµ°åˆ°å¯¹åº”é™æ€å˜é‡æˆ–é™æ€æ–¹æ³•å—æ—¶ï¼Œè¿™äº›é™æ€æ‰ä¼šæ‰§è¡Œï¼Œä¸”åªæ‰§è¡Œä¸€æ¬¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> A a1 = <span class="keyword">new</span> A();</span><br><span class="line">    <span class="keyword">static</span> A a2 = <span class="keyword">new</span> A();</span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;11111111&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;222222222&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        A a2 = <span class="keyword">new</span> A();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è¾“å‡º</span></span><br><span class="line"><span class="comment">    11111111</span></span><br><span class="line"><span class="comment">    11111111</span></span><br><span class="line"><span class="comment">    222222222</span></span><br><span class="line"><span class="comment">    11111111</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h1 id="é¢å‘å¯¹è±¡"><a href="#é¢å‘å¯¹è±¡" class="headerlink" title="é¢å‘å¯¹è±¡"></a>é¢å‘å¯¹è±¡</h1><h2 id="é¢å‘å¯¹è±¡ä¸é¢å‘è¿‡ç¨‹"><a href="#é¢å‘å¯¹è±¡ä¸é¢å‘è¿‡ç¨‹" class="headerlink" title="é¢å‘å¯¹è±¡ä¸é¢å‘è¿‡ç¨‹"></a>é¢å‘å¯¹è±¡ä¸é¢å‘è¿‡ç¨‹</h2><ul><li><p>é¢å‘è¿‡ç¨‹ï¼šè¿‡ç¨‹æœ€é‡è¦ï¼Œéœ€è¦é¡ºåºæ‰§è¡ŒæŒ‰éƒ¨å°±ç­ï¼Œå½“æ€§èƒ½æ˜¯ä¸»è¦è€ƒé‡å› ç´ æ—¶ä½¿ç”¨ï¼Œä¸€èˆ¬éƒ½æ˜¯ç¼–è¯‘æˆæœºæ¢°ç åè¿è¡Œï¼Œæ‰€ä»¥æ•ˆç‡é«˜ã€‚ä¸»è¦æ˜¯åæœŸä¸å¥½ç»´æŠ¤ï¼Œéš¾ä»¥é‡å¤åˆ©ç”¨ã€‚</p></li><li><p>é¢å‘å¯¹è±¡ï¼šæœ‰å°è£…ã€ç»§æ‰¿ã€å¤šæ€çš„ç‰¹æ€§ï¼Œæ˜“ç»´æŠ¤ã€æ˜“å¤ç”¨ã€æ˜“æ‰©å±•ï¼Œèƒ½é™ä½è€¦åˆæ€§ï¼Œä½†æ€§èƒ½ç›¸å¯¹äºé¢å‘è¿‡ç¨‹å¯èƒ½ä½ä¸€äº›ã€‚</p></li></ul><h2 id="æˆå‘˜å˜é‡ä¸å±€éƒ¨å˜é‡"><a href="#æˆå‘˜å˜é‡ä¸å±€éƒ¨å˜é‡" class="headerlink" title="æˆå‘˜å˜é‡ä¸å±€éƒ¨å˜é‡"></a>æˆå‘˜å˜é‡ä¸å±€éƒ¨å˜é‡</h2><ul><li>æˆå‘˜å˜é‡ï¼ˆç±»ï¼‰ï¼šå¯ä»¥è¢«publicã€privateã€staticã€finalç­‰ä¿®é¥°ï¼Œæ²¡æœ‰èµ‹åˆå€¼ä¼šè‡ªåŠ¨ä»¥é»˜è®¤å€¼èµ‹å€¼ã€‚</li><li>å±€éƒ¨å˜é‡ï¼ˆæ–¹æ³•ã€ä»£ç å—ï¼‰ï¼šä¸€èˆ¬ä¸å¯è¢«ä¿®é¥°ç¬¦ä¿®é¥°ï¼Œä½†finalå¯ä»¥ã€‚æ²¡æœ‰èµ‹åˆå€¼ä¼šæŠ¥é”™ï¼Œå±€éƒ¨å˜é‡ä¸ä¼šä»¥é»˜è®¤å€¼è‡ªåŠ¨èµ‹å€¼ã€‚</li></ul><h2 id="é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹å¾"><a href="#é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹å¾" class="headerlink" title="é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹å¾"></a>é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹å¾</h2><ul><li><p>å°è£…</p><p>å®ä½“ç±»çš„å°è£…ï¼Œä¾‹å¦‚é¡¹ç›®ä¸­å°è£…æ•°æ®åº“è¡¨çš„å­—æ®µæˆä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åå¯¹å®ƒè¿›è¡Œèµ‹å€¼ã€å–å€¼æ“ä½œã€‚</p></li><li><p>ç»§æ‰¿</p><p>å­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œæé«˜ä»£ç çš„å¤ç”¨æ€§ï¼Œå­ç±»å¯ä»¥åŒ…æ‹¬çˆ¶ç±»æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼ˆåŒ…æ‹¬ç§æœ‰ï¼‰ï¼Œä½†<strong>ç§æœ‰å±æ€§å’Œæ–¹æ³•æ˜¯ä¸èƒ½è®¿é—®çš„ï¼Œåªæ˜¯æ‹¥æœ‰</strong>ã€‚</p></li><li><p>å¤šæ€ï¼ˆå‘ä¸Šè½¬å‹ï¼‰</p><p>ç®€å•è¯´ä¸€ä¸ªå¯¹è±¡æœ‰å¤šç§çŠ¶æ€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ—è¡¨å¯ä»¥æ˜¯æ•°ç»„æˆ–é“¾è¡¨ä¸¤ç§å®ç°</span></span><br><span class="line">List list = <span class="keyword">new</span> ArrayList();</span><br><span class="line">List list = <span class="keyword">new</span> LinkedList();</span><br></pre></td></tr></table></figure><p>è¦æœ‰ç»§æ‰¿æˆ–å®ç°çš„å…³ç³»ï¼Œå­ç±»å¯¹çˆ¶ç±»æ–¹æ³•è¿›è¡Œäº†é‡å†™ï¼Œä»¥å®ç°å¤šæ€ã€‚</p></li></ul><h1 id="åå°„ï¼ˆæ¡†æ¶ä¸­å¤§é‡ä½¿ç”¨åå°„æœºåˆ¶ï¼‰"><a href="#åå°„ï¼ˆæ¡†æ¶ä¸­å¤§é‡ä½¿ç”¨åå°„æœºåˆ¶ï¼‰" class="headerlink" title="åå°„ï¼ˆæ¡†æ¶ä¸­å¤§é‡ä½¿ç”¨åå°„æœºåˆ¶ï¼‰"></a>åå°„ï¼ˆæ¡†æ¶ä¸­å¤§é‡ä½¿ç”¨åå°„æœºåˆ¶ï¼‰</h1><p>é€šè¿‡forNameã€.classç­‰æ–¹å¼è·å–ç±»ï¼Œç„¶åå†é€šè¿‡æ“ä½œFieldã€Methodã€Constructorå¯¹ç±»çš„å…ƒç´ ã€æ–¹æ³•ç­‰è¿›è¡Œæ“ä½œã€‚</p><h1 id="å¼‚å¸¸ï¼ˆThrowableï¼‰"><a href="#å¼‚å¸¸ï¼ˆThrowableï¼‰" class="headerlink" title="å¼‚å¸¸ï¼ˆThrowableï¼‰"></a>å¼‚å¸¸ï¼ˆThrowableï¼‰</h1><p>Throwableç±»æ˜¯æ‰€æœ‰å¼‚å¸¸çš„å…±åŒç¥–å…ˆï¼Œå…¶æœ‰ä¸¤ä¸ªé‡è¦å­ç±»Exceptionï¼ˆå¼‚å¸¸ï¼‰å’ŒErrorï¼ˆé”™è¯¯ï¼‰ã€‚å…¶ä¸­å¼‚å¸¸å¯ä»¥è¢«try-catchæ•è·ï¼Œé”™è¯¯æ— æ³•å¤„ç†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/21.png" alt="21.png"></p><ul><li><p>Exceptionï¼šç¨‹åºå¯å¤„ç†çš„å¼‚å¸¸ï¼Œé€šè¿‡catchè¿›è¡Œæ•è·</p><ul><li><p>checkå¯æŸ¥å¼‚å¸¸ï¼šåœ¨æºç ä¸­å¿…é¡»æ˜¾æ€§è¿›è¡Œæ•è·å¤„ç†ï¼Œä¼šåœ¨ç¼–è¯‘å™¨è¿›è¡Œæ£€æŸ¥ã€‚</p><p>ä¾‹ï¼šClassNotFoundExceptionã€SQLExceptionç­‰</p></li><li><p>uncheckä¸å¯æŸ¥å¼‚å¸¸ï¼šè¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntimeExceptionï¼‰ï¼Œé€šå¸¸æ˜¯ä»£ç çš„é€»è¾‘é”™è¯¯ï¼Œæ ¹æ®éœ€æ±‚è¿›è¡Œæ•è·ï¼Œå¹¶ä¸åœ¨ç¼–è¯‘æœŸå¼ºåˆ¶è¦æ±‚ã€‚</p><p>ä¾‹ï¼šNullPointerExceptionã€ArrayIndexOutOfBoundsExceptionç­‰</p></li></ul></li><li><p>Errorï¼šç¨‹åºæ— æ³•å¤„ç†çš„é”™è¯¯ï¼Œå¦‚JVMè¿è¡Œé”™è¯¯ã€JVMå†…å­˜ä¸å¤Ÿç­‰é”™è¯¯ï¼Œè¯¥å¼‚å¸¸å‘ç”Ÿæ—¶ï¼ŒJVMä¼šå°†çº¿ç¨‹ç»ˆæ­¢ã€‚</p></li></ul><h1 id="I-Oæµ"><a href="#I-Oæµ" class="headerlink" title="I/Oæµ"></a>I/Oæµ</h1><h2 id="åºåˆ—åŒ–ï¼ˆserializationï¼‰"><a href="#åºåˆ—åŒ–ï¼ˆserializationï¼‰" class="headerlink" title="åºåˆ—åŒ–ï¼ˆserializationï¼‰"></a>åºåˆ—åŒ–ï¼ˆserializationï¼‰</h2><ul><li>åºåˆ—åŒ–ï¼šå°†Javaå¯¹è±¡è½¬æ¢ä¸ºäºŒè¿›åˆ¶å­—èŠ‚æµçš„è¿‡ç¨‹ã€‚</li><li>ååºåˆ—åŒ–ï¼šå°†åºåˆ—åŒ–ç”Ÿæˆçš„äºŒè¿›åˆ¶å­—èŠ‚æµè½¬æ¢æˆJavaå¯¹è±¡çš„è¿‡ç¨‹ã€‚</li></ul><p>åœ¨Javaä¸­åºåˆ—åŒ–ï¼Œæ˜¯å¯¹classå¯¹è±¡è¿›è¡Œæ“ä½œï¼Œè€Œåœ¨C++ä¸­ï¼Œç»“æ„ä½“å®šä¹‰çš„æ•°æ®ç»“æ„å’Œclasså¯¹åº”çš„å¯¹è±¡éƒ½å¯ä»¥åºåˆ—åŒ–ã€‚</p><h2 id="transient"><a href="#transient" class="headerlink" title="transient"></a>transient</h2><p>ä½¿ç”¨<strong>transient</strong>å…³é”®å­—ï¼Œé˜»æ­¢è¢«ä¿®é¥°çš„å˜é‡è¿›è¡Œåºåˆ—åŒ–ï¼Œå¯¹è±¡è¢«ååºåˆ—åŒ–æ—¶ï¼Œè¢«ä¿®é¥°çš„å˜é‡ä¸ä¼šè¢«æŒä¹…åŒ–å’Œæ¢å¤ã€‚</p><ul><li>transientåªèƒ½ä¿®é¥°å˜é‡ï¼Œä¸èƒ½ä¿®é¥°æ–¹æ³•ã€ç±»ã€‚</li><li>transientä¿®é¥°çš„å˜é‡ï¼Œååºåˆ—åŒ–åå…¶å˜é‡å€¼ç½®ä¸ºç±»å‹é»˜è®¤å€¼ã€‚</li><li>staticå˜é‡ä¸ä¼šåºåˆ—åŒ–ã€‚å› ä¸ºstaticä¸å±äºä»»ä½•å¯¹è±¡ï¼Œåªå±äºç±»æœ¬èº«ã€‚</li></ul><h2 id="é”®ç›˜è¾“å…¥"><a href="#é”®ç›˜è¾“å…¥" class="headerlink" title="é”®ç›˜è¾“å…¥"></a>é”®ç›˜è¾“å…¥</h2><ul><li><p>Scanner</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Scanner input = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">String s  = input.nextLine();</span><br><span class="line">input.close();</span><br></pre></td></tr></table></figure></li><li><p>BufferedReaderï¼ˆæ›´å¿«ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BufferedReader input = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</span><br><span class="line">String s = input.readLine();</span><br></pre></td></tr></table></figure></li></ul><h2 id="IOæµ"><a href="#IOæµ" class="headerlink" title="IOæµ"></a>IOæµ</h2><ul><li>è¾“å…¥æµã€è¾“å‡ºæµ</li><li>å­—èŠ‚æµã€å­—ç¬¦æµï¼ˆæœ‰å­—ç¬¦æµæ›´åŠ æ–¹ä¾¿æˆ‘ä»¬å¯¹ä¸€äº›æ–‡ä»¶å­—ç¬¦çš„æ“ä½œï¼Œå¹¶éä½¿ç”¨å­—èŠ‚å¤„ç†æ˜¯æœ€å¥½çš„ï¼Œåˆ†æƒ…å†µï¼‰</li><li>èŠ‚ç‚¹æµã€å¤„ç†æµ</li></ul><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/22.png" alt="22.png"></p><p><img src="https://cdn.jsdelivr.net/gh/aidianfirst/image/23.png" alt="23.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;åŸºæœ¬æ•°æ®ç±»å‹&quot;&gt;&lt;a href=&quot;#åŸºæœ¬æ•°æ®ç±»å‹&quot; class=&quot;headerlink&quot; title=&quot;åŸºæœ¬æ•°æ®ç±»å‹&quot;&gt;&lt;/a&gt;åŸºæœ¬æ•°æ®ç±»å‹&lt;/h1&gt;&lt;h2 id=&quot;8ç§åŸºæœ¬æ•°æ®ç±»å‹åŠåŒ…è£…ç±»&quot;&gt;&lt;a href=&quot;#8ç§åŸºæœ¬æ•°æ®ç±»å‹åŠåŒ…è£…ç±»&quot; class=&quot;head</summary>
      
    
    
    
    <category term="å…«è‚¡" scheme="http://aidianfirst.com/categories/%E5%85%AB%E8%82%A1/"/>
    
    
  </entry>
  
</feed>
